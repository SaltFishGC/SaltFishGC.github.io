---
title: é…ç½®ä¸­å¿ƒ
date: 2026-2-8
---

Nacosï¼ˆ**Dynamic Naming and Configuration Service**ï¼‰æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„ **æœåŠ¡å‘ç° + é…ç½®ç®¡ç†** ä¸­é—´ä»¶ï¼Œä½œä¸º Spring Cloud ç”Ÿæ€çš„é‡è¦ç»„ä»¶ï¼Œå…¶**é…ç½®ç®¡ç†ï¼ˆConfiguration Managementï¼‰** åŠŸèƒ½å¯æ›¿ä»£ Spring Cloud Configï¼Œæä¾›**åŠ¨æ€ã€é›†ä¸­ã€å®æ—¶ç”Ÿæ•ˆ**çš„å¤–éƒ¨åŒ–é…ç½®èƒ½åŠ›ã€‚

### åŸºæœ¬æ¦‚å¿µ

**ä¸ºä»€ä¹ˆ**éœ€è¦é…ç½®ä¸­å¿ƒï¼š

| ä¼ ç»Ÿæ–¹å¼ï¼ˆå¦‚ application.ymlï¼‰         | Nacos é…ç½®ä¸­å¿ƒ                        |
| :------------------------------------- | :------------------------------------ |
| é…ç½®å†™æ­»åœ¨é¡¹ç›®ä¸­ï¼Œæ”¹é…ç½®éœ€é‡æ–°æ‰“åŒ…éƒ¨ç½² | é…ç½®å¤–ç½®ï¼Œ**è¿è¡Œæ—¶åŠ¨æ€ä¿®æ”¹**          |
| å¤šç¯å¢ƒï¼ˆdev/test/prodï¼‰éœ€ç»´æŠ¤å¤šä»½æ–‡ä»¶  | **ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ç¯å¢ƒé…ç½®**              |
| æ— æ³•ç°åº¦å‘å¸ƒé…ç½®                       | æ”¯æŒ **é…ç½®ç‰ˆæœ¬ã€å›æ»šã€ç°åº¦**         |
| æ— å˜æ›´è®°å½•å’Œæƒé™æ§åˆ¶                   | æä¾› **æ“ä½œå®¡è®¡ã€æƒé™ç®¡ç†ã€ç›‘å¬é€šçŸ¥** |

nacosçš„é…ç½®ç®¡ç†**æ¦‚å¿µ**ï¼š

| æ¦‚å¿µ          | è¯´æ˜                                                         |
| :------------ | :----------------------------------------------------------- |
| **Namespace** | **æœ€é«˜çº§éš”ç¦»å•ä½**ï¼Œç”¨äºåŒºåˆ†**ä¸åŒç¯å¢ƒ**ï¼ˆå¦‚ dev / test / prodï¼‰æˆ–**ä¸åŒç§Ÿæˆ·** |
| **Group**     | é…ç½®åˆ†ç»„ï¼Œé»˜è®¤ `DEFAULT_GROUP`ï¼Œå¯ç”¨äºåŒºåˆ†é¡¹ç›®æˆ–ç¯å¢ƒ         |
| **Data ID**   | é…ç½®çš„å”¯ä¸€æ ‡è¯†ï¼Œé€šå¸¸æ ¼å¼ï¼š`${prefix}-${spring.profiles.active}.${file-extension}` ä¾‹å¦‚ï¼š`user-service-dev.yaml` |
| **é…ç½®å†…å®¹**  | æ”¯æŒ **Propertiesã€YAMLã€JSONã€TEXT** ç­‰æ ¼å¼                 |

> ğŸ“Œ æ¨èç»“æ„ï¼š
>
> - **Namespace** â†’ ç¯å¢ƒï¼ˆdev / prodï¼‰
> - **Group** â†’ é¡¹ç›®æˆ–å¾®æœåŠ¡ç»„ï¼ˆå¦‚ `USER_GROUP`ï¼‰
> - **Data ID** â†’ å…·ä½“æœåŠ¡é…ç½®ï¼ˆå¦‚ `order-service.yaml`ï¼‰

nacosçš„é…ç½®è·å–**æµç¨‹**ï¼š

```
 [åº”ç”¨å¯åŠ¨]
     â†“
1. åˆå§‹åŒ– Bootstrap Contextï¼ˆæˆ– ConfigData åŠ è½½å™¨ï¼‰
     â†“
2. æ ¹æ®é…ç½®ç¡®å®šè¦åŠ è½½çš„ Data ID åˆ—è¡¨ï¼š
   - ä¸»é…ç½®ï¼š${spring.application.name}-${spring.profiles.active}.${file-extension}
   - å…±äº«é…ç½®ï¼šshared-configs ä¸­çš„ dataId åˆ—è¡¨
     â†“
3. å‘ Nacos Server å‘èµ· HTTP GET è¯·æ±‚ï¼ˆ/nacos/v1/cs/configsï¼‰
   å‚æ•°ï¼šdataId, group, namespace, tenant
     â†“
4. Nacos Server æŸ¥è¯¢é…ç½®ï¼ˆä»å†…å­˜ç¼“å­˜ â†’ æ•°æ®åº“ï¼‰
     â†“
5. è¿”å›é…ç½®å†…å®¹ï¼ˆå­—ç¬¦ä¸²ï¼‰ç»™å®¢æˆ·ç«¯
     â†“
6. å®¢æˆ·ç«¯å°†é…ç½®è§£æä¸º PropertySourceï¼Œæ³¨å…¥ Spring Environment
     â†“
7. Spring åˆ›å»º DataSourceã€MyBatis ç­‰ Beanï¼ˆä½¿ç”¨ Nacos é…ç½®ï¼‰
     â†“
8. ã€è¿è¡Œæ—¶ã€‘å¯åŠ¨é•¿è½®è¯¢ï¼ˆLong Pollingï¼‰ç›‘å¬é…ç½®å˜æ›´
     â†“
9. ç”¨æˆ·åœ¨ Nacos æ§åˆ¶å°ä¿®æ”¹é…ç½® â†’ Server æ¨é€å˜æ›´é€šçŸ¥
     â†“
10. å®¢æˆ·ç«¯é‡æ–°æ‹‰å–æœ€æ–°é…ç½® â†’ è§¦å‘ @RefreshScope Bean é‡å»º
```



### ä½¿ç”¨æ³¨æ„äº‹é¡¹

#### DataIDå¿…é¡»åŠ ä¸Šæ–‡ä»¶åç¼€

åç¼€æ²¡åŠ /é”™è¯¯ä¹Ÿä¼šå¯¼è‡´nacosæ‰¾ä¸åˆ°æ‰€éœ€è¦çš„é…ç½®æ–‡ä»¶ã€‚

#### ä¸åŒ Namespace ä¹‹é—´çš„é…ç½®å®Œå…¨éš”ç¦»ï¼Œæ— æ³•äº’ç›¸è®¿é—®

devï¼Œpropç­‰namespaceåœ¨æœåŠ¡çš„bootstrap/applicationä¸­åªèƒ½æŒ‡å®šä¸€ä¸ªï¼ä¸å¯åœ¨åŒä¸€æœåŠ¡ä¸­ä½¿ç”¨å¤šä¸ªä¸åŒnamespaceçš„é…ç½®æ–‡ä»¶ï¼

#### ä½¿ç”¨bootstrapä½œä¸ºå¼•å…¥nacosé…ç½®æ–‡ä»¶

> **Spring Boot æœ¬èº«å¹¶ä¸å¼ºåˆ¶è¦æ±‚ä½¿ç”¨ `bootstrap.yml`ï¼Œä½† Spring Cloudï¼ˆåŒ…æ‹¬ Nacos Configï¼‰ä¸ºäº†ä¿è¯â€œé…ç½®æ—©äºåº”ç”¨ä¸Šä¸‹æ–‡åˆå§‹åŒ–â€ï¼Œå¿…é¡»ä½¿ç”¨ `bootstrap` é˜¶æ®µåŠ è½½é…ç½®ä¸­å¿ƒçš„è¿æ¥ä¿¡æ¯ã€‚**

Spring Boot åº”ç”¨å¯åŠ¨æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š

```
1. åˆ›å»º Bootstrap Contextï¼ˆå¼•å¯¼ä¸Šä¸‹æ–‡ï¼‰
   â””â”€â”€ åŠ è½½ bootstrap.yml / bootstrap.properties
   â””â”€â”€ åˆå§‹åŒ– Spring Cloud ç»„ä»¶ï¼ˆå¦‚ Nacos Clientï¼‰
   â””â”€â”€ ä» Nacos æ‹‰å–è¿œç¨‹é…ç½®

2. åˆ›å»º Application Contextï¼ˆä¸»åº”ç”¨ä¸Šä¸‹æ–‡ï¼‰
   â””â”€â”€ åŠ è½½ application.yml
   â””â”€â”€ åˆ›å»º @Beanï¼ˆå¦‚ DataSourceã€MyBatis ç­‰ï¼‰
   â””â”€â”€ å¯åŠ¨ Web å®¹å™¨
```

> âš ï¸ **å…³é”®ç‚¹**ï¼š
> **DataSourceã€Redis ç­‰ Bean çš„åˆ›å»ºä¾èµ– `application.yml` ä¸­çš„é…ç½®**ï¼Œ
> è€Œè¿™äº›é…ç½®å¯èƒ½æ¥è‡ª **Nacos**ã€‚
> æ‰€ä»¥å¿…é¡»åœ¨ **Application Context åˆå§‹åŒ–ä¹‹å‰** å°±è¿æ¥ Nacos å¹¶æ‹‰å–é…ç½®ï¼

è¿™å°±éœ€è¦ä¸€ä¸ª **æ¯” `application.yml` æ›´æ—©åŠ è½½çš„é…ç½®æ–‡ä»¶** â†’ **`bootstrap.yml`**

å¦‚æœä¸ç”¨**`bootstrap.yml`**ï¼š

1. Spring å…ˆè¯» `application.yml`
2. å‘ç° `datasource.url` æœªå®šä¹‰ï¼ˆå› ä¸º Nacos è¿˜æ²¡è¿ï¼‰
3. å°è¯•åˆ›å»º `DataSource` Bean â†’ æŠ¥é”™ï¼š`url is null`
4. **æ ¹æœ¬æ²¡æœºä¼šå»è¿ Nacosï¼**

**ä½†å…¶å®æ–°ç‰ˆæœ¬æˆ‘ä»¬å¯ä»¥ç›´è¿nacosï¼Œåªè¦æŒ‰ä»¥ä¸‹é…ç½®ä¹Ÿå¯ä»¥ä¸å»å‡†å¤‡bootstrapæ–‡ä»¶ï¼š**

```yml
# application.yml
spring:
  application:
    name: user-service

  config:
    import: 
      - optional:nacos:user-service.yaml  # ä» Nacos åŠ è½½é…ç½®

  cloud:
    nacos:
      config:
        server-addr: 127.0.0.1:8848
        group: DEFAULT_GROUP
        namespace: ""  # public å‘½åç©ºé—´
```

> **è€ç‰ˆæœ¬ä¸èƒ½åœ¨ä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­å®Œæˆï¼Œæ˜¯å› ä¸º Nacos å®¢æˆ·ç«¯ä¾èµ– Spring å®¹å™¨ï¼Œè€Œå®¹å™¨åˆ›å»ºåˆä¾èµ–é…ç½®ï¼Œå½¢æˆæ­»é”ï¼›
> æ–°ç‰ˆæœ¬é€šè¿‡ Config Data API è®© Nacos å®¢æˆ·ç«¯è„±ç¦»å®¹å™¨ï¼Œä»¥â€œé…ç½®åŠ è½½æ’ä»¶â€å½¢å¼åœ¨å®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ç›´æ¥æ‹‰å–é…ç½®ï¼Œä»è€Œæ‰“ç ´æ­»é”ã€‚**
>
> æ–°ç‰ˆæœ¬è£…è½½contextæµç¨‹ï¼š
>
> 1. **å¯åŠ¨ Application Context**
> 2. **è§£æ `application.yml`ï¼Œé‡åˆ° `spring.config.import: nacos:xxx`**
> 3. æš‚åœå¸¸è§„é…ç½®åŠ è½½ï¼Œè½¬è€Œï¼š
>    - ä½¿ç”¨ **å†…ç½®çš„ã€é Spring å®¹å™¨ç®¡ç†çš„ Nacos å®¢æˆ·ç«¯**ï¼ˆçº¯ Java å·¥å…·ç±»ï¼‰
>    - ç›´æ¥è°ƒç”¨ Nacos HTTP API æ‹‰å–é…ç½®ï¼ˆä¸ä¾èµ– `@Bean`ï¼‰
> 4. **å°†æ‹‰å–çš„é…ç½®ä½œä¸ºæ–°çš„ PropertySource æ’å…¥ Environment**
> 5. **ç»§ç»­å®Œæˆå‰©ä½™é…ç½®è§£æå’Œ Bean åˆ›å»º**

| ç‰¹æ€§                 | `bootstrap.yml`æ–¹å¼                     | `application.yml + spring.config.import` |
| :------------------- | :-------------------------------------- | :--------------------------------------- |
| **Spring Boot ç‰ˆæœ¬** | æ‰€æœ‰ç‰ˆæœ¬ï¼ˆåŒ…æ‹¬ 2.4+ï¼‰                   | **ä»… Spring Boot 2.4+**                  |
| **æ˜¯å¦éœ€è¦é¢å¤–ä¾èµ–** | éœ€è¦ `spring-cloud-starter-bootstrap`   | ä¸éœ€è¦ï¼ˆå†…ç½®æ”¯æŒï¼‰                       |
| **é…ç½®åŠ è½½é¡ºåº**     | Bootstrap Context â†’ Application Context | å•ä¸€ä¸Šä¸‹æ–‡ï¼ŒæŒ‰ `import` é¡ºåºåŠ è½½         |
| **ç¤¾åŒºæˆç†Ÿåº¦**       | âœ… éå¸¸æˆç†Ÿï¼Œæ–‡æ¡£ä¸°å¯Œ                    | è¾ƒæ–°ï¼Œéƒ¨åˆ†ä¼ä¸šå°šæœªè¿ç§»                   |
| **æ¨èåœºæ™¯**         | ä¼ ç»Ÿé¡¹ç›®ã€ç¨³å®šç”Ÿäº§ç¯å¢ƒ                  | æ–°é¡¹ç›®ã€æ‹¥æŠ± Spring Boot æ–°ç‰¹æ€§          |

> å½“ç„¶åœ¨æ–°ç‰ˆæœ¬ä¸­ä½¿ç”¨bootstrapä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæ›´åŠ ä¿é™©ä¸€ç‚¹



### é…ç½®ä¸ä½¿ç”¨

#### Nacoså‡†å¤‡é…ç½®æ–‡ä»¶

è®¿é—®8848ï¼Œæˆ‘ä»¬å…ˆæ–°å»ºä¸€ä¸ª**jdbc**çš„ç»Ÿä¸€é…ç½®æ–‡ä»¶ï¼š

```yml
spring:
  datasource:
    url: jdbc:mysql://${hm.db.host:192.168.0.200}:${hm.db.port:3306}/${hm.db.database}?useUnicode=true&characterEncoding=UTF-8&autoReconnect=true&serverTimezone=Asia/Shanghai
    driver-class-name: com.mysql.cj.jdbc.Driver
    username: ${hm.db.un:root}
    password: ${hm.db.pw:123}
mybatis-plus:
  configuration:
    default-enum-type-handler: com.baomidou.mybatisplus.core.handlers.MybatisEnumTypeHandler
  global-config:
    db-config:
      update-strategy: not_null
      id-type: auto	
```

>  `${...}` å ä½ç¬¦è‹¥å¸¦ä¸Š`${path:value}`ä¸­çš„`:value`ï¼Œå…¶ä¸­çš„valueå°±æ˜¯é»˜è®¤å€¼ï¼ˆä¸æ˜¾ç¤ºå£°æ˜è‡ªåŠ¨ä½¿ç”¨é»˜è®¤å€¼ï¼‰
>
> **è¿™æ®µé…ç½®ä¸­çš„ `${...}` å ä½ç¬¦ï¼ˆåŒ…æ‹¬é»˜è®¤å€¼å¦‚ `${hm.db.host:192.168.0.200}`ï¼‰æ˜¯ç”± Spring Boot çš„é…ç½®è§£ææœºåˆ¶å®Œæˆçš„ï¼Œè€Œä¸æ˜¯ç”± Nacos æˆ–å…¶ä»–å¤–éƒ¨ç»„ä»¶å¤„ç†çš„ã€‚**

å†æä¸€ä¸ªlogçš„ç»Ÿä¸€é…ç½®æ–‡ä»¶ï¼š

```yml
logging:
  level:
    com.hmall: debug
  pattern:
    dateformat: HH:mm:ss:SSS
  file:
    path: "logs/${spring.application.name}"
```

å’Œswaggerçš„ç»Ÿä¸€é…ç½®ï¼š

```yml
knife4j:
  enable: true
  openapi:
    title: ${hm.swagger.title:é»‘é©¬å•†åŸæ¥å£æ–‡æ¡£}
    description: ${hm.swagger.description:é»‘é©¬å•†åŸæ¥å£æ–‡æ¡£}
    email: ${hm.swagger.email:zhanghuyi@itcast.cn}
    concat: ${hm.swagger.concat:è™å“¥}
    url: https://www.itcast.cn
    version: v1.0.0
    group:
      default:
        group-name: default
        api-rule: package
        api-rule-resources:
          - ${hm.swagger.package}
```

è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†Nacosé…ç½®ä¸­å¿ƒçš„é…ç½®æ–‡ä»¶å‡†å¤‡ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å®ŒæˆSpringBooté¡¹ç›®çš„é…ç½®ï¼š



#### å¼•å…¥ä¾èµ–

åœ¨**çˆ¶é¡¹ç›®pom**ä¸­åšå¥½ä¾èµ–ç‰ˆæœ¬ç®¡ç†ï¼š

```xml
<!--spring cloud-->
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-dependencies</artifactId>
    <version>${spring-cloud.version}</version>
    <type>pom</type>
    <scope>import</scope>
</dependency>
<!--spring cloud alibaba-->
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-alibaba-dependencies</artifactId>
    <version>${spring-cloud-alibaba.version}</version>
    <type>pom</type>
    <scope>import</scope>
</dependency>
```

> æ³¨æ„alibabaä¸cloudæœ¬ä½“ç‰ˆæœ¬æ˜ å°„å…³ç³»ï¼

ç„¶åå†åœ¨éœ€è¦çš„**å­é¡¹ç›®pom**ä¸­ç›´æ¥å¼•å…¥ä¾èµ–å³å¯ï¼š

```xml
  <!--nacosé…ç½®ç®¡ç†-->
  <dependency>
      <groupId>com.alibaba.cloud</groupId>
      <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>
  </dependency>
  <!--è¯»å–bootstrapæ–‡ä»¶-->
  <dependency>
      <groupId>org.springframework.cloud</groupId>
      <artifactId>spring-cloud-starter-bootstrap</artifactId>
  </dependency>
```



#### æœ¬åœ°é…ç½®æ–‡ä»¶ç¼–å†™

é¦–å…ˆæ˜¯å¼•å…¥nacosé…ç½®çš„bootstrapæ–‡ä»¶ï¼š

```YML
spring:
  application:
    name: cart-service # æœåŠ¡åç§°
  profiles:
    active: dev
  cloud:
    nacos:
      server-addr: 192.168.0.200:8848 # nacosåœ°å€
      config:
        file-extension: yaml # æ–‡ä»¶åç¼€å
        shared-configs: # å…±äº«é…ç½®
          - dataId: shared-jdbc.yml # å…±äº«mybatisé…ç½®
          - dataId: shared-log.yml # å…±äº«æ—¥å¿—é…ç½®
          - dataId: shared-swagger.yml # å…±äº«æ—¥å¿—é…ç½®
```

> ä¸å£°æ˜å‘½åç©ºé—´namespaceä»¥åŠç»„groupåˆ™ä½¿ç”¨**é»˜è®¤å€¼**ï¼š
>
> | é…ç½®é¡¹        | é»˜è®¤å€¼                              | è¯´æ˜                                       |
> | :------------ | :---------------------------------- | :----------------------------------------- |
> | **Namespace** | `public`ï¼ˆå®é™… ID ä¸ºç©ºå­—ç¬¦ä¸² `""`ï¼‰ | æ‰€æœ‰æœªæŒ‡å®š namespace çš„å®¢æˆ·ç«¯éƒ½è¿åˆ° public |
> | **Group**     | `DEFAULT_GROUP`                     | Nacos é…ç½®çš„é»˜è®¤åˆ†ç»„                       |
>
> ç­‰ä»·äºï¼š
>
> ```yml
> spring:
>   cloud:
>     nacos:
>       server-addr: 192.168.150.101
>       config:
>         namespace: ""                # â† é»˜è®¤æ˜¯ publicï¼ˆID ä¸ºç©ºï¼‰
>         group: DEFAULT_GROUP         # â† é»˜è®¤åˆ†ç»„
>         file-extension: yaml
>         shared-configs:
>           - dataId: shared-jdbc.yml
>             group: DEFAULT_GROUP     # â† æ¯ä¸ª shared-config ä¹Ÿé»˜è®¤ç”¨ DEFAULT_GROUP
>           - dataId: shared-log.yml
>             group: DEFAULT_GROUP
>           - dataId: shared-swagger.yml
>             group: DEFAULT_GROUP
> ```

ç„¶åæ˜¯åŸºæœ¬çš„applicationæ–‡ä»¶ï¼š

```YML
server:
  port: 8082
feign:
  okhttp:
    enabled: true # å¼€å¯OKHttpè¿æ¥æ± æ”¯æŒ
hm:
  swagger:
    title: è´­ç‰©è½¦æœåŠ¡æ¥å£æ–‡æ¡£
    package: com.hmall.cart.controller
  db:
    database: hm-cart
```

ç„¶åå°±å¯ä»¥è®©SpringBooté¡¹ç›®ä»Nacosä¸­è·å–é…ç½®äº†ã€‚



### é…ç½®çƒ­æ›´æ–°

ä¸šåŠ¡ä¸­æˆ‘ä»¬å¸¸å¸¸ä¼šä½¿ç”¨ä¸€äº›å†™åœ¨ymlç­‰**é…ç½®æ–‡ä»¶é‡Œçš„å‚æ•°**ç”¨äºå†³å®šé˜ˆå€¼ç­‰æ•°æ®ï¼Œéšåä½¿ç”¨`@Value`ï¼Œ`@ConfigurationProperties`ä»¥åŠEnvironmentç­‰æ–¹å¼ç›´æ¥**æ³¨å…¥**åˆ°æŒ‡å®šBeanå¯¹è±¡ä¸­å­˜å‚¨ä»¥åŠä½¿ç”¨ã€‚ä½†æ˜¯è¿™æ ·çš„æ“ä½œåœ¨æœ¬åœ°ä½¿ç”¨æ—¶ä¸€æ—¦åº”ç”¨è¿è¡Œèµ·æ¥æˆ‘ä»¬å°±åªèƒ½**ä¸€ä¸ªå‚æ•°ç”¨åˆ°é‡å¯**äº†ï¼Œæœ‰æ²¡æœ‰**ä¸éœ€è¦é‡å¯ä¹Ÿå¯ä»¥å®ç°å…³é”®å‚æ•°å˜æ›´**çš„æ“ä½œï¼Ÿ

æˆ‘ä»¬å¯ä»¥ç»“åˆnacosæä¾›çš„é…ç½®ç®¡ç†+`@ConfigurationProperties` **+** `@RefreshScope`æ¥å®ç°ç»Ÿä¸€çš„é…ç½®ç®¡ç†ï¼š

é¦–å…ˆåœ¨nacoså®Œæˆå‚æ•°çš„æŒ‡å®šï¼š

```yml
# nacosä¸­çš„cart-service.ymlæ–‡ä»¶
hm:
 cart:
  maxItems: 10
```

ç„¶åå†åœ¨å¯¹åº”SpringBooté¡¹ç›®ä¸­åŠ å…¥æ–°é…ç½®æ–‡ä»¶çš„å£°æ˜ï¼š

```yml
spring:
  application:
    name: cart-service # æœåŠ¡åç§°
  profiles:
    active: dev
  cloud:
    nacos:
      server-addr: 192.168.0.200:8848 # nacosåœ°å€
      config:
        file-extension: yaml # æ–‡ä»¶åç¼€å
        shared-configs: # å…±äº«é…ç½®
          - dataId: shared-jdbc.yml # å…±äº«mybatisé…ç½®
          - dataId: shared-log.yml # å…±äº«æ—¥å¿—é…ç½®
          - dataId: shared-swagger.yml # å…±äº«æ—¥å¿—é…ç½®
          - dataId: cart-service.yml # æœåŠ¡é…ç½®
```

æˆ‘ä»¬å°±å¯ä»¥ä»applicationContextä¸Šä¸‹æ–‡ä¸­è·å–åˆ°æ•°æ®äº†ï¼š

```java
@Component
@ConfigurationProperties(prefix = "hm.cart")
@RefreshScope
@Data
public class CartProperties {
    // æœ€å¤§è´­ç‰©è½¦æ•°é‡
    private Integer maxItems;
}
```

propertiesç±»åœ¨ä¸šåŠ¡ä¸­æ³¨å…¥å³å¯ä½¿ç”¨æ•°æ®äº†ï¼š

```java
@Service
@RequiredArgsConstructor
public class CartServiceImpl extends ServiceImpl<CartMapper, Cart> implements ICartService {
    private final CartProperties cartProperties;
    
    ......
        
    private void checkCartsFull(Long userId) {
        int count = lambdaQuery().eq(Cart::getUserId, userId).count();
        if (count >= cartProperties.getMaxItems()) { // ç›´æ¥è·å–åˆ°æ•°æ®
            throw new BizIllegalException(StrUtil.format("ç”¨æˆ·è´­ç‰©è½¦è¯¾ç¨‹ä¸èƒ½è¶…è¿‡{}", 10));
        }
    }
}
```

åŸºäºnacosçš„æ•°æ®é…ç½®æ–‡ä»¶åœ¨ä½¿ç”¨nacosæ›´æ–°æ—¶ä¼šç›´æ¥æ¨é€åˆ°ä½¿ç”¨è¯¥é…ç½®æ–‡ä»¶çš„æœåŠ¡ä¸­ï¼Œè¯¥æœåŠ¡ä¸ç”¨é‡å¯å³å¯æ›´æ–°å¯¹åº”æ•°æ®ã€‚
