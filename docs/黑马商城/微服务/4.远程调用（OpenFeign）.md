---
title: è¿œç¨‹è°ƒç”¨
date: 2026-2-1
---

### OpenFeign

**OpenFeign**ï¼ˆå…¨ç§°ï¼šSpring Cloud OpenFeignï¼‰æ˜¯ Spring Cloud å¯¹ **Netflix Feign** çš„å¢å¼ºå’Œå°è£…ï¼Œæ˜¯ä¸€ä¸ª**å£°æ˜å¼çš„ HTTP å®¢æˆ·ç«¯**ï¼Œç”¨äºç®€åŒ–å¾®æœåŠ¡ä¹‹é—´çš„è¿œç¨‹è°ƒç”¨ï¼ˆä¹Ÿå³**å¼ºåŒ–ç‰ˆhttpå®¢æˆ·ç«¯**ï¼‰

> ğŸ¯ æ ¸å¿ƒç›®æ ‡ï¼š**è®©è¿œç¨‹æœåŠ¡è°ƒç”¨åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ç®€å•ã€‚**

#### é…ç½®

é¦–å…ˆå¯¼å…¥pomä¾èµ–ï¼š

```XML
  <!--openFeign-->
  <dependency>
      <groupId>org.springframework.cloud</groupId>
      <artifactId>spring-cloud-starter-openfeign</artifactId>
  </dependency>
  <!--è´Ÿè½½å‡è¡¡å™¨-->
  <dependency>
      <groupId>org.springframework.cloud</groupId>
      <artifactId>spring-cloud-starter-loadbalancer</artifactId>
  </dependency>
```

> ç‰ˆæœ¬å·²ç”±çˆ¶pomçš„ä¾èµ–ç®¡ç†é”å®šï¼š
>
> ```xml
> <dependency>
>     <groupId>org.springframework.cloud</groupId>
>     <artifactId>spring-cloud-dependencies</artifactId>
>     <version>${spring-cloud.version}</version>
>     <type>pom</type>
>     <scope>import</scope>
> </dependency>
> ```

ç„¶åå¯åŠ¨feignClientï¼š

```java
@SpringBootApplication
@EnableFeignClients // å¯ç”¨ OpenFeign
public class OrderApplication {
    public static void main(String[] args) {
        SpringApplication.run(OrderApplication.class, args);
    }
}
```



#### ä½¿ç”¨å£°æ˜è°ƒç”¨

æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥åœ¨**éœ€è¦å…¶ä»–æœåŠ¡çš„æœåŠ¡**é‚£è¾¹å£°æ˜**æ‰€éœ€çš„æœåŠ¡åŠå…¶æ–¹æ³•**äº†ï¼š

```java
@FeignClient("item-service")
public interface ItemClient {

    @GetMapping("/items")
    List<ItemDTO> queryItemByIds(@RequestParam("ids") Collection<Long> ids);
}
```

è¿™é‡Œåªéœ€è¦å£°æ˜æ¥å£ï¼Œæ— éœ€å®ç°æ–¹æ³•ã€‚æ¥å£ä¸­çš„å‡ ä¸ªå…³é”®ä¿¡æ¯ï¼š

- `@FeignClient("item-service")` ï¼šå£°æ˜æœåŠ¡åç§°ï¼ˆå³**ymlé…ç½®æ–‡ä»¶**ä¸­æœåŠ¡åç§°ï¼‰
- `@GetMapping` ï¼šå£°æ˜è¯·æ±‚æ–¹å¼
- `@GetMapping("/items")` ï¼šå£°æ˜è¯·æ±‚è·¯å¾„
- `@RequestParam("ids") Collection<Long> ids` ï¼šå£°æ˜è¯·æ±‚å‚æ•°
- `List<ItemDTO>` ï¼šè¿”å›å€¼ç±»å‹

å®Œæˆäº†å¯¹éœ€è¦æ–¹æ³•çš„å°è£…ä»¥åï¼Œæˆ‘ä»¬åˆ°ä¸šåŠ¡ä¸­ä½¿ç”¨è¿™ä¸ªå°è£…æ¥å£è¿›è¡Œè°ƒç”¨ï¼š

```java
@RequiredArgsConstructor
public class CartServiceImpl extends ServiceImpl<CartMapper, Cart> implements ICartService {
    // openfeignå°è£…æ¥å£
    private final ItemClient itemClient;
```

```java
    private void handleCartItems(List<CartVO> vos) {
        // 1.è·å–å•†å“id
        Set<Long> itemIds = vos.stream().map(CartVO::getItemId).collect(Collectors.toSet());
        // 2.è°ƒç”¨openfeignå°è£…æ¥å£å®Œæˆè¿œç¨‹ä¿¡æ¯æŸ¥è¯¢
        List<ItemDTO> items = itemClient.queryItemByIds(itemIds);
        if (CollUtils.isEmpty(items)) {
            return;
        }
        // 3.è½¬ä¸º id åˆ° itemçš„map
        Map<Long, ItemDTO> itemMap = items.stream().collect(Collectors.toMap(ItemDTO::getId, Function.identity()));
        // 4.å†™å…¥vo
        for (CartVO v : vos) {
            ItemDTO item = itemMap.get(v.getItemId());
            if (item == null) {
                continue;
            }
            v.setNewPrice(item.getPrice());
            v.setStatus(item.getStatus());
            v.setStock(item.getStock());
        }
    }
```



### OpenFeignçš„è¿æ¥æ± 

OpenFeign **æœ¬èº«ä¸ç›´æ¥æä¾›è¿æ¥æ± **ï¼Œä½†å®ƒåº•å±‚ä¾èµ–çš„ **HTTP å®¢æˆ·ç«¯ï¼ˆå¦‚ Apache HttpClient æˆ– OkHttpï¼‰æ”¯æŒè¿æ¥æ± **ã€‚å› æ­¤ï¼Œ**OpenFeign çš„â€œè¿æ¥æ± â€èƒ½åŠ›å®Œå…¨ç”±æ‰€é€‰çš„ HTTP å®¢æˆ·ç«¯å®ç°**ã€‚

åœ¨å¾®æœåŠ¡é«˜é¢‘è°ƒç”¨åœºæ™¯ä¸‹ï¼Œæ¯æ¬¡ HTTP è¯·æ±‚éƒ½æ–°å»º TCP è¿æ¥ï¼ˆä¸‰æ¬¡æ¡æ‰‹ + TLS æ¡æ‰‹ï¼‰ä¼šå¸¦æ¥ï¼š

- é«˜å»¶è¿Ÿ
- é«˜ CPU/å†…å­˜å¼€é”€
- ç«¯å£è€—å°½ï¼ˆTIME_WAITï¼‰

âœ… **è¿æ¥æ± çš„ä½œç”¨**ï¼šå¤ç”¨å·²å»ºç«‹çš„è¿æ¥ï¼Œé¿å…é‡å¤å»ºè¿ï¼Œæå‡æ€§èƒ½å’Œç¨³å®šæ€§ã€‚

#### OpenFeignæ”¯æŒçš„å‡ ç§è¿æ¥æ± ï¼š

| å®¢æˆ·ç«¯                     | æ˜¯å¦é»˜è®¤     | è¿æ¥æ± æ”¯æŒ     | æ€§èƒ½         |
| :------------------------- | :----------- | :------------- | :----------- |
| **Java HttpURLConnection** | âœ… æ˜¯ï¼ˆé»˜è®¤ï¼‰ | âŒ **æ— è¿æ¥æ± ** | å·®           |
| **Apache HttpClient**      | âŒ å¦         | âœ… å¼ºå¤§è¿æ¥æ±    | å¥½           |
| **OkHttp**                 | âŒ å¦         | âœ… å†…ç½®è¿æ¥æ±    | ä¼˜ç§€ï¼ˆæ¨èï¼‰ |

> âš ï¸ **å…³é”®ç»“è®º**ï¼š
> **ä¸è¦ä½¿ç”¨é»˜è®¤çš„ HttpURLConnectionï¼å¿…é¡»æ˜¾å¼å¼•å…¥ HttpClient æˆ– OkHttp å¹¶å¯ç”¨è¿æ¥æ± ã€‚**

#### å¯ç”¨**OkHttp**ä½œä¸ºè¿æ¥æ± 

é¦–å…ˆå¼•å…¥pomä¾èµ–ï¼š

```xml
<!-- ä½¿ç”¨ OkHttp ä½œä¸º Feign çš„åº•å±‚å®¢æˆ·ç«¯ -->
<dependency>
    <groupId>io.github.openfeign</groupId>
    <artifactId>feign-okhttp</artifactId>
</dependency>
```

ç„¶åé€šè¿‡ymlå¯åŠ¨OkHttpï¼ˆæ³¨æ„é¡¶æ ¼ï¼Œå¹¶écloudçš„å­é…ç½®ï¼‰ï¼š

```YAML
feign:
  okhttp:
    enabled: true # å¼€å¯OKHttpåŠŸèƒ½
```



### OpenFeignæœ€ä½³å®è·µ

- æ€è·¯1ï¼šæŠ½å–åˆ°**å¾®æœåŠ¡ä¹‹å¤–**çš„**å…¬å…±**module
- æ€è·¯2ï¼šæ¯ä¸ªå¾®æœåŠ¡è‡ªå·±æŠ½å–ä¸€ä¸ªmodule

ä¸€èˆ¬è€ƒè™‘ç¬¬ä¸€ç§ï¼Œæˆ‘ä»¬å®Œæˆäº†å…¬å…±æ¨¡å—åï¼Œå…¶ä»–æ¨¡å—åªéœ€è¦**å¼•å…¥è¯¥æ¨¡å—**å°±å¯ä»¥ç›´æ¥è°ƒç”¨å†™å¥½çš„æ¥å£äº†ï¼

> ç»Ÿä¸€ç®¡ç†éœ€è¦**ä¸¥æ ¼**è§„åˆ’

ç°åœ¨æˆ‘ä»¬å¼€å§‹æ„å»ºè¿™ä¸ªå…¬å…±æ¨¡å—ï¼Œé¦–å…ˆå¼•å…¥ä¾èµ–ï¼š

```xml
<dependencies>
    <!--open feign-->
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-openfeign</artifactId>
    </dependency>
    <!-- load balancer-->
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-loadbalancer</artifactId>
    </dependency>
    <!-- swagger æ³¨è§£ä¾èµ– -->
    <dependency>
        <groupId>io.swagger</groupId>
        <artifactId>swagger-annotations</artifactId>
        <version>1.6.6</version>
        <scope>compile</scope>
    </dependency>
</dependencies>
```

> åç»­å…¶ä»–æ¨¡å—å¼•å…¥åè‡ªåŠ¨ç»§æ‰¿è¿™äº›ä¾èµ–å°±å¯ä»¥è°ƒç”¨æ¥å£äº†ï¼Œå…¶ä»–æ¨¡å—ä¸ç”¨æ˜¾å¼å¼•å…¥feignä¾èµ–äº†ï¼ˆä½†æ˜¯nacosæ˜¯è¦çš„ï¼ï¼‰

ç„¶åå®Œæˆå¯¹openfeignæ¥å£clientçš„ç¼–å†™ï¼ˆè®°å¾—å¸¦ä¸Šdtoï¼‰

æœ€ååœ¨å…¶ä»–æ¨¡å—å¼•å…¥è¯¥å…¬å…±ä¾èµ–å¹¶ç›´æ¥è°ƒç”¨å¯¹åº”clientå³å¯ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„**æˆ‘ä»¬æ‰€ä½¿ç”¨çš„clientæ­¤æ—¶å¹¶æ²¡æœ‰ä½œä¸ºBeanè¢«æ³¨å…¥Iocå®¹å™¨ä¸­**ï¼Œå› ä¸º**ä¸€ä¸ªæ¨¡å—çš„Springåªä¼šæ‰«æè‡ªå·±æ¨¡å—é¡¹ç›®ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¹¶å¯¼å…¥Bean**ï¼Œæ‰€ä»¥è¿™é‡Œè¿˜éœ€è¦å†**æ‰‹åŠ¨å£°æ˜ä¸€ä¸‹æ‰«æè·¯å¾„**ï¼Œè®©æœ¬é¡¹ç›®å»æ‰«æå…¬å…±æ¨¡å—çš„clientæ–‡ä»¶å¤¹ï¼š

```java
@MapperScan("com.hmall.cart.mapper")
@SpringBootApplication
@EnableFeignClients(basePackages = "com.hmall.api.client")	// åœ¨æ­¤å¤„å£°æ˜å…¬å…±æ¨¡å—çš„clientæ–‡ä»¶å¤¹
public class CartServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(CartServiceApplication.class, args);
    }
}
```



### æ—¥å¿—

OpenFeignåªä¼šåœ¨FeignClientæ‰€åœ¨åŒ…çš„æ—¥å¿—çº§åˆ«ä¸º**DEBUG**æ—¶ï¼Œæ‰ä¼šè¾“å‡ºæ—¥å¿—ã€‚è€Œä¸”å…¶æ—¥å¿—çº§åˆ«æœ‰4çº§ï¼š

- **NONE**ï¼šä¸è®°å½•ä»»ä½•æ—¥å¿—ä¿¡æ¯ï¼Œè¿™æ˜¯é»˜è®¤å€¼ã€‚
- **BASIC**ï¼šä»…è®°å½•è¯·æ±‚çš„æ–¹æ³•ï¼ŒURLä»¥åŠå“åº”çŠ¶æ€ç å’Œæ‰§è¡Œæ—¶é—´
- **HEADERS**ï¼šåœ¨BASICçš„åŸºç¡€ä¸Šï¼Œé¢å¤–è®°å½•äº†è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯
- **FULL**ï¼šè®°å½•æ‰€æœ‰è¯·æ±‚å’Œå“åº”çš„æ˜ç»†ï¼ŒåŒ…æ‹¬å¤´ä¿¡æ¯ã€è¯·æ±‚ä½“ã€å…ƒæ•°æ®ã€‚

Feigné»˜è®¤çš„æ—¥å¿—çº§åˆ«å°±æ˜¯NONEï¼Œæ‰€ä»¥é»˜è®¤æˆ‘ä»¬çœ‹ä¸åˆ°è¯·æ±‚æ—¥å¿—ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨å…¬å…±feignæ¨¡å—ä¸­åŠ å…¥ä¸€ä¸ªconfigæ–‡ä»¶æ¥ä½¿å¾—æ—¥å¿—å¯ä»¥å…¨å±€å¿«é€Ÿé€‰æ‹©æ˜¯å¦ç”Ÿæ•ˆï¼š

```java
public class DefaultFeignClient {
    @Bean
    public Logger.Level feignLoggerLevel() {
        return Logger.Level.FULL;
    }
}
```

> æ³¨æ„æ˜¯feignçš„Logger.Levelï¼Œä¸”ä¸è¦åŠ `@Configuration`æ³¨è§£ï¼

ç„¶ååœ¨`@EnableFeignClients`æ³¨è§£ä¸­åŠ å…¥æ—¥å¿—é…ç½®ï¼š

```java
@MapperScan("com.hmall.cart.mapper")
@SpringBootApplication
@EnableFeignClients(basePackages = "com.hmall.api.client" , defaultConfiguration = DefaultFeignClient.class)
public class CartServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(CartServiceApplication.class, args);
    }
}
```

> `@Bean`ç›¸æ¯”`@Component`èƒ½å¤Ÿé…ç½®æ›´åŠ è¯¦ç»†çš„è®¾ç½®













### EXï¼šgRPC

| ç»´åº¦           | HTTP/1.1 + REST (JSON)                 | gRPC                                                         |
| :------------- | :------------------------------------- | :----------------------------------------------------------- |
| **åè®®åŸºç¡€**   | åŸºäºæ–‡æœ¬çš„ HTTP/1.1ï¼ˆå¯å‡çº§åˆ° HTTP/2ï¼‰ | **å¼ºåˆ¶åŸºäº HTTP/2** äºŒè¿›åˆ¶å¸§                                 |
| **æ•°æ®æ ¼å¼**   | JSON / XMLï¼ˆæ–‡æœ¬ï¼Œå¯è¯»ï¼‰               | **Protocol Buffersï¼ˆProtobufï¼‰**ï¼ˆäºŒè¿›åˆ¶ï¼Œé«˜æ•ˆï¼‰             |
| **ä¼ è¾“æ•ˆç‡**   | ä½“ç§¯å¤§ã€è§£ææ…¢                         | ä½“ç§¯å°ï¼ˆæ¯” JSON å° 3~10 å€ï¼‰ã€è§£æå¿«                         |
| **è¿æ¥æ¨¡å¼**   | è¯·æ±‚-å“åº”ï¼ˆçŸ­è¿æ¥ï¼‰                    | **æ”¯æŒå››ç§æ¨¡å¼**ï¼š â€¢ Unaryï¼ˆä¸€å…ƒï¼‰ â€¢ Server Streaming â€¢ Client Streaming â€¢ Bidirectional Streaming |
| **ç±»å‹å®‰å…¨**   | å¼±ç±»å‹ï¼ˆé æ–‡æ¡£çº¦å®šï¼‰                   | **å¼ºç±»å‹**ï¼ˆ`.proto` æ–‡ä»¶ç”Ÿæˆä»£ç ï¼Œç¼–è¯‘æ—¶æ£€æŸ¥ï¼‰              |
| **è·¨è¯­è¨€**     | é€šç”¨ä½†éœ€æ‰‹åŠ¨å¤„ç†                       | å®˜æ–¹æ”¯æŒ 10+ è¯­è¨€ï¼Œ**è‡ªåŠ¨ç”Ÿæˆå®¢æˆ·ç«¯/æœåŠ¡ç«¯ä»£ç **             |
| **æµè§ˆå™¨æ”¯æŒ** | åŸç”Ÿæ”¯æŒ                               | âŒ ä¸ç›´æ¥æ”¯æŒï¼ˆéœ€ gRPC-Web + Proxyï¼‰                          |
| **å…¸å‹åœºæ™¯**   | å…¬å¼€ APIã€Web å‰ç«¯è°ƒç”¨                 | å†…éƒ¨å¾®æœåŠ¡é€šä¿¡ã€é«˜å¹¶å‘ä½å»¶è¿Ÿç³»ç»Ÿ                             |

- å¯¹å¤– API â†’ ç”¨ **HTTP/REST**ï¼ˆå…¼å®¹æ€§å¥½ï¼‰
- å†…éƒ¨å¾®æœåŠ¡ â†’ ä¼˜å…ˆç”¨ **gRPC**ï¼ˆæ€§èƒ½é«˜ã€å¥‘çº¦å¼ºï¼‰

æˆ‘ä»¬ç°åœ¨ä½¿ç”¨çš„Openfeignæ˜¯ä¸æ”¯æŒgRPCçš„ï¼Œéœ€è¦é‡æ–°å»æ‰¾ä¸€ä¸ªClientæ¥åº”ç”¨å®ƒï¼š

| é—®é¢˜                         | ç­”æ¡ˆ                                                         |
| :--------------------------- | :----------------------------------------------------------- |
| **gRPC vs HTTP**             | gRPC æ›´å¿«ã€æ›´å°ã€æ›´å¼ºç±»å‹ï¼Œé€‚åˆå†…éƒ¨é€šä¿¡ï¼›HTTP æ›´é€šç”¨ï¼Œé€‚åˆå¯¹å¤– |
| **OpenFeign èƒ½ç”¨ gRPC å—ï¼Ÿ** | âŒ ä¸èƒ½ï¼OpenFeign æ˜¯ HTTP å®¢æˆ·ç«¯                             |
| **å¾®æœåŠ¡é—´å¦‚ä½•ç”¨ gRPCï¼Ÿ**    | âœ… ç”¨ `grpc-spring-boot-starter` + `@GrpcClient` + Nacos æœåŠ¡å‘ç° |
| **æœ€ä½³å®è·µ**                 | å¯¹å¤– RESTï¼Œå¯¹å†… gRPCï¼›OpenFeign ç”¨äºç¬¬ä¸‰æ–¹è°ƒç”¨ï¼ŒgRPC ç”¨äºå†…éƒ¨è°ƒç”¨ |

[Grpc æ•´åˆ Nacos SpringBoot æ—¥å¸¸ä½¿ç”¨ï¼ˆJavaç‰ˆæœ¬ï¼‰åŒ…æ‹¬ Jwt è®¤è¯_grpc nacos-CSDNåšå®¢](https://blog.csdn.net/qq_42875345/article/details/130828513)
