---
title: è‡ªåˆ¶SQL
date: 2026-1-29
---

é¢å¯¹å¤æ‚ä¸šåŠ¡ï¼ˆå¤šè¡¨ï¼‰çš„æ—¶å€™æˆ‘ä»¬éš¾å…è¿˜æ˜¯è¦è‡ªå·±å»å†™sqlï¼Œå‰é¢è®²äº†mapperç»“åˆæ¡ä»¶æ„é€ å™¨Wrapperçš„è‡ªåˆ¶sqlï¼Œç°åœ¨æˆ‘ä»¬æ¥å¥½å¥½è¯´è¯´æ³¨è§£å’Œmapperè‡ªåˆ¶sqlçš„è¯¦ç»†ä½¿ç”¨ï¼š

åœ¨ MyBatis-Plusï¼ˆMPï¼‰ä¸­ï¼ŒSQL çš„ç¼–å†™æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼š

1. **æ³¨è§£å¼ SQLï¼ˆAnnotation-based SQLï¼‰**  
2. **XML æ˜ å°„æ–‡ä»¶ SQLï¼ˆMapper XML SQLï¼‰**

ä¸¤è€…å¯å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯æ··åˆä½¿ç”¨ã€‚ä¸‹é¢ä»**å†™æ³•ã€é€‚ç”¨åœºæ™¯ã€ä¼˜ç¼ºç‚¹ã€è¯¦ç»†ç¤ºä¾‹**ç­‰æ–¹é¢è¯¦ç»†è¯´æ˜ã€‚

------

### ä¸€ã€æ³¨è§£å¼ SQLï¼ˆAnnotation-based SQLï¼‰

#### âœ… 1. ä»€ä¹ˆæ˜¯æ³¨è§£å¼ SQLï¼Ÿ

ç›´æ¥åœ¨ Mapper æ¥å£çš„æ–¹æ³•ä¸Šä½¿ç”¨ MyBatis æä¾›çš„æ³¨è§£ï¼ˆå¦‚ `@Select`, `@Insert` ç­‰ï¼‰æ¥å†™ SQLï¼Œ**æ— éœ€ XML æ–‡ä»¶**ã€‚

#### âœ… 2. å¸¸ç”¨æ³¨è§£

| æ³¨è§£             | ç”¨é€”               |
| ---------------- | ------------------ |
| `@Select("SQL")` | æŸ¥è¯¢               |
| `@Insert("SQL")` | æ’å…¥               |
| `@Update("SQL")` | æ›´æ–°               |
| `@Delete("SQL")` | åˆ é™¤               |
| `@Param("name")` | å‚æ•°å‘½åï¼ˆå¿…é¡»ï¼ï¼‰ |

> âš ï¸ MP æœ¬èº«ä¸æä¾›æ–°æ³¨è§£ï¼Œè€Œæ˜¯å¤ç”¨ MyBatis åŸç”Ÿæ³¨è§£ã€‚

------

#### âœ… 3. åŸºæœ¬å†™æ³•ç¤ºä¾‹

```java
public interface UserMapper extends BaseMapper<User> {

    // ç®€å•æŸ¥è¯¢
    @Select("SELECT * FROM user WHERE id = #{id}")
    User selectByIdCustom(Long id);

    // å¸¦æ¡ä»¶çš„åŠ¨æ€æŸ¥è¯¢ï¼ˆéœ€ç”¨ <script>ï¼‰
    @Select({
        "<script>",
        "SELECT * FROM user",
        "WHERE status = #{status}",
        "<if test='name != null and name != \"\"'>",
        "  AND name LIKE CONCAT(#{name}, '%')",
        "</if>",
        "</script>"
    })
    List<User> selectByCondition(@Param("status") Integer status, @Param("name") String name);

    // æ’å…¥ï¼ˆè¿”å›ä¸»é”®ï¼‰
    @Insert("INSERT INTO user(name, age) VALUES(#{name}, #{age})")
    @Options(useGeneratedKeys = true, keyProperty = "id", keyColumn = "id")
    int insertUser(User user);
}
```

> ğŸ”¸ æ³¨æ„ï¼š
>
> - å¿…é¡»ç”¨ `@Param` æ ‡æ³¨å‚æ•°åï¼ˆé™¤éåªæœ‰ä¸€ä¸ªå‚æ•°ä¸”æ˜¯åŸºæœ¬ç±»å‹ï¼‰ã€‚
> - åŠ¨æ€ SQL éœ€åŒ…è£¹åœ¨ `<script>...</script>` ä¸­ã€‚
> - ä¸»é”®å›å¡«éœ€ç”¨ `@Options`ã€‚

------

#### âœ… 4. ä¼˜ç‚¹ä¸ç¼ºç‚¹

| ä¼˜ç‚¹                  | ç¼ºç‚¹                              |
| --------------------- | --------------------------------- |
| æ— éœ€ XMLï¼Œä»£ç é›†ä¸­    | SQL å¯è¯»æ€§å·®ï¼ˆå°¤å…¶å¤æ‚ SQLï¼‰      |
| é€‚åˆç®€å•ã€çŸ­å°çš„ SQL  | åŠ¨æ€ SQL å†™èµ·æ¥ç¹çï¼ˆå­—ç¬¦ä¸²æ‹¼æ¥ï¼‰ |
| å¯åŠ¨å¿«ï¼ˆæ—  XML è§£æï¼‰ | ä¸æ”¯æŒ resultMapï¼ˆå¤æ‚æ˜ å°„å›°éš¾ï¼‰  |
| é€‚åˆå¿«é€ŸåŸå‹å¼€å‘      | é‡æ„æ—¶å­—æ®µåç¡¬ç¼–ç æ˜“å‡ºé”™          |

> ğŸ“Œ **é€‚ç”¨åœºæ™¯**ï¼šç®€å•å•è¡¨æ“ä½œã€ä¸´æ—¶è°ƒè¯•ã€è½»é‡çº§é¡¹ç›®ã€‚

------

### äºŒã€Mapper XML SQLï¼ˆæ¨èä¸»æµæ–¹å¼ï¼‰

#### âœ… 1. ä»€ä¹ˆæ˜¯ Mapper XMLï¼Ÿ

å°† SQL å†™åœ¨ç‹¬ç«‹çš„ `.xml` æ–‡ä»¶ä¸­ï¼Œé€šè¿‡ `namespace` ä¸ Mapper æ¥å£ç»‘å®šã€‚

#### âœ… 2. åŸºæœ¬ç»“æ„

##### ï¼ˆ1ï¼‰Mapper æ¥å£

```java
public interface UserMapper extends BaseMapper<User> {
    
    List<UserVO> selectUserWithDept(@Param("deptId") Long deptId);
    
    void batchUpdateStatus(@Param("ids") List<Long> ids, @Param("status") Integer status);
    
}
```

##### ï¼ˆ2ï¼‰XML æ–‡ä»¶ï¼ˆ`resources/mapper/UserMapper.xml`ï¼‰

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.mapper.UserMapper">

    <!-- æŸ¥è¯¢ï¼šå¤šè¡¨ JOIN -->
    <select id="selectUserWithDept" resultType="com.example.vo.UserVO">
        SELECT 
            u.id, u.name, d.dept_name AS deptName
        FROM user u
        LEFT JOIN department d ON u.dept_id = d.id
        WHERE d.id = #{deptId}
    </select>

    <!-- æ‰¹é‡æ›´æ–° -->
    <update id="batchUpdateStatus">
        UPDATE user
        SET status = #{status}
        WHERE id IN
        <foreach collection="ids" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </update>

</mapper>
```

##### ï¼ˆ3ï¼‰é…ç½®æ‰«æè·¯å¾„ï¼ˆ`application.yml`ï¼‰ï¼ˆxmlæ–‡ä»¶è·¯å¾„ï¼‰

```yaml
mybatis-plus:
  mapper-locations: classpath*:mapper/**/*.xml
  type-aliases-package: com.example.entity
```

> ä½†å¾ˆå¤šäººä¼šæ··æ·† **æ¥å£è·¯å¾„** å’Œ **XML æ–‡ä»¶è·¯å¾„**ã€‚
>
> - **æ¥å£è·¯å¾„**ï¼šç”± `@MapperScan` æŒ‡å®šã€‚
> - **XML æ–‡ä»¶è·¯å¾„**ï¼šç”± MyBatis çš„ `mapperLocations` é…ç½®å†³å®šã€‚
>
> | é¡¹ç›®ç±»å‹    | é…ç½®é¡¹                          | ä½œç”¨                     |
> | :---------- | :------------------------------ | :----------------------- |
> | Spring Boot | `@MapperScan("xxx")`            | æ‰«æ Mapper **æ¥å£**     |
> | Spring Boot | `mybatis-plus.mapper-locations` | æ‰«æ Mapper **XML æ–‡ä»¶** |
>
> **åœ¨ Spring Boot ä¸­é…ç½® XML è·¯å¾„ï¼ˆ**`application.yml`**ï¼‰ï¼š**
>
> ```yml
> mybatis-plus:
>   mapper-locations: classpath*:mapper/**/*.xml  # é»˜è®¤å€¼é€šå¸¸æ˜¯è¿™ä¸ª
>   type-aliases-package: com.example.demo.entity
> ```
>
> ğŸ“Œ é»˜è®¤æƒ…å†µä¸‹ï¼ŒMP ä¼šè‡ªåŠ¨åŠ è½½ `classpath*:mapper/**/*.xml`ï¼Œæ‰€ä»¥å¦‚æœä½ æŠŠ XML æ”¾åœ¨ `src/main/resources/mapper/` ä¸‹ï¼Œé€šå¸¸æ— éœ€é¢å¤–é…ç½®ã€‚

------

#### âœ… 3. XML é«˜çº§ç‰¹æ€§

##### ï¼ˆ1ï¼‰`resultMap`ï¼ˆå¤æ‚æ˜ å°„ï¼‰

```xml
<resultMap id="UserDeptMap" type="UserVO">
    <id property="id" column="id"/>
    <result property="name" column="name"/>
    <association property="department" javaType="Department">
        <id property="id" column="dept_id"/>
        <result property="name" column="dept_name"/>
    </association>
</resultMap>

<select id="selectWithDept" resultMap="UserDeptMap">
    SELECT u.*, d.id AS dept_id, d.name AS dept_name
    FROM user u
    LEFT JOIN department d ON u.dept_id = d.id
</select>
```

##### ï¼ˆ2ï¼‰åŠ¨æ€ SQLï¼ˆ`<if>`, `<choose>`, `<foreach>`ï¼‰

```xml
<select id="selectByCondition" resultType="User">
    SELECT * FROM user
    <where>
        <if test="name != null and name != ''">
            AND name LIKE CONCAT(#{name}, '%')
        </if>
        <if test="minAge != null">
            AND age >= #{minAge}
        </if>
    </where>
</select>
```

##### ï¼ˆ3ï¼‰å¤ç”¨ SQL ç‰‡æ®µï¼ˆ`<sql>` + `<include>`ï¼‰

```xml
<sql id="userColumns">
    id, name, age, email
</sql>

<select id="selectAll" resultType="User">
    SELECT <include refid="userColumns"/> FROM user
</select>
```

------

#### âœ… 4. ä¼˜ç‚¹ä¸ç¼ºç‚¹

| ä¼˜ç‚¹                                            | ç¼ºç‚¹                         |
| ----------------------------------------------- | ---------------------------- |
| SQL å¯è¯»æ€§å¼ºï¼Œæ ¼å¼æ¸…æ™°                          | éœ€ç»´æŠ¤é¢å¤– XML æ–‡ä»¶          |
| æ”¯æŒå¤æ‚æ˜ å°„ï¼ˆ`resultMap`ï¼‰                     | å¯åŠ¨ç¨æ…¢ï¼ˆéœ€è§£æ XMLï¼‰       |
| åŠ¨æ€ SQL è¡¨è¾¾èƒ½åŠ›å¼º                             | è·¯å¾„é…ç½®é”™è¯¯æ˜“å¯¼è‡´æ–¹æ³•æ‰¾ä¸åˆ° |
| ä¸ MP çš„ Wrapper å®Œç¾èåˆï¼ˆ`${ew.sqlSegment}`ï¼‰ | â€”                            |

> ğŸ“Œ **é€‚ç”¨åœºæ™¯**ï¼šä¼ä¸šçº§å¼€å‘ã€å¤æ‚æŸ¥è¯¢ã€å¤šè¡¨å…³è”ã€æŠ¥è¡¨ã€æ‰¹é‡æ“ä½œç­‰ã€‚

------

### ä¸‰ã€æ³¨è§£ SQL vs XML SQL å¯¹æ¯”æ€»ç»“

| ç»´åº¦         | æ³¨è§£ SQL                          | XML SQL               |
| ------------ | --------------------------------- | --------------------- |
| **å¯è¯»æ€§**   | å·®ï¼ˆSQL åœ¨å­—ç¬¦ä¸²ä¸­ï¼‰              | ä¼˜ç§€ï¼ˆæ ¼å¼åŒ–ã€é«˜äº®ï¼‰  |
| **åŠ¨æ€ SQL** | éœ€ `<script>`ï¼Œéš¾ç»´æŠ¤             | åŸç”Ÿæ”¯æŒï¼Œç®€æ´å¼ºå¤§    |
| **å¤æ‚æ˜ å°„** | ä¸æ”¯æŒ `resultMap`                | å®Œå…¨æ”¯æŒ              |
| **ç»´æŠ¤æˆæœ¬** | ä½ï¼ˆå•æ–‡ä»¶ï¼‰                      | ä¸­ï¼ˆéœ€ç®¡ç† XMLï¼‰      |
| **MP é›†æˆ**  | å¯ç”¨ï¼Œä½†æ— æ³•ç”¨ `${ew.sqlSegment}` | å®Œç¾æ”¯æŒ Wrapper æ‹¼æ¥ |
| **å›¢é˜Ÿåä½œ** | SQL ä¸ Java æ··åˆï¼Œä¸æ˜“åˆ†ç¦»        | DBA å¯ç›´æ¥çœ‹ SQL      |
| **æ¨èåº¦**   | â­â­ï¼ˆç®€å•åœºæ™¯ï¼‰                    | â­â­â­â­â­ï¼ˆä¸»æµï¼‰         |

------

### å››ã€æœ€ä½³å®è·µå»ºè®®

1. **ç®€å•å•è¡¨æ“ä½œ** â†’ ä¼˜å…ˆç”¨ MP çš„ `IService` / `BaseMapper`ï¼ˆæ— éœ€å†™ SQLï¼‰ã€‚
2. **å¤æ‚ SQLï¼ˆJOIN/å­æŸ¥è¯¢/èšåˆï¼‰** â†’ **å¿…é¡»ç”¨ XML**ã€‚
3. **ä¸´æ—¶è°ƒè¯•æˆ–æç®€é€»è¾‘** â†’ å¯ç”¨æ³¨è§£ SQLã€‚
4. **æ°¸è¿œä¸è¦åœ¨æ³¨è§£ä¸­å†™è¶…è¿‡ 3 è¡Œçš„ SQL**ã€‚
5. **XML æ–‡ä»¶å‘½åè§„èŒƒ**ï¼š`{Entity}Mapper.xml`ï¼Œæ”¾åœ¨ `resources/mapper/` ä¸‹ã€‚
6. **å­—æ®µæ˜ å°„**ï¼šä¼˜å…ˆç”¨ `resultType`ï¼ˆVO/Entity å­—æ®µåŒ¹é…åˆ—åï¼‰ï¼Œå¤æ‚åµŒå¥—ç”¨ `resultMap`ã€‚

------

#### äº”ã€æ··åˆä½¿ç”¨ç¤ºä¾‹ï¼ˆMP + XML + Wrapperï¼‰

```java
// Mapper æ¥å£
List<UserVO> selectCustom(@Param(Constants.WRAPPER) Wrapper<User> wrapper);
<!-- XML -->
<select id="selectCustom" resultType="UserVO">
    SELECT u.name, d.dept_name
    FROM user u
    LEFT JOIN dept d ON u.dept_id = d.id
    <where>
        ${ew.customSqlSegment}  <!-- è‡ªåŠ¨æ³¨å…¥ Wrapper æ¡ä»¶ -->
    </where>
</select>
// è°ƒç”¨
var wrapper = new LambdaQueryWrapper<User>()
    .eq(User::getStatus, 1)
    .likeRight(User::getName, "å¼ ");
userService.getBaseMapper().selectCustom(wrapper);
```

> âœ… è¿™æ˜¯ **MyBatis-Plus æœ€å¼ºå¤§çš„ç»„åˆ**ï¼šè‡ªå®šä¹‰ SQL + åŠ¨æ€æ¡ä»¶æ„é€ å™¨ã€‚

------

### æ€»ç»“

| æ–¹å¼            | ä½•æ—¶ç”¨                                 |
| --------------- | -------------------------------------- |
| **MP å†…ç½®æ–¹æ³•** | 80% å•è¡¨ CRUDï¼ˆé¦–é€‰ï¼‰                  |
| **XML SQL**     | å¤æ‚æŸ¥è¯¢ã€å¤šè¡¨ã€æ‰¹é‡ã€åŠ¨æ€ SQLï¼ˆä¸»åŠ›ï¼‰ |
| **æ³¨è§£ SQL**    | æç®€æŸ¥è¯¢ã€ä¸´æ—¶æµ‹è¯•ï¼ˆæ…ç”¨ï¼‰             |

> ğŸ’¡ **è®°ä½**ï¼š
> **â€œèƒ½ç”¨ IService å°±ä¸ç”¨å†™ SQLï¼›è¦å†™ SQLï¼Œä¼˜å…ˆé€‰ XMLã€‚â€**
> è¿™æ˜¯ MyBatis-Plus é¡¹ç›®çš„é»„é‡‘å‡†åˆ™ã€‚