---
title: MPçš„é¢å¤–åŠŸèƒ½
date: 2026-1-29
---

### é€»è¾‘åˆ é™¤

MyBatis-Plusï¼ˆMPï¼‰çš„ **é€»è¾‘åˆ é™¤ï¼ˆLogic Deleteï¼‰** æ˜¯ä¸€ç§**è½¯åˆ é™¤æœºåˆ¶**ï¼š
å½“æ‰§è¡Œåˆ é™¤æ“ä½œæ—¶ï¼Œ**ä¸çœŸæ­£ä»æ•°æ®åº“ä¸­ç‰©ç†åˆ é™¤è®°å½•ï¼Œè€Œæ˜¯é€šè¿‡æ›´æ–°æŸä¸ªå­—æ®µï¼ˆå¦‚ `deleted = 1`ï¼‰æ¥æ ‡è®°ä¸ºâ€œå·²åˆ é™¤â€**ï¼Œåç»­æŸ¥è¯¢ä¼šè‡ªåŠ¨è¿‡æ»¤æ‰è¿™äº›è®°å½•ã€‚

è¿™åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­éå¸¸å¸¸è§ï¼ˆå¦‚å›æ”¶ç«™ã€æ•°æ®å®¡è®¡ã€é¿å…å…³è”æ•°æ®æ–­è£‚ç­‰ï¼‰ã€‚

| æ“ä½œ            | ç‰©ç†åˆ é™¤                        | é€»è¾‘åˆ é™¤                                   |
| :-------------- | :------------------------------ | :----------------------------------------- |
| **DELETE è¯­å¥** | `DELETE FROM user WHERE id = 1` | âŒ ä¸æ‰§è¡Œ                                   |
| **å®é™…æ‰§è¡Œ**    | â€”                               | `UPDATE user SET deleted = 1 WHERE id = 1` |
| **æŸ¥è¯¢æ—¶**      | æŸ¥ä¸åˆ°                          | è‡ªåŠ¨åŠ æ¡ä»¶ `WHERE deleted = 0`             |

> âœ… **å¯¹å¼€å‘è€…é€æ˜**ï¼šä½ è°ƒç”¨ `removeById()`ï¼ŒMP è‡ªåŠ¨è½¬æˆ UPDATEï¼›ä½ è°ƒç”¨ `list()`ï¼ŒMP è‡ªåŠ¨åŠ  `deleted=0` æ¡ä»¶ã€‚

#### **ç¬¬ 1 æ­¥ï¼šå®ä½“ç±»æ·»åŠ é€»è¾‘åˆ é™¤å­—æ®µ**

```java
@Data
public class User {
    private Long id;
    private String name;

    /**
     * é€»è¾‘åˆ é™¤å­—æ®µ
     * 0 - æœªåˆ é™¤ï¼ˆé»˜è®¤ï¼‰
     * 1 - å·²åˆ é™¤
     */
    @TableLogic
    private Integer deleted;
}
```

> ğŸ”¸ å¿…é¡»åŠ  `@TableLogic` æ³¨è§£ï¼
> ğŸ”¸ å­—æ®µç±»å‹æ”¯æŒï¼š`int`/`Integer`ã€`boolean`/`Boolean`ã€`String` ç­‰ã€‚

------

#### **ç¬¬ 2 æ­¥ï¼šé…ç½®é€»è¾‘åˆ é™¤å€¼ï¼ˆå¯é€‰ï¼Œé»˜è®¤å·²é€‚é…å¸¸è§ç±»å‹ï¼‰**

åœ¨ `application.yml` ä¸­é…ç½®ï¼ˆéå¿…é¡»ï¼ŒMP æœ‰é»˜è®¤å€¼ï¼‰ï¼š

```yml
mybatis-plus:
  global-config:
    db-config:
      logic-delete-value: 1     # åˆ é™¤æ—¶è®¾ä¸º 1
      logic-not-delete-value: 0 # æœªåˆ é™¤æ—¶ä¸º 0
```

> ğŸ’¡ é»˜è®¤è¡Œä¸ºï¼š
>
> - `int/Integer`ï¼šåˆ é™¤=`1`ï¼Œæœªåˆ é™¤=`0`
> - `boolean/Boolean`ï¼šåˆ é™¤=`true`ï¼Œæœªåˆ é™¤=`false`
> - `String`ï¼šåˆ é™¤=`"1"`ï¼Œæœªåˆ é™¤=`"0"`

æ‰€ä»¥**ç®€å•åœºæ™¯å¯ä¸é…ç½®**ï¼

------

#### **ç¬¬ 3 æ­¥ï¼šç¡®ä¿æ•°æ®åº“è¡¨æœ‰è¯¥å­—æ®µ**

```sql
ALTER TABLE user ADD COLUMN deleted TINYINT(1) DEFAULT 0 COMMENT '0-æ­£å¸¸,1-åˆ é™¤';
```

> âš ï¸ å­—æ®µå¿…é¡»æœ‰**é»˜è®¤å€¼ï¼ˆæœªåˆ é™¤çŠ¶æ€ï¼‰**ï¼Œå¦åˆ™æ–°æ’å…¥æ•°æ®å¯èƒ½è¢«è¯¯è¿‡æ»¤ã€‚

| åœºæ™¯                 | å»ºè®®                             |
| :------------------- | :------------------------------- |
| **æ™®é€šä¸šåŠ¡è¡¨**       | å¯ç”¨é€»è¾‘åˆ é™¤ï¼ˆåŠ  `@TableLogic`ï¼‰ |
| **æ—¥å¿—/æµæ°´è¡¨**      | å¯ä¸ç”¨ï¼ˆæ•°æ®åªå¢ä¸åˆ ï¼‰           |
| **é«˜é¢‘æŸ¥è¯¢å¤§è¡¨**     | ç»™ `deleted` å­—æ®µåŠ ç´¢å¼•          |
| **éœ€è¦æŸ¥å·²åˆ é™¤æ•°æ®** | ç”¨è‡ªå®šä¹‰ XML æ–¹æ³•                |
| **å½»åº•åˆ é™¤**         | å•ç‹¬æä¾› `physicalDelete` æ¥å£   |



### æšä¸¾å¤„ç†å™¨

MyBatis-Plusï¼ˆMPï¼‰çš„ **æšä¸¾å¤„ç†å™¨ï¼ˆEnum Handlerï¼‰** æ˜¯ç”¨äº**è‡ªåŠ¨å°† Java æšä¸¾ç±»å‹ä¸æ•°æ®åº“å­—æ®µè¿›è¡ŒåŒå‘è½¬æ¢**çš„æœºåˆ¶ã€‚å®ƒè§£å†³äº†ä¼ ç»Ÿ MyBatis ä¸­æšä¸¾éœ€æ‰‹åŠ¨å†™ `TypeHandler` çš„ç¹çé—®é¢˜ï¼Œæ”¯æŒ **æŒ‰æšä¸¾åï¼ˆnameï¼‰ã€åºå·ï¼ˆordinalï¼‰ã€è‡ªå®šä¹‰å€¼ï¼ˆvalueï¼‰** å­˜å‚¨ã€‚

#### **å®šä¹‰æšä¸¾**

```java
public enum UserStatus {
    ENABLED(0, "å¯ç”¨"),
    DISABLED(1, "ç¦ç”¨");

    @EnumValue // æ ‡è®°å“ªä¸ªå­—æ®µä½œä¸ºå­˜å‚¨å€¼
    private final int code;
    private final String desc;

    UserStatus(int code, String desc) {
        this.code = code;
        this.desc = desc;
    }

    public int getCode() { return code; }
    public String getDesc() { return desc; }
}
```

> ğŸ”¸ `@EnumValue` å¯æ ‡è®°åœ¨ **å­—æ®µæˆ– getter æ–¹æ³•** ä¸Šã€‚

#### é…ç½®yml

```yml
mybatis-plus:
  configuration:
    # å¯ç”¨ MP çš„æšä¸¾è‡ªåŠ¨è½¬æ¢ï¼ˆé»˜è®¤å·²å¼€å¯ï¼‰
    default-enum-type-handler: com.baomidou.mybatisplus.core.handlers.MybatisEnumTypeHandler
```

> âš ï¸ æ³¨æ„ï¼š
>
> - ä¸è¦é…ç½® MyBatis åŸç”Ÿçš„ `typeHandlersPackage` æ¥å¤„ç†è¿™ç±»æšä¸¾
> - MP çš„ `MybatisEnumTypeHandler` ä¼šè‡ªåŠ¨å¤„ç† `IEnum` æˆ– `@EnumValue` æšä¸¾

#### ä½¿ç”¨

```java
// å®ä½“
public class User {
    private Long id;
    private String name;
    private UserStatus status; // è‡ªåŠ¨è½¬æ¢
}

// ä½¿ç”¨
User user = new User();
user.setStatus(UserStatus.LOCKED);
userMapper.insert(user); // DB å­˜ status = 2

List<User> lockedUsers = userMapper.selectList(
    Wrappers.<User>lambdaQuery().eq(User::getStatus, UserStatus.LOCKED)
);
```

**mpä¼šè‡ªåŠ¨å°†enumæ˜ å°„ä¸ºæŒ‡å®šçš„codeï¼ˆåŠ äº†`@EnumValue`çš„é‚£ä¸ªï¼‰**



