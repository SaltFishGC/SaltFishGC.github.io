---
title: ç»“åˆWrapperå’Œmapperè‡ªå®šä¹‰sql
date: 2026-1-29
---

åœ¨ MyBatis-Plusï¼ˆMPï¼‰ä¸­ï¼Œ**ç»“åˆ `Wrapper`ï¼ˆæ¡ä»¶æ„é€ å™¨ï¼‰å’Œ Mapper è‡ªå®šä¹‰ SQL** æ˜¯éå¸¸å¸¸è§çš„éœ€æ±‚ï¼š
ä½ å¸Œæœ› **å¤ç”¨è‡ªå®šä¹‰çš„å¤æ‚ SQLï¼ˆå¦‚å¤šè¡¨ JOINã€å­æŸ¥è¯¢ã€èšåˆç­‰ï¼‰**ï¼ŒåŒæ—¶åˆèƒ½ **åŠ¨æ€ä¼ å…¥ WHERE æ¡ä»¶** â€”â€” è€Œè¿™äº›æ¡ä»¶æœ€å¥½ç”± MP çš„ `Wrapper` æ¥æ„å»ºï¼Œé¿å…æ‰‹åŠ¨æ‹¼æ¥ã€‚

å¥½æ¶ˆæ¯æ˜¯ï¼š**MyBatis-Plus å®Œå…¨æ”¯æŒè¿™ç§æ··åˆæ¨¡å¼ï¼**

------

### âœ… æ ¸å¿ƒæ€è·¯

> åœ¨è‡ªå®šä¹‰ SQL ä¸­ä½¿ç”¨ `<where>` + `${ew.sqlSegment}`ï¼ˆæˆ– `${ew.customSqlSegment}`ï¼‰ï¼Œ
> ç„¶ååœ¨ Mapper æ¥å£ä¸­æ–¹æ³•å‚æ•°åŠ ä¸Š `@Param(Constants.WRAPPER)` Wrapper wrapperã€‚

è¿™æ ·ï¼ŒMP ä¼šè‡ªåŠ¨å°† Wrapper æ„å»ºçš„æ¡ä»¶æ‹¼æ¥åˆ°ä½ çš„ SQL ä¸­ã€‚

------

### ä¸€ã€å…·ä½“æ­¥éª¤ï¼ˆä»¥ `LambdaQueryWrapper` ä¸ºä¾‹ï¼‰

#### 1. Mapper æ¥å£å®šä¹‰

```java
public interface UserMapper extends BaseMapper<User> {

    // è‡ªå®šä¹‰æŸ¥è¯¢æ–¹æ³•ï¼Œæ¥æ”¶ Wrapper ä½œä¸ºæ¡ä»¶
    List<UserVO> selectUserWithDept(@Param(Constants.WRAPPER) Wrapper<User> wrapper);
}
```

> ğŸ”¸ å¿…é¡»ä½¿ç”¨ `@Param(Constants.WRAPPER)` æ³¨è§£ï¼Œä¸”å‚æ•°åå›ºå®šä¸º `wrapper`ï¼ˆæˆ–ä»»æ„åï¼Œä½†æ³¨è§£å€¼å¿…é¡»æ˜¯ `Constants.WRAPPER`ï¼‰ã€‚
> ğŸ”¸ è¿”å›ç±»å‹å¯ä»¥æ˜¯ VOã€Map æˆ–å®ä½“ï¼Œä¸å¼ºåˆ¶æ˜¯ Entityã€‚

------

#### 2. XML ä¸­ç¼–å†™è‡ªå®šä¹‰ SQL

```xml
<select id="selectUserWithDept" resultType="com.example.vo.UserVO">
    SELECT 
        u.id, u.name, u.email,
        d.dept_name AS deptName
    FROM user u
    LEFT JOIN department d ON u.dept_id = d.id
    <where> 
        ${ew.sqlSegment}
    </where>
</select>
```

> ğŸ”¸ `${ew.sqlSegment}` ä¼šè‡ªåŠ¨æ›¿æ¢ä¸º Wrapper ç”Ÿæˆçš„ WHERE æ¡ä»¶ï¼ˆä¸å« `WHERE` å…³é”®å­—ï¼‰ã€‚
> ğŸ”¸ ä½¿ç”¨ `<where>` æ ‡ç­¾å¯è‡ªåŠ¨å¤„ç† AND/OR å¼€å¤´çš„é—®é¢˜ã€‚

------

#### 3. è°ƒç”¨æ—¶ä¼ å…¥ Wrapper

```java
@Autowired
private UserMapper userMapper;

public void test() {
    LambdaQueryWrapper<User> wrapper = new LambdaQueryWrapper<User>()
        .likeRight(User::getName, "å¼ ")
        .ge(User::getAge, 18)
        .eq(User::getStatus, 1);

    List<UserVO> list = userMapper.selectUserWithDept(wrapper);
}
```

ç”Ÿæˆçš„ SQL ç±»ä¼¼ï¼š

```sql
SELECT u.id, u.name, ..., d.dept_name
FROM user u
LEFT JOIN department d ON u.dept_id = d.id
WHERE u.name LIKE 'å¼ %' AND u.age >= 18 AND u.status = 1
```

------

### äºŒã€æ³¨æ„äº‹é¡¹ & é«˜çº§æŠ€å·§

#### âœ… 1. å­—æ®µåè¦å¯¹åº”æ•°æ®åº“åˆ—ï¼ˆä¸æ˜¯ Java å±æ€§ï¼‰

Wrapper ä¸­çš„å­—æ®µæœ€ç»ˆä¼šè½¬æˆ **æ•°æ®åº“åˆ—å**ã€‚
å¦‚æœä½ çš„ Entity ç”¨äº† `@TableField("user_name")`ï¼Œé‚£ä¹ˆï¼š

```java
wrapper.eq(User::getUserName, "xxx") 
// ç”Ÿæˆçš„æ˜¯ user_name = 'xxx'
```

æ‰€ä»¥ä½ çš„è‡ªå®šä¹‰ SQL ä¸­ä¹Ÿè¦ç”¨ **æ•°æ®åº“åˆ—å**ï¼ˆå¦‚ `u.user_name`ï¼‰ã€‚

------

#### âœ… 2. å¦‚æœåªæƒ³ç”¨æ¡ä»¶éƒ¨åˆ†ï¼ˆä¸è¦ ORDER BY / GROUP BYï¼‰

é»˜è®¤ `ew.sqlSegment` åŒ…å« `WHERE ... ORDER BY ... GROUP BY ...`ã€‚

å¦‚æœä½ åªæƒ³è¦ **WHERE æ¡ä»¶éƒ¨åˆ†**ï¼ˆæ¯”å¦‚ä½ è‡ªå·±æ§åˆ¶æ’åºï¼‰ï¼Œç”¨ï¼š

```xml
<where>
    ${ew.customSqlSegment}
</where>
```

> `customSqlSegment` åªåŒ…å« WHERE æ¡ä»¶ï¼Œä¸åŒ…å« ORDER/GROUP/LIMITã€‚

------

#### âœ… 3. æ”¯æŒ Update åœºæ™¯å—ï¼Ÿ

**æ”¯æŒï¼** ä¾‹å¦‚è‡ªå®šä¹‰æ›´æ–°ï¼š

```java
// Mapper æ¥å£
int updateUserStatus(@Param(Constants.WRAPPER) Wrapper<User> wrapper);
<update id="updateUserStatus">
    UPDATE user
    SET status = 0
    <where>
        ${ew.sqlSegment}
    </where>
</update>
```

è°ƒç”¨ï¼š

```java
wrapper.eq(User::getAge, 16);
userMapper.updateUserStatus(wrapper); // æ‰€æœ‰ age=16 çš„ç”¨æˆ· status è®¾ä¸º 0
```

------

#### âŒ å¸¸è§é”™è¯¯

| é”™è¯¯                      | åŸå›                                                          |
| ------------------------- | ------------------------------------------------------------ |
| `Property 'ew' not found` | å¿˜è®°åŠ  `@Param(Constants.WRAPPER)`                           |
| å­—æ®µåå¯¹ä¸ä¸Š              | Entity çš„ Java å±æ€§ vs æ•°æ®åº“åˆ—åä¸ä¸€è‡´ï¼Œä¸”æ²¡ç”¨ `@TableField` |
| SQL æ³¨å…¥è­¦å‘Š              | ç”¨äº† `${}`ï¼Œä½† MP å¯¹ `sqlSegment` åšäº†å®‰å…¨è¿‡æ»¤ï¼ˆåŸºäºå­—æ®µç™½åå•ï¼‰ï¼Œä¸€èˆ¬å®‰å…¨ |

> ğŸ’¡ MP çš„ `sqlSegment` æ˜¯**å®‰å…¨çš„**ï¼Œå› ä¸ºå®ƒåªå…è®¸ Entity ä¸­å®šä¹‰çš„å­—æ®µï¼Œä¸ä¼šç›´æ¥æ‹¼æ¥å¤–éƒ¨å­—ç¬¦ä¸²ã€‚

------

### ä¸‰ã€å®Œæ•´ç¤ºä¾‹ï¼ˆå« VOï¼‰

#### Entity

```java
public class User {
    private Long id;
    @TableField("user_name")
    private String userName;
    private Integer age;
    // getter/setter
}
```

#### VO

```java
public class UserVO {
    private Long id;
    private String userName;
    private String deptName;
    // getter/setter
}
```

#### Mapper

```java
List<UserVO> selectCustom(@Param(Constants.WRAPPER) Wrapper<User> wrapper);
```

#### XML

```xml
<select id="selectCustom" resultType="com.example.vo.UserVO">
    SELECT u.id, u.user_name, d.dept_name
    FROM user u
    LEFT JOIN dept d ON u.dept_id = d.id
    <where>
        ${ew.customSqlSegment}
    </where>
    ORDER BY u.id DESC
</select>
```

#### è°ƒç”¨

```java
var wrapper = new LambdaQueryWrapper<User>()
    .like(User::getUserName, "å¼ ")
    .lt(User::getAge, 30);

List<UserVO> list = userMapper.selectCustom(wrapper);
```

------

### âœ… æ€»ç»“

| è¦ç‚¹           | è¯´æ˜                                                         |
| -------------- | ------------------------------------------------------------ |
| **æ¥å£å‚æ•°**   | ç”¨ `@Param(Constants.WRAPPER) Wrapper<T> wrapper`            |
| **XML å ä½ç¬¦** | ç”¨ `${ew.sqlSegment}`ï¼ˆå« ORDER/GROUPï¼‰æˆ– `${ew.customSqlSegment}`ï¼ˆä»… WHEREï¼‰ |
| **å­—æ®µå®‰å…¨**   | åªèƒ½ä½¿ç”¨ Entity ä¸­å®šä¹‰çš„å­—æ®µï¼Œé˜²æ³¨å…¥                         |
| **é€‚ç”¨åœºæ™¯**   | å¤æ‚æŸ¥è¯¢ï¼ˆJOIN/å­æŸ¥è¯¢ï¼‰+ åŠ¨æ€æ¡ä»¶                            |

> è¿™ç§æ–¹å¼å®Œç¾èåˆäº† **MyBatis çš„çµæ´»æ€§** å’Œ **MyBatis-Plus çš„ä¾¿æ·æ€§**ï¼Œæ˜¯ä¼ä¸šçº§å¼€å‘çš„æ¨èå®è·µã€‚