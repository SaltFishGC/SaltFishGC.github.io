<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.19">
    <script>
      (function() {
        const userMode = localStorage.getItem('vuepress-reco-color-scheme') || 'auto';
        const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (userMode === 'dark' || (userMode === 'auto' && systemDarkMode)) {
          document.documentElement.classList.toggle('dark', true);
        }
      })();
    </script>
    <title>Redis消息队列 | SaltFishGC`s Blog</title><meta name="description" content="">
    <link rel="preload" href="/assets/style-GDClBqfJ.css" as="style"><link rel="stylesheet" href="/assets/style-GDClBqfJ.css">
    <link rel="modulepreload" href="/assets/app-Cm4IjFjh.js"><link rel="modulepreload" href="/assets/6.Redisxiaoxiduilie.html-CTZf84M0.js">
    <link rel="prefetch" href="/assets/timeline.html-BHh40Ayz.js" as="script"><link rel="prefetch" href="/assets/posts.html-BtV6yXC2.js" as="script"><link rel="prefetch" href="/assets/friendship-link.html-C8xSKHW-.js" as="script"><link rel="prefetch" href="/assets/1.html-sVZYJpsw.js" as="script"><link rel="prefetch" href="/assets/1.html-ClZLN3kR.js" as="script"><link rel="prefetch" href="/assets/1.html-Be3kf4Ik.js" as="script"><link rel="prefetch" href="/assets/index.html-u3PQh_8y.js" as="script"><link rel="prefetch" href="/assets/121501.html-BvTVDJU6.js" as="script"><link rel="prefetch" href="/assets/260215.html-DNvNe1xj.js" as="script"><link rel="prefetch" href="/assets/changyongmingling.html-CkI2M6JZ.js" as="script"><link rel="prefetch" href="/assets/Eletronsuji.html-BQfg4X5I.js" as="script"><link rel="prefetch" href="/assets/WebSocketkehuduan.html-DiDSFxeB.js" as="script"><link rel="prefetch" href="/assets/nginx.html-CcVBaz0a.js" as="script"><link rel="prefetch" href="/assets/session，token，jwt.html-BEhxooUN.js" as="script"><link rel="prefetch" href="/assets/sqlitebendihuancun.html-DvOE9oZR.js" as="script"><link rel="prefetch" href="/assets/vuejibensuji.html-BTgpAsr4.js" as="script"><link rel="prefetch" href="/assets/xiugaisheji.html-Dy4U8yHF.js" as="script"><link rel="prefetch" href="/assets/yudaodewenti（qianduan.html-BDZz2T9S.js" as="script"><link rel="prefetch" href="/assets/Nettysuji.html-B0-uRJYg.js" as="script"><link rel="prefetch" href="/assets/yewuzhongxuedaodedongxi（houduan.html-hSqe5BKg.js" as="script"><link rel="prefetch" href="/assets/xiugaisheji（houduan.html-BxCwgixb.js" as="script"><link rel="prefetch" href="/assets/tongyangdeyewuchangjing，weixinshizenmezuode？.html-Cs-vmE6O.js" as="script"><link rel="prefetch" href="/assets/duidaimashengchengqideyouhua.html-Bk-d-aGg.js" as="script"><link rel="prefetch" href="/assets/shujukuhehuancuncunchuxingshizhengli.html-ysYf2Q_c.js" as="script"><link rel="prefetch" href="/assets/yudaodewenti（houduan.html-MSaWj3k_.js" as="script"><link rel="prefetch" href="/assets/1.jianjie.html-DAFq7q49.js" as="script"><link rel="prefetch" href="/assets/2.zidingyirongqi.html-DX5oekCq.js" as="script"><link rel="prefetch" href="/assets/3.yingyongbushu.html-CbI6idOj.js" as="script"><link rel="prefetch" href="/assets/4.rongqijiantongxin.html-DHHWYGmt.js" as="script"><link rel="prefetch" href="/assets/1.jianjie.html-BZrD41Sm.js" as="script"><link rel="prefetch" href="/assets/2.Wrapper.html-CHPLxRMW.js" as="script"><link rel="prefetch" href="/assets/3.jieheWrapperhemapper.html-Ca42UaxD.js" as="script"><link rel="prefetch" href="/assets/4.zizhiSQL.html-16fcqhDg.js" as="script"><link rel="prefetch" href="/assets/5.IService.html-DwAUqzQj.js" as="script"><link rel="prefetch" href="/assets/6.IServicedelambdalianshidiaoyong.html-BC-00BKH.js" as="script"><link rel="prefetch" href="/assets/7.IServicedepiliangcharu.html-BxoPjTDY.js" as="script"><link rel="prefetch" href="/assets/8.fenyechajian.html-CLYPQbxa.js" as="script"><link rel="prefetch" href="/assets/9.ewaigongnen.html-n77O4Nt4.js" as="script"><link rel="prefetch" href="/assets/1.Spring.html-DTCV4awT.js" as="script"><link rel="prefetch" href="/assets/2.JWT.html-zmRmTpD3.js" as="script"><link rel="prefetch" href="/assets/3.weifuwu.html-B44NN3Xt.js" as="script"><link rel="prefetch" href="/assets/1.bushuyuanxiangmu.html-mY4zLOZG.js" as="script"><link rel="prefetch" href="/assets/10.ElasticSearch.html-D6SEfIpI.js" as="script"><link rel="prefetch" href="/assets/2.xiangmuchuburenshi.html-Bsa_jewc.js" as="script"><link rel="prefetch" href="/assets/3.fuwuguanli（zhucezhongxinNacos）.html-BqMKx_u5.js" as="script"><link rel="prefetch" href="/assets/4.yuanchengdiaoyong（OpenFeign）.html-Dx53lmPn.js" as="script"><link rel="prefetch" href="/assets/5.weifuwuwangguan（Gateway）.html-Dlhc2W19.js" as="script"><link rel="prefetch" href="/assets/6.peizhiguanli（peizhizhongxinNacos）.html-3tRbxgkV.js" as="script"><link rel="prefetch" href="/assets/7.fuwubaohu（Sentinelrongduanxianliu）.html-C1m18Oqr.js" as="script"><link rel="prefetch" href="/assets/8.fenbushishiwu（Seata）.html-Bm_KRx6X.js" as="script"><link rel="prefetch" href="/assets/9.xiaoxiduilie（MQ）.html-Bvr2Kxga.js" as="script"><link rel="prefetch" href="/assets/EX：Commonmokuaidezhuyishixiang.html-Dc9dhr6_.js" as="script"><link rel="prefetch" href="/assets/EX：lianluzhuizong.html-DzPLTsKP.js" as="script"><link rel="prefetch" href="/assets/1.duanxindenglu.html-CgAq-cB2.js" as="script"><link rel="prefetch" href="/assets/10.yonghuqiandao.html-CrGXq3bs.js" as="script"><link rel="prefetch" href="/assets/11.uvtongji.html-5LH7dzDF.js" as="script"><link rel="prefetch" href="/assets/2.huancun.html-q6vJdOik.js" as="script"><link rel="prefetch" href="/assets/3.youhuiquanmiaosha.html-DqO2tY5z.js" as="script"><link rel="prefetch" href="/assets/4.fenbushisuo(Redisson).html-DPG6Rb16.js" as="script"><link rel="prefetch" href="/assets/5.miaoshayouhua.html-GQm8sRPu.js" as="script"><link rel="prefetch" href="/assets/7.darentandian.html-CSmwZUlr.js" as="script"><link rel="prefetch" href="/assets/8.haoyouguanzhu.html-CknyfZlq.js" as="script"><link rel="prefetch" href="/assets/9.fujianshangpu.html-M-IcAMrO.js" as="script"><link rel="prefetch" href="/assets/nacuntaihuan.html-BcVuXEhH.js" as="script"><link rel="prefetch" href="/assets/shujujiegou.html-BNy_koyM.js" as="script"><link rel="prefetch" href="/assets/wangluomoxing.html-p67NLDfs.js" as="script"><link rel="prefetch" href="/assets/tongxinxieyi.html-DS6BolRA.js" as="script"><link rel="prefetch" href="/assets/duiRedisUtildegengxin.html-C_F8aZlD.js" as="script"><link rel="prefetch" href="/assets/Redistexing.html-egpedVDU.js" as="script"><link rel="prefetch" href="/assets/changjianyewuwentijibaguwen.html-CbO0g-Dj.js" as="script"><link rel="prefetch" href="/assets/zaqizabadeyichang.html-DYfts_Hs.js" as="script"><link rel="prefetch" href="/assets/baozhuangjianli.html-Df3-9k9O.js" as="script"><link rel="prefetch" href="/assets/changyongmingling.html-jMw-JDr1.js" as="script"><link rel="prefetch" href="/assets/jianjie.html-DGXE9BD2.js" as="script"><link rel="prefetch" href="/assets/1.fenbushihuancun.html-AuTul_wp.js" as="script"><link rel="prefetch" href="/assets/2.duojihuancun.html-Dy9PT_4g.js" as="script"><link rel="prefetch" href="/assets/3.zuijiashijian.html-CamMS-8E.js" as="script"><link rel="prefetch" href="/assets/Rediscunzaidewenti.html-C3MC8ltg.js" as="script"><link rel="prefetch" href="/assets/404.html-CwjkKDg3.js" as="script"><link rel="prefetch" href="/assets/Valine.min-C61SASqw.js" as="script"><link rel="prefetch" href="/assets/giscus-aTimukGI-DWEKOTfS.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container show-series show-catalog"><header class="navbar-container not-open"><div class="navbar-inner"><div class="site-brand nav-item"><img class="logo" src="/doge.jpg" alt="SaltFishGC`s Blog"><a href="/" class="site-name can-hide">SaltFishGC`s Blog</a></div><div class="nav-item navbar-links-wrapper" style=""><div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div><nav class="navbar-links"><!--[--><div class="navbar-links__item"><a href="/" class="link" aria-label="主页"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->主页<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/categories/blog/1.html" class="link" aria-label="Blog"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Blog<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="笔记"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->笔记<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="笔记"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->笔记<!--]--></span></span></span><span class="right arrow"></span></button><ul class="dropdown-link__container" style="display:none;"><!--[--><li class="dropdown-link__item"><a href="/docs/wx/常用命令" class="link" aria-label="仿wx"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->仿wx<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/docs/黑马点评/项目相关/简介" class="link" aria-label="黑马点评"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->黑马点评<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/docs/黑马商城/Docker/1.简介" class="link" aria-label="黑马商城"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->黑马商城<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--><!----><span class="xicon-container btn-toggle-dark-mode btn--dark-mode navbar-links__item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></span><ul class="social-links navbar-links__item"><!--[--><li class="social-item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:25px;height:25px;"><path d="M16 2a14 14 0 0 0-4.43 27.28c.7.13 1-.3 1-.67v-2.38c-3.89.84-4.71-1.88-4.71-1.88a3.71 3.71 0 0 0-1.62-2.05c-1.27-.86.1-.85.1-.85a2.94 2.94 0 0 1 2.14 1.45a3 3 0 0 0 4.08 1.16a2.93 2.93 0 0 1 .88-1.87c-3.1-.36-6.37-1.56-6.37-6.92a5.4 5.4 0 0 1 1.44-3.76a5 5 0 0 1 .14-3.7s1.17-.38 3.85 1.43a13.3 13.3 0 0 1 7 0c2.67-1.81 3.84-1.43 3.84-1.43a5 5 0 0 1 .14 3.7a5.4 5.4 0 0 1 1.44 3.76c0 5.38-3.27 6.56-6.39 6.91a3.33 3.33 0 0 1 .95 2.59v3.84c0 .46.25.81 1 .67A14 14 0 0 0 16 2z" fill-rule="evenodd" fill="currentColor"></path></svg></li><!--]--></ul></nav><span class="xicon-container btn-toggle-menus"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><circle cx="16" cy="8" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="24" r="2" fill="currentColor"></circle></svg></span></div></div></header><header class="sub-navbar-container not-open"><span class="nav-item"><div class="toggle-series-button" aria-expanded="false" role="button" tabindex="0"><span></span><span></span><span></span></div> Series </span></header><!----><!----><div class="theme-main" style=""><aside class="series-container"><!--[--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->仿wx<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->常用命令<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/wx/changyongmingling.html" class="link series-item series-item" aria-label="常用命令"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->常用命令<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->前端部分<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/wx/qianduanbufen/Eletronsuji.html" class="link series-item series-item" aria-label="Eletron速记"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Eletron速记<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/qianduanbufen/WebSocketkehuduan.html" class="link series-item series-item" aria-label="WebSocket客户端"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->WebSocket客户端<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/qianduanbufen/nginx.html" class="link series-item series-item" aria-label="NGINX"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->NGINX<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/qianduanbufen/session，token，jwt.html" class="link series-item series-item" aria-label="session，token，jwt"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->session，token，jwt<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/qianduanbufen/sqlitebendihuancun.html" class="link series-item series-item" aria-label="sqlite本地缓存"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->sqlite本地缓存<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/qianduanbufen/vuejibensuji.html" class="link series-item series-item" aria-label="vue基本速记"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->vue基本速记<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/qianduanbufen/xiugaisheji.html" class="link series-item series-item" aria-label="修改设计"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->修改设计<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/qianduanbufen/yudaodewenti（qianduan.html" class="link series-item series-item" aria-label="遇到的问题（前端）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->遇到的问题（前端）<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->后端部分<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/wx/houduanbufen/Nettysuji.html" class="link series-item series-item" aria-label="Netty速记"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Netty速记<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/houduanbufen/yewuzhongxuedaodedongxi（houduan.html" class="link series-item series-item" aria-label="业务中学到的东西（后端）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->业务中学到的东西（后端）<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/houduanbufen/xiugaisheji（houduan.html" class="link series-item series-item" aria-label="修改设计"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->修改设计<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/houduanbufen/tongyangdeyewuchangjing，weixinshizenmezuode？.html" class="link series-item series-item" aria-label="微信是怎么去解决一些问题的"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->微信是怎么去解决一些问题的<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/houduanbufen/duidaimashengchengqideyouhua.html" class="link series-item series-item" aria-label="对代码生成器的优化"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->对代码生成器的优化<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/houduanbufen/shujukuhehuancuncunchuxingshizhengli.html" class="link series-item series-item" aria-label="数据库和缓存存储形式整理"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->数据库和缓存存储形式整理<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/houduanbufen/yudaodewenti（houduan.html" class="link series-item series-item" aria-label="遇到的问题（后端）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->遇到的问题（后端）<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1 active"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->黑马点评<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->项目相关<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimadianping/xiangmuxiangguan/jianjie.html" class="link series-item series-item" aria-label="项目简介"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->项目简介<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/xiangmuxiangguan/changyongmingling.html" class="link series-item series-item" aria-label="常用命令"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->常用命令<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/xiangmuxiangguan/baozhuangjianli.html" class="link series-item series-item" aria-label="包装简历"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->包装简历<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->业务设计<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimadianping/yewusheji/1.duanxindenglu.html" class="link series-item series-item" aria-label="短信登录（session）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->短信登录（session）<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/2.huancun.html" class="link series-item series-item" aria-label="缓存"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->缓存<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/3.youhuiquanmiaosha.html" class="link series-item series-item" aria-label="优惠券秒杀"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->优惠券秒杀<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/4.fenbushisuo(Redisson).html" class="link series-item series-item" aria-label="分布式锁"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->分布式锁<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/5.miaoshayouhua.html" class="link series-item series-item" aria-label="秒杀优化"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->秒杀优化<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a aria-current="page" href="/docs/heimadianping/yewusheji/6.Redisxiaoxiduilie.html" class="router-link-active router-link-exact-active link router-link-active series-item series-item" aria-label="Redis消息队列"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redis消息队列<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/7.darentandian.html" class="link series-item series-item" aria-label="达人探店"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->达人探店<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/8.haoyouguanzhu.html" class="link series-item series-item" aria-label="好友关注"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->好友关注<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/9.fujianshangpu.html" class="link series-item series-item" aria-label="附件商铺"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->附件商铺<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/10.yonghuqiandao.html" class="link series-item series-item" aria-label="用户签到"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->用户签到<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/11.uvtongji.html" class="link series-item series-item" aria-label="uv统计"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->uv统计<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->高级篇<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimadianping/gaojipian/1.fenbushihuancun.html" class="link series-item series-item" aria-label="分布式缓存"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->分布式缓存<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/gaojipian/2.duojihuancun.html" class="link series-item series-item" aria-label="多级缓存"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->多级缓存<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/gaojipian/3.zuijiashijian.html" class="link series-item series-item" aria-label="最佳实践"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->最佳实践<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/gaojipian/Rediscunzaidewenti.html" class="link series-item series-item" aria-label="Redis存在的问题"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redis存在的问题<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->原理八股文<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimadianping/yuanlibaguwen/wangluomoxing.html" class="link series-item series-item" aria-label="Redis网络模型"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redis网络模型<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yuanlibaguwen/shujujiegou.html" class="link series-item series-item" aria-label="数据结构"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->数据结构<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yuanlibaguwen/nacuntaihuan.html" class="link series-item series-item" aria-label="内存回收"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->内存回收<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yuanlibaguwen/tongxinxieyi.html" class="link series-item series-item" aria-label="Redis通信协议"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redis通信协议<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->应用知识<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimadianping/yingyongzhishi/Redistexing.html" class="link series-item series-item" aria-label="Redis特性"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redis特性<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yingyongzhishi/changjianyewuwentijibaguwen.html" class="link series-item series-item" aria-label="常见业务问题以及八股文"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->常见业务问题以及八股文<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yingyongzhishi/zaqizabadeyichang.html" class="link series-item series-item" aria-label="杂七杂八的异常"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->杂七杂八的异常<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->对脚手架的更新<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimadianping/duijiaoshoujiadegengxin/duiRedisUtildegengxin.html" class="link series-item series-item" aria-label="对RedisUtil的更新"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->对RedisUtil的更新<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->黑马商城<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Docker<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimashangcheng/Docker/1.jianjie.html" class="link series-item series-item" aria-label="Docker简介"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Docker简介<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/Docker/2.zidingyirongqi.html" class="link series-item series-item" aria-label="自制容器"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->自制容器<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/Docker/3.yingyongbushu.html" class="link series-item series-item" aria-label="应用部署"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->应用部署<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/Docker/4.rongqijiantongxin.html" class="link series-item series-item" aria-label="容器间通信"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->容器间通信<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->MybatisPlus<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/1.jianjie.html" class="link series-item series-item" aria-label="MybatisPlus简介"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->MybatisPlus简介<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/2.Wrapper.html" class="link series-item series-item" aria-label="条件构造器Wrapper"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->条件构造器Wrapper<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/3.jieheWrapperhemapper.html" class="link series-item series-item" aria-label="结合Wrapper和mapper自定义sql"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->结合Wrapper和mapper自定义sql<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/4.zizhiSQL.html" class="link series-item series-item" aria-label="自制SQL"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->自制SQL<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/5.IService.html" class="link series-item series-item" aria-label="IService"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->IService<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/6.IServicedelambdalianshidiaoyong.html" class="link series-item series-item" aria-label="IService的链式调用"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->IService的链式调用<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/7.IServicedepiliangcharu.html" class="link series-item series-item" aria-label="IService的批量插入"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->IService的批量插入<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/8.fenyechajian.html" class="link series-item series-item" aria-label="MP的分页插件"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->MP的分页插件<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/9.ewaigongnen.html" class="link series-item series-item" aria-label="MP的额外功能"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->MP的额外功能<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->八股<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimashangcheng/bagu/1.Spring.html" class="link series-item series-item" aria-label="Spring八股"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Spring八股<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/bagu/2.JWT.html" class="link series-item series-item" aria-label="JWT"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->JWT<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/bagu/3.weifuwu.html" class="link series-item series-item" aria-label="微服务"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->微服务<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->微服务<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimashangcheng/weifuwu/1.bushuyuanxiangmu.html" class="link series-item series-item" aria-label="部署原项目"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->部署原项目<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/2.xiangmuchuburenshi.html" class="link series-item series-item" aria-label="微服务初接触"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->微服务初接触<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/3.fuwuguanli（zhucezhongxinNacos）.html" class="link series-item series-item" aria-label="服务管理"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->服务管理<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/4.yuanchengdiaoyong（OpenFeign）.html" class="link series-item series-item" aria-label="远程调用"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->远程调用<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/5.weifuwuwangguan（Gateway）.html" class="link series-item series-item" aria-label="微服务网关"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->微服务网关<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/6.peizhiguanli（peizhizhongxinNacos）.html" class="link series-item series-item" aria-label="配置中心"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->配置中心<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/7.fuwubaohu（Sentinelrongduanxianliu）.html" class="link series-item series-item" aria-label="服务保护"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->服务保护<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/8.fenbushishiwu（Seata）.html" class="link series-item series-item" aria-label="分布式事务"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->分布式事务<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/9.xiaoxiduilie（MQ）.html" class="link series-item series-item" aria-label="消息队列"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->消息队列<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/10.ElasticSearch.html" class="link series-item series-item" aria-label="ElasticSearch"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->ElasticSearch<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/EX：Commonmokuaidezhuyishixiang.html" class="link series-item series-item" aria-label="Common模块的注意事项"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Common模块的注意事项<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/EX：lianluzhuizong.html" class="link series-item series-item" aria-label="链路追踪"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->链路追踪<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li></ul></section><!--]--><!--]--></aside><!--[--><main class="page-container"><div class="page-content"><h1 class="page-title">Redis消息队列</h1><div class="page-info"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M16 4a5 5 0 1 1-5 5a5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7a7 7 0 0 0-7-7z" fill="currentColor"></path><path d="M26 30h-2v-5a5 5 0 0 0-5-5h-6a5 5 0 0 0-5 5v5H6v-5a7 7 0 0 1 7-7h6a7 7 0 0 1 7 7z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->SaltFishGC<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2025-1-18<!--]--></span></span><!----><!----><!----></div><div class="theme-reco-md-content"><div><h2 id="消息队列" tabindex="-1"><a class="header-anchor" href="#消息队列"><span>消息队列</span></a></h2><p>针对我们先前提到的一些问题，比如<strong>异步</strong>提交任务的队列中，怎么去记录<strong>异常信息</strong>，假如后续需要去获取异步操作（两路并行执行）的<strong>结果</strong>。那该怎么办？</p><p>那么我们就可以去考虑使用<strong>消息队列</strong>了：</p><p><strong>消息队列</strong>（Message Queue）是一种<strong>异步通信机制</strong>，用于在分布式系统中实现<strong>生产者</strong>与<strong>消费者</strong>之间的解耦。它通过一个中间层（消息代理缓冲区）<strong>存储</strong>和<strong>转发</strong>消息，确保数据的可靠传递。</p><table><thead><tr><th style="text-align:left;">角色</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>生产者（Producer）</strong></td><td style="text-align:left;">负责创建并发送消息到消息队列。例如：订单服务在用户下单后发送“订单创建”事件。</td></tr><tr><td style="text-align:left;"><strong>消息队列（Message Queue / Broker）</strong></td><td style="text-align:left;">存储、管理消息的中间件，也称为<strong>消息代理</strong>（Message Broker）。负责接收来自生产者的消息，并按规则分发给消费者。</td></tr><tr><td style="text-align:left;"><strong>消费者（Consumer）</strong></td><td style="text-align:left;">从消息队列中获取消息并进行处理。例如：库存服务监听“订单创建”事件，扣减库存。</td></tr></tbody></table><div class="language-mermaid line-numbers-mode" data-highlighter="prismjs" data-ext="mermaid" data-title="mermaid"><pre><code><span class="line"><span class="token keyword">graph</span> LR</span>
<span class="line">    A<span class="token text string">[生产者&lt;br&gt;Producer]</span> <span class="token arrow operator">--&gt;</span> B<span class="token text string">[消息队列&lt;br&gt;Message Queue]</span></span>
<span class="line">    B <span class="token arrow operator">--&gt;</span> C<span class="token text string">[消费者&lt;br&gt;Consumer]</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">style</span> A <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#4285f5<span class="token punctuation">,</span><span class="token property">stroke</span><span class="token operator">:</span>#333<span class="token punctuation">,</span><span class="token property">stroke-width</span><span class="token operator">:</span>2px</span></span>
<span class="line">    <span class="token keyword">style</span> B <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#f8d7da<span class="token punctuation">,</span><span class="token property">stroke</span><span class="token operator">:</span>#dc3545<span class="token punctuation">,</span><span class="token property">stroke-width</span><span class="token operator">:</span>2px</span></span>
<span class="line">    <span class="token keyword">style</span> C <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#28a745<span class="token punctuation">,</span><span class="token property">stroke</span><span class="token operator">:</span>#333<span class="token punctuation">,</span><span class="token property">stroke-width</span><span class="token operator">:</span>2px</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">linkStyle</span> default <span class="token style"><span class="token property">stroke</span><span class="token operator">:</span>#333<span class="token punctuation">,</span><span class="token property">stroke-width</span><span class="token operator">:</span>2px</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在微服务架构下，我们会使用一些成熟的组件：</p><table><thead><tr><th style="text-align:left;">产品</th><th style="text-align:left;">特点</th><th style="text-align:left;">典型用途</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>RabbitMQ</strong></td><td style="text-align:left;">可靠、灵活路由</td><td style="text-align:left;">企业级应用、任务调度</td></tr><tr><td style="text-align:left;"><strong>Kafka</strong></td><td style="text-align:left;">高吞吐、日志流</td><td style="text-align:left;">日志收集、大数据管道</td></tr><tr><td style="text-align:left;"><strong>RocketMQ</strong></td><td style="text-align:left;">高性能、金融级</td><td style="text-align:left;">电商、支付、交易系统</td></tr><tr><td style="text-align:left;"><strong>Pulsar</strong></td><td style="text-align:left;">多租户、云原生</td><td style="text-align:left;">云计算、微服务</td></tr></tbody></table><blockquote><p>真到了微服务层级，Redis提供的Redis Stream是不够用的，还是使用成熟的MQ中间件更合适（链路追踪等方面做的好得多）这里看看就行</p></blockquote><p>Redis的三种消息队列：</p><table><thead><tr><th style="text-align:left;">模型</th><th style="text-align:left;">是否持久化</th><th style="text-align:left;">是否支持消费者组</th><th style="text-align:left;">是否支持 ACK</th><th style="text-align:left;">适用场景</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>Pub/Sub</strong></td><td style="text-align:left;">❌ 否</td><td style="text-align:left;">❌ 否</td><td style="text-align:left;">❌ 否</td><td style="text-align:left;">实时通知、广播事件</td></tr><tr><td style="text-align:left;"><strong>LIST</strong></td><td style="text-align:left;">❌ 否</td><td style="text-align:left;">❌ 否</td><td style="text-align:left;">❌ 否</td><td style="text-align:left;">简单任务分发（允许丢失）</td></tr><tr><td style="text-align:left;"><strong>STREAM</strong></td><td style="text-align:left;">✅ 是</td><td style="text-align:left;">✅ 是</td><td style="text-align:left;">✅ 是</td><td style="text-align:left;">可靠消息队列、事件溯源</td></tr></tbody></table><h2 id="list类型的redis消息队列" tabindex="-1"><a class="header-anchor" href="#list类型的redis消息队列"><span>List类型的Redis消息队列</span></a></h2><p>List类型消息队列就是基于Redis本身提供的List<strong>双向链表</strong>实现的一个消息队列，结合Lpush以及Rpop（或者倒过来）来实现消息队列的，这里为了保证阻塞效果（阻塞/循环等待数据并提取交给消费者），会使用BRpop（<strong>阻塞</strong>泵出，当有数据时泵出，无数据时<strong>阻塞等待</strong>）获取数据/操作消息。</p><p>这样的队列支持单对单/多的消息传递，同时消息丢失无法避免（内存汰换，业务失败消息丢失）</p><div class="language-mermaid line-numbers-mode" data-highlighter="prismjs" data-ext="mermaid" data-title="mermaid"><pre><code><span class="line"><span class="token keyword">graph</span> LR</span>
<span class="line">    P<span class="token text string">[生产者]</span> <span class="token arrow operator">--&gt;</span><span class="token label property">|LPUSH|</span> L<span class="token text string">(列表)</span></span>
<span class="line">    R1<span class="token text string">[消费者1]</span> <span class="token arrow operator">--&gt;</span><span class="token label property">|RPOP|</span> L</span>
<span class="line">    R2<span class="token text string">[消费者2]</span> <span class="token arrow operator">--&gt;</span><span class="token label property">|RPOP|</span> L</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="pubsub类型的redis消息队列" tabindex="-1"><a class="header-anchor" href="#pubsub类型的redis消息队列"><span>PubSub类型的Redis消息队列</span></a></h2><p>这种类型的消息队列支持消费者订阅一个或多个channel，当生产者向channel发送消息，所有订阅了该channel的消费者都能获取到消息。Redission的<strong>RTopic</strong>就是基于该消息队列实现的，这种消息队列适用于<strong>广播</strong>的场景。</p><p>当然，也还是无法实现消息丢失的问题。</p><div class="language-mermaid line-numbers-mode" data-highlighter="prismjs" data-ext="mermaid" data-title="mermaid"><pre><code><span class="line"><span class="token keyword">graph</span> LR</span>
<span class="line">    P<span class="token text string">[生产者]</span> <span class="token arrow operator">--&gt;</span><span class="token label property">|发布消息|</span> C1<span class="token text string">(频道)</span></span>
<span class="line">    C1 <span class="token arrow operator">--&gt;</span><span class="token label property">|订阅并接收消息|</span>R1<span class="token text string">[消费者1]</span></span>
<span class="line">    C1 <span class="token arrow operator">--&gt;</span><span class="token label property">|订阅并接收消息|</span>R2<span class="token text string">[消费者2]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="stream类型的redis消息队列" tabindex="-1"><a class="header-anchor" href="#stream类型的redis消息队列"><span>Stream类型的Redis消息队列</span></a></h2><p>Redis中的这种消息队列是作为数据类型的，也即其可以被持久化，会将消息存储到Redis中。同时也是Redis专门为消息队列设计的一种数据类型，相比前面两个类型，其更加完整，提供了诸多MQ的基础功能，如是否阻塞等待，等待时间等。</p><p>stream存储生产者提供的消息（stream内的消息不会删除），多个消费者组共享消息（订阅该stream），组内将该消息分流到一个消费者（xreadgroup）将数据放到pending-list（组内共享，每组一个）中，消费者完成后xack确认已完成并从pending-list中删除该消息</p><div class="language-mermaid line-numbers-mode" data-highlighter="prismjs" data-ext="mermaid" data-title="mermaid"><pre><code><span class="line"><span class="token keyword">graph</span> LR</span>
<span class="line">    P<span class="token text string">[生产者]</span> <span class="token arrow operator">--&gt;</span><span class="token label property">|XADD|</span> S<span class="token text string">(流)</span></span>
<span class="line">    CG1<span class="token text string">(消费者组1)</span> <span class="token arrow operator">--&gt;</span><span class="token label property">|XREADGROUP|</span> S</span>
<span class="line">    CG1 <span class="token arrow operator">--&gt;</span><span class="token label property">|确认处理|</span> P</span>
<span class="line">    CG2<span class="token text string">(消费者组2)</span> <span class="token arrow operator">--&gt;</span><span class="token label property">|XREADGROUP|</span> S</span>
<span class="line">    CG2 <span class="token arrow operator">--&gt;</span><span class="token label property">|确认处理|</span> P</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:left;">特性</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>持久化存储</strong></td><td style="text-align:left;">消息写入内存 + 可选持久化到磁盘（AOF/RDB），<strong>不会因客户端离线丢失</strong></td></tr><tr><td style="text-align:left;"><strong>消息 ID 自动生成</strong></td><td style="text-align:left;">每条消息有唯一 ID（如 <code>1678901234567-0</code>），支持按 ID 范围查询</td></tr><tr><td style="text-align:left;"><strong>消费者组（Consumer Groups）</strong></td><td style="text-align:left;">类似 Kafka：多个消费者分组协作消费，<strong>每条消息只被组内一个消费者处理</strong></td></tr><tr><td style="text-align:left;"><strong>ACK 机制</strong></td><td style="text-align:left;">消费者处理成功后需手动确认（<code>XACK</code>），失败可重试或进入死信队列</td></tr><tr><td style="text-align:left;"><strong>消息回溯</strong></td><td style="text-align:left;">可从任意 ID 开始读取历史消息（适合故障恢复、重放）</td></tr></tbody></table><p><strong>基本命令示例</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 1. 生产消息（自动分配ID）</span></span>
<span class="line">XADD mystream * event <span class="token string">&quot;user_login&quot;</span> user_id <span class="token number">1001</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2. 创建消费者组</span></span>
<span class="line">XGROUP CREATE mystream mygroup $</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3. 消费者读取消息（&gt; 表示只读新消息）</span></span>
<span class="line">XREADGROUP GROUP mygroup consumer1 COUNT <span class="token number">1</span> STREAMS mystream <span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 4. 确认消息已处理</span></span>
<span class="line">XACK mystream mygroup <span class="token number">1678901234567</span>-0</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>与其他两种类型的区别：</p><table><thead><tr><th style="text-align:left;">模式</th><th style="text-align:left;">是否持久化</th><th style="text-align:left;">消费模型</th><th style="text-align:left;">ACK</th><th style="text-align:left;">适用场景</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>Pub/Sub</strong></td><td style="text-align:left;">❌ 否</td><td style="text-align:left;">广播（所有订阅者）</td><td style="text-align:left;">❌</td><td style="text-align:left;">实时通知（允许丢失）</td></tr><tr><td style="text-align:left;"><strong>LIST</strong></td><td style="text-align:left;">❌ 否</td><td style="text-align:left;">点对点（竞争消费）</td><td style="text-align:left;">❌</td><td style="text-align:left;">简单任务队列</td></tr><tr><td style="text-align:left;"><strong>Stream</strong></td><td style="text-align:left;">✅ 是</td><td style="text-align:left;">消费者组 + 单播</td><td style="text-align:left;">✅</td><td style="text-align:left;"><strong>可靠消息队列、事件溯源</strong></td></tr></tbody></table><p>对于非消费组读<strong>XREAD</strong>，有几个特性：</p><ul><li>消息可回溯（消息不会删除）</li><li>一个消息可被多个消费者读取（非破坏式读取）</li><li>可以阻塞读取（比BLPOP更加完整完善）</li></ul><p>但是存在消息漏读的可能，所以Redis就提供了另外一种方式来防止这种情况的出现。</p><h2 id="redis-stream的消费者组" tabindex="-1"><a class="header-anchor" href="#redis-stream的消费者组"><span>Redis Stream的消费者组</span></a></h2><p><strong>消息分流</strong>：多个消费者分组协作消费，<strong>每条消息只被组内一个消费者处理</strong>，也即消息会分流给组内不同消费者（当然需要被多个消费者共同获取的话，加多个消费者组即可）。</p><p><strong>消息标识</strong>：<strong>消息不会被删除</strong>，消费的记录是通过组内维护一个<strong>标识</strong>来决定下一次读取的消息。</p><p><strong>消息确认</strong>：消费者在获取到消息后，消息处于pending状态，并存入pending-list中，处理完成后需要获取xack以标记为已处理，并从pending-list中删除（宕机时消息状态会被持久化到本地中而非直接丢失）</p><h3 id="从消费者组读取消息-xreadgroup" tabindex="-1"><a class="header-anchor" href="#从消费者组读取消息-xreadgroup"><span><strong>从消费者组读取消息：</strong><code>XREADGROUP</code></span></a></h3><p><strong>命令格式：</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">XREADGROUP GROUP group consumer <span class="token punctuation">[</span>COUNT count<span class="token punctuation">]</span> <span class="token punctuation">[</span>BLOCK milliseconds<span class="token punctuation">]</span> <span class="token punctuation">[</span>NOACK<span class="token punctuation">]</span> STREAMS key <span class="token punctuation">[</span>key <span class="token punctuation">..</span>.<span class="token punctuation">]</span> ID <span class="token punctuation">[</span>ID <span class="token punctuation">..</span>.<span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>参数详解：</strong></p><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><code>group</code></td><td style="text-align:left;">消费组名称</td></tr><tr><td style="text-align:left;"><code>consumer</code></td><td style="text-align:left;">消费者名称，若不存在会自动创建</td></tr><tr><td style="text-align:left;"><code>COUNT count</code></td><td style="text-align:left;">最多返回的消息数量，默认为 1</td></tr><tr><td style="text-align:left;"><code>BLOCK milliseconds</code></td><td style="text-align:left;">当无新消息时阻塞等待的时间（毫秒），如 <code>BLOCK 1000</code> 表示最多等 1 秒；设为 <code>0</code> 则无限等待</td></tr><tr><td style="text-align:left;"><code>NOACK</code></td><td style="text-align:left;">如果设置，获取消息后不会标记为“已确认”，适用于无需手动 ACK 的场景（一般不用，以防万一）</td></tr><tr><td style="text-align:left;"><code>STREAMS key ...</code></td><td style="text-align:left;">要读取的 Stream 名称列表</td></tr><tr><td style="text-align:left;"><code>ID</code></td><td style="text-align:left;">从哪个消息 ID 开始读取</td></tr></tbody></table><table><thead><tr><th style="text-align:left;">ID 值</th><th style="text-align:left;">含义</th></tr></thead><tbody><tr><td style="text-align:left;"><code>&quot;&gt;&quot;</code></td><td style="text-align:left;">从下一个未被消费的消息开始（推荐用于正常消费）</td></tr><tr><td style="text-align:left;"><code>&quot;0&quot;</code></td><td style="text-align:left;">从 pending-list 中第一个<strong>未确认</strong>的消息开始（常用于重试）</td></tr><tr><td style="text-align:left;"><code>&quot;1642738912000-0&quot;</code></td><td style="text-align:left;">指定某个具体的 ID 开始读取</td></tr></tbody></table><blockquote><p>💡 使用 <code>&quot;&gt;&quot;</code> 是最常见的方式，表示“给我下一条还没消费的消息”。</p></blockquote><p>读取后消息被放入组内pending-list。</p><h3 id="xack确认消息已处理" tabindex="-1"><a class="header-anchor" href="#xack确认消息已处理"><span>XACK确认消息已处理</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">XACK mystream mygroup <span class="token operator">&lt;</span>message_id<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>将指定消息从 pending list 中移除，表示已成功处理</li><li>若不 ACK，则消息会一直留在 pending list，可用于监控未完成任务</li></ul><h3 id="从pending-list中获取未确认消息" tabindex="-1"><a class="header-anchor" href="#从pending-list中获取未确认消息"><span>从pending-list中获取未确认消息</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">XPENDING mystream mygroup</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>显示当前组中所有未确认的消息</li><li>可查看哪些消费者卡住了、哪些消息需要重试</li></ul><p>后续的业务需要用到stream的消息队列的话，流程就是：</p><ol><li>生产者xadd消息到stream</li><li>消费者xreadgroup读取消息（&gt;读取最新<strong>未接收</strong>消息），消息放入组内pending-list，尝试完成相应操作</li><li>消费者xack确认消息已经完成，组内pending-list删除该消息</li><li>消费者再次读取消息（0读取<strong>未完成</strong>消息），尝试完成</li></ol><blockquote><p>MQ一般用于处理异步<strong>无需返回值</strong>业务，所以RedisStream本身不提供生产者结果获取，需要<strong>自行设计</strong>，如消费者将结果再次存入Redis的一条新的流或是String中，生产者阻塞/轮询读取存入结果。</p></blockquote><h2 id="在业务中使用stream实现异步执行" tabindex="-1"><a class="header-anchor" href="#在业务中使用stream实现异步执行"><span>在业务中使用Stream实现异步执行</span></a></h2><p>首先我们需要将消息存入消息队列，那么我们可以利用先前完成的lua脚本，在其中加入xadd完成将消息存入队列的操作：</p><div class="language-lua line-numbers-mode" data-highlighter="prismjs" data-ext="lua" data-title="lua"><pre><code><span class="line"><span class="token keyword">local</span> voucherId <span class="token operator">=</span> ARGV<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">local</span> userId <span class="token operator">=</span> ARGV<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">local</span> orderId <span class="token operator">=</span> ARGV<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token comment">-- 库存 key</span></span>
<span class="line"><span class="token keyword">local</span> stockKey <span class="token operator">=</span> <span class="token string">&quot;seckill:stock:&quot;</span> <span class="token operator">..</span> voucherId</span>
<span class="line"><span class="token comment">-- 订单 key</span></span>
<span class="line"><span class="token keyword">local</span> orderKey <span class="token operator">=</span> <span class="token string">&quot;seckill:order:&quot;</span> <span class="token operator">..</span> voucherId</span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 判断库存是否充足</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">tonumber</span><span class="token punctuation">(</span>redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> stockKey<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">then</span></span>
<span class="line">    <span class="token comment">-- 库存不足</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token number">1</span></span>
<span class="line"><span class="token keyword">end</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 判断用户是否重复下单</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;sismember&quot;</span><span class="token punctuation">,</span> orderKey<span class="token punctuation">,</span> userId<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">then</span></span>
<span class="line">    <span class="token comment">-- 用户重复下单</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token number">2</span></span>
<span class="line"><span class="token keyword">end</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 扣减库存</span></span>
<span class="line">redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;incr&quot;</span><span class="token punctuation">,</span> stockKey<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment">-- 将用户记录到 set 集合中</span></span>
<span class="line">redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;sadd&quot;</span><span class="token punctuation">,</span> orderKey<span class="token punctuation">,</span> userId<span class="token punctuation">)</span></span>
<span class="line"><span class="token comment">-- 发送消息</span></span>
<span class="line">redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;xadd&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;stream.orders&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;userId&quot;</span><span class="token punctuation">,</span> userId<span class="token punctuation">,</span> <span class="token string">&quot;voucherId&quot;</span><span class="token punctuation">,</span> voucherId<span class="token punctuation">,</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> orderId<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">return</span> <span class="token number">0</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在将lua放入业务中执行：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token doc-comment comment">/**</span>
<span class="line"> * 秒杀优惠券</span>
<span class="line"> *</span>
<span class="line"> * <span class="token keyword">@param</span> <span class="token parameter">voucherId</span> 优惠券id</span>
<span class="line"> * <span class="token keyword">@return</span> 订单id</span>
<span class="line"> */</span></span>
<span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">seckillVoucher</span><span class="token punctuation">(</span><span class="token class-name">Long</span> voucherId<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BusinessException</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 执行lua</span></span>
<span class="line">    <span class="token class-name">Long</span> userId <span class="token operator">=</span> <span class="token class-name">UserHolder</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">Long</span> id <span class="token operator">=</span> redisIdWorker<span class="token punctuation">.</span><span class="token function">nextId</span><span class="token punctuation">(</span><span class="token string">&quot;order&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 创建订单</span></span>
<span class="line">    <span class="token class-name">Long</span> result <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token constant">SECKILL_SCRIPT</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            userId<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            voucherId<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            id<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;库存不足&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;请勿重复下单&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们在lua中完成校验并将消息放入消息队列中，那么这时候就已经完成redis层的操作了，就可以直接返回结果了。</p><p>之后就只要<strong>异步</strong>完成数据库的修改，也即将传入消息队列的数据写入数据库并完成更新即可！</p><p>而现在，我们需要一个线程去循环等待redis中消息队列的消息并执行：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// 秒杀订单线程</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ExecutorService</span> <span class="token constant">SECKILL_ORDER_EXECUTOR</span> <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newSingleThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 秒杀订单初始化</span></span>
<span class="line"><span class="token annotation punctuation">@PostConstruct</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token constant">SECKILL_ORDER_EXECUTOR</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">VoucherOrderHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对应消息队列循环处理方法：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// 秒杀订单处理线程</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">VoucherOrderHandler</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">String</span> queueName <span class="token operator">=</span> <span class="token string">&quot;stream.orders&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// 获取消息队列中的订单信息 对应命令为 XREADGROUP GROUP g1 c1 COUNT 1 BLOCK 2000 STREAMS stream.orders &gt;</span></span>
<span class="line">                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MapRecord</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> read <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span></span>
<span class="line">                        <span class="token class-name">Consumer</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;g1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                        <span class="token comment">// 消费者组</span></span>
<span class="line">                        <span class="token class-name">StreamReadOptions</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">block</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// 数量</span></span>
<span class="line">                        <span class="token class-name">StreamOffset</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token class-name">ReadOffset</span><span class="token punctuation">.</span><span class="token function">lastConsumed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>         <span class="token comment">// 消费的队列</span></span>
<span class="line">                <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">// 判断是否获取到消息</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>read <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> read<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">continue</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token comment">// 成功，创建订单</span></span>
<span class="line">                <span class="token class-name">MapRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> record <span class="token operator">=</span> read<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// MapRecord是键值对: key : Map（map嵌套map）</span></span>
<span class="line">                <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> values <span class="token operator">=</span> record<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token class-name">VoucherOrder</span> order <span class="token operator">=</span> <span class="token class-name">BeanUtil</span><span class="token punctuation">.</span><span class="token function">fillBeanWithMap</span><span class="token punctuation">(</span>values<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">VoucherOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token function">handleVoucherOrder</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">// ack确认 对应命令为 XACK stream.orders g1 id</span></span>
<span class="line">                stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">acknowledge</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token string">&quot;g1&quot;</span><span class="token punctuation">,</span>record<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;处理订单异常&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">// 处理pending-list中的订单</span></span>
<span class="line">                <span class="token function">handlePendingOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 处理pending-list中的订单</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">handlePendingOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token comment">// 获取消息队列中的订单信息 对应命令为 XREADGROUP GROUP g1 c1 COUNT 1 STREAMS stream.orders 0</span></span>
<span class="line">                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MapRecord</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> read <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span></span>
<span class="line">                        <span class="token class-name">Consumer</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;g1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                      <span class="token comment">// 消费者组</span></span>
<span class="line">                        <span class="token class-name">StreamReadOptions</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                             <span class="token comment">// 数量</span></span>
<span class="line">                        <span class="token class-name">StreamOffset</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token class-name">ReadOffset</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token comment">// 消费的队列</span></span>
<span class="line">                <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">// 判断是否获取到消息</span></span>
<span class="line">                <span class="token keyword">if</span> <span class="token punctuation">(</span>read <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> read<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                    <span class="token comment">// 无异常，则返回</span></span>
<span class="line">                    <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">                <span class="token comment">// 成功，创建订单</span></span>
<span class="line">                <span class="token class-name">MapRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> record <span class="token operator">=</span> read<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// MapRecord是键值对: S : Map（map嵌套map）</span></span>
<span class="line">                <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> values <span class="token operator">=</span> record<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token class-name">VoucherOrder</span> voucherOrder <span class="token operator">=</span> <span class="token class-name">BeanUtil</span><span class="token punctuation">.</span><span class="token function">fillBeanWithMap</span><span class="token punctuation">(</span>values<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">VoucherOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token function">handleVoucherOrder</span><span class="token punctuation">(</span>voucherOrder<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token comment">// ack确认 对应命令为 XACK stream.orders g1 id</span></span>
<span class="line">                stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">acknowledge</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token string">&quot;g1&quot;</span><span class="token punctuation">,</span>record<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;处理pending-list订单异常&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>exception<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">            </span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    </span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到我们就是使用这个线程来<strong>循环read</strong> Redis中的对应消息队列的数据，倘若存在数据则<strong>获取数据</strong>，消息存入<strong>pending-list</strong>并完成数据库<strong>相关操作</strong>，如果中途发生<strong>异常</strong>导致消息处理失败，就会去处理挂起的消息（<strong>pending-list</strong>中的消息），在完成相应操作后会去<strong>ack</strong>消息，将之从pending-list中取出，确认已完成。</p><p>后续如果需要去更进一步，那就需要考虑加入线程池等方面了，那么这时候对于异常的处理，以及阻塞的安排（对pending-list中消息的处理可能存在竞争）就需要额外设计了。</p><hr><h2 id="为什么在微服务中使用rabbitmq等mq-而不是直接使用redis提供的mq" tabindex="-1"><a class="header-anchor" href="#为什么在微服务中使用rabbitmq等mq-而不是直接使用redis提供的mq"><span>为什么在微服务中使用RabbitMQ等MQ，而不是直接使用Redis提供的MQ？</span></a></h2><p><strong>Redis 不是为高可靠、持久化、复杂路由的消息传递而设计的；它是一个内存数据库，消息能力只是“附带功能”。</strong> 而 RabbitMQ/Kafka 是<strong>专为消息传递场景打造的中间件</strong>，在可靠性、一致性、扩展性、运维等方面远胜 Redis。</p><table><thead><tr><th style="text-align:left;">维度</th><th style="text-align:left;"><strong>Redis（作为 MQ）</strong></th><th style="text-align:left;"><strong>RabbitMQ / Kafka（专业 MQ）</strong></th></tr></thead><tbody><tr><td style="text-align:left;"><strong>1. 消息可靠性</strong></td><td style="text-align:left;">❌ 弱 • <code>LIST</code>/<code>PUBSUB</code> 默认<strong>不持久化</strong> • 即使开启 AOF/RDB，仍可能丢消息（如宕机时缓冲区未刷盘）</td><td style="text-align:left;">✅ 强 • 消息默认<strong>持久化到磁盘</strong> • 支持 <strong>生产者确认（Confirm） + 消费者手动 ACK</strong> • 可配置同步刷盘（如 RocketMQ）</td></tr><tr><td style="text-align:left;"><strong>2. 消息堆积能力</strong></td><td style="text-align:left;">❌ 差 • 所有数据在内存中 → 堆积大量消息会<strong>耗尽内存</strong> • 需手动管理内存淘汰策略（如 LRU）</td><td style="text-align:left;">✅ 强 • 消息存储在<strong>磁盘</strong>，可堆积 TB 级数据 • 内存仅作缓存，不影响稳定性</td></tr><tr><td style="text-align:left;"><strong>3. 消费模型</strong></td><td style="text-align:left;">⚠️ 有限 • <code>LIST</code>：点对点，但无 ACK 机制 → 消费失败即丢失 • <code>PUB/SUB</code>：广播，但<strong>不支持持久订阅</strong>（客户端断开即丢消息） • <code>Streams</code>：较新，支持消费者组，但生态弱</td><td style="text-align:left;">✅ 完善 • 支持 <strong>点对点 + 发布/订阅</strong> • <strong>消费者组（Consumer Group）</strong> • <strong>死信队列（DLQ）</strong> • <strong>延迟队列、优先级队列</strong>等高级特性</td></tr><tr><td style="text-align:left;"><strong>4. 消息顺序</strong></td><td style="text-align:left;">⚠️ 仅单流有序 • <code>LIST</code> 或 <code>Stream</code> 单 key 内有序，但无法跨 key 保证</td><td style="text-align:left;">✅ 可控 • Kafka：分区（Partition）内严格有序 • RabbitMQ：单队列有序（需单消费者）</td></tr><tr><td style="text-align:left;"><strong>5. 运维与监控</strong></td><td style="text-align:left;">❌ 弱 • 无内置消息追踪、积压监控 • 需自行开发管理界面</td><td style="text-align:left;">✅ 强 • 提供 Web UI（如 RabbitMQ Management） • 集成 Prometheus/Grafana 监控 • 支持消息轨迹、重试、回溯</td></tr><tr><td style="text-align:left;"><strong>6. 协议与生态</strong></td><td style="text-align:left;">❌ 封闭 • 仅支持 Redis 协议 • 客户端需处理底层命令（如 <code>XREADGROUP</code>）</td><td style="text-align:left;">✅ 开放 • 标准协议（AMQP、MQTT、Kafka 协议） • 丰富客户端库（Java/Python/Go/Node.js 等） • 与 Spring Cloud Stream、Flink、Spark 等无缝集成</td></tr><tr><td style="text-align:left;"><strong>7. 高可用 &amp; 扩展</strong></td><td style="text-align:left;">⚠️ 依赖 Redis 集群 • 主从复制延迟可能导致消息不一致 • 扩容需重新分片（复杂）</td><td style="text-align:left;">✅ 原生支持 • RabbitMQ：镜像队列 / Quorum Queue • Kafka：副本机制 + 自动 Leader 选举 • 水平扩展简单</td></tr></tbody></table><p><strong>场景：订单创建后发送邮件</strong></p><ul><li>用 Redis LIST： <ul><li>订单服务 <code>LPUSH order_queue {orderId}</code></li><li>邮件服务 <code>BRPOP order_queue</code></li><li><strong>风险</strong>：邮件服务处理中宕机 → 消息永久丢失（无 ACK）</li></ul></li><li>用 RabbitMQ： <ul><li>订单服务发送消息到 <code>order.created</code> 队列</li><li>邮件服务消费后<strong>手动 ACK</strong></li><li>失败时自动重回队列或进入 DLQ → <strong>消息不丢</strong></li></ul></li></ul><p><strong>场景：高并发日志收集</strong></p><ul><li><strong>Redis</strong>：内存迅速耗尽，触发淘汰策略 → 日志<strong>丢失</strong></li><li><strong>Kafka</strong>：写入磁盘，可堆积数 TB 数据，消费者按需拉取</li></ul><p><strong>Redis 适合做 MQ 的场景（少数）</strong></p><table><thead><tr><th style="text-align:left;">场景</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>轻量级任务队列</strong></td><td style="text-align:left;">如后台图片压缩、缓存预热，允许少量丢失</td></tr><tr><td style="text-align:left;"><strong>实时通知（非关键）</strong></td><td style="text-align:left;">如在线用户状态广播（用 PUB/SUB）</td></tr><tr><td style="text-align:left;"><strong>已有 Redis，不想引入新组件</strong></td><td style="text-align:left;">快速原型验证（PoC），但<strong>不建议用于生产核心链路</strong></td></tr></tbody></table><p>简单一句总结，Redis毕竟还是专门用于做<strong>缓存</strong>的内存数据库，Redis Streams只能算是添头，面对高并发场景还是选择专门的MQ更好。</p><h2 id="什么场景使用rpc-什么场景使用mq-区别在哪" tabindex="-1"><a class="header-anchor" href="#什么场景使用rpc-什么场景使用mq-区别在哪"><span>什么场景使用RPC？什么场景使用MQ？区别在哪？</span></a></h2><p>RPC（远程过程调用）和 MQ（消息队列）都是服务间通信的手段，但它们的<strong>适用场景、设计理念和系统影响截然不同</strong>。</p><blockquote><p><strong>✅ 一句话总结区别</strong><strong>RPC 是“同步调用”，追求</strong>即时响应**； MQ 是“异步通信”，追求<strong>解耦与可靠传递</strong>。**</p></blockquote><blockquote><p>💡 <strong>黄金法则</strong>：</p><ul><li><strong>要结果 → 用 RPC</strong></li><li><strong>发事件 → 用 MQ</strong></li></ul></blockquote><p><strong>一、RPC（Remote Procedure Call）—— 同步、强依赖</strong></p><p><strong>🔧 典型代表</strong></p><ul><li>gRPC、Dubbo、Spring Cloud OpenFeign、Thrift</li></ul><p><strong>🎯 核心特点</strong></p><table><thead><tr><th style="text-align:left;">特性</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>同步阻塞</strong></td><td style="text-align:left;">调用方等待被调用方返回结果（如 HTTP 请求）</td></tr><tr><td style="text-align:left;"><strong>实时性高</strong></td><td style="text-align:left;">适合需要立即得到结果的场景</td></tr><tr><td style="text-align:left;"><strong>强耦合</strong></td><td style="text-align:left;">调用方必须知道被调用方的地址、接口、协议</td></tr><tr><td style="text-align:left;"><strong>失败即中断</strong></td><td style="text-align:left;">被调用方宕机 → 调用方直接报错</td></tr></tbody></table><p><strong>✅ 适用场景（用 RPC）</strong></p><ol><li>需要立即返回结果 <ul><li>用户登录：调用认证服务验证密码 → 立即返回 token</li><li>查询商品详情：前端请求 → 聚合服务调用商品、库存、评价服务 → 拼装后返回</li></ul></li><li>事务性强的操作 <ul><li>支付前检查余额（必须同步确认）</li></ul></li><li>低延迟要求 <ul><li>实时风控、实时推荐</li></ul></li></ol><p><strong>❌ 不适用场景</strong></p><ul><li>被调用方处理慢（如生成报表）</li><li>被调用方不稳定（会导致调用方雪崩）</li><li>不关心结果（如发通知）</li></ul><hr><p><strong>二、MQ（Message Queue）—— 异步、弱依赖</strong></p><p><strong>🔧 典型代表</strong></p><ul><li>RabbitMQ、Kafka、RocketMQ</li></ul><p><strong>🎯 核心特点</strong></p><table><thead><tr><th style="text-align:left;">特性</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>异步非阻塞</strong></td><td style="text-align:left;">发完消息就返回，不等消费者处理</td></tr><tr><td style="text-align:left;"><strong>解耦</strong></td><td style="text-align:left;">生产者不知道消费者是否存在</td></tr><tr><td style="text-align:left;"><strong>削峰填谷</strong></td><td style="text-align:left;">高峰期消息堆积，消费者按能力消费</td></tr><tr><td style="text-align:left;"><strong>最终一致性</strong></td><td style="text-align:left;">不保证实时，但保证最终会处理</td></tr></tbody></table><p><strong>✅ 适用场景（用 MQ）</strong></p><ol><li>不需要立即响应 <ul><li>用户注册 → 发欢迎邮件/短信（用户不关心是否成功）</li></ul></li><li>流量削峰 <ul><li>秒杀下单 → 先入队列，订单服务匀速处理</li></ul></li><li>广播通知 <ul><li>商品价格变更 → 通知搜索、推荐、缓存服务更新</li></ul></li><li>跨系统集成 <ul><li>订单系统 → 财务系统（不同团队、不同技术栈）</li></ul></li><li>日志/监控数据收集 <ul><li>应用埋点 → Kafka → Flink 实时分析</li></ul></li></ol><p><strong>❌ 不适用场景</strong></p><ul><li>需要返回计算结果（如“计算用户积分”）</li><li>强一致性要求（如银行转账）</li></ul><hr><p><strong>三、对比表格：RPC vs MQ</strong></p><table><thead><tr><th style="text-align:left;">维度</th><th style="text-align:left;"><strong>RPC</strong></th><th style="text-align:left;"><strong>MQ</strong></th></tr></thead><tbody><tr><td style="text-align:left;"><strong>通信模式</strong></td><td style="text-align:left;">同步（请求-响应）</td><td style="text-align:left;">异步（发布-订阅 / 点对点）</td></tr><tr><td style="text-align:left;"><strong>耦合度</strong></td><td style="text-align:left;">高（需知道对方接口）</td><td style="text-align:left;">低（只需约定消息格式）</td></tr><tr><td style="text-align:left;"><strong>可靠性</strong></td><td style="text-align:left;">依赖网络和对方可用性</td><td style="text-align:left;">消息持久化，可重试，不丢</td></tr><tr><td style="text-align:left;"><strong>延迟</strong></td><td style="text-align:left;">低（ms 级）</td><td style="text-align:left;">较高（可能秒级，取决于消费速度）</td></tr><tr><td style="text-align:left;"><strong>吞吐量</strong></td><td style="text-align:left;">受限于被调用方处理能力</td><td style="text-align:left;">高（生产快，消费可慢）</td></tr><tr><td style="text-align:left;"><strong>错误处理</strong></td><td style="text-align:left;">直接抛异常</td><td style="text-align:left;">可重试、死信队列、人工干预</td></tr><tr><td style="text-align:left;"><strong>典型协议</strong></td><td style="text-align:left;">HTTP/2, TCP, Dubbo 协议</td><td style="text-align:left;">AMQP, Kafka 协议, 自定义</td></tr><tr><td style="text-align:left;"><strong>系统复杂度</strong></td><td style="text-align:left;">低（像本地调用）</td><td style="text-align:left;">高（需管理消息格式、幂等、积压）</td></tr></tbody></table><p><strong>✅ 总结</strong></p><table><thead><tr><th style="text-align:left;">场景</th><th style="text-align:left;">推荐</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>查数据、做决策、强一致性</strong></td><td style="text-align:left;">✅ RPC</td></tr><tr><td style="text-align:left;"><strong>发通知、记日志、削峰、广播</strong></td><td style="text-align:left;">✅ MQ</td></tr><tr><td style="text-align:left;"><strong>核心交易链路</strong></td><td style="text-align:left;">RPC（同步校验） + MQ（异步后续）</td></tr><tr><td style="text-align:left;"><strong>跨团队/跨语言系统集成</strong></td><td style="text-align:left;">优先 MQ（解耦）</td></tr></tbody></table><div class="language-mermaid line-numbers-mode" data-highlighter="prismjs" data-ext="mermaid" data-title="mermaid"><pre><code><span class="line"><span class="token keyword">graph</span> TD</span>
<span class="line">    A<span class="token text string">[需要调用其他服务？]</span> <span class="token arrow operator">--&gt;</span> B<span class="token text string">{需要立即返回结果吗？}</span></span>
<span class="line">    B <span class="token arrow operator">--&gt;</span><span class="token label property">|是|</span> C<span class="token text string">[用 RPC]</span></span>
<span class="line">    B <span class="token arrow operator">--&gt;</span><span class="token label property">|否|</span> D<span class="token text string">{操作是否关键？&lt;br&gt;（失败会导致业务中断）}</span></span>
<span class="line">    D <span class="token arrow operator">--&gt;</span><span class="token label property">|是|</span> E<span class="token text string">[考虑 RPC + 重试 或 Saga 事务]</span></span>
<span class="line">    D <span class="token arrow operator">--&gt;</span><span class="token label property">|否|</span> F<span class="token text string">[用 MQ]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="新开线程内调用bean对象的动态代理-其的增强会生效吗" tabindex="-1"><a class="header-anchor" href="#新开线程内调用bean对象的动态代理-其的增强会生效吗"><span>新开线程内调用Bean对象的动态代理，其的增强会生效吗？</span></a></h2><p>是可以的，但是比如<code>@Transactional</code>就是可以在<strong>线程内部</strong>正常开启的，但是由于和外部线程不是一个上下文，事务是无法传播到外部合成一个的。</p><h2 id="stringredistemplate的opsforstream的相关操作" tabindex="-1"><a class="header-anchor" href="#stringredistemplate的opsforstream的相关操作"><span>StringRedisTemplate的opsForStream的相关操作</span></a></h2><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// 获取消息队列中的订单信息 对应命令为 XREADGROUP GROUP g1 c1 COUNT 1 BLOCK 2000 STREAMS stream.orders &gt;</span></span>
<span class="line">                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MapRecord</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> read <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span></span>
<span class="line">                        <span class="token class-name">Consumer</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;g1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                      	<span class="token comment">// 消费者组</span></span>
<span class="line">                        <span class="token class-name">StreamReadOptions</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">block</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment">// 数量</span></span>
<span class="line">                        <span class="token class-name">StreamOffset</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token class-name">ReadOffset</span><span class="token punctuation">.</span><span class="token function">lastConsumed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>           <span class="token comment">// 消费的队列</span></span>
<span class="line">                <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:left;">功能</th><th style="text-align:left;">方法</th></tr></thead><tbody><tr><td style="text-align:left;">写入消息</td><td style="text-align:left;"><code>add(StreamRecords)</code></td></tr><tr><td style="text-align:left;">消费者组读取</td><td style="text-align:left;"><code>read(Consumer, StreamReadOptions, StreamOffset...)</code></td></tr><tr><td style="text-align:left;">普通读取</td><td style="text-align:left;"><code>read(StreamReadOptions, StreamOffset...)</code></td></tr><tr><td style="text-align:left;">确认消息</td><td style="text-align:left;"><code>acknowledge(String group, Record)</code></td></tr><tr><td style="text-align:left;">查看 Pending</td><td style="text-align:left;"><code>pending(String key, String group)</code></td></tr><tr><td style="text-align:left;">转移消息</td><td style="text-align:left;"><code>claim(...)</code></td></tr><tr><td style="text-align:left;">创建组</td><td style="text-align:left;"><code>createGroup(...)</code></td></tr><tr><td style="text-align:left;">删除消息</td><td style="text-align:left;"><code>delete(...)</code></td></tr><tr><td style="text-align:left;">裁剪 Stream</td><td style="text-align:left;"><code>trim(...)</code></td></tr></tbody></table><h3 id="_1-写入消息-xadd" tabindex="-1"><a class="header-anchor" href="#_1-写入消息-xadd"><span><strong>1.</strong> <strong>写入消息（XADD）</strong></span></a></h3><p><strong>方法：</strong></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">String</span> id <span class="token operator">=</span> streamOps<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token class-name">StreamRecords</span><span class="token punctuation">.</span><span class="token function">newRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">ofObject</span><span class="token punctuation">(</span>orderMap<span class="token punctuation">)</span>           <span class="token comment">// 消息内容（Map&lt;String, ?&gt;）</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">withStreamKey</span><span class="token punctuation">(</span><span class="token string">&quot;stream.orders&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>更精细控制：</strong></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">String</span> id <span class="token operator">=</span> streamOps<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token class-name">StreamRecords</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">&quot;stream.orders&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token function">ofEntries</span><span class="token punctuation">(</span><span class="token string">&quot;orderId&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;amount&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;99.9&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>✅ 支持指定 ID（如 <code>&quot;*&quot;</code> 自动生成）、设置 <code>MAXLEN</code> 自动裁剪：</p></blockquote><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">streamOps<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">StreamRecords</span><span class="token punctuation">.</span><span class="token function">newRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">ofObject</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">withStreamKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">.</span><span class="token function">withMaxLen</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>  <span class="token comment">// XADD ... MAXLEN ～ 1000</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="_2-读取消息-xread-xreadgroup" tabindex="-1"><a class="header-anchor" href="#_2-读取消息-xread-xreadgroup"><span><strong>2.</strong> <strong>读取消息（XREAD / XREADGROUP）</strong></span></a></h3><p><strong>(1) 普通读取（无消费者组）</strong></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MapRecord</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> streamOps<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token class-name">StreamReadOptions</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">block</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">StreamOffset</span><span class="token punctuation">.</span><span class="token function">fromStart</span><span class="token punctuation">(</span><span class="token string">&quot;mystream&quot;</span><span class="token punctuation">)</span>   <span class="token comment">// 从开头读</span></span>
<span class="line">    <span class="token comment">// 或 StreamOffset.latest(&quot;mystream&quot;)  // 从最新</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>(2)</strong> <strong>消费者组读取</strong></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MapRecord</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> read <span class="token operator">=</span> streamOps<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token class-name">Consumer</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;g1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token comment">// 消费者组 g1，消费者 c1</span></span>
<span class="line">    <span class="token class-name">StreamReadOptions</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">block</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">StreamOffset</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;stream.orders&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ReadOffset</span><span class="token punctuation">.</span><span class="token function">lastConsumed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 相当于 &quot;&gt;&quot;</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>🔍 <code>ReadOffset.lastConsumed()</code> 对应 Redis 的 <code>&quot;&gt;&quot;</code>，表示“读取下一个未消费的消息”。</p></blockquote><p><strong>(3) 从 Pending List 重试（对应 ID = &quot;0&quot;）</strong></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MapRecord</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> pending <span class="token operator">=</span> streamOps<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token class-name">Consumer</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;g1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">StreamReadOptions</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">StreamOffset</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;stream.orders&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ReadOffset</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 从 pending 开始</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="_3-确认消息-xack" tabindex="-1"><a class="header-anchor" href="#_3-确认消息-xack"><span><strong>3.</strong> <strong>确认消息（XACK）</strong></span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">Long</span> ackCount <span class="token operator">=</span> streamOps<span class="token punctuation">.</span><span class="token function">acknowledge</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token string">&quot;stream.orders&quot;</span><span class="token punctuation">,</span>     <span class="token comment">// Stream key</span></span>
<span class="line">    <span class="token string">&quot;g1&quot;</span><span class="token punctuation">,</span>                <span class="token comment">// 消费者组</span></span>
<span class="line">    <span class="token string">&quot;1642738912000-0&quot;</span>    <span class="token comment">// 消息 ID（可传多个）</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 或从 Record 中直接 ACK</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>read<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">MapRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> record <span class="token operator">=</span> read<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    streamOps<span class="token punctuation">.</span><span class="token function">acknowledge</span><span class="token punctuation">(</span><span class="token string">&quot;g1&quot;</span><span class="token punctuation">,</span> record<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 自动提取 key + id</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>✅ 推荐使用 <code>acknowledge(group, record)</code>，更安全。</p></blockquote><hr><h3 id="_4-查看-pending-信息-xpending" tabindex="-1"><a class="header-anchor" href="#_4-查看-pending-信息-xpending"><span><strong>4.</strong> <strong>查看 Pending 信息（XPENDING）</strong></span></a></h3><p><strong>(1) 获取组级别统计</strong></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">PendingMessagesSummary</span> pendingSummary <span class="token operator">=</span> streamOps<span class="token punctuation">.</span><span class="token function">pending</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token string">&quot;stream.orders&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;g1&quot;</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Total pending: &quot;</span> <span class="token operator">+</span> pendingSummary<span class="token punctuation">.</span><span class="token function">getTotalPendingMessages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Earliest ID: &quot;</span> <span class="token operator">+</span> pendingSummary<span class="token punctuation">.</span><span class="token function">getEarliestMessageId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>(2) 获取具体 Pending 消息详情（含消费者、重试次数）</strong></p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PendingMessages</span><span class="token punctuation">&gt;</span></span> pendingDetails <span class="token operator">=</span> streamOps<span class="token punctuation">.</span><span class="token function">pending</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token string">&quot;stream.orders&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">Consumer</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;g1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// 可指定消费者</span></span>
<span class="line">    <span class="token class-name">Range</span><span class="token punctuation">.</span><span class="token function">unbounded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token comment">// ID 范围，如 Range.closed(&quot;0&quot;, &quot;+&quot;)</span></span>
<span class="line">    <span class="token number">10</span>                          <span class="token comment">// 最多返回条数</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>返回的 <code>PendingMessages</code> 包含：</p><ul><li><code>getId()</code></li><li><code>getConsumerName()</code></li><li><code>getElapsedTimeSinceLastDelivery()</code>（毫秒）</li><li><code>getDeliveryCount()</code></li></ul></blockquote><hr><h3 id="_5-转移消息所有权-xclaim" tabindex="-1"><a class="header-anchor" href="#_5-转移消息所有权-xclaim"><span><strong>5.</strong> <strong>转移消息所有权（XCLAIM）</strong></span></a></h3><p>用于将长时间未处理的 Pending 消息转移给其他消费者（实现“死信处理”）：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MapRecord</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> claimed <span class="token operator">=</span> streamOps<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token string">&quot;stream.orders&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;g1&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;new-consumer&quot;</span><span class="token punctuation">,</span>             <span class="token comment">// 新消费者</span></span>
<span class="line">    <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token comment">// min-idle-time：至少空闲 5 分钟才转移</span></span>
<span class="line">    <span class="token string">&quot;1642738912000-0&quot;</span>           <span class="token comment">// 消息 ID</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>⚠️ 通常配合 <code>XPENDING</code> 使用：先查出高 <code>deliveryCount</code> 的消息，再 <code>XCLAIM</code> 转移。</p></blockquote><hr><h3 id="_6-创建-删除消费者组-xgroup-create-destroy" tabindex="-1"><a class="header-anchor" href="#_6-创建-删除消费者组-xgroup-create-destroy"><span><strong>6.</strong> <strong>创建/删除消费者组（XGROUP CREATE / DESTROY）</strong></span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// 创建消费者组（从最新开始）</span></span>
<span class="line">streamOps<span class="token punctuation">.</span><span class="token function">createGroup</span><span class="token punctuation">(</span><span class="token string">&quot;stream.orders&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ReadOffset</span><span class="token punctuation">.</span><span class="token function">lastConsumed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;g1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 从开头创建</span></span>
<span class="line">streamOps<span class="token punctuation">.</span><span class="token function">createGroup</span><span class="token punctuation">(</span><span class="token string">&quot;stream.orders&quot;</span><span class="token punctuation">,</span> <span class="token class-name">ReadOffset</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;g1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 删除消费者组</span></span>
<span class="line">streamOps<span class="token punctuation">.</span><span class="token function">destroyGroup</span><span class="token punctuation">(</span><span class="token string">&quot;stream.orders&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;g1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>💡 如果组已存在，<code>createGroup</code> 会抛异常。可先用 <code>XINFO GROUPS</code> 检查（但 Spring Data Redis 未直接暴露）。</p></blockquote><hr><h3 id="_7-其他实用操作" tabindex="-1"><a class="header-anchor" href="#_7-其他实用操作"><span><strong>7.</strong> <strong>其他实用操作</strong></span></a></h3><table><thead><tr><th style="text-align:left;">操作</th><th style="text-align:left;">方法</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>删除消息</strong></td><td style="text-align:left;"><code>streamOps.delete(&quot;stream.orders&quot;, &quot;id1&quot;, &quot;id2&quot;)</code></td><td style="text-align:left;">对应 <code>XDEL</code></td></tr><tr><td style="text-align:left;"><strong>裁剪 Stream</strong></td><td style="text-align:left;"><code>streamOps.trim(&quot;stream.orders&quot;, 1000)</code></td><td style="text-align:left;">保留最近 1000 条（<code>XTRIM MAXLEN ～ 1000</code>）</td></tr><tr><td style="text-align:left;"><strong>获取长度</strong></td><td style="text-align:left;"><code>streamOps.size(&quot;stream.orders&quot;)</code></td><td style="text-align:left;">对应 <code>XLEN</code></td></tr><tr><td style="text-align:left;"><strong>读取范围</strong></td><td style="text-align:left;"><code>streamOps.range(&quot;stream.orders&quot;, Range.unbounded())</code></td><td style="text-align:left;">对应 <code>XRANGE</code></td></tr></tbody></table></div></div><footer class="page-meta"><div class="meta-item edit-link"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M2 26h28v2H2z" fill="currentColor"></path><path d="M25.4 9c.8-.8.8-2 0-2.8l-3.6-3.6c-.8-.8-2-.8-2.8 0l-15 15V24h6.4l15-15zm-5-5L24 7.6l-3 3L17.4 7l3-3zM6 22v-3.6l10-10l3.6 3.6l-10 10H6z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Edit this page<!--]--></span></span></div><div class="meta-item last-updated"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Last Updated 2/16/2026, 10:21:10 AM<!--]--></span></span></div></footer><nav class="page-nav"><p class="hasPrev hasNext inner"><span class="page-nav-item prev"> ← 秒杀优化</span><span class="page-nav-item next">达人探店 → </span></p></nav><!----></div><div class="page-catalog-container"><h5 class="tip">ON THIS PAGE</h5><ul><!--[--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/6.Redisxiaoxiduilie.html#消息队列" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="消息队列"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->消息队列<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/6.Redisxiaoxiduilie.html#list类型的redis消息队列" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="List类型的Redis消息队列"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->List类型的Redis消息队列<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/6.Redisxiaoxiduilie.html#pubsub类型的redis消息队列" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="PubSub类型的Redis消息队列"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->PubSub类型的Redis消息队列<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/6.Redisxiaoxiduilie.html#stream类型的redis消息队列" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Stream类型的Redis消息队列"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Stream类型的Redis消息队列<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/6.Redisxiaoxiduilie.html#redis-stream的消费者组" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Redis Stream的消费者组"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redis Stream的消费者组<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/docs/heimadianping/yewusheji/6.Redisxiaoxiduilie.html#从消费者组读取消息-xreadgroup" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="从消费者组读取消息：XREADGROUP"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->从消费者组读取消息：XREADGROUP<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/docs/heimadianping/yewusheji/6.Redisxiaoxiduilie.html#xack确认消息已处理" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="XACK确认消息已处理"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->XACK确认消息已处理<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/docs/heimadianping/yewusheji/6.Redisxiaoxiduilie.html#从pending-list中获取未确认消息" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="从pending-list中获取未确认消息"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->从pending-list中获取未确认消息<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/6.Redisxiaoxiduilie.html#在业务中使用stream实现异步执行" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="在业务中使用Stream实现异步执行"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->在业务中使用Stream实现异步执行<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/6.Redisxiaoxiduilie.html#为什么在微服务中使用rabbitmq等mq-而不是直接使用redis提供的mq" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="为什么在微服务中使用RabbitMQ等MQ，而不是直接使用Redis提供的MQ？"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->为什么在微服务中使用RabbitMQ等MQ，而不是直接使用Redis提供的MQ？<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/6.Redisxiaoxiduilie.html#什么场景使用rpc-什么场景使用mq-区别在哪" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="什么场景使用RPC？什么场景使用MQ？区别在哪？"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->什么场景使用RPC？什么场景使用MQ？区别在哪？<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/6.Redisxiaoxiduilie.html#新开线程内调用bean对象的动态代理-其的增强会生效吗" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="新开线程内调用Bean对象的动态代理，其的增强会生效吗？"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->新开线程内调用Bean对象的动态代理，其的增强会生效吗？<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/6.Redisxiaoxiduilie.html#stringredistemplate的opsforstream的相关操作" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="StringRedisTemplate的opsForStream的相关操作"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->StringRedisTemplate的opsForStream的相关操作<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/docs/heimadianping/yewusheji/6.Redisxiaoxiduilie.html#_1-写入消息-xadd" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1. 写入消息（XADD）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1. 写入消息（XADD）<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/docs/heimadianping/yewusheji/6.Redisxiaoxiduilie.html#_2-读取消息-xread-xreadgroup" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2. 读取消息（XREAD / XREADGROUP）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2. 读取消息（XREAD / XREADGROUP）<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/docs/heimadianping/yewusheji/6.Redisxiaoxiduilie.html#_3-确认消息-xack" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="3. 确认消息（XACK）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->3. 确认消息（XACK）<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/docs/heimadianping/yewusheji/6.Redisxiaoxiduilie.html#_4-查看-pending-信息-xpending" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="4. 查看 Pending 信息（XPENDING）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->4. 查看 Pending 信息（XPENDING）<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/docs/heimadianping/yewusheji/6.Redisxiaoxiduilie.html#_5-转移消息所有权-xclaim" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="5. 转移消息所有权（XCLAIM）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->5. 转移消息所有权（XCLAIM）<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/docs/heimadianping/yewusheji/6.Redisxiaoxiduilie.html#_6-创建-删除消费者组-xgroup-create-destroy" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="6. 创建/删除消费者组（XGROUP CREATE / DESTROY）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->6. 创建/删除消费者组（XGROUP CREATE / DESTROY）<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/docs/heimadianping/yewusheji/6.Redisxiaoxiduilie.html#_7-其他实用操作" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="7. 其他实用操作"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->7. 其他实用操作<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--]--></ul></div></main><!--]--></div></div><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-Cm4IjFjh.js" defer></script>
  </body>
</html>
