<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.19">
    <script>
      (function() {
        const userMode = localStorage.getItem('vuepress-reco-color-scheme') || 'auto';
        const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (userMode === 'dark' || (userMode === 'auto' && systemDarkMode)) {
          document.documentElement.classList.toggle('dark', true);
        }
      })();
    </script>
    <title>分布式锁 | SaltFishGC`s Blog</title><meta name="description" content="">
    <link rel="preload" href="/assets/style-C9PpFGGJ.css" as="style"><link rel="stylesheet" href="/assets/style-C9PpFGGJ.css">
    <link rel="modulepreload" href="/assets/app-CohX4sgD.js"><link rel="modulepreload" href="/assets/4.fenbushisuo(Redisson).html-B8rfKQZO.js">
    <link rel="prefetch" href="/assets/timeline.html-CJnUNOiG.js" as="script"><link rel="prefetch" href="/assets/posts.html-CyjqF1X3.js" as="script"><link rel="prefetch" href="/assets/friendship-link.html-CnoDh8Pl.js" as="script"><link rel="prefetch" href="/assets/1.html-Deb0wl9t.js" as="script"><link rel="prefetch" href="/assets/1.html-DQ0oLu5A.js" as="script"><link rel="prefetch" href="/assets/1.html-Chy6btsl.js" as="script"><link rel="prefetch" href="/assets/index.html-CGMpkAW6.js" as="script"><link rel="prefetch" href="/assets/121501.html-DhjgC1PS.js" as="script"><link rel="prefetch" href="/assets/260215.html-DwZxTZys.js" as="script"><link rel="prefetch" href="/assets/changyongmingling.html-CnYU88yb.js" as="script"><link rel="prefetch" href="/assets/Eletronsuji.html-BdTrk40t.js" as="script"><link rel="prefetch" href="/assets/WebSocketkehuduan.html-DJBZAuQj.js" as="script"><link rel="prefetch" href="/assets/nginx.html-DQ3vw1XP.js" as="script"><link rel="prefetch" href="/assets/session，token，jwt.html-Dj3XmX1n.js" as="script"><link rel="prefetch" href="/assets/sqlitebendihuancun.html-D5pRPA1S.js" as="script"><link rel="prefetch" href="/assets/vuejibensuji.html-WyqmwpVR.js" as="script"><link rel="prefetch" href="/assets/xiugaisheji.html-Cz73i282.js" as="script"><link rel="prefetch" href="/assets/yudaodewenti（qianduan.html-BhtUwJ-M.js" as="script"><link rel="prefetch" href="/assets/Nettysuji.html-Dkx9xZ8d.js" as="script"><link rel="prefetch" href="/assets/yewuzhongxuedaodedongxi（houduan.html-DcvMawhj.js" as="script"><link rel="prefetch" href="/assets/xiugaisheji（houduan.html-_C0W27XV.js" as="script"><link rel="prefetch" href="/assets/tongyangdeyewuchangjing，weixinshizenmezuode？.html-BA0Wtdeh.js" as="script"><link rel="prefetch" href="/assets/duidaimashengchengqideyouhua.html-C70nKC1T.js" as="script"><link rel="prefetch" href="/assets/shujukuhehuancuncunchuxingshizhengli.html-DGhN31rl.js" as="script"><link rel="prefetch" href="/assets/yudaodewenti（houduan.html-BP3c5r-_.js" as="script"><link rel="prefetch" href="/assets/1.jianjie.html-CyCkke6K.js" as="script"><link rel="prefetch" href="/assets/2.zidingyirongqi.html-DsYxrUAc.js" as="script"><link rel="prefetch" href="/assets/3.yingyongbushu.html-C_CriUZk.js" as="script"><link rel="prefetch" href="/assets/4.rongqijiantongxin.html-CTQg4J3_.js" as="script"><link rel="prefetch" href="/assets/1.jianjie.html-DiPvruqX.js" as="script"><link rel="prefetch" href="/assets/2.Wrapper.html-tMAnrQEA.js" as="script"><link rel="prefetch" href="/assets/3.jieheWrapperhemapper.html-C_p7QUOr.js" as="script"><link rel="prefetch" href="/assets/4.zizhiSQL.html-BLT2egI-.js" as="script"><link rel="prefetch" href="/assets/5.IService.html-C70JQG8a.js" as="script"><link rel="prefetch" href="/assets/6.IServicedelambdalianshidiaoyong.html-DoxDUwe3.js" as="script"><link rel="prefetch" href="/assets/7.IServicedepiliangcharu.html-C1J0dY_9.js" as="script"><link rel="prefetch" href="/assets/8.fenyechajian.html-kUKP__xM.js" as="script"><link rel="prefetch" href="/assets/9.ewaigongnen.html-C3982nsI.js" as="script"><link rel="prefetch" href="/assets/1.Spring.html-9kK1BSe_.js" as="script"><link rel="prefetch" href="/assets/2.JWT.html-rP_feSnk.js" as="script"><link rel="prefetch" href="/assets/3.weifuwu.html-S9G2d9R-.js" as="script"><link rel="prefetch" href="/assets/1.bushuyuanxiangmu.html-19x5OYG5.js" as="script"><link rel="prefetch" href="/assets/10.ElasticSearch.html-CeE25xl8.js" as="script"><link rel="prefetch" href="/assets/2.xiangmuchuburenshi.html-BI8C8aIu.js" as="script"><link rel="prefetch" href="/assets/3.fuwuguanli（zhucezhongxinNacos）.html-8C7V-rEF.js" as="script"><link rel="prefetch" href="/assets/4.yuanchengdiaoyong（OpenFeign）.html-DZyKMbVR.js" as="script"><link rel="prefetch" href="/assets/5.weifuwuwangguan（Gateway）.html-Cek4u3Xf.js" as="script"><link rel="prefetch" href="/assets/6.peizhiguanli（peizhizhongxinNacos）.html-DytgU3l5.js" as="script"><link rel="prefetch" href="/assets/7.fuwubaohu（Sentinelrongduanxianliu）.html-C2qIR8vu.js" as="script"><link rel="prefetch" href="/assets/8.fenbushishiwu（Seata）.html-BNv2p4Qq.js" as="script"><link rel="prefetch" href="/assets/9.xiaoxiduilie（MQ）.html-x7MhsdUq.js" as="script"><link rel="prefetch" href="/assets/EX：Commonmokuaidezhuyishixiang.html-DRX-lmcQ.js" as="script"><link rel="prefetch" href="/assets/EX：lianluzhuizong.html-OHavOWDh.js" as="script"><link rel="prefetch" href="/assets/1.duanxindenglu.html-D_fTtJ3k.js" as="script"><link rel="prefetch" href="/assets/10.yonghuqiandao.html-C9GxvzMQ.js" as="script"><link rel="prefetch" href="/assets/11.uvtongji.html-Boc_FuNM.js" as="script"><link rel="prefetch" href="/assets/2.huancun.html-ErmjpVVS.js" as="script"><link rel="prefetch" href="/assets/3.youhuiquanmiaosha.html-DKz5X76y.js" as="script"><link rel="prefetch" href="/assets/5.miaoshayouhua.html-D9U4uA8i.js" as="script"><link rel="prefetch" href="/assets/6.Redisxiaoxiduilie.html-Cr-SGX-j.js" as="script"><link rel="prefetch" href="/assets/7.darentandian.html-CbsNBjgT.js" as="script"><link rel="prefetch" href="/assets/8.haoyouguanzhu.html-Dsbmlb3H.js" as="script"><link rel="prefetch" href="/assets/9.fujianshangpu.html-AYFWlueq.js" as="script"><link rel="prefetch" href="/assets/nacuntaihuan.html-DzuOgHL7.js" as="script"><link rel="prefetch" href="/assets/shujujiegou.html-CxBvPy4h.js" as="script"><link rel="prefetch" href="/assets/wangluomoxing.html-Bbb03rE3.js" as="script"><link rel="prefetch" href="/assets/tongxinxieyi.html-6tR5l8K9.js" as="script"><link rel="prefetch" href="/assets/duiRedisUtildegengxin.html-Cl5NlBD9.js" as="script"><link rel="prefetch" href="/assets/Redistexing.html-VhXCLeSF.js" as="script"><link rel="prefetch" href="/assets/changjianyewuwentijibaguwen.html-CHNpyiff.js" as="script"><link rel="prefetch" href="/assets/zaqizabadeyichang.html-DS8Umup6.js" as="script"><link rel="prefetch" href="/assets/baozhuangjianli.html-D683XGj0.js" as="script"><link rel="prefetch" href="/assets/changyongmingling.html-C8_Vco6X.js" as="script"><link rel="prefetch" href="/assets/jianjie.html-m2CZ4AiO.js" as="script"><link rel="prefetch" href="/assets/1.fenbushihuancun.html-BJS0yc8_.js" as="script"><link rel="prefetch" href="/assets/2.duojihuancun.html-CUJSyNKP.js" as="script"><link rel="prefetch" href="/assets/3.zuijiashijian.html-CAmbwx4u.js" as="script"><link rel="prefetch" href="/assets/Rediscunzaidewenti.html-D35Rwt1w.js" as="script"><link rel="prefetch" href="/assets/404.html-XyvByaiD.js" as="script"><link rel="prefetch" href="/assets/Valine.min-C61SASqw.js" as="script"><link rel="prefetch" href="/assets/giscus-aTimukGI-DWEKOTfS.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container show-series show-catalog"><header class="navbar-container not-open"><div class="navbar-inner"><div class="site-brand nav-item"><img class="logo" src="/doge.jpg" alt="SaltFishGC`s Blog"><a href="/" class="site-name can-hide">SaltFishGC`s Blog</a></div><div class="nav-item navbar-links-wrapper" style=""><div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div><nav class="navbar-links"><!--[--><div class="navbar-links__item"><a href="/" class="link" aria-label="主页"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->主页<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/categories/blog/1.html" class="link" aria-label="Blog"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Blog<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="笔记"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->笔记<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="笔记"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->笔记<!--]--></span></span></span><span class="right arrow"></span></button><ul class="dropdown-link__container" style="display:none;"><!--[--><li class="dropdown-link__item"><a href="/docs/wx/常用命令" class="link" aria-label="仿wx"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->仿wx<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/docs/黑马点评/项目相关/简介" class="link" aria-label="黑马点评"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->黑马点评<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/docs/黑马商城/Docker/1.简介" class="link" aria-label="黑马商城"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->黑马商城<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--><!----><!----><ul class="social-links navbar-links__item"><!--[--><li class="social-item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:25px;height:25px;"><path d="M16 2a14 14 0 0 0-4.43 27.28c.7.13 1-.3 1-.67v-2.38c-3.89.84-4.71-1.88-4.71-1.88a3.71 3.71 0 0 0-1.62-2.05c-1.27-.86.1-.85.1-.85a2.94 2.94 0 0 1 2.14 1.45a3 3 0 0 0 4.08 1.16a2.93 2.93 0 0 1 .88-1.87c-3.1-.36-6.37-1.56-6.37-6.92a5.4 5.4 0 0 1 1.44-3.76a5 5 0 0 1 .14-3.7s1.17-.38 3.85 1.43a13.3 13.3 0 0 1 7 0c2.67-1.81 3.84-1.43 3.84-1.43a5 5 0 0 1 .14 3.7a5.4 5.4 0 0 1 1.44 3.76c0 5.38-3.27 6.56-6.39 6.91a3.33 3.33 0 0 1 .95 2.59v3.84c0 .46.25.81 1 .67A14 14 0 0 0 16 2z" fill-rule="evenodd" fill="currentColor"></path></svg></li><!--]--></ul></nav><span class="xicon-container btn-toggle-menus"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><circle cx="16" cy="8" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="24" r="2" fill="currentColor"></circle></svg></span></div></div></header><header class="sub-navbar-container not-open"><span class="nav-item"><div class="toggle-series-button" aria-expanded="false" role="button" tabindex="0"><span></span><span></span><span></span></div> Series </span></header><!----><!----><div class="theme-main" style=""><aside class="series-container"><!--[--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->仿wx<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->常用命令<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/wx/changyongmingling.html" class="link series-item series-item" aria-label="常用命令"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->常用命令<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->前端部分<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/wx/qianduanbufen/Eletronsuji.html" class="link series-item series-item" aria-label="Eletron速记"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Eletron速记<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/qianduanbufen/WebSocketkehuduan.html" class="link series-item series-item" aria-label="WebSocket客户端"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->WebSocket客户端<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/qianduanbufen/nginx.html" class="link series-item series-item" aria-label="NGINX"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->NGINX<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/qianduanbufen/session，token，jwt.html" class="link series-item series-item" aria-label="session，token，jwt"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->session，token，jwt<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/qianduanbufen/sqlitebendihuancun.html" class="link series-item series-item" aria-label="sqlite本地缓存"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->sqlite本地缓存<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/qianduanbufen/vuejibensuji.html" class="link series-item series-item" aria-label="vue基本速记"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->vue基本速记<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/qianduanbufen/xiugaisheji.html" class="link series-item series-item" aria-label="修改设计"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->修改设计<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/qianduanbufen/yudaodewenti（qianduan.html" class="link series-item series-item" aria-label="遇到的问题（前端）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->遇到的问题（前端）<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->后端部分<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/wx/houduanbufen/Nettysuji.html" class="link series-item series-item" aria-label="Netty速记"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Netty速记<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/houduanbufen/yewuzhongxuedaodedongxi（houduan.html" class="link series-item series-item" aria-label="业务中学到的东西（后端）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->业务中学到的东西（后端）<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/houduanbufen/xiugaisheji（houduan.html" class="link series-item series-item" aria-label="修改设计"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->修改设计<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/houduanbufen/tongyangdeyewuchangjing，weixinshizenmezuode？.html" class="link series-item series-item" aria-label="微信是怎么去解决一些问题的"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->微信是怎么去解决一些问题的<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/houduanbufen/duidaimashengchengqideyouhua.html" class="link series-item series-item" aria-label="对代码生成器的优化"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->对代码生成器的优化<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/houduanbufen/shujukuhehuancuncunchuxingshizhengli.html" class="link series-item series-item" aria-label="数据库和缓存存储形式整理"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->数据库和缓存存储形式整理<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/houduanbufen/yudaodewenti（houduan.html" class="link series-item series-item" aria-label="遇到的问题（后端）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->遇到的问题（后端）<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1 active"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->黑马点评<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->项目相关<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimadianping/xiangmuxiangguan/jianjie.html" class="link series-item series-item" aria-label="项目简介"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->项目简介<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/xiangmuxiangguan/changyongmingling.html" class="link series-item series-item" aria-label="常用命令"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->常用命令<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/xiangmuxiangguan/baozhuangjianli.html" class="link series-item series-item" aria-label="包装简历"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->包装简历<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->业务设计<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimadianping/yewusheji/1.duanxindenglu.html" class="link series-item series-item" aria-label="短信登录（session）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->短信登录（session）<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/2.huancun.html" class="link series-item series-item" aria-label="缓存"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->缓存<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/3.youhuiquanmiaosha.html" class="link series-item series-item" aria-label="优惠券秒杀"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->优惠券秒杀<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a aria-current="page" href="/docs/heimadianping/yewusheji/4.fenbushisuo(Redisson).html" class="router-link-active router-link-exact-active link router-link-active series-item series-item" aria-label="分布式锁"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->分布式锁<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/5.miaoshayouhua.html" class="link series-item series-item" aria-label="秒杀优化"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->秒杀优化<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/6.Redisxiaoxiduilie.html" class="link series-item series-item" aria-label="Redis消息队列"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redis消息队列<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/7.darentandian.html" class="link series-item series-item" aria-label="达人探店"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->达人探店<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/8.haoyouguanzhu.html" class="link series-item series-item" aria-label="好友关注"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->好友关注<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/9.fujianshangpu.html" class="link series-item series-item" aria-label="附件商铺"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->附件商铺<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/10.yonghuqiandao.html" class="link series-item series-item" aria-label="用户签到"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->用户签到<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/11.uvtongji.html" class="link series-item series-item" aria-label="uv统计"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->uv统计<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->高级篇<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimadianping/gaojipian/1.fenbushihuancun.html" class="link series-item series-item" aria-label="分布式缓存"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->分布式缓存<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/gaojipian/2.duojihuancun.html" class="link series-item series-item" aria-label="多级缓存"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->多级缓存<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/gaojipian/3.zuijiashijian.html" class="link series-item series-item" aria-label="最佳实践"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->最佳实践<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/gaojipian/Rediscunzaidewenti.html" class="link series-item series-item" aria-label="Redis存在的问题"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redis存在的问题<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->原理八股文<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimadianping/yuanlibaguwen/wangluomoxing.html" class="link series-item series-item" aria-label="Redis网络模型"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redis网络模型<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yuanlibaguwen/shujujiegou.html" class="link series-item series-item" aria-label="数据结构"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->数据结构<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yuanlibaguwen/nacuntaihuan.html" class="link series-item series-item" aria-label="内存回收"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->内存回收<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yuanlibaguwen/tongxinxieyi.html" class="link series-item series-item" aria-label="Redis通信协议"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redis通信协议<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->应用知识<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimadianping/yingyongzhishi/Redistexing.html" class="link series-item series-item" aria-label="Redis特性"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redis特性<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yingyongzhishi/changjianyewuwentijibaguwen.html" class="link series-item series-item" aria-label="常见业务问题以及八股文"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->常见业务问题以及八股文<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yingyongzhishi/zaqizabadeyichang.html" class="link series-item series-item" aria-label="杂七杂八的异常"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->杂七杂八的异常<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->对脚手架的更新<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimadianping/duijiaoshoujiadegengxin/duiRedisUtildegengxin.html" class="link series-item series-item" aria-label="对RedisUtil的更新"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->对RedisUtil的更新<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->黑马商城<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Docker<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimashangcheng/Docker/1.jianjie.html" class="link series-item series-item" aria-label="Docker简介"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Docker简介<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/Docker/2.zidingyirongqi.html" class="link series-item series-item" aria-label="自制容器"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->自制容器<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/Docker/3.yingyongbushu.html" class="link series-item series-item" aria-label="应用部署"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->应用部署<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/Docker/4.rongqijiantongxin.html" class="link series-item series-item" aria-label="容器间通信"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->容器间通信<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->MybatisPlus<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/1.jianjie.html" class="link series-item series-item" aria-label="MybatisPlus简介"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->MybatisPlus简介<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/2.Wrapper.html" class="link series-item series-item" aria-label="条件构造器Wrapper"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->条件构造器Wrapper<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/3.jieheWrapperhemapper.html" class="link series-item series-item" aria-label="结合Wrapper和mapper自定义sql"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->结合Wrapper和mapper自定义sql<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/4.zizhiSQL.html" class="link series-item series-item" aria-label="自制SQL"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->自制SQL<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/5.IService.html" class="link series-item series-item" aria-label="IService"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->IService<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/6.IServicedelambdalianshidiaoyong.html" class="link series-item series-item" aria-label="IService的链式调用"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->IService的链式调用<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/7.IServicedepiliangcharu.html" class="link series-item series-item" aria-label="IService的批量插入"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->IService的批量插入<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/8.fenyechajian.html" class="link series-item series-item" aria-label="MP的分页插件"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->MP的分页插件<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/9.ewaigongnen.html" class="link series-item series-item" aria-label="MP的额外功能"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->MP的额外功能<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->八股<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimashangcheng/bagu/1.Spring.html" class="link series-item series-item" aria-label="Spring八股"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Spring八股<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/bagu/2.JWT.html" class="link series-item series-item" aria-label="JWT"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->JWT<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/bagu/3.weifuwu.html" class="link series-item series-item" aria-label="微服务"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->微服务<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->微服务<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimashangcheng/weifuwu/1.bushuyuanxiangmu.html" class="link series-item series-item" aria-label="部署原项目"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->部署原项目<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/2.xiangmuchuburenshi.html" class="link series-item series-item" aria-label="微服务初接触"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->微服务初接触<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/3.fuwuguanli（zhucezhongxinNacos）.html" class="link series-item series-item" aria-label="服务管理"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->服务管理<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/4.yuanchengdiaoyong（OpenFeign）.html" class="link series-item series-item" aria-label="远程调用"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->远程调用<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/5.weifuwuwangguan（Gateway）.html" class="link series-item series-item" aria-label="微服务网关"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->微服务网关<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/6.peizhiguanli（peizhizhongxinNacos）.html" class="link series-item series-item" aria-label="配置中心"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->配置中心<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/7.fuwubaohu（Sentinelrongduanxianliu）.html" class="link series-item series-item" aria-label="服务保护"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->服务保护<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/8.fenbushishiwu（Seata）.html" class="link series-item series-item" aria-label="分布式事务"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->分布式事务<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/9.xiaoxiduilie（MQ）.html" class="link series-item series-item" aria-label="消息队列"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->消息队列<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/10.ElasticSearch.html" class="link series-item series-item" aria-label="ElasticSearch"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->ElasticSearch<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/EX：Commonmokuaidezhuyishixiang.html" class="link series-item series-item" aria-label="Common模块的注意事项"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Common模块的注意事项<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/EX：lianluzhuizong.html" class="link series-item series-item" aria-label="链路追踪"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->链路追踪<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li></ul></section><!--]--><!--]--></aside><!--[--><main class="page-container"><div class="page-content"><h1 class="page-title">分布式锁</h1><div class="page-info"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M16 4a5 5 0 1 1-5 5a5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7a7 7 0 0 0-7-7z" fill="currentColor"></path><path d="M26 30h-2v-5a5 5 0 0 0-5-5h-6a5 5 0 0 0-5 5v5H6v-5a7 7 0 0 1 7-7h6a7 7 0 0 1 7 7z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->SaltFishGC<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2025-1-11<!--]--></span></span><!----><!----><!----></div><div class="theme-reco-md-content"><div><p>我们在单机项目中使用synchronized是没毛病，但假如是多机部署的集群环境呢？并发下该怎么处理呢？</p><p>这时候我们就会使用分布式锁：</p><table><thead><tr><th style="text-align:left;">实现方式</th><th style="text-align:left;">互斥机制</th><th style="text-align:left;">高可用性</th><th style="text-align:left;">高性能</th><th style="text-align:left;">安全性（防死锁）</th><th style="text-align:left;">适用场景</th><th style="text-align:left;">缺点/注意事项</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>MySQL</strong></td><td style="text-align:left;">利用 <code>SELECT ... FOR UPDATE</code> 或唯一索引 + 行锁</td><td style="text-align:left;">好</td><td style="text-align:left;">一般</td><td style="text-align:left;">断开连接自动释放锁（需配合事务）</td><td style="text-align:left;">低并发、对一致性要求高</td><td style="text-align:left;">性能较差，不适合高并发；依赖数据库</td></tr><tr><td style="text-align:left;"><strong>Redis</strong></td><td style="text-align:left;">使用 <code>SETNX</code> + 过期时间（或 Redisson 的 RedLock / Lua 脚本）</td><td style="text-align:left;">好</td><td style="text-align:left;">好</td><td style="text-align:left;">设置超时时间ttl，到期自动释放</td><td style="text-align:left;">高并发、轻量级锁</td><td style="text-align:left;">单节点有单点故障风险；需处理网络分区</td></tr><tr><td style="text-align:left;"><strong>ZooKeeper</strong></td><td style="text-align:left;">创建临时顺序节点，通过选举机制保证互斥</td><td style="text-align:left;">好</td><td style="text-align:left;">一般</td><td style="text-align:left;">临时节点断开自动删除</td><td style="text-align:left;">分布式协调、配置中心</td><td style="text-align:left;">性能较低；部署复杂</td></tr><tr><td style="text-align:left;"><strong>Etcd</strong></td><td style="text-align:left;">利用 <code>txn</code> 操作（CAS）和租约（Lease）实现锁</td><td style="text-align:left;">好</td><td style="text-align:left;">好</td><td style="text-align:left;">租约过期自动释放</td><td style="text-align:left;">Kubernetes 等云原生系统</td><td style="text-align:left;">学习成本高；生态不如 Redis 广泛</td></tr><tr><td style="text-align:left;"><strong>Redisson</strong></td><td style="text-align:left;">基于 Redis 的高级客户端，支持 RedLock、公平锁、可重入锁等</td><td style="text-align:left;">好</td><td style="text-align:left;">极好</td><td style="text-align:left;">支持看门狗机制（watchdog），自动续期</td><td style="text-align:left;">高并发、复杂锁需求</td><td style="text-align:left;">依赖 Redis；需引入额外组件</td></tr><tr><td style="text-align:left;"><strong>数据库乐观锁</strong></td><td style="text-align:left;">使用版本号（version）或时间戳字段，通过 <code>UPDATE ... WHERE version = ?</code></td><td style="text-align:left;">好</td><td style="text-align:left;">好</td><td style="text-align:left;">无死锁风险，但失败后需重试</td><td style="text-align:left;">读多写少、允许重试的业务</td><td style="text-align:left;">不适合强一致性场景；需处理重试逻辑</td></tr><tr><td style="text-align:left;"><strong>基于消息队列</strong></td><td style="text-align:left;">使用 MQ（如 Kafka/RabbitMQ）作为任务分发，确保只有一条消息被消费</td><td style="text-align:left;">好</td><td style="text-align:left;">好</td><td style="text-align:left;">消费者异常时由 MQ 重试机制兜底</td><td style="text-align:left;">异步任务调度、幂等性要求高</td><td style="text-align:left;">不能直接用于同步资源竞争</td></tr></tbody></table><h2 id="redis的分布式锁" tabindex="-1"><a class="header-anchor" href="#redis的分布式锁"><span>Redis的分布式锁</span></a></h2><ul><li>获取锁：</li></ul><p>​ 互斥：利用setnx实现，记得加ttl防止redis宕机</p><p>​ 非阻塞：不会等待，需要自己设置重试或返回</p><ul><li>释放锁：</li></ul><p>​ 手动删除：del</p><p>​ 过期删除：设置时带上expire</p><p>现在我们来实现一个工具类实现获取锁释放锁：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ILockImpl</span> <span class="token keyword">implements</span> <span class="token class-name">ILock</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">KEY_PREFIX</span> <span class="token operator">=</span> <span class="token string">&quot;lock:&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">ILockImpl</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>stringRedisTemplate <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeoutSec<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token constant">KEY_PREFIX</span> <span class="token operator">+</span> name<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">long</span> threadId <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Boolean</span> flag <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> threadId <span class="token operator">+</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> timeoutSec<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 拆箱防止出现空指针问题</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 释放</span></span>
<span class="line">        stringRedisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token constant">KEY_PREFIX</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="锁误删问题" tabindex="-1"><a class="header-anchor" href="#锁误删问题"><span>锁误删问题</span></a></h2><p>如果线程阻塞时间过长，ttl设置的又不合理，导致<strong>线程尚未完成任务锁就已经超时释放</strong>了，这就存在很大的问题了，比如这时A的锁超时释放了，B获取了这个锁，结果B还执行着呢A结束任务了就一下给锁删了。</p><p><strong>先来处理误删其他线程的锁这个问题：</strong></p><p>对于这个问题，我们可以对value作设置，在存入时存uuid值并记录，删除时检查该值是否是自己的，如不是自己的则不删：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ILockImpl</span> <span class="token keyword">implements</span> <span class="token class-name">ILock</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">KEY_PREFIX</span> <span class="token operator">=</span> <span class="token string">&quot;lock:&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">ID_PREFIX</span> <span class="token operator">=</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;-&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">ILockImpl</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">this</span><span class="token punctuation">.</span>stringRedisTemplate <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeoutSec<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token constant">KEY_PREFIX</span> <span class="token operator">+</span> name<span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">String</span> threadId <span class="token operator">=</span> <span class="token constant">ID_PREFIX</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">Boolean</span> flag <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> threadId<span class="token punctuation">,</span> timeoutSec<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 拆箱防止出现空指针问题</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 获取线程标识</span></span>
<span class="line">        <span class="token class-name">String</span> threadId <span class="token operator">=</span> <span class="token constant">ID_PREFIX</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 获取锁标识</span></span>
<span class="line">        <span class="token class-name">String</span> id <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token constant">KEY_PREFIX</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 判断是否相同</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>threadId<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token comment">// 释放</span></span>
<span class="line">            stringRedisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token constant">KEY_PREFIX</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里还存在一个问题：<strong>判断线程标识是否相同</strong>以及<strong>释放锁</strong>这两个最关键的操作被分为了<strong>两步</strong>进行，那么这里面就会出现一定问题，比如A判断相同完结果阻塞了，然后超时释放了，其他线程这时加锁然后被A释放了就出问题了。</p><p>熟悉的场景我们在<strong>加锁</strong>其实也见过，我们最后使用的setnx聚合这两个操作来解决这个问题，只要redis靠谱，单线程下我们就一定能确保<strong>判断</strong>与<strong>加锁一块执行</strong>以防止其他请求乘机而入，那么有没有其他方式来帮我们处理<strong>释放锁</strong>呢？</p><h2 id="lua脚本聚合redis命令" tabindex="-1"><a class="header-anchor" href="#lua脚本聚合redis命令"><span>lua脚本聚合Redis命令</span></a></h2><p>Redis提供了lua脚本的功能，使得redis的单线程可<strong>一次连续执行完</strong>一个lua脚本中的所有命令后才会去执行其他命令，这就保证了我们的一些命令的<strong>原子性</strong>从而确保数据不会因为<strong>该操作的并发</strong>导致被错误修改。</p><p>redis执行lua脚本：</p><div class="language-lua line-numbers-mode" data-highlighter="prismjs" data-ext="lua" data-title="lua"><pre><code><span class="line">EVAL <span class="token string">&quot;lua_script&quot;</span> numkeys key1 key2 <span class="token punctuation">...</span> arg1 arg2 <span class="token punctuation">...</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>lua_script</code>：Lua 脚本字符串（需用引号包裹）</li><li><code>numkeys</code>：脚本中使用的 <strong>key 的数量</strong>（必须明确指定）</li><li><code>key1, key2...</code>：传入的 Redis key（通过 <code>KEYS[1]</code>, <code>KEYS[2]</code> 访问）</li><li><code>arg1, arg2...</code>：额外参数（通过 <code>ARGV[1]</code>, <code>ARGV[2]</code> 访问）</li></ul><div class="language-lua line-numbers-mode" data-highlighter="prismjs" data-ext="lua" data-title="lua"><pre><code><span class="line">EVALSHA <span class="token string">&quot;sha1_hash&quot;</span> numkeys key1 key2 <span class="token punctuation">...</span> arg1 arg2 <span class="token punctuation">...</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>先用 <code>SCRIPT LOAD</code> 将脚本加载到 Redis，返回 SHA1 哈希；</li><li>后续用 <code>EVALSHA</code> + 哈希值执行，避免重复传输脚本内容。</li></ul><p>比如：</p><div class="language-lua line-numbers-mode" data-highlighter="prismjs" data-ext="lua" data-title="lua"><pre><code><span class="line">EVAL <span class="token string">&quot;return redis.call(&#39;set&#39;, KEYS[1], ARGV[1])&quot;</span> <span class="token number">1</span> name Rose</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>注意lua中数组的头索引是1而非0！</p><p>而在Spring中使用redisTemplate就可以这么执行这段lua脚本：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">        <span class="token comment">// 定义 Lua 脚本</span></span>
<span class="line">        <span class="token class-name">String</span> script <span class="token operator">=</span> <span class="token string">&quot;return redis.call(&#39;set&#39;, KEYS[1], ARGV[1])&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 创建 RedisScript 对象（返回类型为 String，因为 SET 返回 &quot;OK&quot;）</span></span>
<span class="line">        <span class="token class-name">DefaultRedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> redisScript <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultRedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        redisScript<span class="token punctuation">.</span><span class="token function">setScriptText</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        redisScript<span class="token punctuation">.</span><span class="token function">setResultType</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 执行脚本：KEYS = [&quot;name&quot;], ARGV = [&quot;Rose&quot;]</span></span>
<span class="line">        <span class="token class-name">String</span> result <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span></span>
<span class="line">            redisScript<span class="token punctuation">,</span></span>
<span class="line">            <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment">// KEYS[1]</span></span>
<span class="line">            <span class="token string">&quot;Rose&quot;</span>                               <span class="token comment">// ARGV[1]</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Lua 脚本执行结果: &quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: OK</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意传入参数中，keys是List数组，而argv参数是需全部写明的：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keys <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;user:1001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user:1001:name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">String</span> result <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span></span>
<span class="line">    redisScript<span class="token punctuation">,</span></span>
<span class="line">    keys<span class="token punctuation">,</span>                 <span class="token comment">// KEYS[1] = &quot;user:1001&quot;, KEYS[2] = &quot;user:1001:name&quot;</span></span>
<span class="line">    <span class="token string">&quot;Alice&quot;</span><span class="token punctuation">,</span>              <span class="token comment">// ARGV[1]</span></span>
<span class="line">    <span class="token string">&quot;60&quot;</span>                  <span class="token comment">// ARGV[2]</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keys <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;user:1001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user:1001:name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">String</span> result <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span></span>
<span class="line">    redisScript<span class="token punctuation">,</span></span>
<span class="line">    keys<span class="token punctuation">,</span>                 <span class="token comment">// KEYS[1] = &quot;user:1001&quot;, KEYS[2] = &quot;user:1001:name&quot;</span></span>
<span class="line">    <span class="token string">&quot;Alice&quot;</span><span class="token punctuation">,</span>              <span class="token comment">// ARGV[1]</span></span>
<span class="line">    <span class="token string">&quot;60&quot;</span>                  <span class="token comment">// ARGV[2]</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>那么现在我们需要使用lua脚本完成以下操作：</p><ol><li>获取锁的对应value标识</li><li>检查与传入real标识是否相等</li><li>相等，删除锁</li><li>不相等则直接结束</li></ol><p>那么就可以得到脚本：</p><div class="language-lua line-numbers-mode" data-highlighter="prismjs" data-ext="lua" data-title="lua"><pre><code><span class="line"><span class="token comment">-- 1. 获取锁当前的 value</span></span>
<span class="line"><span class="token keyword">local</span> current_value <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&#39;GET&#39;</span><span class="token punctuation">,</span> KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 2. 检查是否存在且与传入的标识（real）相等</span></span>
<span class="line"><span class="token keyword">if</span> current_value <span class="token operator">==</span> ARGV<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">then</span></span>
<span class="line">    <span class="token comment">-- 3. 相等：删除锁</span></span>
<span class="line">    <span class="token keyword">return</span> redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&#39;DEL&#39;</span><span class="token punctuation">,</span> KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">-- 成功释放</span></span>
<span class="line"><span class="token keyword">else</span></span>
<span class="line">    <span class="token comment">-- 4. 不相等或不存在：直接结束</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token number">0</span>  <span class="token comment">-- 未释放（可能是别人持有的锁）</span></span>
<span class="line"><span class="token keyword">end</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最终使用template执行：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">String</span> script <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;</span>
<span class="line">    local current_value = redis.call(&#39;GET&#39;, KEYS[1])</span>
<span class="line">    if current_value == ARGV[1] then</span>
<span class="line">        redis.call(&#39;DEL&#39;, KEYS[1])</span>
<span class="line">        return 1</span>
<span class="line">    else</span>
<span class="line">        return 0</span>
<span class="line">    end</span>
<span class="line">    &quot;&quot;&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token class-name">Long</span> result <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">new</span> <span class="token class-name">DefaultRedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>script<span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token string">&quot;my_lock_key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;my_request_id&quot;</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当然正常我们是会将lua脚本写到自制的lua文件中的，不会直接在代码中写死，一般放到classpath下即可（也就是resources）</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">DefaultRedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> unlockScript<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">static</span> <span class="token punctuation">{</span></span>
<span class="line">    unlockScript <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultRedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    unlockScript<span class="token punctuation">.</span><span class="token function">setLocation</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">&quot;unlock.lua&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// 指定脚本位置 ClassPathResource会去寻找classpath下的unlock.lua文件</span></span>
<span class="line">    unlockScript<span class="token punctuation">.</span><span class="token function">setResultType</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        stringRedisTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span></span>
<span class="line">                unlockScript<span class="token punctuation">,</span></span>
<span class="line">                <span class="token comment">// 获取锁名称</span></span>
<span class="line">                <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token constant">KEY_PREFIX</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token comment">// 获取线程标识</span></span>
<span class="line">                <span class="token constant">ID_PREFIX</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>好的，那么现在我们就基本确保了并发下释放锁的原子性，保证了多个线程不会误删相互之间的锁，现在的锁才是只会因为自行释放或是ttl超时释放的正常结束周期，而不是被其他线程误删了。</p><h2 id="基于-setnx-实现的分布式锁存在的问题" tabindex="-1"><a class="header-anchor" href="#基于-setnx-实现的分布式锁存在的问题"><span>基于 <code>SETNX</code> <strong>实现的分布式锁存在的问题</strong></span></a></h2><p>但是setnx作为锁在实际业务场景中还是存在问题：</p><p><strong>01 不可重入</strong></p><blockquote><p>同一个线程无法多次获取同一把锁。 ✅ 说明：如果一个线程已经持有锁，再次尝试加锁会失败，导致无法实现“可重入”逻辑。</p></blockquote><hr><p><strong>02 不可重试</strong></p><blockquote><p>获取锁只尝试一次就返回 false，没有重试机制。 ✅ 说明：在高并发场景下，如果第一次抢锁失败，不会自动重试，容易造成资源竞争失败。</p></blockquote><hr><p><strong>03 超时释放</strong></p><blockquote><p>锁超时释放虽然可以避免死锁，但如果是业务执行耗时较长，也会导致锁被提前释放，存在安全隐患。 ✅ 说明：设置过期时间（如 <code>PX 30000</code>）虽能防止死锁，但若业务处理时间超过该值，锁会被误删，其他线程可能抢占，引发并发问题。</p></blockquote><hr><p><strong>04 主从一致性</strong></p><blockquote><p>如果 Redis 提供了主从集群，主从同步存在延迟，当主节点宕机时，如果从节点未同步主节点的锁数据，则会出现锁失效的问题。 ✅ 说明：在 Redis 主从架构中，主节点写入的锁可能还未同步到从节点，主节点宕机后从节点升级为主，原锁信息丢失，导致多个客户端同时获得锁，破坏互斥性。</p></blockquote><p>针对这些场景以及问题，我们可以使用redission，其提供了一系列接口用于解决分布式问题等。</p><h2 id="redission" tabindex="-1"><a class="header-anchor" href="#redission"><span>Redission</span></a></h2><p><strong>Redisson</strong> 是一个基于 <strong>Redis</strong> 的 <strong>Java 客户端</strong>，它不仅提供了对 Redis 原生命令的封装，更重要的是：</p><blockquote><p><strong>在 Redis 基础上实现了丰富的分布式对象和服务</strong>，比如分布式锁、信号量、队列、延迟队列、布隆过滤器等。</p></blockquote><p>它让开发者像操作本地 Java 对象一样，轻松实现<strong>高并发、分布式协调</strong>功能。</p><table><thead><tr><th style="text-align:left;">组件</th><th style="text-align:left;">用途</th></tr></thead><tbody><tr><td style="text-align:left;"><code>RLock</code></td><td style="text-align:left;">分布式可重入锁（最常用）</td></tr><tr><td style="text-align:left;"><code>RAtomicLong</code></td><td style="text-align:left;">分布式原子长整型</td></tr><tr><td style="text-align:left;"><code>RCountDownLatch</code></td><td style="text-align:left;">分布式倒计时门闩</td></tr><tr><td style="text-align:left;"><code>RBlockingQueue</code></td><td style="text-align:left;">分布式阻塞队列</td></tr><tr><td style="text-align:left;"><code>RDelayedQueue</code></td><td style="text-align:left;">分布式延迟队列（如订单超时取消）</td></tr><tr><td style="text-align:left;"><code>RBloomFilter</code></td><td style="text-align:left;">分布式布隆过滤器（防缓存穿透）</td></tr><tr><td style="text-align:left;"><code>RMapCache</code></td><td style="text-align:left;">带过期时间的分布式 Map</td></tr></tbody></table><p>除了以上内容，其还支持**<code>RTopic</code><strong>，</strong><code>RPatternTopic</code><strong>的分布式通信，</strong><code>RQueue</code><strong>等的分布式队列，</strong><code>RCountDownLatch</code><strong>，</strong><code>RSemaphore</code>**等的分布式同步器等等功能。</p><p>简单来说就是比自己手写的好得多，当然详细业务的缓存穿透，击穿等问题，还是需要自己封装的，但至少lua大部分场景下不用自己写了。</p><h3 id="redission的初始化配置" tabindex="-1"><a class="header-anchor" href="#redission的初始化配置"><span>Redission的初始化配置</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Configuration</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{</span></span>
<span class="line">    </span>
<span class="line">    <span class="token annotation punctuation">@Bean</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">RedissonClient</span> <span class="token function">redissonClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Config</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        config<span class="token punctuation">.</span><span class="token function">useSingleServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">&quot;redis://127.0.0.1:6379&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 创建 RedissonClient 对象</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name">Redisson</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用Bean注入一个即可，之后我们就可以自动注入直接使用其所提供的工具了。</p><h3 id="redission的使用" tabindex="-1"><a class="header-anchor" href="#redission的使用"><span>Redission的使用</span></a></h3><p>将原来自制的Lock锁改为Redission的可重入锁：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">RLock</span> lock <span class="token operator">=</span> redissonClient<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token string">&quot;lock:order:&quot;</span> <span class="token operator">+</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 获取锁</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;请勿重复下单&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> self<span class="token punctuation">.</span><span class="token function">createVoucherOrder</span><span class="token punctuation">(</span>voucherId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;创建订单异常&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token string">&quot;服务异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">    lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Redisson <strong>通过“锁标识（lock ID）校验”机制</strong>，从根本上避免了<strong>误删他人锁</strong>的问题，事实上的实现逻辑和我们自制的lua执行接口大差不差，但是value的标识更加唯一。</p></blockquote><h2 id="redission的可重入锁-rlock" tabindex="-1"><a class="header-anchor" href="#redission的可重入锁-rlock"><span>Redission的可重入锁（RLock）</span></a></h2><table><thead><tr><th style="text-align:left;">能力</th><th style="text-align:left;">说明</th><th style="text-align:left;">解决的问题</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>1. 可重入</strong></td><td style="text-align:left;">同一线程可多次加锁（内部计数）</td><td style="text-align:left;">避免死锁（如 A 方法调 B 方法，都需同一把锁）</td></tr><tr><td style="text-align:left;"><strong>2. 自动续期（看门狗）</strong></td><td style="text-align:left;">锁过期前自动延长 TTL（默认每 10 秒续一次）</td><td style="text-align:left;">防止业务执行时间 &gt; 锁过期时间导致锁丢失</td></tr><tr><td style="text-align:left;"><strong>3. 防误删</strong></td><td style="text-align:left;">释放锁时校验持有者身份（UUID + 线程 ID）</td><td style="text-align:left;">避免删除其他线程的锁</td></tr><tr><td style="text-align:left;"><strong>4. 支持超时等待</strong></td><td style="text-align:left;"><code>tryLock(waitTime, leaseTime, unit)</code></td><td style="text-align:left;">避免无限阻塞</td></tr><tr><td style="text-align:left;"><strong>5. 公平锁支持</strong></td><td style="text-align:left;"><code>getFairLock()</code></td><td style="text-align:left;">按请求顺序获取锁（FIFO）</td></tr><tr><td style="text-align:left;"><strong>6. 多种锁模式</strong></td><td style="text-align:left;">可重入锁、公平锁、联锁（MultiLock）、红锁（RedLock）</td><td style="text-align:left;">满足复杂场景</td></tr></tbody></table><p>RLock的<strong>结构</strong>是使用hash存储：</p><table><thead><tr><th style="text-align:left;">key</th><th style="text-align:left;">field</th><th style="text-align:left;">value</th></tr></thead><tbody><tr><td style="text-align:left;">lock</td><td style="text-align:left;">根据线程获取的唯一标识</td><td style="text-align:left;">获取计数（默认生成时为1）</td></tr></tbody></table><p>基于这个结构实现了以下主要功能：</p><p><strong>1.</strong> <em><strong>可重入性（Reentrancy）</strong></em></p><ul><li><p>同一线程多次调用 <code>lock()</code> 不会阻塞；</p></li><li><p>Redis 中存储的 value 是 <code>UUID:threadId</code>，同时记录加锁次数（通过 Hash 结构）：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">HSET myLock <span class="token string">&quot;8743b520...:1&quot;</span> <span class="token number">2</span>   <span class="token comment"># 表示该线程已加锁 2 次</span></span>
<span class="line"><span class="token comment"># 事实上是使用lua脚本实现的，因为还要读取原本的值并加1，或者压根没有要incrby新建一个</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>每次 <code>unlock()</code> 计数减 1，直到为 0 才真正删除 key。</p></li></ul><blockquote><p>✅ 支持递归调用、AOP 嵌套等场景。</p></blockquote><hr><p><strong>2.</strong> <em><strong>看门狗（Watchdog）自动续期</strong></em></p><ul><li>默认锁过期时间：<strong>30 秒</strong>；</li><li>如果你没有指定 <code>leaseTime</code>（如 <code>lock.lock(10, SECONDS)</code>），Redisson 会启动看门狗；</li><li><strong>每 10 秒</strong>（<code>internalLockLeaseTime / 3</code>）检查线程是否存活，若存活则 <strong>延长锁 TTL 到 30 秒</strong>；</li><li>线程结束或调用 <code>unlock()</code> 后，看门狗停止。</li></ul><blockquote><p>⚠️ 注意：</p><ul><li>如果你指定了 <code>leaseTime</code>（如 <code>lock.lock(10, TimeUnit.SECONDS)</code>），<strong>看门狗不会启动</strong>！</li><li>锁会在 10 秒后强制释放，即使业务还没执行完。</li></ul></blockquote><hr><p><strong>3.</strong> <em><strong>防误删（Safe Unlock）</strong></em></p><p>释放锁时执行 Lua 脚本：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token builtin class-name">local</span> current_value <span class="token operator">=</span> redis.call<span class="token punctuation">(</span><span class="token string">&#39;GET&#39;</span>, KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">if</span> current_value <span class="token operator">==</span> ARGV<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">then</span></span>
<span class="line">    <span class="token builtin class-name">return</span> redis.call<span class="token punctuation">(</span><span class="token string">&#39;DEL&#39;</span>, KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">else</span></span>
<span class="line">    <span class="token builtin class-name">return</span> <span class="token number">0</span></span>
<span class="line">end</span>
<span class="line"><span class="token comment"># 仅为例子，还需要对field的重入次数value - 1等操作</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>ARGV[1]</code> 是当前线程的锁标识（<code>UUID:threadId</code>）；</li><li>只有匹配才删除，否则拒绝。</li></ul><blockquote><p>以上特性中有些需要将一些redis命令聚合为一个原子性操作，Redission对于这方面的实现其实就是使用<strong>lua脚本</strong>实现的操作原子化</p></blockquote><h2 id="redission的锁重试" tabindex="-1"><a class="header-anchor" href="#redission的锁重试"><span>Redission的锁重试</span></a></h2><p>trylock的参数设置：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">long</span> waitTime<span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">long</span> leaseTime<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>TimeUnit</span> unit</span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中waitTime指的就是阻塞等待的时间，当超出这个时间的时候就会返回失败，而leaseTime即释放时间ttl，如设置-1则代表无释放时间；</p><p>简单理解锁重试就是在<strong>waitTime</strong>内会<strong>尽可能尝试获取锁</strong>，如在waitTime时间内获取到锁了就返回true，如失败则返回false。</p><h2 id="redission的锁自动续期-watchdog" tabindex="-1"><a class="header-anchor" href="#redission的锁自动续期-watchdog"><span>Redission的锁自动续期（watchdog）</span></a></h2><p>一些锁我们是不会设置过期时间的，我们只希望他们在<strong>业务完成以后再自行释放</strong>，而对于redis来说想要实现这样一个功能似乎只能在一个线程中轮询刷新ttl，一旦阻塞没空干这事了就麻烦了，而<strong>不设置ttl更是危险</strong>！假如阻塞时间过长或是线程出现预期之外的错误就会造成死锁等很大的影响。</p><p>在Redission内部也实现了这样的一个自动续期，当我们没有去<strong>显式</strong>传入<strong>过期时间</strong>参数（或是传入的参数是-1表示无过期时间）时，Redission的lock就会激活<strong>watchdog</strong>机制：其会设置默认ttl为30s，每<strong>10s</strong>（ttl/3）检查当前线程是否存活，如存活则<strong>延长ttl至30s</strong>（其实也就是轮询）</p><p>通过以上<strong>检测线程是否存活</strong>的方式，我们避免了不设置ttl的危险场景。</p><div class="language-mermaid line-numbers-mode" data-highlighter="prismjs" data-ext="mermaid" data-title="mermaid"><pre><code><span class="line"><span class="token keyword">graph</span> TD</span>
<span class="line">    A<span class="token text string">[开始]</span> <span class="token arrow operator">--&gt;</span> B<span class="token text string">[尝试获取锁]</span></span>
<span class="line">    B <span class="token arrow operator">--&gt;</span> C<span class="token text string">{判断所得ttl是否为null}</span></span>
<span class="line">    C <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span> <span class="token label property">是</span> <span class="token arrow operator">--&gt;</span></span> D<span class="token text string">{leaseTime是否为-1}</span></span>
<span class="line">    C <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span> <span class="token label property">否，即存在该锁且非本线程</span> <span class="token arrow operator">--&gt;</span></span> E<span class="token text string">{判断剩余等待时间是否大于0}</span></span>
<span class="line">    D <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span> <span class="token label property">是</span> <span class="token arrow operator">--&gt;</span></span> F<span class="token text string">[开启watchDog]</span></span>
<span class="line">    D <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span> <span class="token label property">否</span> <span class="token arrow operator">--&gt;</span></span> G<span class="token text string">[返回true]</span></span>
<span class="line">    F <span class="token arrow operator">--&gt;</span> G</span>
<span class="line">    G <span class="token arrow operator">--&gt;</span> H<span class="token text string">[结束]</span></span>
<span class="line">    E <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span> <span class="token label property">是</span> <span class="token arrow operator">--&gt;</span></span> I<span class="token text string">[订阅并等待释放锁的信号]</span></span>
<span class="line">    E <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span> <span class="token label property">否</span> <span class="token arrow operator">--&gt;</span></span> J<span class="token text string">[返回false]</span></span>
<span class="line">    I <span class="token arrow operator">--&gt;</span> K<span class="token text string">{判断等待时间是否超时}</span></span>
<span class="line">    K <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span> <span class="token label property">是</span> <span class="token arrow operator">--&gt;</span></span> J</span>
<span class="line">    K <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span> <span class="token label property">否</span> <span class="token arrow operator">--&gt;</span></span> B</span>
<span class="line">    J <span class="token arrow operator">--&gt;</span> H</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="redission的multilock-解决redis集群主从一致性" tabindex="-1"><a class="header-anchor" href="#redission的multilock-解决redis集群主从一致性"><span>Redission的multiLock（解决Redis集群主从一致性）</span></a></h2><p>redis中的集群一般是使用<strong>主从集群</strong>，而在集群中就存在<strong>主从同步</strong>的问题，当主节点在传输数据尤其是<strong>锁</strong>的时候宕机了就会造成很大的影响。</p><p>而在Redission的方案中，其设置了<strong>多个主节点</strong>，当我们需要保证一个主节点爆了，但是锁不会被影响，那我们就会尝试去获取这其中<strong>多个主节点</strong>的锁，只有当<strong>所有主节点的锁</strong>均获取到了才算获取到了，当然<strong>释放锁</strong>也是，会同步释放<strong>所有主节点的锁</strong>：</p><div class="language-mermaid line-numbers-mode" data-highlighter="prismjs" data-ext="mermaid" data-title="mermaid"><pre><code><span class="line"><span class="token keyword">graph</span> LR</span>
<span class="line">    A<span class="token text string">[Java应用]</span> <span class="token arrow operator">--&gt;</span> B<span class="token text string">[Redis Node&lt;br&gt;lock = thread1]</span></span>
<span class="line">    A <span class="token arrow operator">--&gt;</span> C<span class="token text string">[Redis Node&lt;br&gt;lock = thread1]</span></span>
<span class="line">    A <span class="token arrow operator">--&gt;</span> D<span class="token text string">[Redis Node&lt;br&gt;lock = thread1]</span></span>
<span class="line"></span>
<span class="line">    B <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span> <span class="token label property">节点崩溃</span> <span class="token arrow operator">--&gt;</span></span> E<span class="token text string">[Redis Master]</span></span>
<span class="line">    C <span class="token arrow operator">--&gt;</span> F<span class="token text string">[Redis Slave]</span></span>
<span class="line">    D <span class="token arrow operator">--&gt;</span> G<span class="token text string">[Redis Slave]</span></span>
<span class="line"></span>
<span class="line">    B <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span> <span class="token label property">主从同步</span> <span class="token arrow operator">--&gt;</span></span> E</span>
<span class="line">    C <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span> <span class="token label property">主从同步</span> <span class="token arrow operator">--&gt;</span></span> F</span>
<span class="line">    D <span class="token inter-arrow-label"><span class="token arrow-head arrow operator">--</span> <span class="token label property">主从同步</span> <span class="token arrow operator">--&gt;</span></span> G</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">subgraph</span> RedisCluster</span>
<span class="line">        <span class="token keyword">direction</span> TB</span>
<span class="line">        E</span>
<span class="line">        F</span>
<span class="line">        G</span>
<span class="line">    <span class="token keyword">end</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如上图所示，我们的一号主节点爆了，随后一号主节点的一个从节点成为主节点（哨兵），这之中主从同步未能完成！但是其他线程获取锁仍会被阻塞，因为获取这个锁需要从<strong>所有主节点</strong>获取，而现在有其他主节点存储了该锁的信息。</p><blockquote><p>当然，所有主节点全部都爆炸了，且都没能完成这一个锁的主从同步，那也没法子了</p></blockquote><p>对于以上配置，我们需要在后端中配置好几个redis主节点的RedissionClient：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Bean</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">RedissonClient</span> <span class="token function">redissonClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Config</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    config<span class="token punctuation">.</span><span class="token function">useSingleServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">&quot;redis://127.0.0.1:6379&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 创建 RedissonClient 对象</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token class-name">Redisson</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Bean</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">RedissonClient</span> <span class="token function">redissonClient2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Config</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    config<span class="token punctuation">.</span><span class="token function">useSingleServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">&quot;redis://127.0.0.1:6380&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 创建 RedissonClient 对象</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token class-name">Redisson</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Bean</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">RedissonClient</span> <span class="token function">redissonClient3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">Config</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    config<span class="token punctuation">.</span><span class="token function">useSingleServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">&quot;redis://127.0.0.1:6381&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 创建 RedissonClient 对象</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token class-name">Redisson</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后通过一个锁管理多个锁：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Autowired</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">RedissonClient</span> redissonClient<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Autowired</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">RedissonClient</span> redissonClient2<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Autowired</span></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">RedissonClient</span> redissonClient3<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">private</span> <span class="token class-name">RLock</span> lock<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Test</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">RLock</span> lock1 <span class="token operator">=</span> redissonClient<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token string">&quot;anyLock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">RLock</span> lock2 <span class="token operator">=</span> redissonClient2<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token string">&quot;anyLock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">RLock</span> lock3 <span class="token operator">=</span> redissonClient3<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token string">&quot;anyLock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    lock <span class="token operator">=</span> redissonClient<span class="token punctuation">.</span><span class="token function">getMultiLock</span><span class="token punctuation">(</span>lock1<span class="token punctuation">,</span> lock2<span class="token punctuation">,</span> lock3<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>而我们在尝试对这个lock尝试trylock时会对所有的节点尝试上锁/重入次数+1，只有当同时获取到几个节点的所有锁了才能够完全上锁，否则就会阻塞等待</p><hr><h2 id="拆箱防止空指针" tabindex="-1"><a class="header-anchor" href="#拆箱防止空指针"><span>拆箱防止空指针</span></a></h2><p>lang封装的一系列类型都存在空指针问题，尤其是Boolean，我们需要检查一下是否存在问题：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">return</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="redission的订阅是怎么实现的" tabindex="-1"><a class="header-anchor" href="#redission的订阅是怎么实现的"><span>Redission的订阅是怎么实现的</span></a></h2><p><strong>核心原理：基于 Redis 的</strong> <em><strong>*Pub/Sub（发布/订阅）机制*</strong></em></p><p>Redisson 利用 Redis 内置的 <strong>频道（Channel）发布/订阅功能</strong> 来实现线程间的通信：</p><ul><li>每个锁（如 <code>&quot;myLock&quot;</code>）对应一个 <strong>释放通知频道</strong>，例如：<code>redisson_lock__channel:{myLock}</code></li><li>当持有锁的线程执行 <code>unlock()</code> 时，Redisson 会向该频道 <strong>发布一条消息</strong>（如 <code>&quot;0&quot;</code>）</li><li>所有等待该锁的线程都 <strong>订阅了这个频道</strong>，一旦收到消息，就立即尝试重新抢锁</li></ul><blockquote><p>✅ 这就是“订阅”的本质：<strong>监听锁释放的广播信号</strong></p></blockquote><h2 id="redis集群的主从设置" tabindex="-1"><a class="header-anchor" href="#redis集群的主从设置"><span>Redis集群的主从设置</span></a></h2><table><thead><tr><th style="text-align:left;">目标</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">✅ <strong>数据冗余</strong></td><td style="text-align:left;">防止主节点宕机导致数据丢失</td></tr><tr><td style="text-align:left;">✅ <strong>读写分离</strong></td><td style="text-align:left;">主节点处理写，从节点处理读，提升吞吐量</td></tr><tr><td style="text-align:left;">✅ <strong>故障恢复</strong></td><td style="text-align:left;">主节点挂掉后，可手动或自动（配合哨兵）切换到从节点</td></tr><tr><td style="text-align:left;">✅ <strong>数据备份</strong></td><td style="text-align:left;">从节点可用于 RDB/AOF 备份，避免影响主节点性能</td></tr></tbody></table><p>简单来说，可以理解为数据库的<strong>读写分离</strong>，主节点处理写，从节点处理读，主节点的修改会通过异步共享等方式来完成数据同步；同时主节点如果爆了，从节点随时可以接替主节点，而这个我们就称为哨兵：</p><p>Redis <strong>哨兵（Sentinel）</strong> 是 Redis 官方提供的<strong>高可用性（High Availability）解决方案</strong>，用于在主节点（Master）发生故障时，<strong>自动完成故障检测与故障转移（Failover）</strong>，并将客户端流量无缝切换到新的主节点，从而保障服务持续可用。</p><table><thead><tr><th style="text-align:left;">功能</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">✅ <strong>监控（Monitoring）</strong></td><td style="text-align:left;">持续检查主节点和从节点是否正常运行</td></tr><tr><td style="text-align:left;">✅ <strong>自动故障转移（Automatic Failover）</strong></td><td style="text-align:left;">主节点宕机时，自动选举一个从节点晋升为新主</td></tr><tr><td style="text-align:left;">✅ <strong>配置提供者（Configuration Provider）</strong></td><td style="text-align:left;">客户端通过哨兵获取当前主节点地址</td></tr><tr><td style="text-align:left;">✅ <strong>通知（Notification）</strong></td><td style="text-align:left;">可通过 API 或脚本通知管理员或系统</td></tr></tbody></table></div></div><footer class="page-meta"><div class="meta-item edit-link"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M2 26h28v2H2z" fill="currentColor"></path><path d="M25.4 9c.8-.8.8-2 0-2.8l-3.6-3.6c-.8-.8-2-.8-2.8 0l-15 15V24h6.4l15-15zm-5-5L24 7.6l-3 3L17.4 7l3-3zM6 22v-3.6l10-10l3.6 3.6l-10 10H6z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Edit this page<!--]--></span></span></div><div class="meta-item last-updated"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Last Updated 2/15/2026, 4:06:28 PM<!--]--></span></span></div></footer><nav class="page-nav"><p class="hasPrev hasNext inner"><span class="page-nav-item prev"> ← 优惠券秒杀</span><span class="page-nav-item next">秒杀优化 → </span></p></nav><!----></div><div class="page-catalog-container"><h5 class="tip">ON THIS PAGE</h5><ul><!--[--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/4.fenbushisuo(Redisson).html#redis的分布式锁" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Redis的分布式锁"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redis的分布式锁<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/4.fenbushisuo(Redisson).html#锁误删问题" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="锁误删问题"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->锁误删问题<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/4.fenbushisuo(Redisson).html#lua脚本聚合redis命令" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="lua脚本聚合Redis命令"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->lua脚本聚合Redis命令<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/4.fenbushisuo(Redisson).html#基于-setnx-实现的分布式锁存在的问题" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="基于 SETNX 实现的分布式锁存在的问题"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->基于 SETNX 实现的分布式锁存在的问题<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/4.fenbushisuo(Redisson).html#redission" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Redission"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redission<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/docs/heimadianping/yewusheji/4.fenbushisuo(Redisson).html#redission的初始化配置" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Redission的初始化配置"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redission的初始化配置<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/docs/heimadianping/yewusheji/4.fenbushisuo(Redisson).html#redission的使用" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Redission的使用"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redission的使用<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/4.fenbushisuo(Redisson).html#redission的可重入锁-rlock" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Redission的可重入锁（RLock）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redission的可重入锁（RLock）<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/4.fenbushisuo(Redisson).html#redission的锁重试" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Redission的锁重试"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redission的锁重试<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/4.fenbushisuo(Redisson).html#redission的锁自动续期-watchdog" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Redission的锁自动续期（watchdog）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redission的锁自动续期（watchdog）<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/4.fenbushisuo(Redisson).html#redission的multilock-解决redis集群主从一致性" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Redission的multiLock（解决Redis集群主从一致性）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redission的multiLock（解决Redis集群主从一致性）<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/4.fenbushisuo(Redisson).html#拆箱防止空指针" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="拆箱防止空指针"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->拆箱防止空指针<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/4.fenbushisuo(Redisson).html#redission的订阅是怎么实现的" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Redission的订阅是怎么实现的"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redission的订阅是怎么实现的<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/4.fenbushisuo(Redisson).html#redis集群的主从设置" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Redis集群的主从设置"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redis集群的主从设置<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--></ul></div></main><!--]--></div></div><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CohX4sgD.js" defer></script>
  </body>
</html>
