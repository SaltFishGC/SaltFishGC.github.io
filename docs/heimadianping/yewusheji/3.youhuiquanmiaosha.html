<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.19">
    <script>
      (function() {
        const userMode = localStorage.getItem('vuepress-reco-color-scheme') || 'auto';
        const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (userMode === 'dark' || (userMode === 'auto' && systemDarkMode)) {
          document.documentElement.classList.toggle('dark', true);
        }
      })();
    </script>
    <title>优惠券秒杀 | SaltFishGC`s Blog</title><meta name="description" content="">
    <link rel="preload" href="/assets/style-D0DqkupE.css" as="style"><link rel="stylesheet" href="/assets/style-D0DqkupE.css">
    <link rel="modulepreload" href="/assets/app-DXmPnZac.js"><link rel="modulepreload" href="/assets/3.youhuiquanmiaosha.html-BcZvq2ay.js">
    <link rel="prefetch" href="/assets/timeline.html-DAL0eI6E.js" as="script"><link rel="prefetch" href="/assets/posts.html-D2kGBnOZ.js" as="script"><link rel="prefetch" href="/assets/friendship-link.html-CX6CXFKq.js" as="script"><link rel="prefetch" href="/assets/1.html-MKNBWbPV.js" as="script"><link rel="prefetch" href="/assets/1.html-DG4cJ0RE.js" as="script"><link rel="prefetch" href="/assets/1.html-BrSV8bTO.js" as="script"><link rel="prefetch" href="/assets/index.html-C9tX5-qV.js" as="script"><link rel="prefetch" href="/assets/121501.html-C5vpDpf8.js" as="script"><link rel="prefetch" href="/assets/260215.html-BVrmFtSA.js" as="script"><link rel="prefetch" href="/assets/changyongmingling.html-DB42O-Ek.js" as="script"><link rel="prefetch" href="/assets/Eletronsuji.html-B5uEgf6x.js" as="script"><link rel="prefetch" href="/assets/WebSocketkehuduan.html-Cy23Y5os.js" as="script"><link rel="prefetch" href="/assets/nginx.html-CowokyW5.js" as="script"><link rel="prefetch" href="/assets/session，token，jwt.html-050jNPuc.js" as="script"><link rel="prefetch" href="/assets/sqlitebendihuancun.html-DtsMyBT0.js" as="script"><link rel="prefetch" href="/assets/vuejibensuji.html-DKZJMcZE.js" as="script"><link rel="prefetch" href="/assets/xiugaisheji.html-BscRmm6E.js" as="script"><link rel="prefetch" href="/assets/yudaodewenti（qianduan.html-2fNaL6-v.js" as="script"><link rel="prefetch" href="/assets/Nettysuji.html-l4id5imG.js" as="script"><link rel="prefetch" href="/assets/yewuzhongxuedaodedongxi（houduan.html-sZ1ylA6H.js" as="script"><link rel="prefetch" href="/assets/xiugaisheji（houduan.html-DjkuiRFl.js" as="script"><link rel="prefetch" href="/assets/tongyangdeyewuchangjing，weixinshizenmezuode？.html-BWy2CtN4.js" as="script"><link rel="prefetch" href="/assets/duidaimashengchengqideyouhua.html-D_OL_735.js" as="script"><link rel="prefetch" href="/assets/shujukuhehuancuncunchuxingshizhengli.html-DI_MXlRU.js" as="script"><link rel="prefetch" href="/assets/yudaodewenti（houduan.html-BfuidQY7.js" as="script"><link rel="prefetch" href="/assets/1.jianjie.html-BrffiKSk.js" as="script"><link rel="prefetch" href="/assets/2.zidingyirongqi.html-_2cELZWT.js" as="script"><link rel="prefetch" href="/assets/3.yingyongbushu.html-Chis8hji.js" as="script"><link rel="prefetch" href="/assets/4.rongqijiantongxin.html-C1t0xw2K.js" as="script"><link rel="prefetch" href="/assets/1.jianjie.html-DosAUGsG.js" as="script"><link rel="prefetch" href="/assets/2.Wrapper.html-DRMnD94V.js" as="script"><link rel="prefetch" href="/assets/3.jieheWrapperhemapper.html-BKKDqgvx.js" as="script"><link rel="prefetch" href="/assets/4.zizhiSQL.html-DIvbA3zK.js" as="script"><link rel="prefetch" href="/assets/5.IService.html-C55VtD_m.js" as="script"><link rel="prefetch" href="/assets/6.IServicedelambdalianshidiaoyong.html-CiSl1Hab.js" as="script"><link rel="prefetch" href="/assets/7.IServicedepiliangcharu.html-Bh5gqG7G.js" as="script"><link rel="prefetch" href="/assets/8.fenyechajian.html-HuhghP5c.js" as="script"><link rel="prefetch" href="/assets/9.ewaigongnen.html-DZa-daTx.js" as="script"><link rel="prefetch" href="/assets/1.Spring.html-CYPifeuP.js" as="script"><link rel="prefetch" href="/assets/2.JWT.html-Cg8ZNEw9.js" as="script"><link rel="prefetch" href="/assets/3.weifuwu.html-BbYJ6bxz.js" as="script"><link rel="prefetch" href="/assets/1.bushuyuanxiangmu.html-CHR_udxs.js" as="script"><link rel="prefetch" href="/assets/10.ElasticSearch.html-CrcuL0Td.js" as="script"><link rel="prefetch" href="/assets/2.xiangmuchuburenshi.html-BGcnjrls.js" as="script"><link rel="prefetch" href="/assets/3.fuwuguanli（zhucezhongxinNacos）.html-Jf67rpQ0.js" as="script"><link rel="prefetch" href="/assets/4.yuanchengdiaoyong（OpenFeign）.html-CwF_m8nE.js" as="script"><link rel="prefetch" href="/assets/5.weifuwuwangguan（Gateway）.html-B4n75AYt.js" as="script"><link rel="prefetch" href="/assets/6.peizhiguanli（peizhizhongxinNacos）.html-B-bItZ2m.js" as="script"><link rel="prefetch" href="/assets/7.fuwubaohu（Sentinelrongduanxianliu）.html-C9Hix8LX.js" as="script"><link rel="prefetch" href="/assets/8.fenbushishiwu（Seata）.html-DdD0bzAj.js" as="script"><link rel="prefetch" href="/assets/9.xiaoxiduilie（MQ）.html-BPKObdhg.js" as="script"><link rel="prefetch" href="/assets/EX：Commonmokuaidezhuyishixiang.html-Co6qLasw.js" as="script"><link rel="prefetch" href="/assets/EX：lianluzhuizong.html-BmSl6Ymx.js" as="script"><link rel="prefetch" href="/assets/1.duanxindenglu.html-FojN-REB.js" as="script"><link rel="prefetch" href="/assets/10.yonghuqiandao.html-YFWxhYhI.js" as="script"><link rel="prefetch" href="/assets/11.uvtongji.html-DhTU9QAl.js" as="script"><link rel="prefetch" href="/assets/2.huancun.html-Bl8Jy-HA.js" as="script"><link rel="prefetch" href="/assets/4.fenbushisuo(Redisson).html-CJh9CkrC.js" as="script"><link rel="prefetch" href="/assets/5.miaoshayouhua.html-GQvd55-j.js" as="script"><link rel="prefetch" href="/assets/6.Redisxiaoxiduilie.html-Cu2rgDRz.js" as="script"><link rel="prefetch" href="/assets/7.darentandian.html-DDtpLncC.js" as="script"><link rel="prefetch" href="/assets/8.haoyouguanzhu.html-DCeK-T4Z.js" as="script"><link rel="prefetch" href="/assets/9.fujianshangpu.html-obV7PADu.js" as="script"><link rel="prefetch" href="/assets/nacuntaihuan.html-CF1np534.js" as="script"><link rel="prefetch" href="/assets/shujujiegou.html-C67dEDa-.js" as="script"><link rel="prefetch" href="/assets/wangluomoxing.html-BlrERfLr.js" as="script"><link rel="prefetch" href="/assets/tongxinxieyi.html-mPXCvJUV.js" as="script"><link rel="prefetch" href="/assets/duiRedisUtildegengxin.html-BLTUrDDc.js" as="script"><link rel="prefetch" href="/assets/Redistexing.html-mLvsv9vp.js" as="script"><link rel="prefetch" href="/assets/changjianyewuwentijibaguwen.html-tjES0Ls0.js" as="script"><link rel="prefetch" href="/assets/zaqizabadeyichang.html-Dxn72tsx.js" as="script"><link rel="prefetch" href="/assets/baozhuangjianli.html-Co4MGDCE.js" as="script"><link rel="prefetch" href="/assets/changyongmingling.html-CS1S0Ja5.js" as="script"><link rel="prefetch" href="/assets/jianjie.html-BFvNHVR6.js" as="script"><link rel="prefetch" href="/assets/1.fenbushihuancun.html-BRpRd5Hp.js" as="script"><link rel="prefetch" href="/assets/2.duojihuancun.html-BKNeYnP5.js" as="script"><link rel="prefetch" href="/assets/3.zuijiashijian.html-BOrUyCMa.js" as="script"><link rel="prefetch" href="/assets/Rediscunzaidewenti.html-C_TG5mFx.js" as="script"><link rel="prefetch" href="/assets/404.html-Cn5DVyl-.js" as="script"><link rel="prefetch" href="/assets/Valine.min-B0zTb2gI.js" as="script"><link rel="prefetch" href="/assets/giscus-aTimukGI-DWEKOTfS.js" as="script"><link rel="prefetch" href="/assets/katex-CBSAILhF.js" as="script"><link rel="prefetch" href="/assets/dagre-6UL2VRFP-DdaHqB5Z.js" as="script"><link rel="prefetch" href="/assets/cose-bilkent-S5V4N54A-5JyIR-LK.js" as="script"><link rel="prefetch" href="/assets/c4Diagram-YG6GDRKO-DFwlCFj6.js" as="script"><link rel="prefetch" href="/assets/flowDiagram-NV44I4VS-DImQeJ5m.js" as="script"><link rel="prefetch" href="/assets/flowDiagram-NV44I4VS-DImQeJ5m.js" as="script"><link rel="prefetch" href="/assets/erDiagram-Q2GNP2WA-DIVBmw_V.js" as="script"><link rel="prefetch" href="/assets/gitGraphDiagram-NY62KEGX-BWMuLLDq.js" as="script"><link rel="prefetch" href="/assets/ganttDiagram-JELNMOA3-Le0m0_18.js" as="script"><link rel="prefetch" href="/assets/infoDiagram-WHAUD3N6-8KLG1PWq.js" as="script"><link rel="prefetch" href="/assets/pieDiagram-ADFJNKIX-DqbuLBWj.js" as="script"><link rel="prefetch" href="/assets/quadrantDiagram-AYHSOK5B-DPxGP0PF.js" as="script"><link rel="prefetch" href="/assets/xychartDiagram-PRI3JC2R-n84qlWUW.js" as="script"><link rel="prefetch" href="/assets/requirementDiagram-UZGBJVZJ-Dvbtoi32.js" as="script"><link rel="prefetch" href="/assets/sequenceDiagram-WL72ISMW-Bx7gu_zY.js" as="script"><link rel="prefetch" href="/assets/classDiagram-2ON5EDUG-CplwNuKV.js" as="script"><link rel="prefetch" href="/assets/classDiagram-v2-WZHVMYZB-CplwNuKV.js" as="script"><link rel="prefetch" href="/assets/stateDiagram-FKZM4ZOC-BciPgFhW.js" as="script"><link rel="prefetch" href="/assets/stateDiagram-v2-4FDKWEC3-Dt1wbj6A.js" as="script"><link rel="prefetch" href="/assets/journeyDiagram-XKPGCS4Q-CVDZMD5_.js" as="script"><link rel="prefetch" href="/assets/flowDiagram-NV44I4VS-DImQeJ5m.js" as="script"><link rel="prefetch" href="/assets/timeline-definition-IT6M3QCI-DYJcHm6L.js" as="script"><link rel="prefetch" href="/assets/mindmap-definition-VGOIOE7T-HZYEahms.js" as="script"><link rel="prefetch" href="/assets/kanban-definition-3W4ZIXB7-BZOiqjWw.js" as="script"><link rel="prefetch" href="/assets/sankeyDiagram-TZEHDZUN-DCTzPLem.js" as="script"><link rel="prefetch" href="/assets/diagram-S2PKOQOG-C_9ZdkJl.js" as="script"><link rel="prefetch" href="/assets/diagram-QEK2KX5R-D7iUdLL6.js" as="script"><link rel="prefetch" href="/assets/blockDiagram-VD42YOAC-COFQqlRm.js" as="script"><link rel="prefetch" href="/assets/architectureDiagram-VXUJARFQ-BwSHUpFB.js" as="script"><link rel="prefetch" href="/assets/diagram-PSM6KHXK-B9zmyDO0.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container show-series show-catalog"><header class="navbar-container not-open"><div class="navbar-inner"><div class="site-brand nav-item"><img class="logo" src="/doge.jpg" alt="SaltFishGC`s Blog"><a href="/" class="site-name can-hide">SaltFishGC`s Blog</a></div><div class="nav-item navbar-links-wrapper" style=""><div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div><nav class="navbar-links"><!--[--><div class="navbar-links__item"><a href="/" class="link" aria-label="主页"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->主页<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/categories/blog/1.html" class="link" aria-label="Blog"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Blog<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="笔记"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->笔记<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="笔记"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->笔记<!--]--></span></span></span><span class="right arrow"></span></button><ul class="dropdown-link__container" style="display:none;"><!--[--><li class="dropdown-link__item"><a href="/docs/wx/常用命令" class="link" aria-label="仿wx"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->仿wx<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/docs/黑马点评/项目相关/简介" class="link" aria-label="黑马点评"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->黑马点评<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/docs/黑马商城/Docker/1.简介" class="link" aria-label="黑马商城"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->黑马商城<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--><!----><span class="xicon-container btn-toggle-dark-mode btn--dark-mode navbar-links__item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></span><ul class="social-links navbar-links__item"><!--[--><li class="social-item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:25px;height:25px;"><path d="M16 2a14 14 0 0 0-4.43 27.28c.7.13 1-.3 1-.67v-2.38c-3.89.84-4.71-1.88-4.71-1.88a3.71 3.71 0 0 0-1.62-2.05c-1.27-.86.1-.85.1-.85a2.94 2.94 0 0 1 2.14 1.45a3 3 0 0 0 4.08 1.16a2.93 2.93 0 0 1 .88-1.87c-3.1-.36-6.37-1.56-6.37-6.92a5.4 5.4 0 0 1 1.44-3.76a5 5 0 0 1 .14-3.7s1.17-.38 3.85 1.43a13.3 13.3 0 0 1 7 0c2.67-1.81 3.84-1.43 3.84-1.43a5 5 0 0 1 .14 3.7a5.4 5.4 0 0 1 1.44 3.76c0 5.38-3.27 6.56-6.39 6.91a3.33 3.33 0 0 1 .95 2.59v3.84c0 .46.25.81 1 .67A14 14 0 0 0 16 2z" fill-rule="evenodd" fill="currentColor"></path></svg></li><!--]--></ul></nav><span class="xicon-container btn-toggle-menus"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><circle cx="16" cy="8" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="24" r="2" fill="currentColor"></circle></svg></span></div></div></header><header class="sub-navbar-container not-open"><span class="nav-item"><div class="toggle-series-button" aria-expanded="false" role="button" tabindex="0"><span></span><span></span><span></span></div> Series </span></header><!----><!----><div class="theme-main" style=""><aside class="series-container"><!--[--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->仿wx<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->常用命令<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/wx/changyongmingling.html" class="link series-item series-item" aria-label="常用命令"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->常用命令<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->前端部分<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/wx/qianduanbufen/Eletronsuji.html" class="link series-item series-item" aria-label="Eletron速记"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Eletron速记<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/qianduanbufen/WebSocketkehuduan.html" class="link series-item series-item" aria-label="WebSocket客户端"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->WebSocket客户端<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/qianduanbufen/nginx.html" class="link series-item series-item" aria-label="NGINX"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->NGINX<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/qianduanbufen/session，token，jwt.html" class="link series-item series-item" aria-label="session，token，jwt"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->session，token，jwt<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/qianduanbufen/sqlitebendihuancun.html" class="link series-item series-item" aria-label="sqlite本地缓存"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->sqlite本地缓存<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/qianduanbufen/vuejibensuji.html" class="link series-item series-item" aria-label="vue基本速记"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->vue基本速记<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/qianduanbufen/xiugaisheji.html" class="link series-item series-item" aria-label="修改设计"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->修改设计<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/qianduanbufen/yudaodewenti（qianduan.html" class="link series-item series-item" aria-label="遇到的问题（前端）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->遇到的问题（前端）<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->后端部分<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/wx/houduanbufen/Nettysuji.html" class="link series-item series-item" aria-label="Netty速记"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Netty速记<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/houduanbufen/yewuzhongxuedaodedongxi（houduan.html" class="link series-item series-item" aria-label="业务中学到的东西（后端）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->业务中学到的东西（后端）<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/houduanbufen/xiugaisheji（houduan.html" class="link series-item series-item" aria-label="修改设计"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->修改设计<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/houduanbufen/tongyangdeyewuchangjing，weixinshizenmezuode？.html" class="link series-item series-item" aria-label="微信是怎么去解决一些问题的"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->微信是怎么去解决一些问题的<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/houduanbufen/duidaimashengchengqideyouhua.html" class="link series-item series-item" aria-label="对代码生成器的优化"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->对代码生成器的优化<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/houduanbufen/shujukuhehuancuncunchuxingshizhengli.html" class="link series-item series-item" aria-label="数据库和缓存存储形式整理"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->数据库和缓存存储形式整理<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/wx/houduanbufen/yudaodewenti（houduan.html" class="link series-item series-item" aria-label="遇到的问题（后端）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->遇到的问题（后端）<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1 active"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->黑马点评<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->项目相关<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimadianping/xiangmuxiangguan/jianjie.html" class="link series-item series-item" aria-label="项目简介"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->项目简介<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/xiangmuxiangguan/changyongmingling.html" class="link series-item series-item" aria-label="常用命令"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->常用命令<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/xiangmuxiangguan/baozhuangjianli.html" class="link series-item series-item" aria-label="包装简历"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->包装简历<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->业务设计<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimadianping/yewusheji/1.duanxindenglu.html" class="link series-item series-item" aria-label="短信登录（session）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->短信登录（session）<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/2.huancun.html" class="link series-item series-item" aria-label="缓存"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->缓存<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a aria-current="page" href="/docs/heimadianping/yewusheji/3.youhuiquanmiaosha.html" class="router-link-active router-link-exact-active link router-link-active series-item series-item" aria-label="优惠券秒杀"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->优惠券秒杀<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/4.fenbushisuo(Redisson).html" class="link series-item series-item" aria-label="分布式锁"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->分布式锁<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/5.miaoshayouhua.html" class="link series-item series-item" aria-label="秒杀优化"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->秒杀优化<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/6.Redisxiaoxiduilie.html" class="link series-item series-item" aria-label="Redis消息队列"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redis消息队列<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/7.darentandian.html" class="link series-item series-item" aria-label="达人探店"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->达人探店<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/8.haoyouguanzhu.html" class="link series-item series-item" aria-label="好友关注"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->好友关注<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/9.fujianshangpu.html" class="link series-item series-item" aria-label="附件商铺"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->附件商铺<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/10.yonghuqiandao.html" class="link series-item series-item" aria-label="用户签到"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->用户签到<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yewusheji/11.uvtongji.html" class="link series-item series-item" aria-label="uv统计"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->uv统计<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->高级篇<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimadianping/gaojipian/1.fenbushihuancun.html" class="link series-item series-item" aria-label="分布式缓存"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->分布式缓存<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/gaojipian/2.duojihuancun.html" class="link series-item series-item" aria-label="多级缓存"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->多级缓存<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/gaojipian/3.zuijiashijian.html" class="link series-item series-item" aria-label="最佳实践"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->最佳实践<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/gaojipian/Rediscunzaidewenti.html" class="link series-item series-item" aria-label="Redis存在的问题"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redis存在的问题<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->原理八股文<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimadianping/yuanlibaguwen/wangluomoxing.html" class="link series-item series-item" aria-label="Redis网络模型"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redis网络模型<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yuanlibaguwen/shujujiegou.html" class="link series-item series-item" aria-label="数据结构"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->数据结构<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yuanlibaguwen/nacuntaihuan.html" class="link series-item series-item" aria-label="内存回收"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->内存回收<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yuanlibaguwen/tongxinxieyi.html" class="link series-item series-item" aria-label="Redis通信协议"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redis通信协议<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->应用知识<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimadianping/yingyongzhishi/Redistexing.html" class="link series-item series-item" aria-label="Redis特性"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Redis特性<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yingyongzhishi/changjianyewuwentijibaguwen.html" class="link series-item series-item" aria-label="常见业务问题以及八股文"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->常见业务问题以及八股文<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimadianping/yingyongzhishi/zaqizabadeyichang.html" class="link series-item series-item" aria-label="杂七杂八的异常"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->杂七杂八的异常<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->对脚手架的更新<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimadianping/duijiaoshoujiadegengxin/duiRedisUtildegengxin.html" class="link series-item series-item" aria-label="对RedisUtil的更新"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->对RedisUtil的更新<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading series-level-1"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:16px;"><!--[-->黑马商城<!--]--></span></span><span class="arrow down"></span></h5><ul style="display:block;"><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Docker<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimashangcheng/Docker/1.jianjie.html" class="link series-item series-item" aria-label="Docker简介"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Docker简介<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/Docker/2.zidingyirongqi.html" class="link series-item series-item" aria-label="自制容器"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->自制容器<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/Docker/3.yingyongbushu.html" class="link series-item series-item" aria-label="应用部署"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->应用部署<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/Docker/4.rongqijiantongxin.html" class="link series-item series-item" aria-label="容器间通信"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->容器间通信<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->MybatisPlus<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/1.jianjie.html" class="link series-item series-item" aria-label="MybatisPlus简介"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->MybatisPlus简介<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/2.Wrapper.html" class="link series-item series-item" aria-label="条件构造器Wrapper"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->条件构造器Wrapper<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/3.jieheWrapperhemapper.html" class="link series-item series-item" aria-label="结合Wrapper和mapper自定义sql"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->结合Wrapper和mapper自定义sql<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/4.zizhiSQL.html" class="link series-item series-item" aria-label="自制SQL"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->自制SQL<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/5.IService.html" class="link series-item series-item" aria-label="IService"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->IService<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/6.IServicedelambdalianshidiaoyong.html" class="link series-item series-item" aria-label="IService的链式调用"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->IService的链式调用<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/7.IServicedepiliangcharu.html" class="link series-item series-item" aria-label="IService的批量插入"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->IService的批量插入<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/8.fenyechajian.html" class="link series-item series-item" aria-label="MP的分页插件"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->MP的分页插件<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/MybatisPlus/9.ewaigongnen.html" class="link series-item series-item" aria-label="MP的额外功能"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->MP的额外功能<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->八股<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimashangcheng/bagu/1.Spring.html" class="link series-item series-item" aria-label="Spring八股"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Spring八股<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/bagu/2.JWT.html" class="link series-item series-item" aria-label="JWT"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->JWT<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/bagu/3.weifuwu.html" class="link series-item series-item" aria-label="微服务"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->微服务<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="series-group series-item"><h6 class="series-heading series-level-2"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->微服务<!--]--></span></span><!----></h6><ul style="display:block;"><li><!--[--><a href="/docs/heimashangcheng/weifuwu/1.bushuyuanxiangmu.html" class="link series-item series-item" aria-label="部署原项目"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->部署原项目<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/2.xiangmuchuburenshi.html" class="link series-item series-item" aria-label="微服务初接触"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->微服务初接触<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/3.fuwuguanli（zhucezhongxinNacos）.html" class="link series-item series-item" aria-label="服务管理"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->服务管理<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/4.yuanchengdiaoyong（OpenFeign）.html" class="link series-item series-item" aria-label="远程调用"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->远程调用<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/5.weifuwuwangguan（Gateway）.html" class="link series-item series-item" aria-label="微服务网关"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->微服务网关<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/6.peizhiguanli（peizhizhongxinNacos）.html" class="link series-item series-item" aria-label="配置中心"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->配置中心<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/7.fuwubaohu（Sentinelrongduanxianliu）.html" class="link series-item series-item" aria-label="服务保护"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->服务保护<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/8.fenbushishiwu（Seata）.html" class="link series-item series-item" aria-label="分布式事务"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->分布式事务<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/9.xiaoxiduilie（MQ）.html" class="link series-item series-item" aria-label="消息队列"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->消息队列<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/10.ElasticSearch.html" class="link series-item series-item" aria-label="ElasticSearch"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->ElasticSearch<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/EX：Commonmokuaidezhuyishixiang.html" class="link series-item series-item" aria-label="Common模块的注意事项"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Common模块的注意事项<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/docs/heimashangcheng/weifuwu/EX：lianluzhuizong.html" class="link series-item series-item" aria-label="链路追踪"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->链路追踪<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--></li></ul></section><!--]--><!--]--></aside><!--[--><main class="page-container"><div class="page-content"><h1 class="page-title">优惠券秒杀</h1><div class="page-info"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M16 4a5 5 0 1 1-5 5a5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7a7 7 0 0 0-7-7z" fill="currentColor"></path><path d="M26 30h-2v-5a5 5 0 0 0-5-5h-6a5 5 0 0 0-5 5v5H6v-5a7 7 0 0 1 7-7h6a7 7 0 0 1 7 7z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->SaltFishGC<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2025-1-7<!--]--></span></span><!----><!----><!----></div><div class="theme-reco-md-content"><div><h2 id="全局唯一id" tabindex="-1"><a class="header-anchor" href="#全局唯一id"><span>全局唯一ID</span></a></h2><p>简单业务下我们会使用自增长ID来确保其的唯一性，但是这样的方式存在一定问题：</p><ul><li>id规律过于明显，容易从中暴露信息</li><li>数据量太大，即便是多位数字也无法存储</li></ul><p>而UUid又存在不确保唯一性的问题</p><p>那么我们在思考一下全局id的几个要求</p><ul><li><strong>唯一性</strong>：不可重复</li><li><strong>高可用</strong>：多服务均可用且可靠</li><li><strong>高性能</strong>：生成速度快</li><li><strong>递增性</strong>：有利于数据库构建索引</li><li><strong>安全性</strong>：尽量避免暴露信息</li></ul><p>而基于以上要求，我们可以利用Redis实现一个全局ID生成器，比如用时间戳以及序列号<strong>拼接</strong>生成ID实现唯一性（比如用long，8字节，64位，除去1位符号位，31位时间戳+32位序列号实现2^31秒*秒内2^32个序列号实现完全不同的ID）</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Component</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisIdWorker</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * 开始时间戳</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> <span class="token constant">BEGIN_TIMESTAMP</span> <span class="token operator">=</span> <span class="token number">1768052420L</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * 序列号位数</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">COUNT_BITS</span> <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * 获取该key下一个ID</span>
<span class="line">     *</span>
<span class="line">     * <span class="token keyword">@param</span> <span class="token parameter">keyPrefix</span> key前缀</span>
<span class="line">     * <span class="token keyword">@return</span> id</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">nextId</span><span class="token punctuation">(</span><span class="token class-name">String</span> keyPrefix<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 生成时间戳</span></span>
<span class="line">        <span class="token class-name">LocalDateTime</span> now <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">long</span> nowSecond <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">toEpochSecond</span><span class="token punctuation">(</span><span class="token class-name">ZoneOffset</span><span class="token punctuation">.</span><span class="token constant">UTC</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">long</span> timestamp <span class="token operator">=</span> nowSecond <span class="token operator">-</span> <span class="token constant">BEGIN_TIMESTAMP</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 生成序列号</span></span>
<span class="line">        <span class="token comment">// 借助redis自增生成序列号，这里统计的是每天的，序列号最大为2^32-1，每天最多生成2^32个ID</span></span>
<span class="line">        <span class="token comment">// key不存在时，自动生成0，后续自增正常执行</span></span>
<span class="line">        <span class="token class-name">String</span> date <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy:MM:dd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">long</span> count <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token string">&quot;icr:&quot;</span> <span class="token operator">+</span> keyPrefix <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> date<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 拼接并返回</span></span>
<span class="line">        <span class="token comment">// |运算和||不一样，一个是对每一位bit进行或运算，一个是逻辑运算符</span></span>
<span class="line">        <span class="token keyword">return</span> timestamp <span class="token operator">&lt;&lt;</span> <span class="token constant">COUNT_BITS</span> <span class="token operator">|</span> count<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样的做法和<strong>雪花算法</strong>类似，详见后续说明</p><h2 id="优惠券" tabindex="-1"><a class="header-anchor" href="#优惠券"><span>优惠券</span></a></h2><p>本项目对优惠券表的设置是每种优惠券单独在表中作为一行数据，记录对应店铺，库存等相关信息。</p><p>开始优惠秒杀活动时，用户点击购买，后端确认优惠券<strong>活动是否开始</strong>-&gt;判断<strong>库存是否充足</strong>-&gt;减扣库存，中间有异常则抛出异常，返回失败结果，成功则返回订单id。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token annotation punctuation">@Transactional</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">seckillVoucher</span><span class="token punctuation">(</span><span class="token class-name">Long</span> voucherId<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BusinessException</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">SeckillVoucher</span> seckillVoucher <span class="token operator">=</span> seckillVoucherService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>voucherId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 查询活动是否开始</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>seckillVoucher<span class="token punctuation">.</span><span class="token function">getBeginTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isAfter</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;优惠活动尚未开始&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>seckillVoucher<span class="token punctuation">.</span><span class="token function">getEndTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isBefore</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;优惠活动已结束&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token comment">// 检查库存是否充足</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>seckillVoucher<span class="token punctuation">.</span><span class="token function">getStock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;优惠券已售罄&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token comment">// 扣减库存</span></span>
<span class="line">        <span class="token keyword">boolean</span> success <span class="token operator">=</span> seckillVoucherService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpdateWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SeckillVoucher</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">                <span class="token function">setSql</span><span class="token punctuation">(</span><span class="token string">&quot;stock = stock - 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">                <span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;voucher_id&quot;</span><span class="token punctuation">,</span> voucherId<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//        seckillVoucherService.update().setSql(&quot;stock = stock + 1&quot;).eq(&quot;voucher_id&quot;, voucherId).update();</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>success<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;库存不足&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 创建订单</span></span>
<span class="line">        <span class="token class-name">VoucherOrder</span> voucherOrder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VoucherOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 订单id</span></span>
<span class="line">        <span class="token keyword">long</span> id <span class="token operator">=</span> redisIdWorker<span class="token punctuation">.</span><span class="token function">nextId</span><span class="token punctuation">(</span><span class="token string">&quot;order&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        voucherOrder<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 用户id（通过Threadlocal提取）</span></span>
<span class="line">        <span class="token class-name">Long</span> userId <span class="token operator">=</span> <span class="token class-name">UserHolder</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        voucherOrder<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 代金券券id</span></span>
<span class="line">        voucherOrder<span class="token punctuation">.</span><span class="token function">setVoucherId</span><span class="token punctuation">(</span>voucherId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 保存订单</span></span>
<span class="line">        voucherOrderMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>voucherOrder<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>voucherId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但是以上操作实际上是存在问题的，比如这里在高并发场景下，检查库存数量时会出现异常（都发现为1，然后都进入临界区导致库存减到负数），但是这里如果随便加锁就会造成极大且无法接受的速率损耗，怎么办呢？</p><h2 id="悲观锁以及乐观锁" tabindex="-1"><a class="header-anchor" href="#悲观锁以及乐观锁"><span>悲观锁以及乐观锁</span></a></h2><p><strong>悲观锁</strong></p><p>认为无论何时，线程安全问题一定会发生，执行操作前必须尝试获取锁，保证线程串行执行：比如synchronized，Lock就是悲观锁，这样的阻塞对速率的影响非常大。</p><p><strong>乐观锁</strong></p><p>认为线程安全问题不一定会发生，<strong>不加锁</strong>，只在更新数据时判断<strong>是否有其他线程对数据做操作</strong>了：如无，则判断安全；如已被其他线程修改，则判断不安全，尝试重试或返回错误。<strong>（推荐）</strong></p><h2 id="超卖问题" tabindex="-1"><a class="header-anchor" href="#超卖问题"><span>超卖问题</span></a></h2><p>乐观锁常见的实现方法有：</p><ul><li><strong>版本号法：</strong></li></ul><p>为数据增加一条版本列（Version），专门用于记录该数据是否被其他事务/线程修改了（保证前后数据一致才可继续执行，类似mvcc的事务id检查）：</p><div class="mermaid-diagram" style="text-align:center;"></div><p>关键在于其中对数据的更新不是</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">update</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">	<span class="token keyword">set</span> stock <span class="token operator">=</span> stock <span class="token operator">+</span> <span class="token number">1</span></span>
<span class="line">	<span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">10</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>而是</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">update</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">	<span class="token keyword">set</span> stock <span class="token operator">=</span> stock <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">,</span> version <span class="token operator">=</span> version <span class="token operator">+</span> <span class="token number">1</span></span>
<span class="line">	<span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">and</span> version <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这就保证了几个事务获取到一个version的数据后，只能有一个事务修改库存了。</p><p>这里之所以不会再次遇到高并发问题，是因为一条update语句会对对应的数据行加<strong>X锁</strong>，其他的update操作会被阻塞，而等当前事务完成操作后，再次update就会发现version变了从而无法找到对应行，只能返回错误。</p><ul><li><strong>CAS法</strong></li></ul><p>但是以上操作不仅稍显复杂，还需要额外占用一点空间用于存储version，我们说这不合理，所以就使用类似的一种方式，即只比较前后库存是否相同，如相同我们会对其进行更新，若不相同则会返回错误：</p><div class="mermaid-diagram" style="text-align:center;"></div><p>通过CAS比较<strong>前后数据是否一致</strong>且后续的<strong>更新操作</strong>和<strong>比较操作</strong>是耦合在一起的，具有<strong>原子性</strong>的sql，这时就保证了该修改操作一定是安全的。</p><p>但是！只是安全是不够的，以上操作会导致失败率过高，即由于<strong>获取到同一stock版本的几个事务只能有一个事务成功</strong>，其他的都会失败，导致很多的请求返回了失败异常！</p><p>那么这时候，我们就可以换一种策略：</p><p>我们将对stock前后必须一致要求改为<strong>stock必须&gt;0</strong>来解决这个失败问题（update操作会加<strong>X锁</strong>，保证同一行数据同一时刻只能有一个事务进行修改操作，那么这里在update的原子性sql中加一条stock必须&gt;0的确可以保证每一条修改sql都不会将stock减到负数，且都可以正常获取优惠。但是！这实际上是将并发问题丢给了数据库，归根结底还是用数据库的<strong>X锁</strong>来解决这个并发问题，<strong>是悲观锁并非乐观锁</strong>！）</p><blockquote><p>这时我们会发现update操作是<strong>在事务内</strong>的，这时在<strong>可重复读</strong>的事务隔离等级下，是否会由于<strong>并发事务之间数据不可见</strong>的特性导致stock超卖呢？</p><p>事实上是不会的！update的<strong>where条件</strong>读的并非和select一样要符合<strong>快照</strong>要求！</p><p><strong>在 InnoDB 的可重复读（RR）隔离级别下：</strong><strong><code>UPDATE</code> / <code>DELETE</code> 语句的 WHERE 条件使用的是 *当前最新已提交的数据*（即“实时读”），而不是事务启动时的快照！</strong> 但 <strong>SET 子句中的值</strong>（如果涉及子查询）可能仍受快照影响。</p><p>换句话说： 🔹 <strong><code>WHERE</code> 条件 → 实时读（Read Committed 行为）</strong> 🔹 <strong>普通 <code>SELECT</code> → 快照读（Repeatable Read 行为）</strong></p><p>而上了X锁，只会在事务提交的时候释放，也就是说只要其他事务修改了，就必须等待到正在处理的事务提交了才能够上X锁并检查stock&gt;0并修改</p></blockquote><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token annotation punctuation">@Transactional</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">seckillVoucher</span><span class="token punctuation">(</span><span class="token class-name">Long</span> voucherId<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BusinessException</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">SeckillVoucher</span> seckillVoucher <span class="token operator">=</span> seckillVoucherService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>voucherId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 查询活动是否开始</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>seckillVoucher<span class="token punctuation">.</span><span class="token function">getBeginTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isAfter</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;优惠活动尚未开始&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>seckillVoucher<span class="token punctuation">.</span><span class="token function">getEndTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isBefore</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;优惠活动已结束&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// 检查库存是否充足</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>seckillVoucher<span class="token punctuation">.</span><span class="token function">getStock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;优惠券已售罄&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// 扣减库存</span></span>
<span class="line">    <span class="token keyword">boolean</span> success <span class="token operator">=</span> seckillVoucherService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpdateWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SeckillVoucher</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">            <span class="token function">setSql</span><span class="token punctuation">(</span><span class="token string">&quot;stock = stock - 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">            <span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;voucher_id&quot;</span><span class="token punctuation">,</span> voucherId<span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">            <span class="token function">gt</span><span class="token punctuation">(</span><span class="token string">&quot;stock&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>  </span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;库存不足&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 创建订单</span></span>
<span class="line">    <span class="token class-name">VoucherOrder</span> voucherOrder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VoucherOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 订单id</span></span>
<span class="line">    <span class="token keyword">long</span> id <span class="token operator">=</span> redisIdWorker<span class="token punctuation">.</span><span class="token function">nextId</span><span class="token punctuation">(</span><span class="token string">&quot;order&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    voucherOrder<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 用户id（通过Threadlocal提取）</span></span>
<span class="line">    <span class="token class-name">Long</span> userId <span class="token operator">=</span> <span class="token class-name">UserHolder</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    voucherOrder<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 代金券券id</span></span>
<span class="line">    voucherOrder<span class="token punctuation">.</span><span class="token function">setVoucherId</span><span class="token punctuation">(</span>voucherId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 保存订单</span></span>
<span class="line">    voucherOrderMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>voucherOrder<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>voucherId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>X锁会在update语句尝试获取，未获取到则阻塞等待，直到成功获取，最后在事务完成commit后释放；</p><p>同时X锁会获取到<strong>实时数据</strong>而非符合快照的数据（包括**<code>SELECT ... FOR UPDATE</code>**）</p><p><strong>所有“当前读”（Current Read）操作 —— 包括 <code>SELECT ... FOR UPDATE</code>、<code>SELECT ... LOCK IN SHARE MODE</code>、<code>UPDATE</code>、<code>DELETE</code> —— 在 RR 隔离级别下都会：</strong></p><ol><li><strong>读取最新已提交的数据（实时视图）</strong>；</li><li><strong>对匹配的行加锁（X 锁或 S 锁）</strong>；</li><li><strong>忽略 MVCC 快照（Read View）</strong>。</li></ol></blockquote><h2 id="一人一单" tabindex="-1"><a class="header-anchor" href="#一人一单"><span>一人一单</span></a></h2><p>为了避免一个用户使用多次优惠券，我们需要在检测数据库是否已经存在该订单，使用了该优惠券id且用户id与输入订单信息重复，如有则表示该用户已经使用了该优惠券，无法再次使用：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// 检测用户是否已经使用过该优惠券</span></span>
<span class="line"><span class="token class-name">Long</span> userId <span class="token operator">=</span> <span class="token class-name">UserHolder</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">int</span> count <span class="token operator">=</span> voucherOrderMapper<span class="token punctuation">.</span><span class="token function">selectCount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">VoucherOrder</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;user_id&quot;</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;voucher_id&quot;</span><span class="token punctuation">,</span> voucherId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;用户已经使用过该优惠券&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但是在这里存在一个问题：并发下多次查询可能多个请求均同时通过，为了避免这个情况，我们很容易联系到加<strong>锁</strong>使得每次只能有一个进程修改数据，前面我们讲过用<strong>redis</strong>做互斥锁，<strong>乐观锁</strong>（前后保持一致等），以及借助X锁实现的悲观锁，这里我们再讲一个jvm提供的synchronized实现的悲观锁：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">        <span class="token comment">// String类型的==可能比较的是内存地址而非字符串内容，所以用String的intern()方法保证锁准确</span></span>
<span class="line">        <span class="token class-name">Long</span> userId <span class="token operator">=</span> <span class="token class-name">UserHolder</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>userId<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token function">createVoucherOrder</span><span class="token punctuation">(</span>voucherId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * 创建订单</span>
<span class="line">     *</span>
<span class="line">     * <span class="token keyword">@param</span> <span class="token parameter">voucherId</span> 代金券id</span>
<span class="line">     * <span class="token keyword">@return</span> 订单id</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token annotation punctuation">@Transactional</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">createVoucherOrder</span><span class="token punctuation">(</span><span class="token class-name">Long</span> voucherId<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BusinessException</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 检测用户是否已经使用过该优惠券</span></span>
<span class="line">        <span class="token class-name">Long</span> userId <span class="token operator">=</span> <span class="token class-name">UserHolder</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">int</span> count <span class="token operator">=</span> voucherOrderMapper<span class="token punctuation">.</span><span class="token function">selectCount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">VoucherOrder</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">                <span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;user_id&quot;</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">                <span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;voucher_id&quot;</span><span class="token punctuation">,</span> voucherId<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;用户已经使用过该优惠券&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 扣减库存</span></span>
<span class="line">        <span class="token keyword">boolean</span> success <span class="token operator">=</span> seckillVoucherService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpdateWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SeckillVoucher</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">                <span class="token function">setSql</span><span class="token punctuation">(</span><span class="token string">&quot;stock = stock - 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">                <span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;voucher_id&quot;</span><span class="token punctuation">,</span> voucherId<span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">                <span class="token function">gt</span><span class="token punctuation">(</span><span class="token string">&quot;stock&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">// 事实上是借助数据库X锁保证同一时间只能有一个进程修改的实现的悲观锁</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;库存不足&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 创建订单</span></span>
<span class="line">        <span class="token class-name">VoucherOrder</span> voucherOrder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VoucherOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 订单id</span></span>
<span class="line">        <span class="token keyword">long</span> id <span class="token operator">=</span> redisIdWorker<span class="token punctuation">.</span><span class="token function">nextId</span><span class="token punctuation">(</span><span class="token string">&quot;order&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        voucherOrder<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 用户id（通过Threadlocal提取）</span></span>
<span class="line">        voucherOrder<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 代金券券id</span></span>
<span class="line">        voucherOrder<span class="token punctuation">.</span><span class="token function">setVoucherId</span><span class="token punctuation">(</span>voucherId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 保存订单</span></span>
<span class="line">        voucherOrderMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>voucherOrder<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意锁释放时一定要保证事务已经提交！<strong>否则其他事务读不到该事务修改的数据（MVCC</strong>可重复读</strong>下，事务只会读<strong>该事务开启前已经提交的事务修改的数据版本</strong>）</p><p><strong>而且这里一定要注意外层的方法不要加事务注解！<strong>假如加了，那么事务AB先后启动，A未提交时进入synchronized（内部方法并入A），B等待，<strong>A完成数据修改后B是看不到的！（B启动时活跃事务快照视图中包含A）<strong>这里要保证将</strong>操作的事务</strong>放入锁内！（当然其实也可以把事务隔离等级改为</strong>读已提交</strong>：每执行一条 <code>SELECT</code> 语句（而不是事务启动时），就创建一个新的 Read View，只包含当时已提交的数据。）</p><blockquote><p><strong>事务必须在获取应用层锁（如 synchronized）之后才开启！（事务放到锁里面）</strong> 否则 MVCC 的 Read View 会“冻结”在锁等待之前的状态，导致看不到已提交数据。</p></blockquote><p><strong>即我们要求某操作一个一个执行，且后一个操作拿得到前面一个操作修改的数据！那么这时候我们上锁，保证操作一个一个执行，且要么对这段操作整体加事务（提交了之后再释放锁让下一个事务开启），要么改事务隔离等级为读已提交，以保证操作间数据一致性。</strong></p><p>当然这里还有问题，比如synchronized<strong>无法跨机</strong>，分布式或微服务下无法实现全局的上锁，最后可能还是需要<strong>redis的分布式锁</strong>来解决这一问题（或者在数据库加<strong>唯一索引</strong>保证只有一个，尝试添加已有的会报异常）</p><p><strong>总结以上内容，我们保证某一数据的完全安全，就是要求对其的操作一个一个顺序串行执行（加锁），且查询条件操作以及修改操作是耦合在一块的一个原子性操作（放入一个事务/sql），同时注意条件的准确性（操作间数据一致性，改事务隔离等级，或让事务不交叉即放到锁内）</strong></p><p><strong>简单记忆就是如需加锁，那么这时候一般考虑将事务挪到锁内，让锁包住事务，保证事务间数据一致性！</strong></p><hr><h2 id="mybatisplus提供的update以及setsql-快速拼接update的sql" tabindex="-1"><a class="header-anchor" href="#mybatisplus提供的update以及setsql-快速拼接update的sql"><span>Mybatisplus提供的update以及setSql()快速拼接update的sql</span></a></h2><p>都知道可以通过Service的update，再给出updateWrapper来实现更新，我们其实也可以用链式编程来实现sql的拼接：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">seckillVoucherService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSql</span><span class="token punctuation">(</span><span class="token string">&quot;stock = stock + 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;voucher_id&quot;</span><span class="token punctuation">,</span> voucherId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这也可以实现sql语句的拼接效果，当然使用wrapper的话：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">seckillVoucherService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpdateWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SeckillVoucher</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">        <span class="token function">setSql</span><span class="token punctuation">(</span><span class="token string">&quot;stock = stock - 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">        <span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;voucher_id&quot;</span><span class="token punctuation">,</span> voucherId<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中<strong>setSql</strong>比较重要，我们平时写简单更新业务的时候不想到mapper层写的话，就可以在这直接加上set后面的语句。</p><h2 id="雪花算法" tabindex="-1"><a class="header-anchor" href="#雪花算法"><span>雪花算法</span></a></h2><p>雪花算法（Snowflake）是一种<strong>分布式唯一 ID 生成算法</strong>，最早由 Twitter 开源，广泛用于数据库主键、订单号、消息队列等需要<strong>高性能、全局唯一、有序递增</strong>的场景。</p><p><strong>核心结构</strong></p><p>标准 64 位 Snowflake ID 由以下部分组成：</p><ul><li><strong>1 位符号位</strong>：固定为 0，保证正数。</li><li><strong>41 位时间戳</strong>：记录自定义起始时间（epoch）以来的毫秒数，可用约 69 年。</li><li><strong>10 位机器标识</strong>：区分不同节点（可拆分为数据中心 ID + 机器 ID）。</li><li><strong>12 位序列号</strong>：同一毫秒内的自增序列，最大支持每毫秒 4096 个 ID。</li></ul><p>生成流程</p><ol><li><strong>获取当前时间戳</strong>（毫秒）并减去 epoch。</li><li><strong>处理时钟回拨</strong>：若当前时间小于上次生成时间，可等待追平或抛异常。</li><li><strong>生成序列号</strong>： 同一毫秒内递增，超过最大值则等待下一毫秒。 不同毫秒重置为 0。</li><li><strong>位移拼接</strong>：将时间戳、机器 ID、序列号按位移组合成 64 位整数。</li></ol><h2 id="lang封装的类型注意-判断可能并非内容是否相等" tabindex="-1"><a class="header-anchor" href="#lang封装的类型注意-判断可能并非内容是否相等"><span>lang封装的类型注意==判断可能并非内容是否相等</span></a></h2><p>在 Java 中，使用 <code>==</code> 比较封装类型（如 <code>Integer</code>、<code>Long</code>、<code>Boolean</code> 等）时，<strong>比较的是对象的引用（内存地址），而不是它们的值内容</strong>。这可能导致 <strong>看似相等的数值，用 <code>==</code> 判断却返回 <code>false</code></strong>。</p><p><strong>对封装类型（Wrapper Classes）应始终使用 <code>.equals()</code> 比较值是否相等，而不是 <code>==</code>。</strong></p><h2 id="解决自调用" tabindex="-1"><a class="header-anchor" href="#解决自调用"><span>解决自调用</span></a></h2><ol><li>简单事务失效直接在外层套一个事务注解就行，但是内层事务相关配置是不会生效了。</li><li>自注入</li></ol><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">OrderService</span> self<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><p>AOP获取代理对象</p></li><li><p><strong><code>ApplicationContext</code></strong> 上下文获取代理对象**（不推荐）**</p></li><li><p>拆分到其他Service</p></li></ol><h2 id="mvcc可重复读保证的事务内数据一致性" tabindex="-1"><a class="header-anchor" href="#mvcc可重复读保证的事务内数据一致性"><span>MVCC可重复读保证的事务内数据一致性</span></a></h2><p>MVCC可重复读是用于保证事务内前后读取同一行数据不一致的问题的版本管理，可重复读它是保证每个事务只能读到<strong>该事务开启之前就已经完成提交</strong>的事务修改的数据版本，其他的一概不可见！</p><p>这就会导致事务间数据不一致，使用事务不要无脑，结合业务场景去选择事务隔离等级，如业务要求操作间数据一致性强，那么就要考虑如何使得操作之间事务不交叉（加锁），或是换成读已提交了！</p><h2 id="保证并发下数据安全的几个必要条件" tabindex="-1"><a class="header-anchor" href="#保证并发下数据安全的几个必要条件"><span>保证并发下数据安全的几个必要条件</span></a></h2><ol><li>原子性：<strong>条件检查</strong>与<strong>修改</strong>操作内聚为一个<strong>原子</strong>操作</li><li>互斥性：对原子操作上锁，保证同一时间对该数据只能有一个修改操作正在执行</li><li>条件获取必须准确（如RR的事务隔离可能会导致条件数据存在异常，需修改隔离等级或保证事务不交叉）</li></ol><p>以超卖问题为例：</p><p>一条sql实现where条件与update修改实现原子性；X锁实现互斥；X锁读取最新数据</p></div></div><footer class="page-meta"><div class="meta-item edit-link"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M2 26h28v2H2z" fill="currentColor"></path><path d="M25.4 9c.8-.8.8-2 0-2.8l-3.6-3.6c-.8-.8-2-.8-2.8 0l-15 15V24h6.4l15-15zm-5-5L24 7.6l-3 3L17.4 7l3-3zM6 22v-3.6l10-10l3.6 3.6l-10 10H6z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Edit this page<!--]--></span></span></div><div class="meta-item last-updated"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Last Updated 2/17/2026, 2:23:36 PM<!--]--></span></span></div></footer><nav class="page-nav"><p class="hasPrev hasNext inner"><span class="page-nav-item prev"> ← 缓存</span><span class="page-nav-item next">分布式锁 → </span></p></nav><!----></div><div class="page-catalog-container"><h5 class="tip">ON THIS PAGE</h5><ul><!--[--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/3.youhuiquanmiaosha.html#全局唯一id" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="全局唯一ID"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->全局唯一ID<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/3.youhuiquanmiaosha.html#优惠券" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="优惠券"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->优惠券<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/3.youhuiquanmiaosha.html#悲观锁以及乐观锁" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="悲观锁以及乐观锁"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->悲观锁以及乐观锁<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/3.youhuiquanmiaosha.html#超卖问题" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="超卖问题"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->超卖问题<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/3.youhuiquanmiaosha.html#一人一单" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="一人一单"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->一人一单<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/3.youhuiquanmiaosha.html#mybatisplus提供的update以及setsql-快速拼接update的sql" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Mybatisplus提供的update以及setSql()快速拼接update的sql"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Mybatisplus提供的update以及setSql()快速拼接update的sql<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/3.youhuiquanmiaosha.html#雪花算法" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="雪花算法"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->雪花算法<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/3.youhuiquanmiaosha.html#lang封装的类型注意-判断可能并非内容是否相等" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="lang封装的类型注意==判断可能并非内容是否相等"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->lang封装的类型注意==判断可能并非内容是否相等<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/3.youhuiquanmiaosha.html#解决自调用" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="解决自调用"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->解决自调用<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/3.youhuiquanmiaosha.html#mvcc可重复读保证的事务内数据一致性" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="MVCC可重复读保证的事务内数据一致性"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->MVCC可重复读保证的事务内数据一致性<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/docs/heimadianping/yewusheji/3.youhuiquanmiaosha.html#保证并发下数据安全的几个必要条件" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="保证并发下数据安全的几个必要条件"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->保证并发下数据安全的几个必要条件<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--></ul></div></main><!--]--></div></div><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-DXmPnZac.js" defer></script>
  </body>
</html>
