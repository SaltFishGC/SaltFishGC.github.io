---
title: ç¼“å­˜
date: 2025-1-7
---

### Redisç¼“å­˜

æŸ¥è¯¢å¾ªåºï¼š

â€‹	å‰ç«¯å…ˆæŸ¥ç¼“å­˜->ç¼“å­˜å­˜åœ¨ï¼šè¿”å›æ•°æ®->ç¼“å­˜ä¸å­˜åœ¨è¯¥æ•°æ®ï¼šæŸ¥è¯¢æ•°æ®åº“

â€‹	æŸ¥è¯¢æ•°æ®åº“->å­˜åœ¨/ä¸å­˜åœ¨ï¼šè¿”å›ç»“æœï¼Œè‹¥å­˜åœ¨åˆ™æ›´æ–°ç¼“å­˜

å¥½å¤„ï¼š

è¯»å†™å¿«ï¼Œå“åº”é€Ÿåº¦å¿«ï¼Œé™ä½æ•°æ®åº“å‹åŠ›

åå¤„ï¼š

æ•°æ®ä¸€è‡´æ€§è¦æ±‚ï¼ˆç¼“å­˜å’Œæ•°æ®åº“æ•°æ®è¦æ±‚ä¸€è‡´ï¼‰ï¼Œè¿ç»´æˆæœ¬

ç¬¦åˆç¼“å­˜çš„æ•°æ®è¦æ±‚ï¼š 

1. æ•°æ®é‡æ²¡æœ‰å¤§åˆ°ç¦»è°±
2. å¯¹è¯¥æ•°æ®QPSè¾ƒé«˜

è®¾ç½®ç¼“å­˜å°½é‡åŠ ä¸Šttl



### ç¼“å­˜æ›´æ–°ç­–ç•¥

redisæ¯•ç«Ÿè¿˜æ˜¯åƒå†…å­˜çš„ï¼Œå‡å¦‚æ•°æ®é‡è¾¾åˆ°è®¾ç½®çš„é˜ˆå€¼äº†ï¼Œå†åŠ æ•°æ®æ€ä¹ˆåŠï¼Ÿ

**å†…å­˜æ·˜æ±°**

redisè‡ªå¸¦ï¼Œå¿«åˆ°ä¸Šé™äº†å°±ä¼šè‡ªåŠ¨åˆ é™¤éƒ¨åˆ†æ•°æ®ä»¥ç©ºå‡ºä¸€éƒ¨åˆ†ç©ºé—´ï¼Œç”¨æˆ·ä¸‹æ¬¡æŸ¥ä¸åˆ°äº†å†åŠ 

**è¶…æ—¶åˆ é™¤**

å¸¸è§çš„ttlï¼Œè¿‡æœŸè‡ªåŠ¨åˆ é™¤

**ä¸»åŠ¨æ›´æ–°**

è‡ªä¸»è®¾è®¡ä¿®æ”¹æ•°æ®è¯·æ±‚



### ä¸»åŠ¨æ›´æ–°ç­–ç•¥

ä¸Šé¢æˆ‘ä»¬è¯´äº†å­˜å‚¨ä¸Šé™åˆ°äº†ï¼Œç”¨**æ–°æ•°æ®**æ¥æ›¿æ¢**æ—§æ•°æ®**çš„ç­–ç•¥ï¼Œè¿™é‡Œæˆ‘ä»¬å†è®²è®²å°†ä¸€ä¸ªç¼“å­˜æ•°æ®æ›´æ–°è¯¥æ€ä¹ˆæ“ä½œï¼Ÿ

1. åŒæ—¶ï¼šæ›´æ–°æ•°æ®åº“çš„åŒæ—¶æ›´æ–°ç¼“å­˜**ï¼ˆæœ€å¸¸ä½¿ç”¨ï¼‰**
2. å†™ç©¿ï¼šæ•°æ®åº“ä¸ç¼“å­˜é«˜å†…èšï¼Œåªç®¡ç”¨
3. å†™å›ï¼šåªç®¡æ›´æ–°ç¼“å­˜ï¼Œç¼“å­˜é€šè¿‡rdbå¿«ç…§ï¼Œaofç­‰æ–¹å¼å¼‚æ­¥æŒä¹…åŒ–å†™å›æ•°æ®åº“ï¼ˆrediså…¨æ­‡èœäº†å°±å®Œè›‹ï¼Œéœ€è¦é›†ç¾¤å“¨å…µç­‰ä¿è¯ç¼“å­˜å¯é æ€§ï¼‰

**é«˜ä¸€è‡´æ€§éœ€æ±‚**ï¼šåˆ†å¸ƒå¼é”ï¼ˆéå¸¸éœ€è¦æ•°æ®ä¸€è‡´/æ•°æ®å®‰å…¨æ—¶ï¼‰

**ä½ä¸€è‡´æ€§éœ€æ±‚**ï¼šå…ˆè¯»å†è¯´

å½“ç„¶ä»¥ä¸Šéƒ½æ˜¯å¯¹**å­˜å…¥ç¼“å­˜**çš„æ•°æ®è®¨è®ºçš„ï¼Œå¯¹äºqpsä¸é«˜çš„æ•°æ®ï¼Œç›´æ¥è¯»æ•°æ®åº“ç”šè‡³HBaseçš„æ…¢è¯»éƒ½å¯ä»¥ã€‚



### æ•°æ®æ›´æ–°åå¯¹ç¼“å­˜çš„å¤„ç†

è¿™é‡Œè¿˜éœ€è¦æ³¨æ„ä¸€ä¸‹æ•°æ®åº“æ•°æ®æ›´æ–°å®Œäº†ï¼Œæˆ‘ä»¬æ˜¯ç›´æ¥æ›´æ–°ç¼“å­˜æ•°æ®ï¼Œè¿˜æ˜¯å…ˆåˆ é™¤äº†ï¼Œç­‰ä»¥åæŸ¥è¯¢äº†å†å°†æ–°æ•°æ®åŠ åˆ°ç¼“å­˜é‡Œé¢å¥½ï¼š

ç›´æ¥æ›´æ–°ï¼šå‡å¦‚æ›´æ–°å¤šï¼ŒæŸ¥è¯¢å°‘ï¼Œé‚£å°±ä¼šå¯¼è‡´æ¯æ¬¡æ›´æ–°è¿˜å¾—å†æ”¹ä¸€ä¸‹ç¼“å­˜

**ç›´æ¥åˆ äº†**ï¼šæ›´æ–°å®Œäº†æ²¡æœ‰è¿™ä¸ªç¼“å­˜ï¼Œä¸‹æ¬¡æŸ¥è¯¢å®Œäº†å†åŠ å…¥ç¼“å­˜ï¼Œå¤šæ¬¡æ›´æ–°é—´æ— éœ€æ‰§è¡Œä¿®æ”¹ç¼“å­˜æ“ä½œ**ï¼ˆæ¨èï¼‰**



### æ›´æ–°æ“ä½œä¸­ï¼Œæ•°æ®åº“ä»¥åŠç¼“å­˜çš„å¤„ç†é¡ºåº

å…¶å®éƒ½å¯ä»¥ï¼š

**å…ˆæ”¹æ•°æ®åº“ååˆ ç¼“å­˜**ï¼šåˆ ç¼“å­˜æœŸé—´ä¼šè„è¯»ï¼ŒåŒæ—¶ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´æ—§æ•°æ®å†™ç¼“å­˜ï¼Œä½†ç›¸å¯¹æ¦‚ç‡å°**ï¼ˆæ¨èï¼‰**

**å…ˆåˆ ç¼“å­˜åæ”¹æ•°æ®åº“**ï¼šæ”¹æ•°æ®åº“æœªæäº¤æœŸé—´å…¶ä»–äº‹åŠ¡è¯»äº†æ—§æ•°æ®å¯èƒ½ä¼šå°†æ—§æ•°æ®å†™åˆ°ç¼“å­˜ä¸­ï¼Œéœ€è¦å»¶è¿ŸåŒåˆ 

**ä½æ•°æ®ä¸€è‡´æ€§**ï¼šå»¶è¿ŸåŒåˆ ï¼ˆä¸€å®šè¦ç¡®ä¿å»¶è¿Ÿæ—¶é—´å¤§äºä¸€ä¸ªè¯·æ±‚çš„å¤„ç†æ—¶é—´ï¼‰

**é«˜æ•°æ®ä¸€è‡´æ€§**ï¼šåˆ†å¸ƒå¼é”ï¼ˆè¦ç¡®ä¿é˜»å¡å¸¦æ¥çš„å½±å“ä¸ä¼šè¿‡å¤§ï¼‰

ç”¨æˆ·æ›´æ–°æ•°æ®å¯¼è‡´æ•°æ®åº“ä»¥åŠç¼“å­˜ä¸ä¸€è‡´çš„é—®é¢˜ä»¥åŠå…¶æ‰€å¸¦æ¥çš„è„è¯»é—®é¢˜ï¼Œæ€ä¹ˆè§£å†³ï¼Ÿ

**å»¶è¿ŸåŒåˆ **ï¼šå½»åº•æ›´æ–°å®Œäº†å†åˆ é™¤ä¸€æ¬¡redisä¸­çš„ç¼“å­˜

**åˆ†å¸ƒå¼é”**ï¼šç›´æ¥åŠ é”ï¼Œæ‹¿ä¸åˆ°é”ä¸å‡†æŸ¥ï¼Œç›´æ¥é˜»å¡ä½

å¯¹qpsä»¥åŠæ›´æ–°é¢‘ç‡æœ‰ä¸€å®šè¦æ±‚ï¼Œé«˜qpsä¸‹å¤šæ¬¡æ›´æ–°æ‰€å¸¦æ¥çš„å»¶è¿Ÿéå¸¸ç ´åç”¨æˆ·ä½“éªŒ



### ç®€å•æ€»ç»“ç¼“å­˜æ›´æ–°é—®é¢˜

1. **ä½ä¸€è‡´æ€§éœ€æ±‚**ï¼š
    ä½¿ç”¨ Redis è‡ªå¸¦çš„å†…å­˜æ·˜æ±°æœºåˆ¶ï¼ˆå¦‚ `LRU`ã€`LFU` ç­‰ï¼‰ï¼Œå…è®¸ç¼“å­˜æ•°æ®è¿‡æœŸæˆ–è¢«é©±é€ï¼Œé€‚ç”¨äºå¯¹æ•°æ®å®æ—¶æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯ã€‚
2. **é«˜ä¸€è‡´æ€§éœ€æ±‚**ï¼š
    é‡‡ç”¨ä¸»åŠ¨æ›´æ–°ï¼ˆå…ˆæ”¹æ•°æ®åº“ååˆ ç¼“å­˜ï¼Œå»¶è¿ŸåŒåˆ /åˆ†å¸ƒå¼é”ï¼‰ç­–ç•¥ï¼Œå¹¶ä»¥è¶…æ—¶å‰”é™¤ä½œä¸ºå…œåº•æ–¹æ¡ˆï¼Œç¡®ä¿ç¼“å­˜ä¸æ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§ã€‚

#### â—† è¯»æ“ä½œï¼š

- ç¼“å­˜å‘½ä¸­ â†’ ç›´æ¥è¿”å›ç»“æœï¼ˆæ­¤æ­¥è€ƒè™‘æ·»åŠ åˆ·æ–°è¶…æ—¶æ—¶é—´ï¼‰ï¼›
- ç¼“å­˜æœªå‘½ä¸­ â†’ æŸ¥è¯¢æ•°æ®åº“ï¼Œå°†ç»“æœå†™å…¥ç¼“å­˜ï¼Œå¹¶è®¾å®šåˆç†çš„è¶…æ—¶æ—¶é—´ã€‚

#### â—† å†™æ“ä½œï¼š

- å…ˆå†™æ•°æ®åº“ï¼Œç„¶åå†åˆ é™¤ç¼“å­˜ï¼ˆé¿å…è„è¯»ï¼‰ï¼›
- è¦ç¡®ä¿æ•°æ®åº“å†™å…¥ä¸ç¼“å­˜åˆ é™¤æ“ä½œçš„åŸå­æ€§ï¼ˆå¯é€šè¿‡äº‹åŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—æˆ–å»¶è¿ŸåŒåˆ ç”šè‡³åˆ†å¸ƒå¼é”ç­‰æœºåˆ¶å®ç°ï¼‰ã€‚



### ç¼“å­˜ç©¿é€

**é—®é¢˜å®šä¹‰**ï¼šæŸ¥è¯¢çš„**æ•°æ®**åœ¨**ç¼“å­˜**ä»¥åŠ**æ•°æ®åº“**éƒ½**å‡ä¸å­˜åœ¨**ï¼Œä½†æ˜¯å§‹ç»ˆæœ‰è¯·æ±‚æŸ¥è¯¢ä¸”æ•°é‡ä¸å°‘ï¼Œå¯¼è‡´**æ¯æ¬¡éƒ½æŸ¥è¯¢æ•°æ®åº“**æµªè´¹èµ„æºï¼Œç¼“å­˜å¯¹äºè¿™äº›æ•°æ®çš„æŸ¥è¯¢å¤±æ•ˆäº†ï¼Œç§°ä¸ºç¼“å­˜ç©¿é€ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

#### 1. ç¼“å­˜ç©ºæ•°æ®

æ•°æ®åº“æŸ¥ä¸åˆ°å°±ç¼“å­˜ä¸€ä¸ªç©ºå¯¹è±¡ï¼ˆåªæœ‰ä¸€ä¸ªkeyï¼Œå¯¹åº”valueä¸ºç©ºï¼‰é¡ºå¸¦ä¸Šä¸€ä¸ªçŸ­æœŸttlï¼Œå½“ç¼“å­˜æŸ¥å¾—æ•°æ®ä¸ºç©ºæ—¶è¡¨ç¤ºä¸å­˜åœ¨è¯¥æ•°æ®

ä½†æ˜¯è¿™æ ·çš„è®°å½•æ–¹å¼ä¼šå ç”¨ä¸€äº›é¢å¤–å†…å­˜

ä¸”**æ’å…¥æ–°æ•°æ®**æ—¶éœ€è¦**æ£€æŸ¥**æ˜¯å¦å­˜åœ¨**è¯¥ç¼“å­˜**ï¼Œä¸å¤„ç†ç©ºç¼“å­˜ä¼šå¯¼è‡´çŸ­æœŸæŸ¥è¯¢æŸ¥ä¸åˆ°æ–°æ’å…¥çš„æ•°æ®ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥åˆ äº†å¯¹åº”ç¼“å­˜keyäº†äº‹ï¼‰

å½“ç„¶ä¿®æ”¹æœ¬æ¥å°±è¦åˆ é™¤ç¼“å­˜æ‰€ä»¥ä¸ä¼šäº§ç”Ÿå½±å“

#### 2. å¸ƒéš†è¿‡æ»¤å™¨

ç®€å•ç†è§£ä¸ºä½¿ç”¨byteæ•°ç»„å­˜å‚¨æ•°æ®ï¼Œåˆ©ç”¨hashç®—æ³•è®¡ç®—hashå€¼ï¼Œä»¥hashcodeçš„æ–¹å¼å­˜å‚¨keyã€‚å½“ç„¶è¿™é‡Œé¢ä¹Ÿä¼šå­˜åœ¨hashç®—æ³•å¸¸è§çš„å†²çªé—®é¢˜ï¼ˆä¸åŒçš„keyå¾—åˆ°æœ€ç»ˆåŒæ ·çš„hashcodeæˆ–è€…æœ€ç»ˆç´¢å¼•ä¸€è‡´ï¼‰ï¼Œç®€å•ä½¿ç”¨ä¸­ä¸å¯¹è¿™ä¸€æ–¹é¢åšå¤„ç†å°±ä¼šå¯¼è‡´ä¸å‡†ç¡®çš„é—®é¢˜ï¼Œå³å¸ƒéš†è¿‡æ»¤å™¨è¿”å›çš„**â€œå­˜åœ¨â€ç»“æœå¯èƒ½æœ‰è¯¯**ï¼ˆAä¸Bä¸åŒï¼Œä½†æ˜¯hashçš„ç»“æœä¸€è‡´ï¼Œå¯æ˜¯Aå­˜åœ¨äºç¼“å­˜ï¼Œä½†æ˜¯Bä¸å­˜åœ¨ï¼Œå‘å¸ƒéš†è¿‡æ»¤å™¨è¾“å…¥Bä¼šå‘ç°ç»“æœå­˜åœ¨ï¼Œä½†æ˜¯äº‹å®ä¸Šæ²¡æœ‰ï¼Œä½†æ˜¯**ä¸å­˜åœ¨ä¸€å®šæ˜¯æ²¡æœ‰çš„**ï¼‰



### ç¼“å­˜é›ªå´©

**é—®é¢˜å®šä¹‰ï¼š**åŒä¸€æ—¶é—´å¤§é‡ç¼“å­˜keyå¤±æ•ˆï¼ˆå¦‚redisæœåŠ¡å®•æœºï¼Œå½“ç„¶å¯ä»¥é€šè¿‡è®¾ç½®é›†ç¾¤å“¨å…µç­‰æ–¹æ¡ˆå°½å¯èƒ½é¿å…è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼‰ï¼Œè¯·æ±‚å…¨éƒ¨æ‰“åˆ°æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“å‹åŠ›è¿‡å¤§å¯¼è‡´å´©æºƒã€‚

**è§£å†³æ–¹æ¡ˆï¼š**

1. **ç»™ä¸åŒçš„keyåŠ éšæœºçš„ttl**ï¼šé˜²æ­¢åŒä¸€æ—¶é—´å¤§é‡ç¼“å­˜å¤±æ•ˆã€‚
2. **å¼ºåŒ–redisçš„å¯é æ€§ï¼š**ä¸Šé›†ç¾¤ï¼Œå“¨å…µ**ï¼ˆæ¨èï¼‰**
3. **ç»™ç¼“å­˜åŠ é™æµ**
4. **ç»™ä¸šåŠ¡åŠ å¤šçº§ç¼“å­˜**ï¼šnginxåŠ ç¼“å­˜ï¼ˆä½†æ˜¯æ•°æ®ä¸€è‡´æ€§ç­‰æ–¹é¢è¾ƒéš¾å¤„ç†ï¼Œ**ç®€å•**å®é™…ç”Ÿäº§ç¯å¢ƒ**ä¸æ¨è**ï¼Œå½“ç„¶å¤§å‹é¡¹ç›®åšå¥½è§„åˆ’å°±å¯ä»¥äº†ï¼‰



### ç¼“å­˜å‡»ç©¿

**é—®é¢˜å®šä¹‰ï¼š**ä¸€ä¸ªè¢«é«˜å¹¶å‘è®¿é—®çš„keyçªç„¶å¤±æ•ˆå¯¼è‡´å¤§é‡è¯·æ±‚æ‰“åˆ°æ•°æ®åº“ï¼Œè¿™å°±ä¼šå¯¼è‡´çŸ­æ—¶é—´ï¼ˆkeyå°šæœªè¢«æ›´æ–°åˆ°redisä¸­å‰ï¼‰æ•°æ®åº“å‹åŠ›éª¤å‡

**è§£å†³æ–¹æ¡ˆï¼š**

1. **äº’æ–¥é”ï¼š**æ¯ä¸ªè¿›ç¨‹åœ¨æŸ¥è¯¢rediså¤±è´¥æ—¶ï¼Œä¼šå°è¯•è·å–ä¸€ä¸ªé”ä»¥æŸ¥è¯¢æ•°æ®åº“å¹¶ç¼“å­˜åœ¨redisï¼Œæœ€åé‡Šæ”¾ï¼Œå¦‚æœæœ‰å…¶ä»–è¿›ç¨‹å…ˆè¡Œä¸€æ­¥è·å–åˆ°äº†é”ï¼Œå°±ä¼šé˜»å¡è‡ªå·±ï¼ˆretryå¤šæ¬¡ç›´åˆ°é”é‡Šæ”¾/è¶…æ—¶ï¼‰
2. **é€»è¾‘è¿‡æœŸï¼š**å‘ç”Ÿæ­¤ç±»é—®é¢˜çš„å¸¸è§ä¸šåŠ¡åœºæ™¯æ˜¯ttlè¶…æ—¶ï¼ˆæŸ¥è¯¢åˆ°äº†è¯¥ç¼“å­˜ä½†ä¸ä¼šåˆ·æ–°è¯¥ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨é€»è¾‘è¿‡æœŸï¼Œä¸è®¾ç½®ttlï¼Œä½†æ˜¯åœ¨æ¯ä¸ªç¼“å­˜valueè‡ªå·±è®°å½•æ—¶é—´æˆ³ï¼Œè¿‡æœŸæ—¶é—´ç­‰ã€‚å½“å‘ç°ç¼“å­˜è¿‡æœŸäº†ï¼Œå°±ä¼šå¼€ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œè®©å®ƒè·å–ä¸€ä¸ªé”ï¼Œéšåè®©å®ƒå°†æ•°æ®åº“å¯¹åº”ä¿¡æ¯æ›´æ–°åˆ°ç¼“å­˜ä¸­å¹¶é‡Šæ”¾é”ï¼Œè€Œè‡ªå·±ç›´æ¥è¿”å›åŸæ¥çš„ç»“æœã€‚è¿™å…¶ä¸­å€˜è‹¥è·å–é”å¤±è´¥ï¼Œå°±ä¼šç›´æ¥è¿”å›æ—§çš„ç»“æœã€‚ï¼ˆä½†å…¶å®æ›´æ–°ï¼Œåˆ é™¤æ“ä½œä¹Ÿä¼šåŒæ­¥ä¿®æ”¹ç¼“å­˜ï¼Œç”šè‡³ä¼šåŠ é”ä¿è¯ä¸€è‡´æ€§ï¼Œå…¶å®ä¸ªäººæ„Ÿè§‰è¿™é‡Œæ›´éœ€è¦è€ƒè™‘ttlåˆ·æ–°é—®é¢˜ï¼Œä»¥è¿™ä¸ªæ–¹å¼å¤„ç†ç¼“å­˜å‡»ç©¿æœ‰ç‚¹æ©è€³ç›—é“ƒï¼‰è€Œä¸”è¿™ç§å½¢å¼å­˜å‚¨èµ·æ¥ç¼“å­˜å…¶å®å°±ç®—æ˜¯æŒä¹…åŒ–äº†ï¼Œå’Œæ•°æ®åº“å¤§å·®ä¸å·®ï¼Œè¿˜è¦è€ƒè™‘æ’å…¥æ–°æ•°æ®ï¼Œä¿®æ”¹æ—¶æ€ä¹ˆæ“ä½œç¼“å­˜çš„é—®é¢˜



### åˆ©ç”¨rediså®ç°é”-setnx

ä¹‹å‰æƒ³è¿‡ä½¿ç”¨redisæ¥åšä¸€ä¸ªäº’æ–¥é”ï¼Œæ¯•ç«Ÿredisæ˜¯å•çº¿ç¨‹çš„ï¼ŒAå…ˆæ¥ï¼ŒAæ‰§è¡Œå®Œäº†æ‰ä¼šæ‰§è¡ŒBã€‚ä½†å½“åˆæƒ³çš„æ˜¯ï¼š

```java
if(redisUtil.getLock(lockId)==null){
	redisUtil.setLock(lockId);
    ...
}
```

å¯ä»¥çœ‹åˆ°è¿™é‡Œå¯¹é”çš„è·å–ä»¥åŠä¸Šé”æ˜¯ä¸¤æ¡å‘½ä»¤ï¼Œè¿™å°±ä¼šå‡ºç°é—®é¢˜äº†ï¼ŒAåœ¨æ£€æµ‹æ—¶å‘ç°æ²¡æœ‰ï¼Œç„¶åå‡†å¤‡ä¸Šé”ï¼Œä½†æ˜¯æ­¤æ—¶Båˆšå¥½ä¹Ÿæ£€æµ‹äº†å‘ç°æ²¡æœ‰ï¼Œå°±ä¼šå¯¼è‡´ä¸€å—æ‰§è¡Œç›¸åº”æ“ä½œçš„é—®é¢˜ï¼

é‚£ä¹ˆredisæœ‰æ²¡æœ‰æä¾›ä¸€ä¸ªå‘½ä»¤èƒ½å¤Ÿå®ç°å°è¯•è·å–é”å’Œä¸Šé”åœ¨ä¸€æ¬¡æ‰§è¡Œæ—¶åŒæ—¶è¿›è¡Œå‘¢ï¼Ÿæœ‰çš„xdï¼Œæœ‰çš„ã€‚é‚£å°±æ˜¯`setnx key value`

`setnx`ä¼šåœ¨åªæœ‰æ²¡æœ‰è¿™ä¸ªkeyå€¼æ—¶è®¾ç½®ä¸€ä¸ªstringç±»å‹çš„é”®å€¼å¯¹ï¼Œå¹¶è¿”å›valueå€¼ï¼Œå‡å¦‚å·²ç»å­˜åœ¨è¿™ä¸ªkeyäº†ï¼Œå°±ä¼šè¿”å›0ã€‚æˆ‘ä»¬å°±å¯ä»¥åŸºäºè¿™ä¸€æ¡å‘½ä»¤æ¥ä¿è¯é”çš„å‡†ç¡®æ€§ï¼Œä¿è¯åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªè¿›ç¨‹èƒ½è·å–åˆ°é”ä»¥åŠæ‰§è¡Œç›¸åº”æ“ä½œï¼Œå¹¶ç²¾å‡†é˜»å¡å…¶ä»–è¿›ç¨‹ã€‚

**æ³¨æ„ï¼š**`setnx`ä¸Šé”æ—¶ä¸è¦è®¾ç½®valueä¸º0ï¼Œä¼šå¯¼è‡´å†²çª



### æ–°å¼€çº¿ç¨‹ä»¥å¼‚æ­¥å®ç°æ‰€éœ€åŠŸèƒ½

æˆ‘ä»¬çŸ¥é“javaä¸­åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯ä»¥`new Thread().start()`è¿™æ ·æ¥å®ç°ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼éœ€è¦**é¢‘ç¹åˆ›å»ºé”€æ¯çº¿ç¨‹**ï¼Œä¸”**èµ„æºä¸å¯æ§**ï¼Œä»…å¯ç”¨äºç®€æ˜“åœºæ™¯æ¯”å¦‚å­¦çš„æ—¶å€™ç”¨ï¼Œå±äºä¸‹ä¸‹ç­–ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±è€ƒè™‘ä½¿ç”¨å¯æ§èµ„æºæ¥å®ç°è¿™ä¸ªéœ€æ±‚ï¼š

1. **ä½¿ç”¨** `ExecutorService`**ï¼ˆçµæ´»æ§åˆ¶çº¿ç¨‹æ± ï¼‰**

```java
// åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ï¼ˆæ¨èç”¨ ThreadPoolTaskExecutor åœ¨ Spring ä¸­ï¼‰
ExecutorService executor = Executors.newFixedThreadPool(5);

// æäº¤ä»»åŠ¡
executor.submit(() -> {
    // ä½ çš„ä¸šåŠ¡é€»è¾‘
    System.out.println("æˆ‘åœ¨æ–°çº¿ç¨‹ä¸­è¿è¡Œ: " + Thread.currentThread().getName());
});

// åº”ç”¨å…³é—­æ—¶ä¼˜é›…å…³é—­ï¼ˆé‡è¦ï¼ï¼‰
executor.shutdown();
```

é»˜è®¤çŠ¶æ€ä¸‹ï¼Œ**`ExecutorService` æäº¤ä»»åŠ¡æœ¬èº«æ˜¯â€œåŒæ­¥â€çš„ï¼ˆç«‹å³è¿”å›ï¼‰ï¼Œä½†ä»»åŠ¡çš„æ‰§è¡Œæ˜¯â€œå¼‚æ­¥â€çš„ï¼ˆåœ¨åå°çº¿ç¨‹è¿è¡Œï¼‰**ã€‚

| æ“ä½œ                                          | æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿ             | è¯´æ˜                                         |
| :-------------------------------------------- | :--------------------------- | :------------------------------------------- |
| `executor.submit(...)` æˆ– `execute(...)` è°ƒç”¨ | **âœ… åŒæ­¥ï¼ˆç«‹å³è¿”å›ï¼‰**       | ä¸»çº¿ç¨‹ä¸ä¼šç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œï¼Œè€Œæ˜¯ç«‹åˆ»ç»§ç»­å¾€ä¸‹èµ° |
| æäº¤çš„ä»»åŠ¡ï¼ˆRunnable/Callable å†…éƒ¨é€»è¾‘ï¼‰      | **âœ… å¼‚æ­¥ï¼ˆåœ¨åå°çº¿ç¨‹æ‰§è¡Œï¼‰** | å®é™…ä¸šåŠ¡é€»è¾‘åœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­è¿è¡Œ               |

é‚£ä¹ˆé»˜è®¤çŠ¶æ€ä¸‹ï¼Œå¦‚æœä½ éœ€è¦å»è·å–æ–°å¼€çº¿ç¨‹çš„æ‰§è¡Œç»“æœï¼Œä¹Ÿå°±æ˜¯æƒ³è¦é˜»å¡ç­‰å¾…è¿”å›ç»“æœçš„è¯ï¼š

```java
Future<String> future = executor.submit(() -> {
    // æ¨¡æ‹ŸæŸ¥è¯¢æ•°æ®åº“
    Thread.sleep(1000);
    return "æŸ¥è¯¢ç»“æœ: ç”¨æˆ·ID=123";
});

// ä¸»çº¿ç¨‹å¯ä»¥ç»§ç»­åšå…¶ä»–äº‹...
System.out.println("ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ...");

// éœ€è¦ç»“æœæ—¶å† getï¼ˆä¼šé˜»å¡ç›´åˆ°å®Œæˆï¼‰
try {
    String result = future.get(); // â† é˜»å¡ç­‰å¾…
    System.out.println(result);
} catch (Exception e) {
    e.printStackTrace();
}
```
æˆ‘ä»¬å¯ä»¥ç®€å•æŠŠ`Future`ç†è§£ä¸ºjsä¸­çš„`Promise`ï¼Œä»–å°±æ˜¯å°†æ‰§è¡Œçš„è¿‡ç¨‹å°è£…ä¸ºè¿™ä¸ªä¸œè¥¿ï¼Œå¯ç”¨äºè·å–æœ€ç»ˆçš„æ‰§è¡Œç»“æœï¼ˆæœªç»“æŸæ—¶å°è¯•è·å–ä¼šè¿›è¡Œé˜»å¡ï¼‰


2. **ä½¿ç”¨CompletableFutureï¼ˆé“¾å¼å¼‚æ­¥ç¼–ç¨‹ï¼‰**

```java
CompletableFuture<Void> future = CompletableFuture.runAsync(() -> {
    // å¼‚æ­¥å‘çŸ­ä¿¡
    smsService.sendSms(phone, code);
}, executor); // å¯æŒ‡å®šçº¿ç¨‹æ± 

// å¯ç»§ç»­é“¾å¼æ“ä½œ
future.thenRun(() -> {
    log.info("çŸ­ä¿¡å‘é€å®Œæˆ");
});
```

3. **ä½¿ç”¨ @Async å¦å»ºä¸€ä¸ªService**

**å¯ç”¨å¼‚æ­¥æ”¯æŒ**ï¼š

```java
@SpringBootApplication
@EnableAsync // ğŸ‘ˆ å…³é”®æ³¨è§£
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

**å®šä¹‰å¼‚æ­¥æ–¹æ³•**ï¼š

```java
@Service
public class SmsService {

    @Async // ğŸ‘ˆ æ ‡è®°ä¸ºå¼‚æ­¥
    public void sendCodeAsync(String phone, String code) {
        // æ¨¡æ‹Ÿå‘çŸ­ä¿¡ï¼ˆè€—æ—¶ 2 ç§’ï¼‰
        try { Thread.sleep(2000); } catch (InterruptedException e) {}
        System.out.println("çŸ­ä¿¡å·²å‘é€: " + phone + " -> " + code);
    }
}
```

**è°ƒç”¨ï¼ˆæ— éœ€å…³å¿ƒçº¿ç¨‹ï¼‰**ï¼š

```java
@RestController
public class UserController {

    @Autowired
    private SmsService smsService;

    @PostMapping("/send")
    public String send(@RequestParam String phone) {
        String code = "123456";
        smsService.sendCodeAsync(phone, code); // ç«‹å³è¿”å›ï¼Œä¸ç­‰å¾…
        return "éªŒè¯ç å·²å‘é€ï¼Œè¯·æ³¨æ„æŸ¥æ”¶";
    }
}
```



----



### tips

#### ä»¥Objectå½¢å¼å­˜å‚¨æ—¶æ€ä¹ˆè½¬æ¢æˆå…¶ä»–å½¢å¼çš„ç±»

1. è€ƒè™‘ä½¿ç”¨hutoolæä¾›çš„`JsonObject`ï¼š

```java
Shop shop1 = JSONUtil.toBean((JSONObject) redisData.getData(), Shop.class);
```

å¯ä»¥é€šè¿‡JSONUtilå®ç°objectåˆ°æŒ‡å®šç±»çš„è½¬æ¢
