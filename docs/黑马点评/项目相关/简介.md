---
title: é¡¹ç›®ç®€ä»‹
date: 2025-12-22
---

## é¡¹ç›®é‡ç‚¹ï¼š

åˆ©ç”¨redisè§£å†³å¸¸è§ä¸šåŠ¡åœºæ™¯ä»¥åŠæŠ€æœ¯é—®é¢˜ï¼š

### ðŸ”¹ 1. **çŸ­ä¿¡ç™»å½•ï¼šRedis å…±äº« Session åº”ç”¨**

- **æŠ€æœ¯é—®é¢˜**ï¼š
  å¤šå°æœåŠ¡å™¨é›†ç¾¤çŽ¯å¢ƒä¸‹ï¼Œç”¨æˆ·ç™»å½•çŠ¶æ€ï¼ˆSessionï¼‰æ— æ³•å…±äº«ï¼Œå¯¼è‡´è·¨æœåŠ¡å™¨ç™»å½•å¤±æ•ˆã€‚

- **è§£å†³æ–¹æ¡ˆ**ï¼š

  ä½¿ç”¨ Redis å­˜å‚¨ç”¨æˆ·çš„ Session ä¿¡æ¯ï¼Œå®žçŽ°åˆ†å¸ƒå¼ Session å…±äº«ã€‚

  - ç”¨æˆ·ç™»å½•åŽå°† Session å†™å…¥ Redisï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ã€‚
- åŽç»­è¯·æ±‚é€šè¿‡ Token æˆ– Cookie èŽ·å– Session IDï¼Œä»Ž Redis ä¸­è¯»å–ä¼šè¯æ•°æ®ã€‚

------

### ðŸ”¹ 2. **è¾¾äººæŽ¢åº—ï¼šåŸºäºŽ List å’Œ SortedSet çš„ç‚¹èµžåŠŸèƒ½**

- **æŠ€æœ¯é—®é¢˜**ï¼š
  å¦‚ä½•é«˜æ•ˆå®žçŽ°â€œç‚¹èµžåˆ—è¡¨â€å’Œâ€œç‚¹èµžæŽ’è¡Œæ¦œâ€ï¼Ÿ

- **è§£å†³æ–¹æ¡ˆ**ï¼š
- **ç‚¹èµžåˆ—è¡¨**ï¼šä½¿ç”¨ `List` æ•°æ®ç»“æž„å­˜å‚¨ç”¨æˆ·ç‚¹èµžè®°å½•ï¼Œæ”¯æŒé¡ºåºæŸ¥çœ‹ã€‚
  - **ç‚¹èµžæŽ’è¡Œæ¦œ**ï¼šä½¿ç”¨ `SortedSet`ï¼ˆZSetï¼‰ï¼Œä»¥ç‚¹èµžæ•°ä¸ºåˆ†æ•°æŽ’åºï¼Œæ”¯æŒå¿«é€ŸæŸ¥è¯¢ Top Nã€‚
- æ”¯æŒåŽ»é‡ï¼ˆé¿å…é‡å¤ç‚¹èµžï¼‰ã€å®žæ—¶æ›´æ–°æŽ’åã€‚

------

### ðŸ”¹ 3. **å¥½å‹å…³æ³¨ï¼šåŸºäºŽ Set é›†åˆçš„ç¤¾äº¤å…³ç³»ç®¡ç†**

- **æŠ€æœ¯é—®é¢˜**ï¼š
  å¦‚ä½•é«˜æ•ˆå¤„ç†ç”¨æˆ·ä¹‹é—´çš„å…³æ³¨ã€å–å…³ã€å…±åŒå…³æ³¨ç­‰æ“ä½œï¼Ÿ

- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - ä½¿ç”¨ `Set` å­˜å‚¨ç”¨æˆ·å…³æ³¨åˆ—è¡¨ï¼ˆå¦‚ `follow:user:1`ï¼‰ã€‚
  - åˆ©ç”¨ `SINTER`ï¼ˆäº¤é›†ï¼‰è®¡ç®—å…±åŒå…³æ³¨ç”¨æˆ·ã€‚
  - æ”¯æŒæ¶ˆæ¯æŽ¨é€ï¼ˆå¦‚â€œXXX å…³æ³¨äº†ä½ â€ï¼‰ã€‚
  - å¯ç»“åˆ Redis æ¶ˆæ¯é˜Ÿåˆ—æˆ– Pub/Sub å®žçŽ°å¼‚æ­¥é€šçŸ¥ã€‚

------

### ðŸ”¹ 4. **ä¼˜æƒ åˆ¸ç§’æ€ï¼šé«˜å¹¶å‘ä¸‹çš„åº“å­˜æŽ§åˆ¶ä¸Žé˜²è¶…å–**

- **æŠ€æœ¯é—®é¢˜**ï¼š
  ç§’æ€åœºæ™¯ä¸‹ï¼Œé«˜å¹¶å‘è¯·æ±‚å¯èƒ½å¯¼è‡´åº“å­˜è¶…å–ã€ç³»ç»ŸåŽ‹åŠ›è¿‡å¤§ã€‚

- **è§£å†³æ–¹æ¡ˆ**ï¼š
- **Redis è®¡æ•°å™¨**ï¼šç”¨ `INCR`/`DECR` åŽŸå­æ“ä½œæŽ§åˆ¶åº“å­˜ï¼Œé¿å…è¶…å–ã€‚
  
- **Lua è„šæœ¬**ï¼šä¿è¯â€œå‡åº“å­˜ + ä¸‹å•â€æ“ä½œçš„åŽŸå­æ€§ï¼Œé˜²æ­¢å¹¶å‘é—®é¢˜ã€‚
  
- **åˆ†å¸ƒå¼é”**ï¼šä½¿ç”¨ Redis å®žçŽ°åˆ†å¸ƒå¼é”ï¼ˆå¦‚ `SETNX` + è¿‡æœŸæ—¶é—´ï¼‰ï¼Œé˜²æ­¢é‡å¤ä¸‹å•ã€‚
  
- ä¸‰ç§æ¶ˆæ¯é˜Ÿåˆ—ï¼š
  
  - ä½¿ç”¨ Redis çš„ `List`ã€`Pub/Sub`ã€`Stream` å®žçŽ°å¼‚æ­¥å¤„ç†è®¢å•ï¼Œå‰Šå³°å¡«è°·ã€‚

------

### ðŸ”¹ 5. **é™„è¿‘çš„å•†æˆ·ï¼šGeoHash å®šä½æŸ¥è¯¢**

- **æŠ€æœ¯é—®é¢˜**ï¼š
  å¦‚ä½•å¿«é€ŸæŸ¥æ‰¾ç”¨æˆ·é™„è¿‘çš„å•†å®¶ï¼Ÿä¼ ç»Ÿæ•°æ®åº“æŸ¥è¯¢æ•ˆçŽ‡ä½Žã€‚

- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - ä½¿ç”¨ Redis çš„ `GEO` åŠŸèƒ½ï¼ˆåŸºäºŽ GeoHashï¼‰ã€‚
  - å°†å•†æˆ·ä½ç½®ï¼ˆç»çº¬åº¦ï¼‰å­˜å…¥ Redis çš„ Geo ç´¢å¼•ã€‚
  - ä½¿ç”¨ `GEORADIUS` æˆ– `GEORADIUSBYMEMBER` å¿«é€ŸæŸ¥è¯¢æŒ‡å®šèŒƒå›´å†…çš„å•†æˆ·ã€‚
  - æ”¯æŒæŒ‰è·ç¦»æŽ’åºã€é™åˆ¶è¿”å›žæ•°é‡ã€‚

### ðŸ”¹ 6. **ç”¨æˆ·ç­¾åˆ°ï¼šBitMap æ•°æ®ç»Ÿè®¡**

- **æŠ€æœ¯é—®é¢˜**ï¼š
  å¦‚ä½•é«˜æ•ˆç»Ÿè®¡ç”¨æˆ·æ¯æ—¥ç­¾åˆ°æƒ…å†µï¼Ÿä¼ ç»Ÿæ–¹å¼å­˜å‚¨æˆæœ¬é«˜ã€‚
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - ä½¿ç”¨ Redis çš„ `BitMap`ï¼Œæ¯ä¸ªç”¨æˆ·æ¯å¤©ä¸€ä¸ª bit è¡¨ç¤ºæ˜¯å¦ç­¾åˆ°ã€‚
  - ä¾‹å¦‚ï¼š`BITMAP:user:1:20240501`ï¼Œbit ä½ç½®è¡¨ç¤ºæ—¥æœŸã€‚
  - æ”¯æŒå¿«é€Ÿç»Ÿè®¡è¿žç»­ç­¾åˆ°å¤©æ•°ã€ç­¾åˆ°çŽ‡ç­‰ã€‚
  - ç©ºé—´å ç”¨æžå°ï¼Œé€‚åˆæµ·é‡ç”¨æˆ·åœºæ™¯ã€‚

------

### ðŸ”¹ 7. **UV ç»Ÿè®¡ï¼šHyperLogLog åŽ»é‡ç»Ÿè®¡**

- **æŠ€æœ¯é—®é¢˜**ï¼š
  å¦‚ä½•å‡†ç¡®ç»Ÿè®¡ç½‘ç«™æ—¥æ´»ç”¨æˆ·ï¼ˆUVï¼‰ï¼Ÿä¼ ç»Ÿé›†åˆå­˜å‚¨å†…å­˜æ¶ˆè€—å¤§ã€‚
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - ä½¿ç”¨ Redis çš„ `HyperLogLog` æ•°æ®ç»“æž„ã€‚
  - ä»¥æžå°çš„å†…å­˜ï¼ˆçº¦ 12KBï¼‰ä¼°ç®—æµ·é‡æ•°æ®çš„åŸºæ•°ï¼ˆå”¯ä¸€å€¼æ•°é‡ï¼‰ã€‚
  - æ”¯æŒ `PFADD` æ·»åŠ ç”¨æˆ· IDï¼Œ`PFCOUNT` ç»Ÿè®¡ UVã€‚
  - è¯¯å·®çŽ‡å°äºŽ 0.8%ï¼Œé€‚ç”¨äºŽå¤§æ•°æ®é‡çš„è¿‘ä¼¼ç»Ÿè®¡ã€‚

------

### ðŸ”¹ 8. **å•†æˆ·æŸ¥è¯¢ç¼“å­˜ï¼šä¼ä¸šçº§ç¼“å­˜ç­–ç•¥**

- **æŠ€æœ¯é—®é¢˜**ï¼š
  - ç¼“å­˜é›ªå´©ï¼ˆå¤§é‡ç¼“å­˜åŒæ—¶è¿‡æœŸï¼‰
  - ç¼“å­˜ç©¿é€ï¼ˆæŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼Œæ‰“ç©¿ç¼“å­˜ï¼‰
  - ç¼“å­˜å‡»ç©¿ï¼ˆçƒ­ç‚¹ key è¿‡æœŸçž¬é—´è¢«å¤§é‡è¯·æ±‚å‡»ç©¿ï¼‰
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - **ç¼“å­˜é›ªå´©**ï¼šè®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´éšæœºåŒ–ï¼ˆå¦‚ Â±10sï¼‰ã€‚
  - **ç¼“å­˜ç©¿é€**ï¼šå¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰é¢„åˆ¤ä¸å­˜åœ¨çš„ keyã€‚
  - **ç¼“å­˜å‡»ç©¿**ï¼šä½¿ç”¨äº’æ–¥é”ï¼ˆå¦‚ Redis åˆ†å¸ƒå¼é”ï¼‰æˆ–â€œäº’æ–¥é”®â€ç­–ç•¥ã€‚
  - ä½¿ç”¨æœ¬åœ°ç¼“å­˜ + åˆ†å¸ƒå¼ç¼“å­˜åŒå±‚æž¶æž„æå‡æ€§èƒ½ã€‚

## æž¶æž„æ¡†æž¶å›¾ï¼š
```mermaid
graph LR
    A[æ‰‹æœº] --> B[NGINX]
    C[ç”µè„‘] --> B
    D[æ‰‹æœº] --> B

B --> E[tomcat]

E --> F[Redis é›†ç¾¤]
E --> G[MySQL é›†ç¾¤]

subgraph Redis é›†ç¾¤
    F1[Redis]
    F2[Redis]
    F3[Redis]
end

subgraph MySQL é›†ç¾¤
    G1[MySQL]
    G2[MySQL]
    G3[MySQL]
end
```

