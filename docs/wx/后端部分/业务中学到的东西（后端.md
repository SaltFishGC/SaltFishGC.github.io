---
title: ä¸šåŠ¡ä¸­å­¦åˆ°çš„ä¸œè¥¿ï¼ˆåç«¯ï¼‰
date: 2025-11-28
---

### å¯¹äºä¸šåŠ¡å¼‚å¸¸çš„å¤„ç†

å½“å‡ºç°é‡å¤ï¼Œè¾“å…¥å‚æ•°ä¸å¯¹æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†æç¤ºä¿¡æ¯åŒ…è£…åˆ°responseä¸­å†è¿”å›ç»™å‰ç«¯ï¼Œå‡å¦‚æ˜¯åœ¨Serviceå±‚é‡åˆ°çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦å°†å‡ºé”™ç±»å‹ä¸ä¼ å‚ä½œæ˜ å°„ï¼ˆç›´æ¥ä¼ å­—ç¬¦ä¸²ä¸ç¾è§‚ï¼ˆä¸ºä»€ä¹ˆæ„Ÿè§‰æœ‰ç‚¹è ¢ï¼Ÿï¼‰ï¼‰ã€‚è¿™æ ·éå¸¸çš„ä¸æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªè¡Œè®¾è®¡ä¸šåŠ¡å¼‚å¸¸BusinessExceptionçš„æ–¹å¼æ¥å®ç°å¯¹é”™è¯¯çš„å¤„ç†ï¼Œè¿™æ ·è¿˜ä¸ç”¨åœ¨Serviceå±‚ä¸­å‡ºé”™æ—¶å¿…é¡»ä¼ è¾“é”™è¯¯è¯¦ç»†ä¿¡æ¯ï¼Œåªéœ€è¦é…ç½®å¥½å…¨å±€å¼‚å¸¸æ•è·å³å¯ç®€å•å®ç°æ•ˆæœã€‚

**å¯¼å‘ï¼š**`@RestControllerAdvice`ä¸`@ExceptionHandler(value = Exception.class)`æ³¨è§£çš„ä½¿ç”¨ï¼›`BusinessException`çš„è®¾è®¡

### Serviceä¸­å¤šä¸ªè¿è´¯å†™æ“ä½œåˆ«å¿˜äº†Transactional

å¤šä¸ªè¡¨æ“ä½œå¦‚å‡ºç°å¤±è´¥éš¾ä»¥å›æ»šï¼Œä¸€å®šè®°å¾—åŠ ä¸Šäº‹åŠ¡æ³¨è§£ï¼è¿˜æœ‰redisä¸ä¼šè¢«äº‹åŠ¡æ³¨è§£å›è°ƒä¸è¦è®°é”™äº†

**å¯¼å‘ï¼š**`@Transactional`æ³¨è§£çš„ä½¿ç”¨ï¼›æ•°æ®åº“äº‹åŠ¡ï¼›éš”ç¦»æœºåˆ¶ï¼›MVCCä»¥åŠäº‹åŠ¡é”

### å…¨TMæ˜¯æšä¸¾æ€ä¹ˆæï¼Ÿ

æ¢è‹±æ–‡è¯´æ˜ç›´æ¥ä¼ å¾—äº†

### å¸¸é‡å°½é‡ä¸è¦ç¡¬ç¼–ç 

ç¡¬ç¼–ç ï¼Œå°±æ˜¯å†™æ­»ï¼Œæ¯”å¦‚æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ï¼Œç”¨æˆ·åï¼Œå¯†ç ï¼Œæ•°æ®åº“åç­‰ç­‰ï¼Œè¿™æ ·ä¸€æ—¦éœ€è¦ä¿®æ”¹ï¼Œå°±éœ€è¦å»ä¿®æ”¹ä»£ç ï¼Œè¿™æ ·éå¸¸ä¸æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¸¸é‡æ¥å®šä¹‰ï¼Œè¿™æ ·åªéœ€è¦ä¿®æ”¹å¸¸é‡å³å¯ï¼Œè¿™æ ·éå¸¸æ–¹ä¾¿ã€‚

æ¯”å¦‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå¸¸é‡ç±»Constantsï¼Œå°†ä¸€äº›å¸¸é‡ä»¥public static finalçš„é™æ€å˜é‡çš„å½¢å¼å®šä¹‰åœ¨é‡Œé¢ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹å¼•ç”¨è¿™ä¸ªå¸¸é‡ï¼Œè¿™æ ·éå¸¸æ–¹ä¾¿åç»­ç»´æŠ¤ä¿®æ”¹ã€‚

### èƒ½å°½é‡æ•è·å¤šçš„å¼‚å¸¸å°½åŠ›å»ä½¿ç”¨è‡ªå·±çš„å…¨å±€å¼‚å¸¸æ•è·

ä¸æ˜¯è‡ªå·±åŒ…è£…çš„å¼‚å¸¸ç›´æ¥æŠ›å‡ºä¸å®‰å…¨ï¼Œä¸”ä¸ç¾è§‚ã€‚

**å¯¼å‘ï¼š**`@RestControllerAdvice`+`@ExceptionHandler(value = Exception.class)`å…¨å±€å¼‚å¸¸æ•è·çš„ä½¿ç”¨

### è¿”å›ç»“æœï¼ˆResponse.dataï¼‰çš„å‡ ç§å½¢å¼

1. **VO**ï¼šå¦‚æœé¡¹ç›®è§„åˆ’åˆç†ï¼Œæ‰€æœ‰çš„è¿”å›å½¢å¼é™¤å¼€ä¸éœ€è¦é¢å¤–æ“ä½œå°±å¯ä»¥ç›´æ¥ä¼ å›çš„POï¼Œé‚£ä¹ˆæœ€å¥½å°†ç»“æœå°½å¯èƒ½å°è£…ä¸ºä¸€ä¸ªVOç±»ï¼Œè¿™æ ·åç»­ç»´æŠ¤èµ·æ¥è™½ç„¶è¦æ”¹çš„å¤šï¼Œä½†æ˜¯æœ‰è¿¹å¯å¾ª
2. **ResultMap**ï¼šä»¥Hashmapçš„å½¢å¼è¿”å›ç»“æœï¼Œå¥½å¤„æ˜¯æ²¡æœ‰VOçš„å¿…é¡»åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»çš„åˆ¶çº¦ï¼Œåå¤„æ˜¯ç¡¬ç¼–ç èµ·æ¥éå¸¸éœ€è¦æ³¨æ„è§„èŒƒï¼Œä¸”è¯´æ˜æ–‡æ¡£ä¸€å®šè¦åšå…¨ï¼ˆä¸€ä¸ªäººå¼€å‘å°é¡¹ç›®æ¯”è¾ƒæ¨èï¼‰

### ä¸€äº›å¸¸ç”¨å·¥å…·

Hutoolé‡Œé¢æä¾›äº†å¾ˆå¤šåŸºäºjavaåº•å±‚å°è£…å®ç°çš„å·¥å…·ï¼š

1. **RandomUtil**:æä¾›äº†ç”Ÿæˆéšæœºå­—ç¬¦ä¸²ï¼Œæ•°å­—ï¼ˆåŒ…æ‹¬Stringç±»å‹ï¼‰çš„åŠŸèƒ½
2. **SecureUtil**:æä¾›äº†md5åŠ å¯†ç­‰åŠ å¯†
3. **BeanUtil**:æä¾›äº†å¯¹Beanå¯¹è±¡çš„æ“ä½œï¼Œå¦‚copyPropertieså®ç°ç›¸åŒå­—æ®µåçš„å¤åˆ¶
4. **VersionComparator**:æä¾›äº†å¸‚é¢ä¸ŠåŸºæœ¬çš„ç‰ˆæœ¬æ¯”å¯¹
5.  **FileTypeUtil**:æä¾›æ–‡ä»¶ç±»å‹åˆ¤æ–­ï¼Œä»æ–‡ä»¶ç¼–ç ä¸Šè·å–ä¿¡æ¯ï¼Œä¿è¯ä¸€ç‚¹å®‰å…¨

### mybatisplusæä¾›çš„åˆ†é¡µ

[åˆ†é¡µæ’ä»¶ | MyBatis-Plus](https://baomidou.com/plugins/pagination/)

æ³¨æ„3.5.9ä¹‹åå°±éœ€è¦è‡ªè¡ŒåŠ å…¥æ–°ä¾èµ–äº†ï¼š

```xml
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-jsqlparser</artifactId>
    <version>${mybatis-plus.version}</version>
</dependency>
```

ç‰ˆæœ¬æ³¨æ„ä¸€è‡´

### mybatisplusæä¾›çš„è”è¡¨æŸ¥è¯¢

[MyBatis-Plus-Join ğŸš€ ä¸ºç®€åŒ–å¼€å‘è€Œç”Ÿ | MyBatis-Plus-Join](https://mybatis-plus-join.github.io/)

æ³¨æ„ç‰ˆæœ¬ä¾èµ–ä»¥åŠymlé…ç½®ï¼š

```xml
<dependency>
    <groupId>com.github.yulichang</groupId>
    <artifactId>mybatis-plus-join-boot-starter</artifactId>
    <version>1.5.4</version>
</dependency>
```

> æœ€æ–°ç‰ˆ MyBatis-Plus-Join éœ€è¦é…åˆ MyBatis-Plus 3.1.2 åŠä»¥ä¸Šçš„ç‰ˆæœ¬ä½¿ç”¨

[é…ç½® | MyBatis-Plus-Join](https://mybatis-plus-join.github.io/pages/core/config/config.html)

ä¸è¿‡æ„Ÿè§‰è¿˜æ˜¯æœ‰ç‚¹ç¹çäº†ï¼Œå†™å‡ºæ¥ä¸å¤ªæ¸…æ™°ï¼Œä¸å¦‚è‡ªå·±å†™sql

### ä¸ºä»€ä¹ˆéœ€è¦å…³è”æŸ¥è¯¢

åœ¨å†™ä¸šåŠ¡çš„æ—¶å€™æˆ‘ä»¬ä¼šå‘ç°ä¸€äº›æ—¶å€™å¤šåŠ ä¸€ç‚¹å­—æ®µèƒ½å°‘è”å‡ æ¬¡è¡¨ï¼Œä¸ºä»€ä¹ˆä¸€å®šè¦å…³è”æŸ¥è¯¢å‘¢ï¼Ÿ

å› ä¸ºæœ‰äº›å­—æ®µçš„å†…å®¹å¯èƒ½ä¼šä¿®æ”¹ï¼Œæ¯”å¦‚nicknameæ˜µç§°ï¼Œç­¾åï¼Œç­‰ç­‰ï¼Œå‡å¦‚æˆ‘ä»¬åœ¨è¿™é‡Œç›´æ¥å­˜æ­»äº†ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡ä¿®æ”¹çš„æ—¶å€™ï¼Œå°±éœ€è¦æŠŠè¿™ä¸ªè¡¨ä¸€å¹¶ä¿®æ”¹ï¼Œå€˜è‹¥ä¸€ä¸å°å¿ƒå¿˜äº†ï¼Œå°±æˆäº†æ¯”è¾ƒè‹¥æ™ºçš„bugäº†ã€‚

æ‰€ä»¥ä¸€èˆ¬æŠŠä¸€è¡Œæ•°æ®é‡Œé¢ç»å¯¹ä¸ä¼šå˜çš„ä¸€ä¸ªæ•°æ®ä¸å…¶ä»–è¡¨ä½œå…³è”ï¼Œå…¶ä»–æœ‰å¯èƒ½ä¼šä¿®æ”¹çš„æ•°æ®ï¼Œæˆ‘ä»¬ä»¥å¤šè”è¡¨æŸ¥è¯¢çš„å½¢å¼æ¥å¯¼å‡ºï¼Œé˜²æ­¢å¤šå¤„ä¿®æ”¹ä½¿å¾—ä¸šåŠ¡å˜å¾—ä¸å¿…è¦çš„å†—ä½™å¤æ‚ï¼ˆè§£è€¦ï¼‰ã€‚

### Tokençš„è®¾è®¡

 è¿˜å¯ä»¥åŠ å…¥è®¾å¤‡ï¼Œipåœ°å€ç­‰ä¿¡æ¯åŠ ä»¥éªŒè¯ï¼Œåªéœ€è¦å°†ä¸Šä¸€æ¬¡ç”Ÿæˆçš„tokenä¿¡æ¯å®Œæ•´å­˜å…¥rediså³å¯å®ç°

tokené“¾è·¯è¿½è¸ªï¼š

### ä¸ºä»€ä¹ˆéœ€è¦é•¿è¿æ¥

ç›´æ¥çœ‹åº”ç”¨åœºæ™¯ï¼š

| åœºæ™¯            | çŸ­è¿æ¥ï¼ˆè½®è¯¢ï¼‰             | é•¿è¿æ¥ï¼ˆWebSocketï¼‰              |
| --------------- | -------------------------- | -------------------------------- |
| èŠå¤©åº”ç”¨        | å®¢æˆ·ç«¯æ¯2ç§’æŸ¥ä¸€æ¬¡æ•°æ®åº“    | å»ºç«‹è¿æ¥åï¼Œå¯¹æ–¹å‘æ¶ˆæ¯ä½ ç«‹åˆ»æ”¶åˆ° |
| è‚¡ç¥¨è¡Œæƒ…        | æ¯ç§’å‘10æ¬¡è¯·æ±‚æŸ¥ä»·æ ¼       | æœåŠ¡å™¨ä¸»åŠ¨æ¨é€æœ€æ–°ä»·æ ¼           |
| åœ¨çº¿æ¸¸æˆ        | æŒ‰â€œåˆ·æ–°â€æŒ‰é’®æ‰æ›´æ–°         | è§’è‰²ç§»åŠ¨ã€æ”»å‡»å®æ—¶åŒæ­¥           |
| è®¾å¤‡ç›‘æ§ï¼ˆIoTï¼‰ | è®¾å¤‡å®šæ—¶ä¸ŠæŠ¥               | æœåŠ¡å™¨å¯éšæ—¶ä¸‹å‘æŒ‡ä»¤             |
| è®¢å•çŠ¶æ€é€šçŸ¥    | ç”¨æˆ·åˆ·æ–°é¡µé¢çœ‹æ˜¯å¦æ”¯ä»˜æˆåŠŸ | æ”¯ä»˜æˆåŠŸåæœåŠ¡ç«¯ç«‹åˆ»æ¨â€œæ”¯ä»˜å®Œæˆâ€ |

å¯ä»¥å‘ç°ä»…æ”¯æŒå¤„ç†å®¢æˆ·ç«¯å‘æ¥çš„requestçš„åç«¯æœåŠ¡å™¨åªèƒ½æ”¯æŒè½®è¯¢æ¥å®ç°ä¸å„ä¸ªå®¢æˆ·ç«¯çš„é€šä¿¡ï¼Œè¿™æ ·çš„æ–¹å¼å­˜åœ¨å‡ºå¤šå¼Šç«¯ï¼Œè€Œé•¿è¿æ¥å°±è¾ƒå¥½çš„è§£å†³äº†è¿™äº›é—®é¢˜ï¼š

| ç—›ç‚¹             | é•¿è¿æ¥å¦‚ä½•è§£å†³              |
| ---------------- | --------------------------- |
| **å»¶è¿Ÿé«˜**       | æ¶ˆæ¯ç›´è¾¾ï¼Œæ— éœ€ç­‰å¾…è½®è¯¢å‘¨æœŸ  |
| **èµ„æºæµªè´¹**     | 1æ¬¡è¿æ¥ vs æ•°ç™¾æ¬¡ HTTP è¯·æ±‚ |
| **æ•°æ®åº“å‹åŠ›å¤§** | ä¸ç”¨é¢‘ç¹æŸ¥è¡¨                |
| **æ— æ³•ä¸»åŠ¨é€šçŸ¥** | æœåŠ¡ç«¯å¯ä»¥éšæ—¶â€œå–Šä¸€å£°â€      |
| **ç”¨æˆ·ä½“éªŒå·®**   | ç”¨æˆ·ä¸ç”¨åˆ·æ–°å°±èƒ½çœ‹åˆ°æ›´æ–°    |

å½“ç„¶ï¼Œè¿™æ ·çš„é•¿è¿æ¥ä¹Ÿå¹¶éå®Œå…¨æ˜¯å¥½å¤„ï¼Œæ‰€ä»¥è¯·ç»“åˆä¸šåŠ¡åœºæ™¯æ¥åˆç†é€‰ç”¨å¯¹åº”çš„è§£å†³æ–¹æ³•ï¼š

| ä»£ä»·         | è¯´æ˜                               | å¦‚ä½•åº”å¯¹                     |
| ------------ | ---------------------------------- | ---------------------------- |
| å†…å­˜å ç”¨     | æ¯ä¸ªè¿æ¥å ç”¨ä¸€å®šå†…å­˜ï¼ˆå¦‚ 4KB~8KBï¼‰ | ä½¿ç”¨è¿æ¥æ± ã€åŠæ—¶å…³é—­æ— ç”¨è¿æ¥ |
| è¿æ¥ç®¡ç†å¤æ‚ | éœ€å¤„ç†æ–­çº¿ã€é‡è¿ã€å¿ƒè·³             | ä½¿ç”¨ Nettyã€WebSocket åè®®æ ˆ |
| é›†ç¾¤éš¾åº¦é«˜   | ç”¨æˆ·è¿æ¥åˆ†å¸ƒåœ¨ä¸åŒæœåŠ¡å™¨           | éœ€è¦ Redisã€MQ åšæ¶ˆæ¯å¹¿æ’­    |
| è¶…å¤§è§„æ¨¡æŒ‘æˆ˜ | ç™¾ä¸‡è¿æ¥éœ€ä¼˜åŒ–å†…æ ¸å‚æ•°             | ä½¿ç”¨ epollã€åç¨‹ç­‰æŠ€æœ¯       |

**å¯¼å‘ï¼š**é•¿è¿æ¥ï¼›WebSocketï¼›ä½å»¶è¿Ÿè¦æ±‚çš„å®ç°

### é•¿è¿æ¥ä¸‹å¦‚ä½•ç¡®å®šç”¨æˆ·æ˜¯å¦åœ¨çº¿

å¯ä»¥é€šè¿‡å‘é€å¿ƒè·³åŒ…çš„æ–¹å¼æ¥ç¡®å®šwsè¿æ¥æ˜¯å¦å­˜åœ¨å¼‚å¸¸ï¼Œå½“å¿ƒè·³è¶…æ—¶æ—¶å°±å¯ä»¥ç¡®è®¤ç¦»çº¿äº†ã€‚

### äº‹åŠ¡å¼€å¯åæ³¨æ„è¯»å†™å…ˆåé¡ºåº

ä¸€èˆ¬æ¥è¯´æ³¨æ„å°½é‡å…ˆè¯»åå†™ï¼š

- å†™æ“ä½œä¼šåŠ é”ï¼ˆå¦‚è¡Œé”ã€é—´éš™é”ï¼‰ã€‚
- å¦‚æœå…ˆå†™ï¼Œé”æŒæœ‰æ—¶é—´å˜é•¿ï¼Œå¢åŠ ä¸å…¶ä»–äº‹åŠ¡æ­»é”çš„æ¦‚ç‡ã€‚
- å…ˆè¯»ï¼ˆå¿…è¦æ—¶åŠ  `FOR UPDATE`ï¼‰å†å†™ï¼Œå¯ä»¥æ›´ç²¾å‡†åœ°æ§åˆ¶é”çš„èŒƒå›´å’Œæ—¶é—´ã€‚

### éš”ç¦»ç­‰çº§

åŒä¸€äº‹åŠ¡ï¼š

ä¸åŒäº‹åŠ¡ï¼š

### è‡ªè°ƒç”¨ä»¥åŠå¾ªç¯ä¾èµ–

äº‹åŠ¡æ³¨è§£å¤±æ•ˆ

åˆ‡æ¢è°ƒç”¨é€»è¾‘ï¼Œä½¿ç”¨Springæä¾›çš„ä»£ç†å¯¹è±¡

@Lazyè§£å†³å¾ªç¯ä¾èµ–





### mybatisplusçš„åå¤„

åœ¨å¤„ç†å¤šè¡¨è”æŸ¥ç­‰å¤æ‚ä¸šåŠ¡æ—¶å°±ä¸å¥½ç”¨äº†

### inner joinä¸left joinçš„åŒºåˆ«

| ç±»å‹                                | ä¸­æ–‡å   | å®šä¹‰                                                         |
| ----------------------------------- | -------- | ------------------------------------------------------------ |
| `INNER JOIN`                        | å†…è¿æ¥   | åªè¿”å›ä¸¤ä¸ªè¡¨ä¸­ **éƒ½æœ‰åŒ¹é…è®°å½•** çš„æ•°æ®ã€‚                     |
| `LEFT JOIN`ï¼ˆæˆ– `LEFT OUTER JOIN`ï¼‰ | å·¦å¤–è¿æ¥ | è¿”å›å·¦è¡¨çš„å…¨éƒ¨è®°å½•ï¼Œä»¥åŠå³è¡¨ä¸­ **æœ‰åŒ¹é…çš„è®°å½•**ï¼›å¦‚æœå³è¡¨æ²¡æœ‰åŒ¹é…ï¼Œåˆ™å¯¹åº”å­—æ®µä¸º `NULL`ã€‚ |

### **`ON DUPLICATE KEY UPDATE`**æ˜¯ä»€ä¹ˆï¼Ÿ

MySQLç‰¹æœ‰çš„**å°è¯•æ’å…¥ä¸€æ¡è®°å½•**ï¼Œå¦‚æœå‘ç°è¿™æ¡è®°å½•çš„ä¸»é”®ï¼ˆPRIMARY KEYï¼‰æˆ–å”¯ä¸€é”®ï¼ˆUNIQUE KEYï¼‰å·²ç»å­˜åœ¨ï¼ˆå³ä¼šå¼•å‘â€œDuplicate entryâ€é”™è¯¯ï¼‰ï¼Œé‚£ä¹ˆå°±**æ‰§è¡Œæ›´æ–°æ“ä½œ**ï¼Œè€Œä¸æ˜¯æŠ¥é”™ã€‚

å³insertOrUpdateçš„å¸¸ç”¨åŸºæœ¬sqlè¯­å¥ã€‚

è¿™é‡Œä¹‹æ‰€ä»¥é¢å¤–æä¸€å˜´æ˜¯å› ä¸ºmybatisplusçš„insertOrUpdateæ˜¯åŸºäºä½ åœ¨POç±»ä¸­æ‰€æ ‡è¯†çš„ä¸»é”®è¿›è¡Œçš„ï¼Œå…¶ä½™çš„è”åˆç´¢å¼•ç­‰ä»–æ˜¯ä¸åšåˆ¤æ–­çš„ï¼Œæ‰€ä»¥ä¸šåŠ¡å¤æ‚çš„æ—¶å€™è¿˜æ˜¯éœ€è¦ç”¨ä¸Šè¿™ä¸ªè‡ªå·±å»å†™mapperçš„ã€‚

**ä½†æ˜¯è¯·æ³¨æ„**ï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œè¿™ä¸€æ¡å‘½ä»¤ä¼šå¯¼è‡´æ­»é”çš„é—®é¢˜ï¼š

[INSERT ... ON DUPLICATE KEY UPDATEäº§ç”Ÿdeath lockæ­»é”åŸç†_insert on duplicate keyä¼šåŠ è¯»é”å—-CSDNåšå®¢](https://blog.csdn.net/pml18710973036/article/details/78452688)

[IGNOREï¼ŒREPLACEï¼ŒON DUPLICATE KEY UPDATEåœ¨é¿å…é‡å¤æ’å…¥è®°å½•æ—¶å­˜åœ¨çš„é—®é¢˜åŠæœ€ä½³å®è·µ_sqlè®¾ç½®ignore on duplicate key updateè¿˜æœ‰æ•ˆæœå—-CSDNåšå®¢](https://blog.csdn.net/Saintyyu/article/details/104330881)

å¯èƒ½çœ‹åˆ°ç”±äºä¼šè·å–Xé”ï¼Œå¯¼è‡´æ‰§è¡ŒåŒä¸€è¡Œçš„å…¶ä»–å¸¦Xé”ä¼šä¸ä¹‹ç«äº‰ï¼Œè€Œè¿™æ—¶å¦‚æœæ°å¥½è¿˜å°±æ˜¯`ON DUPLICATE KEY UPDATE`ï¼Œé‚£ä¹ˆå°±ä¼šä¸€ç›´ç­‰å¾…å¯¹æ–¹çš„Sé”é‡Šæ”¾äº†æ‰èƒ½ä¸ŠXé”è¿›è¡Œupdateæ“ä½œï¼Œè¿™æ—¶å°±ä¼šå¯¼è‡´æ­»é”ï¼

è™½ç„¶å¯ä»¥è¯·æ±‚æ—¶é—´è¿‡é•¿æŠ›å‡ºå¼‚å¸¸å›æ»šäº‹åŠ¡ï¼Œä½†æ˜¯åœ¨**ç”Ÿäº§ç¯å¢ƒ**è¿˜æ˜¯**å°½é‡é¿å…ä½¿ç”¨DUPLICATE**ï¼Œå°¤å…¶æ˜¯å¯¹**åŒä¸€è¡Œ**ä¼šè¿›è¡Œé«˜å¹¶å‘DUPLICATEæ“ä½œæ—¶ï¼

è¿˜æ˜¯æ¨èå¯¹ç›¸å…³ç´¢å¼•æ£€æŸ¥ååˆ†å¸ƒæ“ä½œï¼Œé‚£ä¹ˆè¿™é‡Œå¦‚æœè¿˜æ˜¯éœ€è¦å¯¹ç›¸å…³è¡ŒåŠ é”çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨SELECT FOR UPDATEçš„æ–¹å¼æ¥å®ç°ä¸ŠXé”ï¼ˆç›´æ¥ä¸ŠXé”ï¼Œä¸æ˜¯åˆ†å¸ƒSå†Xï¼‰

###  **S é”ï¼ˆå…±äº«é”ï¼‰** å’Œ **X é”ï¼ˆæ’ä»–é”ï¼‰**

| é”ç±»å‹   | å…¨ç§°           | ä¸­æ–‡å        | å…è®¸çš„æ“ä½œ                                   | å…¼å®¹æ€§                 |
| -------- | -------------- | ------------- | -------------------------------------------- | ---------------------- |
| **S é”** | Shared Lock    | å…±äº«é” / è¯»é” | å…¶ä»–äº‹åŠ¡å¯ä»¥**è¯»**è¯¥æ•°æ®ï¼ˆæ‰€æœ‰äº‹åŠ¡éƒ½ä¸èƒ½å†™ï¼‰ | âœ… å¯ä¸å…¶ä»– S é”å…±å­˜    |
| **X é”** | Exclusive Lock | æ’ä»–é” / å†™é” | å½“å‰äº‹åŠ¡å¯ä»¥**è¯»+å†™**è¯¥æ•°æ®                  | âŒ ä¸èƒ½ä¸ä»»ä½•å…¶ä»–é”å…±å­˜ |

- **å¤šä¸ª S é”å¯ä»¥åŒæ—¶å­˜åœ¨**ï¼ˆå¤šäººåŒæ—¶è¯»æ²¡é—®é¢˜ï¼‰
- **X é”æ˜¯â€œéœ¸é“â€çš„**ï¼šåªè¦æœ‰äººæŒæœ‰ S æˆ– X é”ï¼ŒX é”å°±å¿…é¡»ç­‰
- **S é”é‡åˆ° X é”ä¹Ÿä¼šç­‰**ï¼ˆå› ä¸º X é”å¯èƒ½æ­£åœ¨ä¿®æ”¹æ•°æ®ï¼Œè¯»æ—§å€¼ä¼šä¸ä¸€è‡´ï¼‰

| æ—¶é—´ | äº‹åŠ¡ Aï¼ˆæŒæœ‰ S é”ï¼‰                                          | äº‹åŠ¡ Bï¼ˆè¯·æ±‚ X é”ï¼‰                                         |
| :--- | ------------------------------------------------------------ | ----------------------------------------------------------- |
| t1   | `SELECT balance FROM accounts WHERE id=1 LOCK IN SHARE MODE;` â†’ è¯»åˆ° 100 |                                                             |
| t2   | ï¼ˆæ­£åœ¨å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼‰                                         | `UPDATE accounts SET balance = 200 WHERE id=1;` â†’ éœ€è¦ X é” |
| t3   |                                                              | **é˜»å¡ï¼ç­‰å¾… A é‡Šæ”¾ S é”**                                  |

æ³¨æ„æ˜¯ç­‰å¾…å…¶ä»–äº‹åŠ¡é‡Šæ”¾äº†Sé”ååŠ ä¸ŠXé”ã€‚

### é—´éš™é”



###  **HTTP è¯·æ±‚æ–¹æ³•ï¼ˆHTTP Methodsï¼‰**çš„åˆ†å·¥

| æ–¹æ³•      | ç”¨é€”                     | æ˜¯å¦æœ‰è¯·æ±‚ä½“ï¼ˆBodyï¼‰ | å¹‚ç­‰æ€§   | å®‰å…¨æ€§   |
| --------- | ------------------------ | -------------------- | -------- | -------- |
| `GET`     | è·å–èµ„æº                 | âŒ é€šå¸¸æ²¡æœ‰           | âœ… å¹‚ç­‰   | âœ… å®‰å…¨   |
| `POST`    | åˆ›å»ºèµ„æº æˆ– æäº¤æ•°æ®     | âœ… æœ‰                 | âŒ éå¹‚ç­‰ | âŒ ä¸å®‰å…¨ |
| `PUT`     | æ›´æ–°èµ„æºï¼ˆå…¨é‡ï¼‰         | âœ… æœ‰                 | âœ… å¹‚ç­‰   | âŒ ä¸å®‰å…¨ |
| `PATCH`   | æ›´æ–°èµ„æºï¼ˆéƒ¨åˆ†ï¼‰         | âœ… æœ‰                 | âŒ éå¹‚ç­‰ | âŒ ä¸å®‰å…¨ |
| `DELETE`  | åˆ é™¤èµ„æº                 | âŒ é€šå¸¸æ²¡æœ‰           | âœ… å¹‚ç­‰   | âŒ ä¸å®‰å…¨ |
| `HEAD`    | è·å–å“åº”å¤´ï¼ˆæ— å“åº”ä½“ï¼‰   | âŒ æ²¡æœ‰               | âœ… å¹‚ç­‰   | âœ… å®‰å…¨   |
| `OPTIONS` | æŸ¥è¯¢æœåŠ¡å™¨æ”¯æŒçš„è¯·æ±‚æ–¹æ³• | âŒ æ²¡æœ‰               | âœ… å¹‚ç­‰   | âœ… å®‰å…¨   |

### Springæä¾›çš„ä¼´éšå¯åŠ¨

```java
@Component
public class InitApplication implements ApplicationRunner {

    @Autowired
    private NettyWebSocketStarter nettyWebSocketStarter;

    @Override
    public void run(ApplicationArguments args) throws Exception {
        new Thread(nettyWebSocketStarter).start();
    }
}
```

å®ç°ApplicationRunneræ¥å£åï¼Œå¯åŠ¨SpringæœåŠ¡è¿˜ä¼šè‡ªåŠ¨è¿è¡Œåœ¨è¯¥Componentä¸­runæ–¹æ³•ä¸­çš„ä¸šåŠ¡ã€‚

### å¤åˆä¸»é”®

å½“ä¸€å¼ è¡¨è®¾ç½®äº†**ä¸¤ä¸ªä¸»é”®**ï¼ˆå³å¤åˆä¸»é”®ï¼‰æ—¶ï¼Œè¦æ±‚æ˜¯ï¼š**è¿™ä¸¤ä¸ªå­—æ®µçš„ç»„åˆå€¼ä¸èƒ½é‡å¤**ï¼Œä½†**å•ä¸ªå­—æ®µçš„å€¼å¯ä»¥é‡å¤**ã€‚

æ¯”å¦‚ä¸€ä¸ªè¡¨è®°å½•äº†ç”¨æˆ·ä¸å…¶ä»–ç”¨æˆ·ä¹‹é—´çš„å…³ç³»ï¼š

| user_id | contact_id |
| ------- | ---------- |
| 101     | 102        |
| 101     | 103        |

è¿™æ—¶useridå¯ä»¥è‡ªå·±é‡å¤ï¼Œcontactidä¹Ÿå¯ä»¥åŒåˆ—é‡å¤ï¼Œä½†æ˜¯å¦‚æœä¸¤åˆ—éƒ½é‡å¤äº†é‚£å°±ä¸è¡Œäº†ã€‚

### å¤šè”è¡¨ä¸å¤šæ¬¡æŸ¥è¯¢çš„ä½¿ç”¨åœºæ™¯

| ç»´åº¦               | å¤šè”è¡¨æŸ¥è¯¢ï¼ˆJOINï¼‰      | å¤šæ¬¡å•ç‹¬æŸ¥è¯¢           |
| ------------------ | ----------------------- | ---------------------- |
| **ç½‘ç»œå¼€é”€**       | âœ… ä¸€æ¬¡è¯·æ±‚              | âŒ å¤šæ¬¡è¯·æ±‚             |
| **æ•°æ®åº“è¿æ¥å ç”¨** | âœ… å°‘                    | âŒ å¤šï¼ˆå°¤å…¶å¹¶å‘é«˜æ—¶ï¼‰   |
| **SQL å¤æ‚åº¦**     | âŒ é«˜ï¼ˆéš¾å†™ã€éš¾ç»´æŠ¤ï¼‰    | âœ… ä½ï¼ˆç®€å•æ¸…æ™°ï¼‰       |
| **ç´¢å¼•åˆ©ç”¨**       | âš ï¸ å¯èƒ½å¤±æ•ˆï¼ˆå¤§è¡¨ JOINï¼‰ | âœ… å®¹æ˜“å‘½ä¸­ç´¢å¼•         |
| **ç¼“å­˜å‹å¥½æ€§**     | âŒ å·®ï¼ˆç»“æœä¸å¯å¤ç”¨ï¼‰    | âœ… å¥½ï¼ˆå¯ç¼“å­˜å•è¡¨æ•°æ®ï¼‰ |
| **æ‰©å±•æ€§**         | âŒ å·®ï¼ˆåŠ è¡¨å°±æ”¹ SQLï¼‰    | âœ… å¥½ï¼ˆæ¨¡å—åŒ–ï¼‰         |
| **é”ç«äº‰**         | âŒ é«˜ï¼ˆé•¿æ—¶é—´æŒæœ‰é”ï¼‰    | âœ… ä½ï¼ˆçŸ­äº‹åŠ¡ï¼‰         |

**å¤šè”è¡¨ï¼ˆJOINï¼‰ï¼š**

1. **æ•°æ®é‡å°ï¼Œå…³ç³»æ˜ç¡®**

   - å¦‚ï¼šç”¨æˆ· + è§’è‰² + æƒé™ æŸ¥è¯¢
   - ä¸‰å¼ å°è¡¨ JOINï¼Œé€Ÿåº¦å¿«

2. **éœ€è¦æ’åºã€åˆ†é¡µçš„æ±‡æ€»æ•°æ®**

   ```sql
   SELECT u.name, c.last_message, g.member_count
   FROM chat_session_user u
   JOIN chat_session c ON c.session_id = u.session_id
   LEFT JOIN group_info g ON g.group_id = u.contact_id
   ORDER BY c.last_receive_time DESC
   LIMIT 10;
   ```

   - å¦‚æœåˆ†é¡µï¼Œå¿…é¡»ä¸€æ¬¡æŸ¥å®Œï¼Œå¦åˆ™æ— æ³•ä¿è¯ä¸€è‡´æ€§

3. **å¼ºä¸€è‡´æ€§è¦æ±‚é«˜**

   - æ‰€æœ‰æ•°æ®æ¥è‡ªåŒä¸€æ—¶åˆ»çš„æ•°æ®åº“å¿«ç…§

4. **ç½‘ç»œå»¶è¿Ÿé«˜ï¼ˆå¦‚è·¨æœºæˆ¿ï¼‰**

   - å‡å°‘æ•°æ®åº“å¾€è¿”æ¬¡æ•°è‡³å…³é‡è¦

----

 **å¤šæ¬¡æŸ¥è¯¢ + åº”ç”¨å±‚å¤„ç†**ï¼š

1. **å¤§è¡¨ JOIN æ€§èƒ½å·®**
   - æ¯”å¦‚ `chat_message` æœ‰ä¸Šäº¿æ¡è®°å½•
   - `JOIN` å¯èƒ½å¯¼è‡´å…¨è¡¨æ‰«æã€ç´¢å¼•å¤±æ•ˆ
2. **éƒ¨åˆ†æ•°æ®å¯ç¼“å­˜**
   - ç”¨æˆ·ä¿¡æ¯ã€ç¾¤ä¿¡æ¯ â†’ å¯ç¼“å­˜åœ¨ Redis
   - æ¶ˆæ¯åˆ—è¡¨ â†’ ä»æ•°æ®åº“æŸ¥
   - åº”ç”¨å±‚æ‹¼æ¥ï¼Œå‡å°‘æ•°æ®åº“å‹åŠ›
3. **å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œæ•°æ®åˆ†å¸ƒåœ¨ä¸åŒæœåŠ¡**
   - ç”¨æˆ·æœåŠ¡ã€æ¶ˆæ¯æœåŠ¡ã€ç¾¤ç»„æœåŠ¡å„è‡ªç‹¬ç«‹
   - åªèƒ½å…ˆæŸ¥ä¸€ä¸ªï¼Œå†è°ƒ API è·å–å…¶ä»–
4. **å¼‚æ­¥åŠ è½½éœ€æ±‚**
   - å…ˆæ˜¾ç¤ºä¼šè¯åˆ—è¡¨ï¼ˆå¿«ï¼‰
   - å†å¼‚æ­¥åŠ è½½æœªè¯»æ•°ã€æˆå‘˜æ•°ç­‰ï¼ˆæ…¢ï¼‰

### nettyä¸­é€šè¯channelçš„è®¾è®¡

æ¯ä¸ªç”¨æˆ·è‡ªå·±ä¼šåœ¨æœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªchannelå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ ¹æ®useridæ”¾åˆ°Hashmapé‡Œï¼›

æ¯ä¸ªç¾¤ç»„ä¼šåœ¨æœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªchannelgroupï¼ˆå½“éå†ç”¨æˆ·ç¾¤ç»„å‘ç°æœ‰æ—¶ä¼šå°è¯•å¯»æ‰¾å†…å­˜ä¸­æ˜¯å¦æœ‰è¯¥channelgroupï¼Œæ— åˆ™æ–°å»ºä¸€ä¸ªï¼‰ï¼Œæ ¹æ®groupidæ”¾åˆ°Hashmapé‡Œï¼›

ï¼ˆuseridå’Œgroupidæ˜¯å”¯ä¸€å­˜åœ¨æ•°æ®åº“ä¸­çš„ï¼‰

ç”¨æˆ·ä¹‹é—´å‘é€æ¶ˆæ¯æ—¶ä¼šå‘å¯¹æ–¹çš„channelå‘é€æ¶ˆæ¯ï¼Œç”¨æˆ·å‘ç¾¤ç»„é‡Œå‘é€æ¶ˆæ¯ä¼šå‘ç¾¤ç»„channelgroupå†…æ‰€æœ‰åœ¨çº¿çš„channelå‘é€æ¶ˆæ¯ã€‚ï¼ˆæ¶ˆæ¯ä¿¡æ¯ä¼šå­˜å‚¨åˆ°æœåŠ¡å™¨ï¼Œç¦»çº¿æ¶ˆæ¯ä¼šåœ¨ç”¨æˆ·ç™»å½•åå‘æœåŠ¡å™¨è¯·æ±‚è·å–ç¦»çº¿åçš„æ¶ˆæ¯ï¼‰

### ç¦»çº¿åæ¶ˆæ¯çš„è·å–

å½“æˆ‘ä»¬ç™»å½•æ—¶ï¼Œchannelå¯ä»¥ç›´æ¥è·å–æ¶ˆæ¯å¹¶å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ç¼“å­˜åˆ°æœ¬åœ°sqliteï¼Œä½†æ˜¯ç¦»çº¿äº†æ€ä¹ˆåŠï¼Ÿ

äº‹å®ä¸Šï¼Œç”¨æˆ·å‘é€äº†æ¶ˆæ¯ä¹‹åï¼Œæ¶ˆæ¯å†…å®¹ä¼šè¢«åç«¯æœåŠ¡å™¨è®°å½•ï¼ˆåŒ…æ‹¬å‘é€å¯¹è±¡ï¼Œæ¥æ”¶å¯¹è±¡ï¼Œå‘é€æ—¶é—´ç­‰ï¼‰ã€‚ç”¨æˆ·åœ¨ç™»å½•ï¼Œchannelå®Œæˆåˆ›å»ºæ—¶ï¼Œä¼šå‘æ•°æ®åº“å‘é€ä¸€ä¸ªç¦»çº¿æ¶ˆæ¯çš„æŸ¥è¯¢ï¼Œä¼šå°†ç”¨æˆ·ç¦»çº¿åæ¥æ”¶åˆ°çš„æ¶ˆæ¯è¿›è¡ŒæŸ¥è¯¢å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

### Redisæ¶ˆæ¯é˜Ÿåˆ—çš„ä½¿ç”¨â€”Redission

æ¶ˆæ¯é˜Ÿåˆ—æˆ‘ä»¬éƒ½çŸ¥é“ä¸€èˆ¬ç”¨æ¥è§£è€¦ï¼Œå°†ä¸€ä¸ªä¸»çº¿ç¨‹çš„å¤šä¸ªæ­¥éª¤åˆ†è§£ä¸ºä¸€ä¸ªä¸»çº¿ç¨‹+å¤šä¸ªå‰¯çº¿ç¨‹åŒæ—¶å¤„ç†æˆ–æ˜¯å»¶åå¤„ç†çš„å¼‚æ­¥æ“ä½œï¼Œå¯ä»¥å°†ä¸šåŠ¡æ¨¡å—åŒ–ï¼Œå°†å„ä¸ªä¸šåŠ¡ä¸ä¸»çº¿ç¨‹éš”ç¦»å¼€æ¥é˜²æ­¢é˜»å¡ä¸»çº¿ç¨‹ã€‚

åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œæ¶ˆæ¯é˜Ÿåˆ—çš„ä½¿ç”¨è¿˜ç”¨äºå®ç°å¤šä¸ªæœåŠ¡å™¨éƒ¨ç½²æ—¶çš„æ¶ˆæ¯åŒæ­¥ã€‚å› ä¸ºç”¨æˆ·å‘é€requeståˆ°çš„æœåŠ¡å™¨ä¸å…¶ä»–ç”¨æˆ·çš„æœåŠ¡å™¨å¯èƒ½ä¸åŒï¼Œæœ¬é¡¹ç›®ä¸­nettyçš„channelåˆæ˜¯åªå­˜å‚¨åœ¨ä¸€ä¸ªåç«¯æœåŠ¡å™¨çš„å†…å­˜å½“ä¸­çš„ï¼Œè¿™å°±è¦æ±‚æˆ‘ä»¬å®ç°å¤šä¸ªæœåŠ¡å™¨çš„æ¶ˆæ¯é€šä¿¡ï¼Œè€Œè¿™ä¹Ÿå¯ä»¥ç”±æ¶ˆæ¯é˜Ÿåˆ—æ¥è§£å†³ã€‚

åªéœ€è¦å°†Redisä»¥å•æœºæˆ–è€…é›†ç¾¤ï¼ˆredisé›†ç¾¤å¦‚Redis Clusteræœ¬èº«å°±æ”¯æŒèŠ‚ç‚¹é€šä¿¡ä»¥å®ç°æ•°æ®ä¸€è‡´æ€§ï¼‰éƒ¨ç½²å®Œæ¯•åï¼Œç¡®ä¿å¤šå°åç«¯æœåŠ¡å™¨è¿æ¥åˆ°è¯¥redisæœåŠ¡ä¸Šï¼Œå°±å¯ç»“åˆredissonæä¾›çš„å¹¿æ’­å®ç°æœåŠ¡å™¨ä¹‹é—´çš„æ¶ˆæ¯é€šä¿¡äº†ã€‚

```java
/**
 * ç›‘å¬é¢‘é“æ¶ˆæ¯
 */
@PostConstruct // å¯åŠ¨æ—¶æ‰§è¡Œç›‘å¬
public void listenMessage() {
    // è®¢é˜…è¯é¢˜é¢‘é“æ¶ˆæ¯ï¼Œæ¥æ”¶é€šè¿‡redisä¼ è¾“çš„å…¶ä»–èŠ‚ç‚¹çš„æ¶ˆæ¯
    RTopic topic = redissonClient.getTopic(MESSAGE_TOPIC);
    topic.addListener(MessageSendDto.class, (channel, msg) -> {
        // æ¥æ”¶åˆ°æ¶ˆæ¯ã€‚æ ¹æ®ä¿¡æ¯å°è¯•å¯¹è‡ªå·±çš„å†…å­˜å†…çš„receiveIdç”¨æˆ·å‘é€æ¶ˆæ¯
        logger.info("æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š{}", msg);
        channelContextUtils.sendMessage(msg);
    });
}

/**
 * å‘redissioné¢‘é“å‘é€æ¶ˆæ¯
 * @param message è¦å‘é€çš„æ¶ˆæ¯
 */
public void sendMessage(MessageSendDto message) {
    // å‘é€æ¶ˆæ¯
    RTopic topic = redissonClient.getTopic(MESSAGE_TOPIC);
    topic.publish(message);
}
```

æ³¨æ„redissonClientçš„ä½¿ç”¨éœ€è¦è‡ªå·±é…ç½®configï¼š

```java
/**
 * åˆ›å»º RedissonClient å¯¹è±¡ï¼Œç”¨äºæ“ä½œ Redis
 * @return RedissonClient å¯¹è±¡
 */
@Bean(destroyMethod = "shutdown")
public RedissonClient redissonClient() {
    Config config = new Config();
    config.setCodec(new org.redisson.codec.JsonJacksonCodec()).
            useSingleServer().
            setAddress("redis://" + host + ":" + port).
            setDatabase(Integer.parseInt(database));
    return Redisson.create(config);
}
```

è¿™æ ·ï¼Œå½“æˆ‘ä»¬çš„ç”¨æˆ·channelå¤„äºä¸åŒçš„æœåŠ¡å™¨ï¼Œä¸åŒçš„æœåŠ¡å™¨ä¼šç›‘å¬redissionè¯é¢˜é¢‘é“çš„è¿™ä¸ªsendMessageæ–¹æ³•ã€‚

å½“ç”¨æˆ·å‘é€ç»™å…¶ä»–**å•ä¸€ç”¨æˆ·**æ¶ˆæ¯æ—¶ï¼Œç›‘å¬åˆ°å‘½ä»¤çš„**æ‰€æœ‰æœåŠ¡å™¨**ä¼šå°è¯•åœ¨è‡ªå·±çš„å†…å­˜ä¸­æŸ¥æ‰¾msgç»™å‡ºçš„contactIdçš„channelï¼Œæ²¡æœ‰åˆ™ä¸å“åº”ï¼Œæœ‰åˆ™è¿”å›ç»“æœã€‚

å½“ç”¨æˆ·å‘é€ç»™**ç¾¤ç»„**æ¶ˆæ¯æ—¶ï¼Œç›‘å¬åˆ°å‘½ä»¤çš„**æ‰€æœ‰æœåŠ¡å™¨**ä¹Ÿä¼šå°è¯•åœ¨è‡ªå·±çš„å†…å­˜ä¸­æŸ¥æ‰¾msgç»™å‡ºçš„contactIdçš„channelGroupï¼Œå¹¶å¯¹groupå†…çš„æ‰€æœ‰channelå‘é€æ¶ˆæ¯ï¼Œç»“æœåŒä¸Šã€‚

è¿™æ ·æˆ‘ä»¬å°±å®ç°äº†æ¶ˆæ¯çš„è·¨æœåŠ¡å™¨ä¼ æ’­ã€‚

### é˜²å¾¡ç”¨æˆ·ç¼–ç¨‹

åœ¨gatewayä»¥åŠnginxæœªé…ç½®çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„æ¥å£apiéƒ½æ˜¯å¯¹å¤–å¼€æ”¾çš„ï¼ˆå³ä¾¿é…ç½®äº†ä¹Ÿæ˜¯æœ‰è¿¹å¯å¾ªçš„ï¼‰ï¼Œè¿™æ—¶å€™ç”¨æˆ·ç”¨æŠ“åŒ…å·¥å…·å°±æœ‰å¯èƒ½æŠŠæˆ‘ä»¬çš„æ¥å£å‚æ•°å’Œtokenç­‰ä¿¡æ¯å–å‡ºæ¥ï¼Œè¿™æ ·å°±å¯ä»¥è‡ªå·±åšrequestå¯¹æ•°æ®è¿›è¡Œç ´åï¼Œæˆ‘ä»¬æœ€å¥½åœ¨åç«¯çš„ä¸šåŠ¡ä¸­åŠ å…¥å¯¹æ•°æ®çš„æ ¡éªŒï¼Œå°†è·å–çš„æ•°æ®å’Œæ•°æ®åº“çš„ä¿¡æ¯è¿›è¡Œæ ¸å¯¹é˜²æ­¢å‡ºç°é—®é¢˜ã€‚å½“ç„¶è¿™åªæ˜¯ç®€å•çš„ç¬¬ä¸€å±‚ï¼Œè¿˜æœ‰å¾ˆå¤šå¥½åŠæ³•è®©ç”¨æˆ·åªèƒ½é€šè¿‡å‰ç«¯æä¾›çš„æ–¹å¼æ¥ä¼ è¾“ä¿¡æ¯ï¼š

æ¯”å¦‚æœ¬é¡¹ç›®å°±åšäº†**token**çš„å½¢å¼æ¥åšï¼Œä½†æ˜¯jwtï¼Œsessionä¹Ÿå¯ä»¥é€šè¿‡æŠ“åŒ…å·¥å…·è§£æè¯·æ±‚å¤´è·å–åˆ°

ä¹Ÿå¯ä»¥ä½¿ç”¨**æ¥å£ç­¾å**çš„æ–¹å¼æ¥åŠ å¯†ï¼š

1. å‰ç«¯å°†æ‰€æœ‰å‚æ•°æŒ‰å­—å…¸åºæ’åº
2. æ‹¼æ¥æˆå­—ç¬¦ä¸² + åŠ ç›ï¼ˆsecretKeyï¼‰
3. ç”Ÿæˆ `sign = MD5(params + secretKey)`
4. è¯·æ±‚æ—¶å¸¦ä¸Š `sign` å‚æ•°
5. åç«¯é‡æ–°è®¡ç®— signï¼Œå¯¹æ¯”æ˜¯å¦ä¸€è‡´

ä½†æ˜¯jsä»£ç åœ¨æ§åˆ¶å°é‡ŒåŒæ ·è¿˜æ˜¯å¯ä»¥å–å‡ºæ¥çš„ï¼Œæœ‰äº†åŒæ¬¾md5ï¼ŒåŒæ ·å¯ä»¥ç ´è§£ã€‚

å½“ç„¶ä¹Ÿå¯ä»¥é…ç½®å¥½**nginx**ï¼Œå¯¹å¼‚å¸¸è¡Œä¸ºè¿›è¡Œæ£€æµ‹ï¼Œåšå¥½é£æ§

æœ€ç»ˆï¼Œä¸€äº›éå¸¸é‡è¦çš„æ“ä½œï¼Œæ¯”å¦‚äº¤æ˜“ç­‰ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åš**äºŒæ¬¡ç¡®è®¤**ï¼ˆå‘éªŒè¯ç ï¼‰ï¼Œä¸´æ—¶**token**ç­‰æ¥æœ€ç»ˆé˜²æ­¢æ„å¤–

### è¯·æ±‚å¤´



### staticå’Œfinal

`final` çš„æ„æ€æ˜¯â€œæœ€ç»ˆçš„â€ï¼Œä¸€æ—¦è¢«ä¿®é¥°ï¼Œå°±ä¸èƒ½å†æ”¹å˜ã€‚

 1. `final` ä¿®é¥°å˜é‡

- **åŸºæœ¬ç±»å‹**ï¼šå€¼ä¸èƒ½æ”¹å˜ã€‚
- **å¼•ç”¨ç±»å‹**ï¼šå¼•ç”¨ä¸èƒ½æ”¹å˜ï¼ˆå³ä¸èƒ½æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ï¼‰ï¼Œä½†å¯¹è±¡å†…éƒ¨çš„å±æ€§å¯ä»¥å˜ã€‚

```java
final int a = 10;
a = 20; // âŒ ç¼–è¯‘é”™è¯¯ï¼

final List<String> list = new ArrayList<>();
list.add("hello"); // âœ… å¯ä»¥ï¼Œå¯¹è±¡å†…å®¹å¯ä»¥å˜
list = new ArrayList<>(); // âŒ ä¸è¡Œï¼Œå¼•ç”¨ä¸èƒ½å˜
```

> âœ… å¸¸ç”¨äºå®šä¹‰å¸¸é‡ï¼Œå°¤å…¶æ˜¯é…åˆ `static` ä½¿ç”¨ã€‚

---

 2. `final` ä¿®é¥°æ–¹æ³•

- è¡¨ç¤ºè¯¥æ–¹æ³•**ä¸èƒ½è¢«å­ç±»é‡å†™ï¼ˆoverrideï¼‰**ã€‚

```java
class Parent {
    final void print() {
        System.out.println("This cannot be overridden");
    }
}

class Child extends Parent {
    // void print() { } // âŒ ç¼–è¯‘é”™è¯¯ï¼
}
```

> âœ… å¸¸ç”¨äºé˜²æ­¢å…³é”®é€»è¾‘è¢«ç¯¡æ”¹ï¼Œæ¯”å¦‚å®‰å…¨ã€å·¥å…·ç±»æ–¹æ³•ã€‚

---

 3. `final` ä¿®é¥°ç±»

- è¡¨ç¤ºè¯¥ç±»**ä¸èƒ½è¢«ç»§æ‰¿**ã€‚

```java
final class MathUtils {
    public static int add(int a, int b) {
        return a + b;
    }
}

// class MyMath extends MathUtils { } // âŒ ç¼–è¯‘é”™è¯¯ï¼
```

> âœ… å…¸å‹ä¾‹å­ï¼š`String`ã€`Integer` ç­‰åŒ…è£…ç±»éƒ½æ˜¯ `final` çš„ï¼Œä¿è¯ä¸å¯å˜æ€§å’Œå®‰å…¨æ€§ã€‚

---

`static` çš„æ„æ€æ˜¯â€œé™æ€çš„â€ï¼Œå®ƒå±äºç±»æœ¬èº«ï¼Œè€Œä¸æ˜¯æŸä¸ªå®ä¾‹ã€‚

 1. `static` ä¿®é¥°å˜é‡ï¼ˆç±»å˜é‡ï¼‰

- æ‰€æœ‰å®ä¾‹**å…±äº«**åŒä¸€ä¸ªé™æ€å˜é‡ã€‚
- å¯ä»¥é€šè¿‡ `ç±»å.å˜é‡å` ç›´æ¥è®¿é—®ã€‚

```java
class Counter {
    static int count = 0;
    Counter() {
        count++;
    }
}

Counter c1 = new Counter();
Counter c2 = new Counter();
System.out.println(Counter.count); // è¾“å‡º 2
```

> âš ï¸ æ³¨æ„çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹éœ€è°¨æ…ä½¿ç”¨ã€‚

---

 2. `static` ä¿®é¥°æ–¹æ³•

- é™æ€æ–¹æ³•å±äºç±»ï¼Œ**ä¸èƒ½è®¿é—®éé™æ€æˆå‘˜**ï¼ˆå˜é‡æˆ–æ–¹æ³•ï¼‰ã€‚
- å¯ä»¥ç›´æ¥é€šè¿‡ `ç±»å.æ–¹æ³•å()` è°ƒç”¨ã€‚

```java
class MathUtils {
    static int add(int a, int b) {
        return a + b;
    }
}

int result = MathUtils.add(3, 5); // âœ… ç›´æ¥è°ƒç”¨
```

---

 3. `static` ä¿®é¥°ä»£ç å—

- åœ¨ç±»åŠ è½½æ—¶æ‰§è¡Œï¼Œåªæ‰§è¡Œä¸€æ¬¡ã€‚
- å¸¸ç”¨äºåˆå§‹åŒ–é™æ€èµ„æºã€‚

```java
static {
    System.out.println("é™æ€ä»£ç å—æ‰§è¡Œäº†");
    // æ¯”å¦‚åŠ è½½é…ç½®ã€åˆå§‹åŒ–ç¼“å­˜ç­‰
}
```

---

 4. `static` å†…éƒ¨ç±»

- æ™®é€šå†…éƒ¨ç±»ä¾èµ–å¤–éƒ¨ç±»å®ä¾‹ï¼Œè€Œ `static` å†…éƒ¨ç±»ä¸ä¾èµ–ã€‚

```java
class Outer {
    static class Inner {
        void print() {
            System.out.println("é™æ€å†…éƒ¨ç±»");
        }
    }
}

// ä½¿ç”¨ï¼š
Outer.Inner inner = new Outer.Inner(); // ä¸éœ€è¦ Outer å®ä¾‹
```

---

 **`final` å’Œ `static` ä¸€èµ·ä½¿ç”¨**

æœ€å¸¸è§çš„åœºæ™¯æ˜¯å®šä¹‰**å…¨å±€å¸¸é‡**ï¼š

```java
public class Constants {
    public static final String FILE_FOLDER_FILE = "/file/";
    public static final String FILE_FOLDER_AVATAR_NAME = "avatar/";
}
```

- `static`ï¼šå±äºç±»ï¼Œå¯é€šè¿‡ `Constants.FILE_FOLDER_FILE` ç›´æ¥è®¿é—®ã€‚
- `final`ï¼šå€¼ä¸å¯å˜ï¼Œç¡®ä¿æ˜¯å¸¸é‡ã€‚

### MySQLæœ€å·¦åŒ¹é…åŸåˆ™



### æ•°æ®ä¸€è‡´æ€§é—®é¢˜

#### å°é¡¹ç›®ï¼šSELECT FOR UPDATE

SELECT FOR UPDATEå¯ä»¥å®ç°å¯¹å¯¹åº”è¡Œçš„åŠ é”ï¼Œåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œäº†è¿™ä¹ˆä¸€æ¡å‘½ä»¤åï¼Œå…¶ä»–äº‹åŠ¡æƒ³è¦å†™æˆ–è€…æ˜¯å¸¦é”çš„è¯»éƒ½ä¼šè¢«é˜»å¡ï¼š

| æ“ä½œç±»å‹                                              | æ˜¯å¦è¢« `SELECT ... FOR UPDATE` é˜»å¡ï¼Ÿ | è¯´æ˜                                                         |
| ----------------------------------------------------- | ------------------------------------- | ------------------------------------------------------------ |
| **æ™®é€š `SELECT`**ï¼ˆå¦‚ `SELECT * FROM t WHERE id=1`ï¼‰  | âŒ **ä¸é˜»å¡**                          | InnoDB ä½¿ç”¨ MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰ï¼Œè¯»çš„æ˜¯**å†å²å¿«ç…§**ï¼Œæ— éœ€åŠ é” |
| **`SELECT ... FOR UPDATE`**                           | âœ… **é˜»å¡**                            | éœ€è¦è·å– X é”ï¼Œä¼šè¢«å·²æŒæœ‰çš„ X é”é˜»å¡                         |
| **`SELECT ... LOCK IN SHARE MODE`**ï¼ˆæˆ– `FOR SHARE`ï¼‰ | âœ… **é˜»å¡**                            | S é”ä¸ X é”äº’æ–¥                                              |
| **`UPDATE` / `DELETE`**                               | âœ… **é˜»å¡**                            | è¿™äº›æ“ä½œä¼šå°è¯•åŠ  X é”ï¼Œä¸å·²æœ‰ X é”å†²çª                       |
| **`INSERT`ï¼ˆæ’å…¥æ–°è¡Œï¼‰**                              | âŒ **é€šå¸¸ä¸é˜»å¡**                      | é™¤éæ¶‰åŠå”¯ä¸€é”®å†²çªæˆ–é—´éš™é”ï¼ˆè§ä¸‹æ–‡ï¼‰                         |

è¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥å¯¹ç›¸å…³è¡Œè¿›è¡Œæ›´æ–°æ“ä½œäº†ã€‚

sqlï¼š

```java
import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import org.apache.ibatis.annotations.Param;
import org.apache.ibatis.annotations.Select;
import java.math.BigDecimal;
import java.util.List;

public interface AccountMapper extends BaseMapper<Account> {

    // æŒ‰ user_id æŸ¥è¯¢ï¼ˆç”¨äº FOR UPDATEï¼‰
    @Select("SELECT * FROM account WHERE user_id = #{userId} FOR UPDATE")
    Account selectForUpdateByUserId(@Param("userId") String userId);

    // æŒ‰å¤šä¸ª user_id æŸ¥è¯¢ï¼Œå¹¶æŒ‰ user_id æ’åºï¼ˆé¿å…æ­»é”ï¼‰
    @Select({
        "<script>",
        "SELECT * FROM account WHERE user_id IN ",
        "<foreach collection='userIds' item='id' open='(' separator=',' close=')'>",
        "#{id}",
        "</foreach>",
        " ORDER BY user_id FOR UPDATE",
        "</script>"
    })
    List<Account> selectForUpdateByUserIds(@Param("userIds") List<String> userIds);
}
```

serviceï¼š


```java
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.retry.annotation.Backoff;
import org.springframework.retry.annotation.Retryable;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import java.math.BigDecimal;
import java.util.Arrays;
import java.util.List;

@Slf4j
@Service
@RequiredArgsConstructor
public class TransferService {

    private final AccountMapper accountMapper;

    // æœ€å¤šé‡è¯• 3 æ¬¡ï¼Œé—´éš”æŒ‡æ•°é€€é¿
    @Retryable(
        value = {Exception.class},
        maxAttempts = 3,
        backoff = @Backoff(delay = 50, multiplier = 2)
    )
    @Transactional(rollbackFor = Exception.class)
    public void transfer(String fromUserId, String toUserId, BigDecimal amount) {
        if (fromUserId.equals(toUserId)) {
            throw new IllegalArgumentException("ä¸èƒ½ç»™è‡ªå·±è½¬è´¦");
        }
        if (amount.compareTo(BigDecimal.ZERO) <= 0) {
            throw new IllegalArgumentException("é‡‘é¢å¿…é¡»å¤§äº0");
        }

        // æŒ‰å›ºå®šé¡ºåºï¼ˆå­—å…¸åºï¼‰é”å®šè´¦æˆ·ï¼Œé¿å…æ­»é”
        List<String> userIds = Arrays.asList(
            fromUserId.compareTo(toUserId) < 0 ? fromUserId : toUserId,
            fromUserId.compareTo(toUserId) < 0 ? toUserId : fromUserId
        );

        List<Account> accounts = accountMapper.selectForUpdateByUserIds(userIds);
        if (accounts.size() != 2) {
            throw new RuntimeException("è´¦æˆ·ä¸å­˜åœ¨");
        }

        Account fromAccount = accounts.get(0).getUserId().equals(fromUserId) 
            ? accounts.get(0) : accounts.get(1);
        Account toAccount = accounts.get(0).getUserId().equals(toUserId) 
            ? accounts.get(0) : accounts.get(1);

        // æ£€æŸ¥ä½™é¢
        if (fromAccount.getBalance().compareTo(amount) < 0) {
            throw new RuntimeException("ä½™é¢ä¸è¶³");
        }

        // æ‰§è¡Œè½¬è´¦
        fromAccount.setBalance(fromAccount.getBalance().subtract(amount));
        toAccount.setBalance(toAccount.getBalance().add(amount));

        accountMapper.updateById(fromAccount);
        accountMapper.updateById(toAccount);

        log.info("è½¬è´¦æˆåŠŸ: {} -> {}, é‡‘é¢: {}", fromUserId, toUserId, amount);
    }
}
```

è¿™é‡Œç”±äºå­˜åœ¨é”ç«äº‰çš„é—®é¢˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ­»é”çš„é—®é¢˜ï¼Œæ‰€ä»¥åœ¨äº‹åŠ¡çš„åŸºç¡€åŠ ä¸Šäº†é‡è¯•ä»¥ä¿è¯å°½å¯èƒ½æˆåŠŸã€‚

è¿™é‡Œè¿˜å¯ä»¥åŠ å…¥ä¹è§‚é”ä»¥ä¿è¯æœ€å¤§ç¨‹åº¦çš„å®‰å…¨ã€‚

ç¼ºç‚¹ï¼šé«˜qpsä¸‹é”ç«äº‰æ¿€çƒˆï¼Œä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™

#### å¤§é¡¹ç›®ï¼šmqå¼‚æ­¥+ä¹è§‚é”+å¯¹è´¦



### Redisä¸­çš„hash

ä¸èƒ½å¯¹å•ç‹¬çš„ä¸€é¡¹è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œåªèƒ½æ•´ä½“è®¾ç½®è¿‡æœŸæ—¶é—´

æ•°æ®é‡å¤§æ—¶ä¸å¦‚ç®€å•çš„listç´§å‡‘

**é€‚åˆç”¨ Hash å­˜å‚¨çš„æ•°æ®ç‰¹å¾ï¼š**

1. **ä¸€ä¸ªé€»è¾‘å¯¹è±¡åŒ…å«å¤šä¸ªå±æ€§å­—æ®µ**
   ä¾‹å¦‚ï¼šç”¨æˆ·ä¿¡æ¯ï¼ˆname, age, emailï¼‰ã€å•†å“ä¿¡æ¯ï¼ˆtitle, price, stockï¼‰ç­‰ã€‚
2. **éœ€è¦éƒ¨åˆ†æ›´æ–°æˆ–è¯»å–å­—æ®µ**
   æ¯”å¦‚åªæ›´æ–°ç”¨æˆ·çš„é‚®ç®±ï¼Œè€Œä¸å½±å“å…¶ä»–å­—æ®µã€‚
3. **å­—æ®µæ•°é‡é€‚ä¸­ï¼ˆå‡ ååˆ°å‡ ç™¾ä¸ªï¼‰**
   Redis å¯¹å° Hash æœ‰å†…å­˜ä¼˜åŒ–ï¼ˆziplist / listpack ç¼–ç ï¼‰ï¼Œæ¯”å¤šä¸ª String æ›´çœå†…å­˜ã€‚
4. **ä¸éœ€è¦å¯¹å­—æ®µå•ç‹¬è®¾ç½®è¿‡æœŸæ—¶é—´**
   Hash æ•´ä½“å…±ç”¨ä¸€ä¸ª key çš„ TTLï¼Œä¸èƒ½ä¸ºæ¯ä¸ª field å•ç‹¬è®¾è¿‡æœŸã€‚

**æ³¨æ„ï¼**Redisä¸­çš„æ‰€æœ‰**é¡¶å±‚key**éƒ½æ˜¯ä½¿ç”¨**hashdict**æ¥å®ç°æŸ¥æ‰¾çš„ï¼æ‰€ä»¥æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)ï¼Œä¸æ˜¯åªæœ‰hashä½¿ç”¨äº†hashç®—æ³•çš„ï¼



### AOPçš„Aspectä¸­è·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„requestä¸Šä¸‹æ–‡

```java
    private void checkLogin(Boolean checkAdmin) throws BusinessException {
        // è·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„è¯·æ±‚ä¸Šä¸‹æ–‡
        ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
        HttpServletRequest request = attributes.getRequest();
        String token = request.getHeader("token");
        .....
    }
```

1. è·å–è¯·æ±‚ä¸Šä¸‹æ–‡:
   ä½¿ç”¨ RequestContextHolder.getRequestAttributes() è·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„è¯·æ±‚ä¸Šä¸‹æ–‡
   è¿™æ˜¯Springæ¡†æ¶æä¾›çš„æœºåˆ¶ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è®¿é—®å½“å‰HTTPè¯·æ±‚ä¿¡æ¯
2. ç±»å‹è½¬æ¢:
   å°†è¿”å›çš„ RequestAttributes å¼ºåˆ¶è½¬æ¢ä¸º ServletRequestAttributes
   ServletRequestAttributes æ˜¯ä¸“é—¨ç”¨äºServletç¯å¢ƒçš„è¯·æ±‚å±æ€§åŒ…è£…å™¨
3. è·å–è¯·æ±‚å¯¹è±¡:
   è°ƒç”¨ attributes.getRequest() æ–¹æ³•è·å¾—å®é™…çš„ HttpServletRequest å¯¹è±¡
   é€šè¿‡è¿™ä¸ªå¯¹è±¡å¯ä»¥è®¿é—®HTTPè¯·æ±‚çš„å„ç§ä¿¡æ¯ï¼Œå¦‚headersã€parametersç­‰

> ServletRequestAttributes: Servletè¯·æ±‚å±æ€§çš„åŒ…è£…å™¨ï¼Œæä¾›äº†å¯¹Servletç‰¹å®šåŠŸèƒ½çš„è®¿é—®
> HttpServletRequest: å®é™…çš„HTTPè¯·æ±‚å¯¹è±¡ï¼ŒåŒ…å«ï¼š
> 	è¯·æ±‚å¤´ä¿¡æ¯: å¦‚ç”¨äºè®¤è¯çš„ token å¤´éƒ¨
> 	è¯·æ±‚å‚æ•°: æŸ¥è¯¢å‚æ•°å’Œè¡¨å•æ•°æ®
> 	ä¼šè¯ä¿¡æ¯: ç”¨æˆ·sessionæ•°æ®
> 	è¯·æ±‚è·¯å¾„: URLè·¯å¾„å’ŒHTTPæ–¹æ³•
> 	å®¢æˆ·ç«¯ä¿¡æ¯: IPåœ°å€ç­‰



### AOPçš„Aspectè·å–annotationæ³¨è§£çš„å‚æ•°

æ³¨è§£ç»“æ„ï¼š
```java
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface MyLog {
    String value() default "";          // æ³¨è§£å‚æ•°1
    String module() default "DEFAULT";  // æ³¨è§£å‚æ•°2
    boolean record() default true;      // æ³¨è§£å‚æ•°3
}
```

```java
    @MyLog(value = "ç”¨æˆ·ç™»å½•", module = "AUTH", record = true)
    public void login(String username) {
        System.out.println("ç™»å½•: " + username);
    }
```

æœ€ååœ¨aspectä¸­å¯¹å¸¦ä¸Šäº†è¿™ä¸ªæ³¨è§£çš„methodåšåˆ‡é¢ï¼š

```java
@Aspect
@Component
public class LogAspect {

    @Around("@annotation(com.example.annotation.MyLog)")
    public Object log(ProceedingJoinPoint joinPoint) throws Throwable {
        // 1. è·å–ç›®æ ‡æ–¹æ³•
        MethodSignature signature = (MethodSignature) joinPoint.getSignature();
        Method method = signature.getMethod();

        // 2. è·å–æ–¹æ³•ä¸Šçš„ MyLog æ³¨è§£
        MyLog myLog = method.getAnnotation(MyLog.class);
        if (myLog != null) {
            // 3. è¯»å–æ³¨è§£å‚æ•°
            String value = myLog.value();
            String module = myLog.module();
            boolean record = myLog.record();

            System.out.println("æ³¨è§£å‚æ•° - value: " + value);
            System.out.println("æ³¨è§£å‚æ•° - module: " + module);
            System.out.println("æ³¨è§£å‚æ•° - record: " + record);

            if (record) {
                // æ‰§è¡Œæ—¥å¿—è®°å½•ç­‰é€»è¾‘
            }
        }

        return joinPoint.proceed();
    }
}
```

å¯ä»¥çœ‹åˆ°æˆ‘ä»¬é€šè¿‡pjpæ‹¿åˆ°å¯¹åº”çš„**methodç­¾å**åï¼Œé€šè¿‡ç­¾åæ‹¿åˆ°**method**ï¼Œå†é€šè¿‡è¿™ä¸ªæ‹¿åˆ°**æŒ‡å®š**çš„æ³¨è§£ï¼ˆè¿™é‡Œå¿…é¡»ç»™å‡ºæ³¨è§£ç±»å‹ï¼Œå› ä¸ºä¸€ä¸ªmethodå¯èƒ½æœ‰å¤šä¸ªæ³¨è§£ï¼‰éšåå°±å¯ä»¥é€šè¿‡æ³¨è§£å¯¹è±¡è·å–åˆ°èµ‹ç»™å…¶çš„å‚æ•°äº†ã€‚
