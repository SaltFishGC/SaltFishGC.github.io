import{_ as t,c as l,e as s,a,b as p,d as i,r as c,o}from"./app-Cm4IjFjh.js";const r={},d={href:"https://nacos.io/blog/faq/nacos-user-question-history11838/",target:"_blank",rel:"noopener noreferrer"};function u(k,n){const e=c("ExternalLinkIcon");return o(),l("div",null,[n[1]||(n[1]=s('<h2 id="注册中心" tabindex="-1"><a class="header-anchor" href="#注册中心"><span>注册中心</span></a></h2><p>微服务架构中，<strong>注册中心（Service Registry）</strong> 是一个核心组件，用于实现服务的<strong>自动注册与发现</strong>。它的基本原理可以概括为：<strong>服务提供者在启动时向注册中心注册自身信息，服务消费者通过注册中心查询并调用所需服务</strong>。</p><p>下面从几个关键方面详细讲解注册中心的原理：</p><hr><h3 id="_1-核心功能" tabindex="-1"><a class="header-anchor" href="#_1-核心功能"><span>1. <strong>核心功能</strong></span></a></h3><p>注册中心主要有以下三大功能：</p><ul><li><strong>服务注册（Registration）</strong> 微服务实例启动后，将自己的元数据（如服务名、IP地址、端口、健康状态、版本号等）上报到注册中心。</li><li><strong>服务发现（Discovery）</strong> 消费者需要调用某个服务时，向注册中心查询该服务当前可用的实例列表，然后选择一个（或多个）进行调用。</li><li><strong>健康检查（Health Check）</strong> 注册中心会定期检测已注册服务的健康状态，剔除不可用的实例，确保服务列表的实时性和可靠性。</li></ul><hr><h3 id="_2-工作流程" tabindex="-1"><a class="header-anchor" href="#_2-工作流程"><span>2. <strong>工作流程</strong></span></a></h3><p>以一次典型的调用为例：</p><ol><li><strong>服务提供者 A 启动</strong> → 向注册中心注册自己（如 <code>order-service: 192.168.1.10:8080</code>）。</li><li><strong>服务消费者 B 启动</strong> → 从注册中心拉取 <code>order-service</code> 的可用实例列表。</li><li><strong>B 调用 A</strong> → 根据负载均衡策略（如轮询、随机、权重等）选择一个实例发起请求。</li><li><strong>A 下线或宕机</strong> → 注册中心通过心跳机制或主动探测发现异常，将其从服务列表中移除。</li><li><strong>B 下次调用时</strong> → 不再使用已下线的实例，保证调用成功率。</li></ol><hr><h3 id="_3-实现机制" tabindex="-1"><a class="header-anchor" href="#_3-实现机制"><span>3. <strong>实现机制</strong></span></a></h3><h4 id="_1-心跳机制-heartbeat" tabindex="-1"><a class="header-anchor" href="#_1-心跳机制-heartbeat"><span>（1）心跳机制（Heartbeat）</span></a></h4><ul><li>服务实例定期（如每5秒）向注册中心发送心跳，表明自己“还活着”。</li><li>如果注册中心在一定时间内（如15秒）未收到心跳，则认为该实例失效，将其剔除。</li></ul><h4 id="_2-服务列表缓存" tabindex="-1"><a class="header-anchor" href="#_2-服务列表缓存"><span>（2）服务列表缓存</span></a></h4><ul><li>为提高性能和降低对注册中心的依赖，客户端通常会<strong>本地缓存服务列表</strong>。</li><li>注册中心支持<strong>推送变更</strong>（如通过长连接、WebSocket）或客户端<strong>定时拉取更新</strong>。</li></ul><h4 id="_3-一致性模型" tabindex="-1"><a class="header-anchor" href="#_3-一致性模型"><span>（3）一致性模型</span></a></h4><ul><li>有些注册中心（如 Eureka）采用 <strong>AP 模型</strong>（高可用、最终一致），适合云环境。</li><li>有些（如 ZooKeeper、etcd）采用 <strong>CP 模型</strong>（强一致），适合对一致性要求高的场景。</li></ul><hr><h3 id="_4-常见注册中心对比" tabindex="-1"><a class="header-anchor" href="#_4-常见注册中心对比"><span>4. <strong>常见注册中心对比</strong></span></a></h3><table><thead><tr><th>注册中心</th><th>一致性模型</th><th>健康检查方式</th><th>特点</th></tr></thead><tbody><tr><td><strong>Eureka</strong></td><td>AP</td><td>客户端心跳</td><td>Netflix 开源，Spring Cloud 默认集成</td></tr><tr><td><strong>Consul</strong></td><td>CP（可配）</td><td>主动探测 + 心跳</td><td>支持多数据中心、内置 UI</td></tr><tr><td><strong>ZooKeeper</strong></td><td>CP</td><td>临时节点 + Session</td><td>强一致，但对网络分区敏感</td></tr><tr><td><strong>Nacos</strong></td><td>AP/CP 可切换</td><td>心跳 + 主动探测</td><td>阿里开源，支持配置中心 + 服务发现</td></tr></tbody></table><hr><h3 id="_5-为什么需要注册中心" tabindex="-1"><a class="header-anchor" href="#_5-为什么需要注册中心"><span>5. <strong>为什么需要注册中心？</strong></span></a></h3><p>在单体架构中，服务调用是固定的；但在微服务中：</p><ul><li>服务实例动态扩缩容；</li><li>IP 和端口不固定；</li><li>需要负载均衡和故障转移。</li></ul><p>注册中心解耦了服务提供者和消费者，使系统具备<strong>弹性、可扩展性和自愈能力</strong>。</p><hr><h2 id="nacos" tabindex="-1"><a class="header-anchor" href="#nacos"><span>Nacos</span></a></h2><h3 id="服务器搭建与配置" tabindex="-1"><a class="header-anchor" href="#服务器搭建与配置"><span>服务器搭建与配置</span></a></h3><p>Nacos不仅支持注册中心，同时还配备了配置中心的功能，我们现在来通过docker部署一下：</p><p>首先准备nacos的数据源，可以是mysql：</p>',32)),a("p",null,[a("a",d,[n[0]||(n[0]=p("nacos配置mysql数据库 | Nacos 官网",-1)),i(e)])]),n[2]||(n[2]=s(`<p>获取镜像：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker</span> pull nacos/nacos-server</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p>注意版本！server和client的版本也需要一定对应关系！</p><p>如果下载过慢也可以直接去下载tar包然后<code>docker load</code>：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker</span> load <span class="token parameter variable">-i</span> nacos.tar</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></blockquote><p>同时我们还需要完成nacos的配置：</p><div class="language-env line-numbers-mode" data-highlighter="prismjs" data-ext="env" data-title="env"><pre><code><span class="line">PREFER_HOST_MODE=hostname</span>
<span class="line">MODE=standalone</span>
<span class="line">SPRING_DATASOURCE_PLATFORM=mysql</span>
<span class="line">MYSQL_SERVICE_HOST=192.168.0.200</span>
<span class="line">MYSQL_SERVICE_DB_NAME=nacos</span>
<span class="line">MYSQL_SERVICE_PORT=3306</span>
<span class="line">MYSQL_SERVICE_USER=root</span>
<span class="line">MYSQL_SERVICE_PASSWORD=123</span>
<span class="line">MYSQL_SERVICE_DB_PARAM=characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useSSL=false&amp;allowPublicKeyRetrieval=true&amp;serverTimezone=Asia/Shanghai</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>将这个文件挂载到我们生成的容器中去：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\\</span></span>
<span class="line"><span class="token parameter variable">--name</span> nacos <span class="token punctuation">\\</span></span>
<span class="line">--env-file ./nacos/custom.env <span class="token punctuation">\\</span></span>
<span class="line"><span class="token parameter variable">-p</span> <span class="token number">8848</span>:8848 <span class="token punctuation">\\</span></span>
<span class="line"><span class="token parameter variable">-p</span> <span class="token number">9848</span>:9848 <span class="token punctuation">\\</span></span>
<span class="line"><span class="token parameter variable">-p</span> <span class="token number">9849</span>:9849 <span class="token punctuation">\\</span></span>
<span class="line"><span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token punctuation">\\</span></span>
<span class="line">nacos/nacos-server:v2.1.0-slim</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>完成之后我们就可以访问nacos的可视化页面了：http://192.168.0.200:8848/nacos/#/login</p><h3 id="客户端搭建与配置" tabindex="-1"><a class="header-anchor" href="#客户端搭建与配置"><span>客户端搭建与配置</span></a></h3><p>首先引入依赖：</p><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token comment">&lt;!--nacos 服务注册发现--&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后完成yml配置：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">application</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> item<span class="token punctuation">-</span>service <span class="token comment"># 服务名称</span></span>
<span class="line">  <span class="token key atrule">cloud</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">nacos</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.0.200<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment"># nacos地址</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在我们启动项目就可以在nacos中发现该项目了。</p><blockquote><p>注意不同版本的配置写法可能会有所不同！</p></blockquote><p>在引入了发现中心之后，接入发现中心的服务不仅可以被其他接入nacos的服务发现并调用，也可以去发现其他接入nacos的服务并调用他们：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">DiscoveryClient</span> discoveryClient<span class="token punctuation">;</span> <span class="token comment">// lombok @RequiredArgsConstructor构造器注入</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 2.1 获取商品服务实例</span></span>
<span class="line"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceInstance</span><span class="token punctuation">&gt;</span></span> instances <span class="token operator">=</span> discoveryClient<span class="token punctuation">.</span><span class="token function">getInstances</span><span class="token punctuation">(</span><span class="token string">&quot;item-service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 2.2 随机获取一个</span></span>
<span class="line"><span class="token class-name">ServiceInstance</span> instance <span class="token operator">=</span> instances<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">RandomUtil</span><span class="token punctuation">.</span><span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> instances<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 2.3 通过发Request获取商品信息</span></span>
<span class="line"><span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">&quot;http://&quot;</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> instance<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;/item/queryItemByIds&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当然这个负载均衡方式和拿ip去手动发Request还是有点疯狂原始人了，我们其实可以使用更加好的方式来完成服务之间的相互调用：<code>Openfeign</code>提供了一套和Cloud高度契合的模式来完成对于其他服务的调用。</p>`,18))])}const v=t(r,[["render",u]]),h=JSON.parse('{"path":"/docs/heimashangcheng/weifuwu/3.fuwuguanli（zhucezhongxinNacos）.html","title":"服务管理","lang":"en-US","frontmatter":{"title":"服务管理","date":"2026-2-1"},"headers":[{"level":2,"title":"注册中心","slug":"注册中心","link":"#注册中心","children":[{"level":3,"title":"1. 核心功能","slug":"_1-核心功能","link":"#_1-核心功能","children":[]},{"level":3,"title":"2. 工作流程","slug":"_2-工作流程","link":"#_2-工作流程","children":[]},{"level":3,"title":"3. 实现机制","slug":"_3-实现机制","link":"#_3-实现机制","children":[]},{"level":3,"title":"4. 常见注册中心对比","slug":"_4-常见注册中心对比","link":"#_4-常见注册中心对比","children":[]},{"level":3,"title":"5. 为什么需要注册中心？","slug":"_5-为什么需要注册中心","link":"#_5-为什么需要注册中心","children":[]}]},{"level":2,"title":"Nacos","slug":"nacos","link":"#nacos","children":[{"level":3,"title":"服务器搭建与配置","slug":"服务器搭建与配置","link":"#服务器搭建与配置","children":[]},{"level":3,"title":"客户端搭建与配置","slug":"客户端搭建与配置","link":"#客户端搭建与配置","children":[]}]}],"git":{"createdTime":1771237270000,"updatedTime":1771237270000,"contributors":[{"name":"SaltFishGC","email":"130335482+SaltFishGC@users.noreply.github.com","commits":1}]},"filePathRelative":"docs/黑马商城/微服务/3.服务管理（注册中心Nacos）.md"}');export{v as comp,h as data};
