import{_ as s,c as a,e as t,o as p}from"./app-Cm4IjFjh.js";const e={};function o(l,n){return p(),a("div",null,[...n[0]||(n[0]=[t(`<p>æˆ‘ä»¬è™½ç„¶å¯ä»¥ä½¿ç”¨æ•°æ®åº“æ¥å®ç°å¯¹ç”¨æˆ·ç­¾åˆ°æ•°æ®çš„è®°å½•ï¼Œä½†æ˜¯è¿™æ ·ä¸€æ¥æ•°æ®é‡å°±ä¼šè¾¾åˆ°ææ€–çš„é‡çº§ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å¯ä»¥ä½¿ç”¨å…¶ä»–æ–¹å¼æ¥å­˜å‚¨ç”¨æˆ·çš„ç­¾åˆ°æƒ…å†µå‘¢ï¼Ÿ</p><p>å‡å¦‚æˆ‘ä»¬ç”¨0æ¥ä»£è¡¨æœªç­¾åˆ°ï¼Œ1ä»£è¡¨ç­¾åˆ°ï¼Œé‚£ä¹ˆ30/31ä½bitï¼Œ4ä¸ªå­—èŠ‚å°±å¯ä»¥è®°å½•æŸä¸€ç”¨æˆ·æŸä¸€æœˆçš„ç­¾åˆ°æƒ…å†µï¼Œè€Œå†å¤šå‡ ä½æ¥è¡¨ç¤ºå¹´ä»½ä»¥åŠæœˆä»½å³å¯è¡¨ç¤ºå®ç°è®°å½•è¯¥å¹´ä¸­è¯¥æœˆçš„ç­¾åˆ°æƒ…å†µ</p><h2 id="redisä¸­çš„bitmap" tabindex="-1"><a class="header-anchor" href="#redisä¸­çš„bitmap"><span>Redisä¸­çš„BitMap</span></a></h2><p>Redis ä¸­çš„ <strong>Bitmapï¼ˆä½å›¾ï¼‰</strong> å¹¶ä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®ç±»å‹ï¼Œè€Œæ˜¯åŸºäº <strong>Stringï¼ˆå­—ç¬¦ä¸²ï¼‰</strong> ç±»å‹å®ç°çš„ä¸€ç§<strong>é«˜æ•ˆå­˜å‚¨å¸ƒå°”å€¼ï¼ˆ0/1ï¼‰</strong> çš„æ•°æ®ç»“æ„ã€‚å®ƒåˆ©ç”¨æ¯ä¸ªå­—èŠ‚çš„ 8 ä¸ª bit ä½æ¥è¡¨ç¤ºçŠ¶æ€ï¼Œ<strong>æå¤§èŠ‚çœå†…å­˜</strong>ï¼Œéå¸¸é€‚åˆå¤„ç†<strong>æµ·é‡äºŒå€¼çŠ¶æ€</strong>åœºæ™¯ã€‚è¡¨æ ¼</p><table><thead><tr><th style="text-align:left;">å‘½ä»¤</th><th style="text-align:left;">åŠŸèƒ½</th><th style="text-align:left;">ç¤ºä¾‹</th></tr></thead><tbody><tr><td style="text-align:left;"><strong><code>SETBIT key offset value</code></strong></td><td style="text-align:left;">è®¾ç½®æŸä¸€ä½çš„å€¼ï¼ˆ0 æˆ– 1ï¼‰</td><td style="text-align:left;"><code>SETBIT user:sign:20240601 123 1</code></td></tr><tr><td style="text-align:left;"><strong><code>GETBIT key offset value</code></strong></td><td style="text-align:left;">è·å–æŸä¸€ä½çš„å€¼</td><td style="text-align:left;"><code>GETBIT user:sign:20240601 123</code> â†’ è¿”å› <code>1</code></td></tr><tr><td style="text-align:left;"><strong><code>BITCOUNT key [start end]</code></strong></td><td style="text-align:left;">ç»Ÿè®¡ 1 çš„ä¸ªæ•°ï¼ˆå¯é€‰å­—èŠ‚èŒƒå›´ï¼‰</td><td style="text-align:left;"><code>BITCOUNT user:sign:20240601</code></td></tr><tr><td style="text-align:left;"><strong><code>BITPOS key bit [start end]</code></strong></td><td style="text-align:left;">æŸ¥æ‰¾ç¬¬ä¸€ä¸ªæŒ‡å®š bitï¼ˆ0 æˆ– 1ï¼‰çš„ä½ç½®</td><td style="text-align:left;"><code>BITPOS user:sign:20240601 0</code> â†’ æ‰¾ç¬¬ä¸€ä¸ªæœªç­¾åˆ°ç”¨æˆ·</td></tr><tr><td style="text-align:left;"><strong><code>BITOP operation destkey key1 key2 ...</code></strong></td><td style="text-align:left;">å¯¹å¤šä¸ª Bitmap åšä½è¿ç®—ï¼ˆAND/OR/XOR/NOTï¼‰</td><td style="text-align:left;"><code>BITOP AND result k1 k2</code></td></tr><tr><td style="text-align:left;"><strong><code>BITFIELD key [GET type offset] [SET type offset value] [INCRBY type offset increment] [OVERFLOW WRAP SAT FAIL]</code></strong></td><td style="text-align:left;">è·å–/è®¾ç½®æŸä¸€æ®µçš„å€¼</td><td style="text-align:left;"><code>BITFIELD user:1001 SET u2 9 0</code></td></tr></tbody></table><p><strong>åº”ç”¨åœºæ™¯ï¼š</strong></p><p><strong>âœ… 1. ç”¨æˆ·ç­¾åˆ° / æ‰“å¡ç³»ç»Ÿ</strong></p><ul><li>æ¯å¤©ä¸€ä¸ª keyï¼š<code>sign:20240601</code></li><li>ç”¨æˆ· ID ä½œä¸º offset</li><li>ç­¾åˆ°ï¼š<code>SETBIT sign:20240601 1001 1</code></li><li>æŸ¥æ˜¯å¦ç­¾åˆ°ï¼š<code>GETBIT sign:20240601 1001</code></li><li>ç»Ÿè®¡å½“æ—¥ç­¾åˆ°äººæ•°ï¼š<code>BITCOUNT sign:20240601</code></li></ul><blockquote><p>ğŸ’¡ <strong>å†…å­˜å¯¹æ¯”</strong>ï¼š</p><ul><li>100 ä¸‡ç”¨æˆ·ç­¾åˆ°ï¼š <ul><li>ç”¨ Set å­˜ç”¨æˆ· ID â†’ çº¦ 50ï½100 MB</li><li>ç”¨ Bitmap â†’ ä»…éœ€ <strong>1000000 / 8 / 1024 â‰ˆ 122 KB</strong></li></ul></li></ul></blockquote><hr><p><strong>âœ… 2. æ´»è·ƒç”¨æˆ·ç»Ÿè®¡ï¼ˆDAU/MAUï¼‰</strong></p><ul><li>æ¯å¤©ç”Ÿæˆä¸€ä¸ª Bitmapï¼ˆè®°å½•å½“å¤©æ´»è·ƒç”¨æˆ·ï¼‰</li><li>è®¡ç®—å‘¨æ´»ï¼šå¯¹ 7 å¤© Bitmap åš <code>BITOP OR week_active day1 day2 ... day7</code></li><li><code>BITCOUNT week_active</code> â†’ å‘¨æ´»äººæ•°</li></ul><blockquote><p>ğŸ” æ”¯æŒä»»æ„æ—¶é—´æ®µç»„åˆï¼ˆå¦‚â€œå·¥ä½œæ—¥æ´»è·ƒâ€ã€â€œè¿ç»­æ´»è·ƒâ€ç­‰ï¼‰</p></blockquote><hr><p><strong>âœ… 3. å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰åº•å±‚å®ç°</strong></p><ul><li>Bloom Filter éœ€è¦å¤šä¸ª hash å‡½æ•°æ˜ å°„åˆ° bit ä½</li><li>Redis Bitmap å¯ä½œä¸ºå…¶å­˜å‚¨åç«¯ï¼ˆä½†å®˜æ–¹æ¨èç”¨ <strong>RedisBloom æ¨¡å—</strong>ï¼‰</li></ul><hr><p><strong>âœ… 4. æƒé™æ§åˆ¶ / æ ‡ç­¾ç³»ç»Ÿ</strong></p><ul><li>æ¯ä¸ªæƒé™å¯¹åº”ä¸€ä¸ª bit ä½</li><li>ç”¨æˆ·æƒé™ = ä¸€ä¸ª Bitmap</li><li>åˆ¤æ–­æ˜¯å¦æœ‰æƒé™ Aï¼ˆç¬¬ 3 ä½ï¼‰ï¼š<code>GETBIT user:perm:1001 3</code></li></ul><h2 id="åœ¨ä¸šåŠ¡ä¸­å€ŸåŠ©bitmapå®ç°ç­¾åˆ°" tabindex="-1"><a class="header-anchor" href="#åœ¨ä¸šåŠ¡ä¸­å€ŸåŠ©bitmapå®ç°ç­¾åˆ°"><span>åœ¨ä¸šåŠ¡ä¸­å€ŸåŠ©bitmapå®ç°ç­¾åˆ°</span></a></h2><p>ç­¾åˆ°æœ‰ä¸¤ç§åšæ³•ï¼Œå¦‚æœ<strong>äººæ•°å¯æ§</strong>ï¼Œä¸”æ›´åŠ éœ€è¦æ£€æŸ¥å‘˜å·¥/ç”¨æˆ·<strong>æ•´ä½“</strong>ç­¾åˆ°æƒ…å†µï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†<strong>keyè®¾ç½®ä¸ºyyyyMMdd</strong>è¡¨ç¤ºæ¯ä¸€å¤©ï¼Œè€Œå†…éƒ¨çš„value bitmapçš„æ¯ä¸€ä½è¡¨ç¤º<strong>å¯¹åº”ç¼–å·å‘˜å·¥/ç”¨æˆ·</strong>çš„ç­¾åˆ°æƒ…å†µã€‚</p><p>å¦‚æœ<strong>äººæ•°æ¯”è¾ƒå¤š</strong>ï¼Œä¸”ä¸šåŠ¡æ›´åŠ æ³¨é‡ä¸æ¯ä¸€ä½ç”¨æˆ·<strong>è‡ªå·±</strong>çš„ç­¾åˆ°æƒ…å†µï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†<strong>keyè®¾ç½®ä¸ºyyyyMM + userid</strong>æ¥è¡¨ç¤ºæŸä¸€ç”¨æˆ·çš„ä¸€ä¸ªæœˆï¼Œå†…éƒ¨value bitmapçš„æ¯ä¸€ä½è¡¨ç¤º<strong>è¯¥ç”¨æˆ·è¯¥æœˆä»½</strong>çš„ç­¾åˆ°æƒ…å†µã€‚</p><blockquote><p>Redisçš„bitmapè‡ªåŠ¨ä»¥<strong>å­—èŠ‚</strong>ä¸ºå•ä½æ‰©å®¹ï¼Œå½“æˆ‘ä»¬setä¸€ä¸ªkeyçš„ç´¢å¼•ä¸º6çš„ç‚¹ä½ä¸º1/0æ—¶ï¼Œä¼šå¯¹ä»å‰å¾€åæ•°7å·ä½ç½®æ“ä½œï¼ˆç´¢å¼•ä»0å¼€å§‹ï¼Œluaä»1å¼€å§‹ï¼‰ï¼Œè¿™æ—¶ä¼šè‡ªåŠ¨ç”³è¯·ä¸€ä¸ªå­—èŠ‚ï¼ˆ8bitï¼‰çš„ç©ºé—´ç”¨äºå­˜å‚¨è¯¥bitmapï¼›è‹¥æ˜¯æ“ä½œç¬¬12å·ç‚¹ä½ï¼Œåˆ™ä¼šæ‰©å®¹è‡³ä¸¤ä¸ªå­—èŠ‚ä»¥å­˜å‚¨è¯¥bitmapï¼›</p><p>æ‰€ä»¥ä¸å¿…æ‹…å¿ƒå…¶å ç”¨ç©ºé—´ä¸å¥½æ§åˆ¶çš„é—®é¢˜ï¼Œå…¶çš„ç”³è¯·ç©ºé—´æ˜¯åŠ¨æ€çš„ï¼ˆå°½å¯èƒ½å°ï¼‰ã€‚</p></blockquote><p>è€Œç›®å‰çš„ä¸šåŠ¡æ›´å€¾å‘äºç»Ÿè®¡æ¯ä¸ªç”¨æˆ·è‡ªå·±çš„ç­¾åˆ°æƒ…å†µï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å°†keyè®¾ç½®ä¸º suffix + userid + yyyyMM çš„å½¢å¼ï¼Œvalueçš„bitmapç”¨32ä½bitå­˜å‚¨è¯¥æœˆçš„ç­¾åˆ°æƒ…å†µï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">UserDTO</span> user <span class="token operator">=</span> <span class="token class-name">UserHolder</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token class-name">RedisConstants</span><span class="token punctuation">.</span><span class="token constant">USER_SIGN_KEY</span> <span class="token operator">+</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// è·å–å½“å‰æ—¶é—´ï¼Œè½¬åŒ–ä¸ºæ—¥æœŸ</span></span>
<span class="line">    <span class="token class-name">LocalDateTime</span> now <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span> suffix <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">&quot;:yyyyMM&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    key <span class="token operator">=</span> key <span class="token operator">+</span> suffix<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// è·å–å½“å‰åœ¨æœˆä»½ä¸­çš„ç¬¬å‡ å¤©</span></span>
<span class="line">    <span class="token keyword">int</span> day <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">getDayOfMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// è®¾ç½®ç”¨æˆ·ç­¾åˆ°ï¼Œæ³¨æ„ç´¢å¼•ä»0å¼€å§‹ setbit key offset value</span></span>
<span class="line">    stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setBit</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> day <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç­¾åˆ°ç»Ÿè®¡" tabindex="-1"><a class="header-anchor" href="#ç­¾åˆ°ç»Ÿè®¡"><span>ç­¾åˆ°ç»Ÿè®¡</span></a></h2><p>**éœ€æ±‚ï¼š**ç»Ÿè®¡æœ¬æœˆè¿ç»­ç­¾åˆ°å¤©æ•°</p><p>æˆ‘ä»¬å¯ä»¥å€ŸåŠ©Redisçš„bitmapæä¾›çš„ç»Ÿè®¡æ¥å£ï¼Œé€†åºç»Ÿè®¡æŸä¸€ç´¢å¼•å‘å‰çš„è¿ç»­å€¼ä¸º0/1çš„æ¬¡æ•°ï¼Œå½“è·å–åˆ°æœªç­¾åˆ°çš„æ ‡è¯†æ—¶åœæ­¢è®¡æ•°ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">signCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">UserDTO</span> user <span class="token operator">=</span> <span class="token class-name">UserHolder</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token class-name">RedisConstants</span><span class="token punctuation">.</span><span class="token constant">USER_SIGN_KEY</span> <span class="token operator">+</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// è·å–å½“å‰æ—¶é—´ï¼Œè½¬åŒ–ä¸ºæ—¥æœŸ</span></span>
<span class="line">    <span class="token class-name">LocalDateTime</span> now <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">String</span> suffix <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">&quot;:yyyyMM&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    key <span class="token operator">=</span> key <span class="token operator">+</span> suffix<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// è·å–å½“å‰åœ¨æœˆä»½ä¸­çš„ç¬¬å‡ å¤©</span></span>
<span class="line">    <span class="token keyword">int</span> day <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">getDayOfMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// è·å–æœ¬æœˆçš„ç­¾åˆ°è®°å½• bitfield key get i</span></span>
<span class="line">    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bitField</span><span class="token punctuation">(</span></span>
<span class="line">            key<span class="token punctuation">,</span></span>
<span class="line">            <span class="token class-name">BitFieldSubCommands</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">                    <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">BitFieldSubCommands<span class="token punctuation">.</span>BitFieldType</span><span class="token punctuation">.</span><span class="token function">unsigned</span><span class="token punctuation">(</span>day<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">valueAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// åˆ¤æ–­ç»“æœ</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> result<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token class-name">Long</span> num <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> num <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// å¾ªç¯éå†</span></span>
<span class="line">    <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// ä¸è¿ç®—ï¼Œå’Œ1ä¸è¿ç®—åï¼Œå‰å¤šä¸ªbitä½éƒ½è¢«ç½®0ï¼Œåªä½™æœ€åä¸€ä¸ªbitä½ï¼Œä¸º1ï¼Œåˆ™countåŠ 1</span></span>
<span class="line">    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>num <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        count<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// &gt;&gt; ä¸ºå¸¦ç¬¦å·å³ç§»ï¼ˆç®—æœ¯å³ç§»ï¼‰é«˜ä½è¡¥ç¬¦å·ä½</span></span>
<span class="line">        <span class="token comment">// &gt;&gt;&gt; æ— ç¬¦å·å³ç§»ï¼ˆé€»è¾‘å³ç§»ï¼‰é«˜ä½è¡¥0</span></span>
<span class="line">        num <span class="token operator">=</span> num <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bitField</span><span class="token punctuation">(</span></span>
<span class="line">    key<span class="token punctuation">,</span></span>
<span class="line">    <span class="token class-name">BitFieldSubCommands</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">        <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">BitFieldSubCommands<span class="token punctuation">.</span>BitFieldType</span><span class="token punctuation">.</span><span class="token function">unsigned</span><span class="token punctuation">(</span>day<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">valueAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è¿”å›å€¼ç±»å‹</strong> è¿”å›ç±»å‹: <code>List&lt;Long&gt;</code> å®é™…å†…å®¹: åŒ…å«ä¸€ä¸ª Long å…ƒç´ çš„åˆ—è¡¨ï¼Œä»£è¡¨æŒ‡å®šä½ç½®çš„ä½åŸŸå€¼</p><p><strong>å‘½ä»¤è§£æ</strong><code>BitFieldSubCommands.create()</code> åˆ›å»ºä¸€ä¸ª Redis BitField å‘½ä»¤æ„å»ºå™¨</p><p><code>get(BitFieldType.unsigned(day))</code> unsigned(day): æŒ‡å®šè·å–æ— ç¬¦å·æ•´æ•°ï¼Œå®½åº¦ä¸º day ä½ day æ¥è‡ª now.getDayOfMonth()ï¼Œè¡¨ç¤ºå½“å‰æœˆä»½çš„å¤©æ•° ä¾‹å¦‚ï¼šå¦‚æœæ˜¯15å·ï¼Œåˆ™è·å–15ä½çš„æ— ç¬¦å·æ•´æ•°</p><p><code>valueAt(0)</code> ä»åç§»é‡0å¼€å§‹è¯»å–ä½å€¼ ä»æœ€å·¦è¾¹çš„ä½å¼€å§‹è·å–æŒ‡å®šæ•°é‡çš„ä½ï¼Œå³ä»0~è¾“å…¥dayæ—¥æœŸ-1</p><p><strong>å®é™…ä½œç”¨</strong> è·å–æœ¬æœˆç­¾åˆ°è®°å½•: ä»Redisä¸­è·å–å­˜å‚¨çš„æœ¬æœˆç­¾åˆ°bitmap ä½å›¾è§£ç : å°†è¿ç»­çš„ç­¾åˆ°ä½è½¬æ¢ä¸ºä¸€ä¸ªæ•´æ•° è¿ç»­ç­¾åˆ°è®¡ç®—: é€šè¿‡ (num &amp; 1) å’Œ num &gt;&gt;&gt; 1 æ“ä½œé€ä½æ£€æŸ¥è¿ç»­ç­¾åˆ°æƒ…å†µ</p></blockquote><blockquote><p>å‡å¦‚éœ€è¦ç»Ÿè®¡<strong>è·¨æœˆ</strong>è¿ç»­ç­¾åˆ°å‘¢ï¼Ÿ</p><p>å…¶å®ä¹Ÿå¯ä»¥è®°å½•<strong>ä¸Šæ¬¡ç­¾åˆ°æ—¶é—´</strong>å’Œ<strong>è¿ç»­ç­¾åˆ°æ¬¡æ•°</strong>ï¼Œå‡å¦‚ç­¾åˆ°åæ£€æµ‹åˆ°ä¸Šæ¬¡ç­¾åˆ°æ—¶é—´æ˜¯<strong>å‰ä¸€å¤©</strong>ï¼Œé‚£ä¹ˆå°±<strong>æ¬¡æ•°+1</strong>åŒæ—¶åˆ·æ–°<strong>ä¸Šæ¬¡ç­¾åˆ°æ—¶é—´</strong>ï¼›å‡å¦‚æ£€æµ‹åˆ°ä¸Šæ¬¡ç­¾åˆ°æ—¶é—´ä¸æ˜¯ä¸Šä¸€å¤©ï¼Œé‚£ä¹ˆæ¬¡æ•°å½’é›¶/å˜ä¸º1ã€‚ï¼ˆä»Šæ—¥ç­¾è¿‡ä¸èƒ½å†ç­¾ï¼‰</p></blockquote>`,31)])])}const i=s(e,[["render",o]]),u=JSON.parse('{"path":"/docs/heimadianping/yewusheji/10.yonghuqiandao.html","title":"ç”¨æˆ·ç­¾åˆ°","lang":"en-US","frontmatter":{"title":"ç”¨æˆ·ç­¾åˆ°","date":"2025-1-23"},"headers":[{"level":2,"title":"Redisä¸­çš„BitMap","slug":"redisä¸­çš„bitmap","link":"#redisä¸­çš„bitmap","children":[]},{"level":2,"title":"åœ¨ä¸šåŠ¡ä¸­å€ŸåŠ©bitmapå®ç°ç­¾åˆ°","slug":"åœ¨ä¸šåŠ¡ä¸­å€ŸåŠ©bitmapå®ç°ç­¾åˆ°","link":"#åœ¨ä¸šåŠ¡ä¸­å€ŸåŠ©bitmapå®ç°ç­¾åˆ°","children":[]},{"level":2,"title":"ç­¾åˆ°ç»Ÿè®¡","slug":"ç­¾åˆ°ç»Ÿè®¡","link":"#ç­¾åˆ°ç»Ÿè®¡","children":[]}],"git":{"createdTime":1771237270000,"updatedTime":1771237270000,"contributors":[{"name":"SaltFishGC","email":"130335482+SaltFishGC@users.noreply.github.com","commits":1}]},"filePathRelative":"docs/é»‘é©¬ç‚¹è¯„/ä¸šåŠ¡è®¾è®¡/10.ç”¨æˆ·ç­¾åˆ°.md"}');export{i as comp,u as data};
