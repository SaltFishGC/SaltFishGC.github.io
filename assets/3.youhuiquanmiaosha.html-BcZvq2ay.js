import{ar as t,as as e,ax as s,aw as p,ay as c,at as o}from"./app-DXmPnZac.js";const l={};function i(u,n){const a=c("MermaidDiagram");return o(),e("div",null,[n[0]||(n[0]=s(`<h2 id="å…¨å±€å”¯ä¸€id" tabindex="-1"><a class="header-anchor" href="#å…¨å±€å”¯ä¸€id"><span>å…¨å±€å”¯ä¸€ID</span></a></h2><p>ç®€å•ä¸šåŠ¡ä¸‹æˆ‘ä»¬ä¼šä½¿ç”¨è‡ªå¢é•¿IDæ¥ç¡®ä¿å…¶çš„å”¯ä¸€æ€§ï¼Œä½†æ˜¯è¿™æ ·çš„æ–¹å¼å­˜åœ¨ä¸€å®šé—®é¢˜ï¼š</p><ul><li>idè§„å¾‹è¿‡äºæ˜æ˜¾ï¼Œå®¹æ˜“ä»ä¸­æš´éœ²ä¿¡æ¯</li><li>æ•°æ®é‡å¤ªå¤§ï¼Œå³ä¾¿æ˜¯å¤šä½æ•°å­—ä¹Ÿæ— æ³•å­˜å‚¨</li></ul><p>è€ŒUUidåˆå­˜åœ¨ä¸ç¡®ä¿å”¯ä¸€æ€§çš„é—®é¢˜</p><p>é‚£ä¹ˆæˆ‘ä»¬åœ¨æ€è€ƒä¸€ä¸‹å…¨å±€idçš„å‡ ä¸ªè¦æ±‚</p><ul><li><strong>å”¯ä¸€æ€§</strong>ï¼šä¸å¯é‡å¤</li><li><strong>é«˜å¯ç”¨</strong>ï¼šå¤šæœåŠ¡å‡å¯ç”¨ä¸”å¯é </li><li><strong>é«˜æ€§èƒ½</strong>ï¼šç”Ÿæˆé€Ÿåº¦å¿«</li><li><strong>é€’å¢æ€§</strong>ï¼šæœ‰åˆ©äºæ•°æ®åº“æ„å»ºç´¢å¼•</li><li><strong>å®‰å…¨æ€§</strong>ï¼šå°½é‡é¿å…æš´éœ²ä¿¡æ¯</li></ul><p>è€ŒåŸºäºä»¥ä¸Šè¦æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨Rediså®ç°ä¸€ä¸ªå…¨å±€IDç”Ÿæˆå™¨ï¼Œæ¯”å¦‚ç”¨æ—¶é—´æˆ³ä»¥åŠåºåˆ—å·<strong>æ‹¼æ¥</strong>ç”ŸæˆIDå®ç°å”¯ä¸€æ€§ï¼ˆæ¯”å¦‚ç”¨longï¼Œ8å­—èŠ‚ï¼Œ64ä½ï¼Œé™¤å»1ä½ç¬¦å·ä½ï¼Œ31ä½æ—¶é—´æˆ³+32ä½åºåˆ—å·å®ç°2^31ç§’*ç§’å†…2^32ä¸ªåºåˆ—å·å®ç°å®Œå…¨ä¸åŒçš„IDï¼‰</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Component</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisIdWorker</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * å¼€å§‹æ—¶é—´æˆ³</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> <span class="token constant">BEGIN_TIMESTAMP</span> <span class="token operator">=</span> <span class="token number">1768052420L</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * åºåˆ—å·ä½æ•°</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">COUNT_BITS</span> <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * è·å–è¯¥keyä¸‹ä¸€ä¸ªID</span>
<span class="line">     *</span>
<span class="line">     * <span class="token keyword">@param</span> <span class="token parameter">keyPrefix</span> keyå‰ç¼€</span>
<span class="line">     * <span class="token keyword">@return</span> id</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">nextId</span><span class="token punctuation">(</span><span class="token class-name">String</span> keyPrefix<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// ç”Ÿæˆæ—¶é—´æˆ³</span></span>
<span class="line">        <span class="token class-name">LocalDateTime</span> now <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">long</span> nowSecond <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">toEpochSecond</span><span class="token punctuation">(</span><span class="token class-name">ZoneOffset</span><span class="token punctuation">.</span><span class="token constant">UTC</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">long</span> timestamp <span class="token operator">=</span> nowSecond <span class="token operator">-</span> <span class="token constant">BEGIN_TIMESTAMP</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// ç”Ÿæˆåºåˆ—å·</span></span>
<span class="line">        <span class="token comment">// å€ŸåŠ©redisè‡ªå¢ç”Ÿæˆåºåˆ—å·ï¼Œè¿™é‡Œç»Ÿè®¡çš„æ˜¯æ¯å¤©çš„ï¼Œåºåˆ—å·æœ€å¤§ä¸º2^32-1ï¼Œæ¯å¤©æœ€å¤šç”Ÿæˆ2^32ä¸ªID</span></span>
<span class="line">        <span class="token comment">// keyä¸å­˜åœ¨æ—¶ï¼Œè‡ªåŠ¨ç”Ÿæˆ0ï¼Œåç»­è‡ªå¢æ­£å¸¸æ‰§è¡Œ</span></span>
<span class="line">        <span class="token class-name">String</span> date <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy:MM:dd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">long</span> count <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token string">&quot;icr:&quot;</span> <span class="token operator">+</span> keyPrefix <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> date<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// æ‹¼æ¥å¹¶è¿”å›</span></span>
<span class="line">        <span class="token comment">// |è¿ç®—å’Œ||ä¸ä¸€æ ·ï¼Œä¸€ä¸ªæ˜¯å¯¹æ¯ä¸€ä½bitè¿›è¡Œæˆ–è¿ç®—ï¼Œä¸€ä¸ªæ˜¯é€»è¾‘è¿ç®—ç¬¦</span></span>
<span class="line">        <span class="token keyword">return</span> timestamp <span class="token operator">&lt;&lt;</span> <span class="token constant">COUNT_BITS</span> <span class="token operator">|</span> count<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·çš„åšæ³•å’Œ<strong>é›ªèŠ±ç®—æ³•</strong>ç±»ä¼¼ï¼Œè¯¦è§åç»­è¯´æ˜</p><h2 id="ä¼˜æƒ åˆ¸" tabindex="-1"><a class="header-anchor" href="#ä¼˜æƒ åˆ¸"><span>ä¼˜æƒ åˆ¸</span></a></h2><p>æœ¬é¡¹ç›®å¯¹ä¼˜æƒ åˆ¸è¡¨çš„è®¾ç½®æ˜¯æ¯ç§ä¼˜æƒ åˆ¸å•ç‹¬åœ¨è¡¨ä¸­ä½œä¸ºä¸€è¡Œæ•°æ®ï¼Œè®°å½•å¯¹åº”åº—é“ºï¼Œåº“å­˜ç­‰ç›¸å…³ä¿¡æ¯ã€‚</p><p>å¼€å§‹ä¼˜æƒ ç§’æ€æ´»åŠ¨æ—¶ï¼Œç”¨æˆ·ç‚¹å‡»è´­ä¹°ï¼Œåç«¯ç¡®è®¤ä¼˜æƒ åˆ¸<strong>æ´»åŠ¨æ˜¯å¦å¼€å§‹</strong>-&gt;åˆ¤æ–­<strong>åº“å­˜æ˜¯å¦å……è¶³</strong>-&gt;å‡æ‰£åº“å­˜ï¼Œä¸­é—´æœ‰å¼‚å¸¸åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œè¿”å›å¤±è´¥ç»“æœï¼ŒæˆåŠŸåˆ™è¿”å›è®¢å•idã€‚</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token annotation punctuation">@Transactional</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">seckillVoucher</span><span class="token punctuation">(</span><span class="token class-name">Long</span> voucherId<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BusinessException</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">SeckillVoucher</span> seckillVoucher <span class="token operator">=</span> seckillVoucherService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>voucherId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// æŸ¥è¯¢æ´»åŠ¨æ˜¯å¦å¼€å§‹</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>seckillVoucher<span class="token punctuation">.</span><span class="token function">getBeginTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isAfter</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;ä¼˜æƒ æ´»åŠ¨å°šæœªå¼€å§‹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>seckillVoucher<span class="token punctuation">.</span><span class="token function">getEndTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isBefore</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;ä¼˜æƒ æ´»åŠ¨å·²ç»“æŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token comment">// æ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>seckillVoucher<span class="token punctuation">.</span><span class="token function">getStock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;ä¼˜æƒ åˆ¸å·²å”®ç½„&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token comment">// æ‰£å‡åº“å­˜</span></span>
<span class="line">        <span class="token keyword">boolean</span> success <span class="token operator">=</span> seckillVoucherService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpdateWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SeckillVoucher</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">                <span class="token function">setSql</span><span class="token punctuation">(</span><span class="token string">&quot;stock = stock - 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">                <span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;voucher_id&quot;</span><span class="token punctuation">,</span> voucherId<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//        seckillVoucherService.update().setSql(&quot;stock = stock + 1&quot;).eq(&quot;voucher_id&quot;, voucherId).update();</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>success<span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;åº“å­˜ä¸è¶³&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// åˆ›å»ºè®¢å•</span></span>
<span class="line">        <span class="token class-name">VoucherOrder</span> voucherOrder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VoucherOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// è®¢å•id</span></span>
<span class="line">        <span class="token keyword">long</span> id <span class="token operator">=</span> redisIdWorker<span class="token punctuation">.</span><span class="token function">nextId</span><span class="token punctuation">(</span><span class="token string">&quot;order&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        voucherOrder<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// ç”¨æˆ·idï¼ˆé€šè¿‡Threadlocalæå–ï¼‰</span></span>
<span class="line">        <span class="token class-name">Long</span> userId <span class="token operator">=</span> <span class="token class-name">UserHolder</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        voucherOrder<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// ä»£é‡‘åˆ¸åˆ¸id</span></span>
<span class="line">        voucherOrder<span class="token punctuation">.</span><span class="token function">setVoucherId</span><span class="token punctuation">(</span>voucherId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// ä¿å­˜è®¢å•</span></span>
<span class="line">        voucherOrderMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>voucherOrder<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>voucherId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ä»¥ä¸Šæ“ä½œå®é™…ä¸Šæ˜¯å­˜åœ¨é—®é¢˜çš„ï¼Œæ¯”å¦‚è¿™é‡Œåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œæ£€æŸ¥åº“å­˜æ•°é‡æ—¶ä¼šå‡ºç°å¼‚å¸¸ï¼ˆéƒ½å‘ç°ä¸º1ï¼Œç„¶åéƒ½è¿›å…¥ä¸´ç•ŒåŒºå¯¼è‡´åº“å­˜å‡åˆ°è´Ÿæ•°ï¼‰ï¼Œä½†æ˜¯è¿™é‡Œå¦‚æœéšä¾¿åŠ é”å°±ä¼šé€ æˆæå¤§ä¸”æ— æ³•æ¥å—çš„é€Ÿç‡æŸè€—ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ</p><h2 id="æ‚²è§‚é”ä»¥åŠä¹è§‚é”" tabindex="-1"><a class="header-anchor" href="#æ‚²è§‚é”ä»¥åŠä¹è§‚é”"><span>æ‚²è§‚é”ä»¥åŠä¹è§‚é”</span></a></h2><p><strong>æ‚²è§‚é”</strong></p><p>è®¤ä¸ºæ— è®ºä½•æ—¶ï¼Œçº¿ç¨‹å®‰å…¨é—®é¢˜ä¸€å®šä¼šå‘ç”Ÿï¼Œæ‰§è¡Œæ“ä½œå‰å¿…é¡»å°è¯•è·å–é”ï¼Œä¿è¯çº¿ç¨‹ä¸²è¡Œæ‰§è¡Œï¼šæ¯”å¦‚synchronizedï¼ŒLockå°±æ˜¯æ‚²è§‚é”ï¼Œè¿™æ ·çš„é˜»å¡å¯¹é€Ÿç‡çš„å½±å“éå¸¸å¤§ã€‚</p><p><strong>ä¹è§‚é”</strong></p><p>è®¤ä¸ºçº¿ç¨‹å®‰å…¨é—®é¢˜ä¸ä¸€å®šä¼šå‘ç”Ÿï¼Œ<strong>ä¸åŠ é”</strong>ï¼Œåªåœ¨æ›´æ–°æ•°æ®æ—¶åˆ¤æ–­<strong>æ˜¯å¦æœ‰å…¶ä»–çº¿ç¨‹å¯¹æ•°æ®åšæ“ä½œ</strong>äº†ï¼šå¦‚æ— ï¼Œåˆ™åˆ¤æ–­å®‰å…¨ï¼›å¦‚å·²è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼Œåˆ™åˆ¤æ–­ä¸å®‰å…¨ï¼Œå°è¯•é‡è¯•æˆ–è¿”å›é”™è¯¯ã€‚<strong>ï¼ˆæ¨èï¼‰</strong></p><h2 id="è¶…å–é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#è¶…å–é—®é¢˜"><span>è¶…å–é—®é¢˜</span></a></h2><p>ä¹è§‚é”å¸¸è§çš„å®ç°æ–¹æ³•æœ‰ï¼š</p><ul><li><strong>ç‰ˆæœ¬å·æ³•ï¼š</strong></li></ul><p>ä¸ºæ•°æ®å¢åŠ ä¸€æ¡ç‰ˆæœ¬åˆ—ï¼ˆVersionï¼‰ï¼Œä¸“é—¨ç”¨äºè®°å½•è¯¥æ•°æ®æ˜¯å¦è¢«å…¶ä»–äº‹åŠ¡/çº¿ç¨‹ä¿®æ”¹äº†ï¼ˆä¿è¯å‰åæ•°æ®ä¸€è‡´æ‰å¯ç»§ç»­æ‰§è¡Œï¼Œç±»ä¼¼mvccçš„äº‹åŠ¡idæ£€æŸ¥ï¼‰ï¼š</p>`,23)),p(a,{code:"graph%20TD%0Asubgraph%20%E7%BA%BF%E7%A8%8B1%0A%20%20%20%20A1%5B%E6%9F%A5%E8%AF%A2%E5%95%86%E5%93%81%E5%BA%93%E5%AD%98%E5%92%8C%E7%89%88%E6%9C%AC%E5%8F%B7%5D%20--%3E%20B1%7B%E5%BA%93%E5%AD%98%3E0%20%E4%B8%94%20%E7%89%88%E6%9C%AC%E5%8F%B7%3D1%3F%7D%0A%20%20%20%20B1%20--%20%E6%98%AF%20--%3E%20C1%5B%E6%89%A7%E8%A1%8C%E6%9B%B4%E6%96%B0%3A%20stock%20%3D%20stock%20-%201%2C%20version%20%3D%20version%20%2B%201%5D%0A%20%20%20%20C1%20--%3E%20D1%5B%E6%9B%B4%E6%96%B0%E6%88%90%E5%8A%9F%EF%BC%8C%E7%89%88%E6%9C%AC%E5%8F%B7%E5%8F%98%E4%B8%BA2%5D%0Aend%0A%0Asubgraph%20%E7%BA%BF%E7%A8%8B2%0A%20%20%20%20A2%5B%E6%9F%A5%E8%AF%A2%E5%95%86%E5%93%81%E5%BA%93%E5%AD%98%E5%92%8C%E7%89%88%E6%9C%AC%E5%8F%B7%5D%20--%3E%20B2%7B%E5%BA%93%E5%AD%98%3E0%20%E4%B8%94%20%E7%89%88%E6%9C%AC%E5%8F%B7%3D1%3F%7D%0A%20%20%20%20B2%20--%20%E6%98%AF%20--%3E%20C2%5B%E6%89%A7%E8%A1%8C%E6%9B%B4%E6%96%B0%3A%20stock%20%3D%20stock%20-%201%2C%20version%20%3D%20version%20%2B%201%5D%0A%20%20%20%20C2%20--%3E%20D2%5B%E6%9B%B4%E6%96%B0%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%9B%A0%E4%B8%BA%E7%89%88%E6%9C%AC%E5%8F%B7%E5%B7%B2%E5%8F%98%E4%B8%BA2%5D%0Aend%0A%0A%25%25%20%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6%0Asubgraph%20%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6%0A%20%20%20%20B1%20--%3E%7C%E8%AF%BB%E5%8F%96%E6%97%B6%E7%89%88%E6%9C%AC%E5%8F%B7%E4%B8%BA1%7C%20E1%5B%E7%89%88%E6%9C%AC%E5%8F%B7%E6%A3%80%E6%9F%A5%5D%0A%20%20%20%20B2%20--%3E%7C%E8%AF%BB%E5%8F%96%E6%97%B6%E7%89%88%E6%9C%AC%E5%8F%B7%E4%B8%BA1%7C%20E2%5B%E7%89%88%E6%9C%AC%E5%8F%B7%E6%A3%80%E6%9F%A5%5D%0A%20%20%20%20E1%20--%3E%20F1%5B%E7%BA%BF%E7%A8%8B1%E6%9B%B4%E6%96%B0%E5%89%8D%5D%0A%20%20%20%20E2%20--%3E%20F2%5B%E7%BA%BF%E7%A8%8B2%E6%9B%B4%E6%96%B0%E5%89%8D%5D%0A%20%20%20%20F1%20--%3E%20G1%5B%E7%BA%BF%E7%A8%8B1%E6%8F%90%E4%BA%A4%E6%9B%B4%E6%96%B0%5D%0A%20%20%20%20F2%20-.-%3E%20G2%5B%E7%BA%BF%E7%A8%8B2%E5%B0%9D%E8%AF%95%E6%8F%90%E4%BA%A4%E6%9B%B4%E6%96%B0%EF%BC%8C%E4%BD%86%E5%A4%B1%E8%B4%A5%5D%0Aend%0A%0A%25%25%20%E7%BB%93%E6%9E%9C%E6%98%BE%E7%A4%BA%0Asubgraph%20%E7%BB%93%E6%9E%9C%0A%20%20%20%20H1%5B%E7%BA%BF%E7%A8%8B1%E6%9B%B4%E6%96%B0%E5%90%8E%E7%BB%93%E6%9E%9C%3A%20stock%3D0%2C%20version%3D2%5D%0A%20%20%20%20H2%5B%E7%BA%BF%E7%A8%8B2%E6%9B%B4%E6%96%B0%E5%A4%B1%E8%B4%A5%3A%20%E5%BA%93%E5%AD%98%E4%B8%8D%E8%B6%B3%E6%88%96%E7%89%88%E6%9C%AC%E5%86%B2%E7%AA%81%5D%0Aend%0A%0A%25%25%20%E8%BF%9E%E6%8E%A5%E8%8A%82%E7%82%B9%0AD1%20--%3E%20H1%0AD2%20--%3E%20H2%0A"}),n[1]||(n[1]=s(`<p>å…³é”®åœ¨äºå…¶ä¸­å¯¹æ•°æ®çš„æ›´æ–°ä¸æ˜¯</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">update</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">	<span class="token keyword">set</span> stock <span class="token operator">=</span> stock <span class="token operator">+</span> <span class="token number">1</span></span>
<span class="line">	<span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">10</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è€Œæ˜¯</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">update</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">	<span class="token keyword">set</span> stock <span class="token operator">=</span> stock <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">,</span> version <span class="token operator">=</span> version <span class="token operator">+</span> <span class="token number">1</span></span>
<span class="line">	<span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">and</span> version <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™å°±ä¿è¯äº†å‡ ä¸ªäº‹åŠ¡è·å–åˆ°ä¸€ä¸ªversionçš„æ•°æ®åï¼Œåªèƒ½æœ‰ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹åº“å­˜äº†ã€‚</p><p>è¿™é‡Œä¹‹æ‰€ä»¥ä¸ä¼šå†æ¬¡é‡åˆ°é«˜å¹¶å‘é—®é¢˜ï¼Œæ˜¯å› ä¸ºä¸€æ¡updateè¯­å¥ä¼šå¯¹å¯¹åº”çš„æ•°æ®è¡ŒåŠ <strong>Xé”</strong>ï¼Œå…¶ä»–çš„updateæ“ä½œä¼šè¢«é˜»å¡ï¼Œè€Œç­‰å½“å‰äº‹åŠ¡å®Œæˆæ“ä½œåï¼Œå†æ¬¡updateå°±ä¼šå‘ç°versionå˜äº†ä»è€Œæ— æ³•æ‰¾åˆ°å¯¹åº”è¡Œï¼Œåªèƒ½è¿”å›é”™è¯¯ã€‚</p><ul><li><strong>CASæ³•</strong></li></ul><p>ä½†æ˜¯ä»¥ä¸Šæ“ä½œä¸ä»…ç¨æ˜¾å¤æ‚ï¼Œè¿˜éœ€è¦é¢å¤–å ç”¨ä¸€ç‚¹ç©ºé—´ç”¨äºå­˜å‚¨versionï¼Œæˆ‘ä»¬è¯´è¿™ä¸åˆç†ï¼Œæ‰€ä»¥å°±ä½¿ç”¨ç±»ä¼¼çš„ä¸€ç§æ–¹å¼ï¼Œå³åªæ¯”è¾ƒå‰ååº“å­˜æ˜¯å¦ç›¸åŒï¼Œå¦‚ç›¸åŒæˆ‘ä»¬ä¼šå¯¹å…¶è¿›è¡Œæ›´æ–°ï¼Œè‹¥ä¸ç›¸åŒåˆ™ä¼šè¿”å›é”™è¯¯ï¼š</p>`,8)),p(a,{code:"graph%20TD%0Asubgraph%20%E7%BA%BF%E7%A8%8B1%0A%20%20%20%20A1%5B%E6%9F%A5%E8%AF%A2%E5%BA%93%E5%AD%98%5D%20--%3E%20B1%7B%E5%BA%93%E5%AD%98%20%3E%200%3F%7D%0A%20%20%20%20B1%20--%20%E6%98%AF%20--%3E%20C1%5B%E6%89%A7%E8%A1%8C%E6%9B%B4%E6%96%B0%3A%20stock%20%3D%20stock%20-%201%5D%0A%20%20%20%20C1%20--%3E%20D1%5B%E6%9D%A1%E4%BB%B6%3A%20id%3D10%20and%20stock%3D1%5D%0A%20%20%20%20D1%20--%3E%20E1%5B%E6%9B%B4%E6%96%B0%E6%88%90%E5%8A%9F%20%E2%9C%85%5D%0Aend%0A%0Asubgraph%20%E7%BA%BF%E7%A8%8B2%0A%20%20%20%20A2%5B%E6%9F%A5%E8%AF%A2%E5%BA%93%E5%AD%98%5D%20--%3E%20B2%7B%E5%BA%93%E5%AD%98%20%3E%200%3F%7D%0A%20%20%20%20B2%20--%20%E6%98%AF%20--%3E%20C2%5B%E6%89%A7%E8%A1%8C%E6%9B%B4%E6%96%B0%3A%20stock%20%3D%20stock%20-%201%5D%0A%20%20%20%20C2%20--%3E%20D2%5B%E6%9D%A1%E4%BB%B6%3A%20id%3D10%20and%20stock%3D1%5D%0A%20%20%20%20D2%20--%3E%20E2%5B%E6%9B%B4%E6%96%B0%E5%A4%B1%E8%B4%A5%20%E2%9D%8C%5D%0Aend%0A%0A%25%25%20%E6%95%B0%E6%8D%AE%E7%8A%B6%E6%80%81%0Asubgraph%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%8A%B6%E6%80%81%0A%20%20%20%20F%5B%E5%88%9D%E5%A7%8B%E7%8A%B6%E6%80%81%3A%20id%3D10%2C%20stock%3D1%5D%0A%20%20%20%20G%5B%E7%BA%BF%E7%A8%8B1%E6%9B%B4%E6%96%B0%E5%90%8E%3A%20id%3D10%2C%20stock%3D0%5D%0Aend%0A%0A%25%25%20%E6%97%B6%E9%97%B4%E7%BA%BF%E4%B8%8E%E5%B9%B6%E5%8F%91%E5%85%B3%E7%B3%BB%0AA1%20--%3E%20F%0AA2%20--%3E%20F%0AC1%20--%3E%20G%0AC2%20-.-%3E%20G%0AD1%20--%3E%7C%E6%BB%A1%E8%B6%B3%E6%9D%A1%E4%BB%B6%7C%20E1%0AD2%20--%3E%7C%E4%B8%8D%E6%BB%A1%E8%B6%B3%E6%9D%A1%E4%BB%B6%7C%20E2%0A%0A%25%25%20%E7%BB%93%E6%9E%9C%E8%AF%B4%E6%98%8E%0AE1%20--%3E%20H1%5B%E7%BA%BF%E7%A8%8B1%E6%88%90%E5%8A%9F%E6%89%A3%E5%87%8F%E5%BA%93%E5%AD%98%5D%0AE2%20--%3E%20H2%5B%E7%BA%BF%E7%A8%8B2%E5%9B%A0%E6%9D%A1%E4%BB%B6%E4%B8%8D%E6%BB%A1%E8%B6%B3%E8%80%8C%E5%A4%B1%E8%B4%A5%5D%0A"}),n[2]||(n[2]=s(`<p>é€šè¿‡CASæ¯”è¾ƒ<strong>å‰åæ•°æ®æ˜¯å¦ä¸€è‡´</strong>ä¸”åç»­çš„<strong>æ›´æ–°æ“ä½œ</strong>å’Œ<strong>æ¯”è¾ƒæ“ä½œ</strong>æ˜¯è€¦åˆåœ¨ä¸€èµ·çš„ï¼Œå…·æœ‰<strong>åŸå­æ€§</strong>çš„sqlï¼Œè¿™æ—¶å°±ä¿è¯äº†è¯¥ä¿®æ”¹æ“ä½œä¸€å®šæ˜¯å®‰å…¨çš„ã€‚</p><p>ä½†æ˜¯ï¼åªæ˜¯å®‰å…¨æ˜¯ä¸å¤Ÿçš„ï¼Œä»¥ä¸Šæ“ä½œä¼šå¯¼è‡´å¤±è´¥ç‡è¿‡é«˜ï¼Œå³ç”±äº<strong>è·å–åˆ°åŒä¸€stockç‰ˆæœ¬çš„å‡ ä¸ªäº‹åŠ¡åªèƒ½æœ‰ä¸€ä¸ªäº‹åŠ¡æˆåŠŸ</strong>ï¼Œå…¶ä»–çš„éƒ½ä¼šå¤±è´¥ï¼Œå¯¼è‡´å¾ˆå¤šçš„è¯·æ±‚è¿”å›äº†å¤±è´¥å¼‚å¸¸ï¼</p><p>é‚£ä¹ˆè¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¢ä¸€ç§ç­–ç•¥ï¼š</p><p>æˆ‘ä»¬å°†å¯¹stockå‰åå¿…é¡»ä¸€è‡´è¦æ±‚æ”¹ä¸º<strong>stockå¿…é¡»&gt;0</strong>æ¥è§£å†³è¿™ä¸ªå¤±è´¥é—®é¢˜ï¼ˆupdateæ“ä½œä¼šåŠ <strong>Xé”</strong>ï¼Œä¿è¯åŒä¸€è¡Œæ•°æ®åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªäº‹åŠ¡è¿›è¡Œä¿®æ”¹æ“ä½œï¼Œé‚£ä¹ˆè¿™é‡Œåœ¨updateçš„åŸå­æ€§sqlä¸­åŠ ä¸€æ¡stockå¿…é¡»&gt;0çš„ç¡®å¯ä»¥ä¿è¯æ¯ä¸€æ¡ä¿®æ”¹sqléƒ½ä¸ä¼šå°†stockå‡åˆ°è´Ÿæ•°ï¼Œä¸”éƒ½å¯ä»¥æ­£å¸¸è·å–ä¼˜æƒ ã€‚ä½†æ˜¯ï¼è¿™å®é™…ä¸Šæ˜¯å°†å¹¶å‘é—®é¢˜ä¸¢ç»™äº†æ•°æ®åº“ï¼Œå½’æ ¹ç»“åº•è¿˜æ˜¯ç”¨æ•°æ®åº“çš„<strong>Xé”</strong>æ¥è§£å†³è¿™ä¸ªå¹¶å‘é—®é¢˜ï¼Œ<strong>æ˜¯æ‚²è§‚é”å¹¶éä¹è§‚é”</strong>ï¼ï¼‰</p><blockquote><p>è¿™æ—¶æˆ‘ä»¬ä¼šå‘ç°updateæ“ä½œæ˜¯<strong>åœ¨äº‹åŠ¡å†…</strong>çš„ï¼Œè¿™æ—¶åœ¨<strong>å¯é‡å¤è¯»</strong>çš„äº‹åŠ¡éš”ç¦»ç­‰çº§ä¸‹ï¼Œæ˜¯å¦ä¼šç”±äº<strong>å¹¶å‘äº‹åŠ¡ä¹‹é—´æ•°æ®ä¸å¯è§</strong>çš„ç‰¹æ€§å¯¼è‡´stockè¶…å–å‘¢ï¼Ÿ</p><p>äº‹å®ä¸Šæ˜¯ä¸ä¼šçš„ï¼updateçš„<strong>whereæ¡ä»¶</strong>è¯»çš„å¹¶éå’Œselectä¸€æ ·è¦ç¬¦åˆ<strong>å¿«ç…§</strong>è¦æ±‚ï¼</p><p><strong>åœ¨ InnoDB çš„å¯é‡å¤è¯»ï¼ˆRRï¼‰éš”ç¦»çº§åˆ«ä¸‹ï¼š</strong><strong><code>UPDATE</code> / <code>DELETE</code> è¯­å¥çš„ WHERE æ¡ä»¶ä½¿ç”¨çš„æ˜¯ *å½“å‰æœ€æ–°å·²æäº¤çš„æ•°æ®*ï¼ˆå³â€œå®æ—¶è¯»â€ï¼‰ï¼Œè€Œä¸æ˜¯äº‹åŠ¡å¯åŠ¨æ—¶çš„å¿«ç…§ï¼</strong> ä½† <strong>SET å­å¥ä¸­çš„å€¼</strong>ï¼ˆå¦‚æœæ¶‰åŠå­æŸ¥è¯¢ï¼‰å¯èƒ½ä»å—å¿«ç…§å½±å“ã€‚</p><p>æ¢å¥è¯è¯´ï¼š ğŸ”¹ <strong><code>WHERE</code> æ¡ä»¶ â†’ å®æ—¶è¯»ï¼ˆRead Committed è¡Œä¸ºï¼‰</strong> ğŸ”¹ <strong>æ™®é€š <code>SELECT</code> â†’ å¿«ç…§è¯»ï¼ˆRepeatable Read è¡Œä¸ºï¼‰</strong></p><p>è€Œä¸Šäº†Xé”ï¼Œåªä¼šåœ¨äº‹åŠ¡æäº¤çš„æ—¶å€™é‡Šæ”¾ï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦å…¶ä»–äº‹åŠ¡ä¿®æ”¹äº†ï¼Œå°±å¿…é¡»ç­‰å¾…åˆ°æ­£åœ¨å¤„ç†çš„äº‹åŠ¡æäº¤äº†æ‰èƒ½å¤Ÿä¸ŠXé”å¹¶æ£€æŸ¥stock&gt;0å¹¶ä¿®æ”¹</p></blockquote><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Override</span></span>
<span class="line"><span class="token annotation punctuation">@Transactional</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">seckillVoucher</span><span class="token punctuation">(</span><span class="token class-name">Long</span> voucherId<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BusinessException</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token class-name">SeckillVoucher</span> seckillVoucher <span class="token operator">=</span> seckillVoucherService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>voucherId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// æŸ¥è¯¢æ´»åŠ¨æ˜¯å¦å¼€å§‹</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>seckillVoucher<span class="token punctuation">.</span><span class="token function">getBeginTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isAfter</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;ä¼˜æƒ æ´»åŠ¨å°šæœªå¼€å§‹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>seckillVoucher<span class="token punctuation">.</span><span class="token function">getEndTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isBefore</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;ä¼˜æƒ æ´»åŠ¨å·²ç»“æŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// æ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>seckillVoucher<span class="token punctuation">.</span><span class="token function">getStock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;ä¼˜æƒ åˆ¸å·²å”®ç½„&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// æ‰£å‡åº“å­˜</span></span>
<span class="line">    <span class="token keyword">boolean</span> success <span class="token operator">=</span> seckillVoucherService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpdateWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SeckillVoucher</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">            <span class="token function">setSql</span><span class="token punctuation">(</span><span class="token string">&quot;stock = stock - 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">            <span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;voucher_id&quot;</span><span class="token punctuation">,</span> voucherId<span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">            <span class="token function">gt</span><span class="token punctuation">(</span><span class="token string">&quot;stock&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>  </span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;åº“å­˜ä¸è¶³&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// åˆ›å»ºè®¢å•</span></span>
<span class="line">    <span class="token class-name">VoucherOrder</span> voucherOrder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VoucherOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// è®¢å•id</span></span>
<span class="line">    <span class="token keyword">long</span> id <span class="token operator">=</span> redisIdWorker<span class="token punctuation">.</span><span class="token function">nextId</span><span class="token punctuation">(</span><span class="token string">&quot;order&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    voucherOrder<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// ç”¨æˆ·idï¼ˆé€šè¿‡Threadlocalæå–ï¼‰</span></span>
<span class="line">    <span class="token class-name">Long</span> userId <span class="token operator">=</span> <span class="token class-name">UserHolder</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    voucherOrder<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// ä»£é‡‘åˆ¸åˆ¸id</span></span>
<span class="line">    voucherOrder<span class="token punctuation">.</span><span class="token function">setVoucherId</span><span class="token punctuation">(</span>voucherId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// ä¿å­˜è®¢å•</span></span>
<span class="line">    voucherOrderMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>voucherOrder<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>voucherId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Xé”ä¼šåœ¨updateè¯­å¥å°è¯•è·å–ï¼Œæœªè·å–åˆ°åˆ™é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°æˆåŠŸè·å–ï¼Œæœ€ååœ¨äº‹åŠ¡å®Œæˆcommitåé‡Šæ”¾ï¼›</p><p>åŒæ—¶Xé”ä¼šè·å–åˆ°<strong>å®æ—¶æ•°æ®</strong>è€Œéç¬¦åˆå¿«ç…§çš„æ•°æ®ï¼ˆåŒ…æ‹¬**<code>SELECT ... FOR UPDATE</code>**ï¼‰</p><p><strong>æ‰€æœ‰â€œå½“å‰è¯»â€ï¼ˆCurrent Readï¼‰æ“ä½œ â€”â€” åŒ…æ‹¬ <code>SELECT ... FOR UPDATE</code>ã€<code>SELECT ... LOCK IN SHARE MODE</code>ã€<code>UPDATE</code>ã€<code>DELETE</code> â€”â€” åœ¨ RR éš”ç¦»çº§åˆ«ä¸‹éƒ½ä¼šï¼š</strong></p><ol><li><strong>è¯»å–æœ€æ–°å·²æäº¤çš„æ•°æ®ï¼ˆå®æ—¶è§†å›¾ï¼‰</strong>ï¼›</li><li><strong>å¯¹åŒ¹é…çš„è¡ŒåŠ é”ï¼ˆX é”æˆ– S é”ï¼‰</strong>ï¼›</li><li><strong>å¿½ç•¥ MVCC å¿«ç…§ï¼ˆRead Viewï¼‰</strong>ã€‚</li></ol></blockquote><h2 id="ä¸€äººä¸€å•" tabindex="-1"><a class="header-anchor" href="#ä¸€äººä¸€å•"><span>ä¸€äººä¸€å•</span></a></h2><p>ä¸ºäº†é¿å…ä¸€ä¸ªç”¨æˆ·ä½¿ç”¨å¤šæ¬¡ä¼˜æƒ åˆ¸ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ£€æµ‹æ•°æ®åº“æ˜¯å¦å·²ç»å­˜åœ¨è¯¥è®¢å•ï¼Œä½¿ç”¨äº†è¯¥ä¼˜æƒ åˆ¸idä¸”ç”¨æˆ·idä¸è¾“å…¥è®¢å•ä¿¡æ¯é‡å¤ï¼Œå¦‚æœ‰åˆ™è¡¨ç¤ºè¯¥ç”¨æˆ·å·²ç»ä½¿ç”¨äº†è¯¥ä¼˜æƒ åˆ¸ï¼Œæ— æ³•å†æ¬¡ä½¿ç”¨ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// æ£€æµ‹ç”¨æˆ·æ˜¯å¦å·²ç»ä½¿ç”¨è¿‡è¯¥ä¼˜æƒ åˆ¸</span></span>
<span class="line"><span class="token class-name">Long</span> userId <span class="token operator">=</span> <span class="token class-name">UserHolder</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">int</span> count <span class="token operator">=</span> voucherOrderMapper<span class="token punctuation">.</span><span class="token function">selectCount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">VoucherOrder</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;user_id&quot;</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;voucher_id&quot;</span><span class="token punctuation">,</span> voucherId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;ç”¨æˆ·å·²ç»ä½¿ç”¨è¿‡è¯¥ä¼˜æƒ åˆ¸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯åœ¨è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå¹¶å‘ä¸‹å¤šæ¬¡æŸ¥è¯¢å¯èƒ½å¤šä¸ªè¯·æ±‚å‡åŒæ—¶é€šè¿‡ï¼Œä¸ºäº†é¿å…è¿™ä¸ªæƒ…å†µï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“è”ç³»åˆ°åŠ <strong>é”</strong>ä½¿å¾—æ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªè¿›ç¨‹ä¿®æ”¹æ•°æ®ï¼Œå‰é¢æˆ‘ä»¬è®²è¿‡ç”¨<strong>redis</strong>åšäº’æ–¥é”ï¼Œ<strong>ä¹è§‚é”</strong>ï¼ˆå‰åä¿æŒä¸€è‡´ç­‰ï¼‰ï¼Œä»¥åŠå€ŸåŠ©Xé”å®ç°çš„æ‚²è§‚é”ï¼Œè¿™é‡Œæˆ‘ä»¬å†è®²ä¸€ä¸ªjvmæä¾›çš„synchronizedå®ç°çš„æ‚²è§‚é”ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">        <span class="token comment">// Stringç±»å‹çš„==å¯èƒ½æ¯”è¾ƒçš„æ˜¯å†…å­˜åœ°å€è€Œéå­—ç¬¦ä¸²å†…å®¹ï¼Œæ‰€ä»¥ç”¨Stringçš„intern()æ–¹æ³•ä¿è¯é”å‡†ç¡®</span></span>
<span class="line">        <span class="token class-name">Long</span> userId <span class="token operator">=</span> <span class="token class-name">UserHolder</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>userId<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token function">createVoucherOrder</span><span class="token punctuation">(</span>voucherId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * åˆ›å»ºè®¢å•</span>
<span class="line">     *</span>
<span class="line">     * <span class="token keyword">@param</span> <span class="token parameter">voucherId</span> ä»£é‡‘åˆ¸id</span>
<span class="line">     * <span class="token keyword">@return</span> è®¢å•id</span>
<span class="line">     */</span></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token annotation punctuation">@Transactional</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">createVoucherOrder</span><span class="token punctuation">(</span><span class="token class-name">Long</span> voucherId<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BusinessException</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// æ£€æµ‹ç”¨æˆ·æ˜¯å¦å·²ç»ä½¿ç”¨è¿‡è¯¥ä¼˜æƒ åˆ¸</span></span>
<span class="line">        <span class="token class-name">Long</span> userId <span class="token operator">=</span> <span class="token class-name">UserHolder</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">int</span> count <span class="token operator">=</span> voucherOrderMapper<span class="token punctuation">.</span><span class="token function">selectCount</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">VoucherOrder</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">                <span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;user_id&quot;</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">                <span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;voucher_id&quot;</span><span class="token punctuation">,</span> voucherId<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;ç”¨æˆ·å·²ç»ä½¿ç”¨è¿‡è¯¥ä¼˜æƒ åˆ¸&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// æ‰£å‡åº“å­˜</span></span>
<span class="line">        <span class="token keyword">boolean</span> success <span class="token operator">=</span> seckillVoucherService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpdateWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SeckillVoucher</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">                <span class="token function">setSql</span><span class="token punctuation">(</span><span class="token string">&quot;stock = stock - 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">                <span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;voucher_id&quot;</span><span class="token punctuation">,</span> voucherId<span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">                <span class="token function">gt</span><span class="token punctuation">(</span><span class="token string">&quot;stock&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">// äº‹å®ä¸Šæ˜¯å€ŸåŠ©æ•°æ®åº“Xé”ä¿è¯åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªè¿›ç¨‹ä¿®æ”¹çš„å®ç°çš„æ‚²è§‚é”</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessException</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token string">&quot;åº“å­˜ä¸è¶³&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// åˆ›å»ºè®¢å•</span></span>
<span class="line">        <span class="token class-name">VoucherOrder</span> voucherOrder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VoucherOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// è®¢å•id</span></span>
<span class="line">        <span class="token keyword">long</span> id <span class="token operator">=</span> redisIdWorker<span class="token punctuation">.</span><span class="token function">nextId</span><span class="token punctuation">(</span><span class="token string">&quot;order&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        voucherOrder<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// ç”¨æˆ·idï¼ˆé€šè¿‡Threadlocalæå–ï¼‰</span></span>
<span class="line">        voucherOrder<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// ä»£é‡‘åˆ¸åˆ¸id</span></span>
<span class="line">        voucherOrder<span class="token punctuation">.</span><span class="token function">setVoucherId</span><span class="token punctuation">(</span>voucherId<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// ä¿å­˜è®¢å•</span></span>
<span class="line">        voucherOrderMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>voucherOrder<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ³¨æ„é”é‡Šæ”¾æ—¶ä¸€å®šè¦ä¿è¯äº‹åŠ¡å·²ç»æäº¤ï¼<strong>å¦åˆ™å…¶ä»–äº‹åŠ¡è¯»ä¸åˆ°è¯¥äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®ï¼ˆMVCC</strong>å¯é‡å¤è¯»</strong>ä¸‹ï¼Œäº‹åŠ¡åªä¼šè¯»<strong>è¯¥äº‹åŠ¡å¼€å¯å‰å·²ç»æäº¤çš„äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®ç‰ˆæœ¬</strong>ï¼‰</p><p><strong>è€Œä¸”è¿™é‡Œä¸€å®šè¦æ³¨æ„å¤–å±‚çš„æ–¹æ³•ä¸è¦åŠ äº‹åŠ¡æ³¨è§£ï¼<strong>å‡å¦‚åŠ äº†ï¼Œé‚£ä¹ˆäº‹åŠ¡ABå…ˆåå¯åŠ¨ï¼ŒAæœªæäº¤æ—¶è¿›å…¥synchronizedï¼ˆå†…éƒ¨æ–¹æ³•å¹¶å…¥Aï¼‰ï¼ŒBç­‰å¾…ï¼Œ<strong>Aå®Œæˆæ•°æ®ä¿®æ”¹åBæ˜¯çœ‹ä¸åˆ°çš„ï¼ï¼ˆBå¯åŠ¨æ—¶æ´»è·ƒäº‹åŠ¡å¿«ç…§è§†å›¾ä¸­åŒ…å«Aï¼‰<strong>è¿™é‡Œè¦ä¿è¯å°†</strong>æ“ä½œçš„äº‹åŠ¡</strong>æ”¾å…¥é”å†…ï¼ï¼ˆå½“ç„¶å…¶å®ä¹Ÿå¯ä»¥æŠŠäº‹åŠ¡éš”ç¦»ç­‰çº§æ”¹ä¸º</strong>è¯»å·²æäº¤</strong>ï¼šæ¯æ‰§è¡Œä¸€æ¡ <code>SELECT</code> è¯­å¥ï¼ˆè€Œä¸æ˜¯äº‹åŠ¡å¯åŠ¨æ—¶ï¼‰ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°çš„ Read Viewï¼ŒåªåŒ…å«å½“æ—¶å·²æäº¤çš„æ•°æ®ã€‚ï¼‰</p><blockquote><p><strong>äº‹åŠ¡å¿…é¡»åœ¨è·å–åº”ç”¨å±‚é”ï¼ˆå¦‚ synchronizedï¼‰ä¹‹åæ‰å¼€å¯ï¼ï¼ˆäº‹åŠ¡æ”¾åˆ°é”é‡Œé¢ï¼‰</strong> å¦åˆ™ MVCC çš„ Read View ä¼šâ€œå†»ç»“â€åœ¨é”ç­‰å¾…ä¹‹å‰çš„çŠ¶æ€ï¼Œå¯¼è‡´çœ‹ä¸åˆ°å·²æäº¤æ•°æ®ã€‚</p></blockquote><p><strong>å³æˆ‘ä»¬è¦æ±‚æŸæ“ä½œä¸€ä¸ªä¸€ä¸ªæ‰§è¡Œï¼Œä¸”åä¸€ä¸ªæ“ä½œæ‹¿å¾—åˆ°å‰é¢ä¸€ä¸ªæ“ä½œä¿®æ”¹çš„æ•°æ®ï¼é‚£ä¹ˆè¿™æ—¶å€™æˆ‘ä»¬ä¸Šé”ï¼Œä¿è¯æ“ä½œä¸€ä¸ªä¸€ä¸ªæ‰§è¡Œï¼Œä¸”è¦ä¹ˆå¯¹è¿™æ®µæ“ä½œæ•´ä½“åŠ äº‹åŠ¡ï¼ˆæäº¤äº†ä¹‹åå†é‡Šæ”¾é”è®©ä¸‹ä¸€ä¸ªäº‹åŠ¡å¼€å¯ï¼‰ï¼Œè¦ä¹ˆæ”¹äº‹åŠ¡éš”ç¦»ç­‰çº§ä¸ºè¯»å·²æäº¤ï¼Œä»¥ä¿è¯æ“ä½œé—´æ•°æ®ä¸€è‡´æ€§ã€‚</strong></p><p>å½“ç„¶è¿™é‡Œè¿˜æœ‰é—®é¢˜ï¼Œæ¯”å¦‚synchronized<strong>æ— æ³•è·¨æœº</strong>ï¼Œåˆ†å¸ƒå¼æˆ–å¾®æœåŠ¡ä¸‹æ— æ³•å®ç°å…¨å±€çš„ä¸Šé”ï¼Œæœ€åå¯èƒ½è¿˜æ˜¯éœ€è¦<strong>redisçš„åˆ†å¸ƒå¼é”</strong>æ¥è§£å†³è¿™ä¸€é—®é¢˜ï¼ˆæˆ–è€…åœ¨æ•°æ®åº“åŠ <strong>å”¯ä¸€ç´¢å¼•</strong>ä¿è¯åªæœ‰ä¸€ä¸ªï¼Œå°è¯•æ·»åŠ å·²æœ‰çš„ä¼šæŠ¥å¼‚å¸¸ï¼‰</p><p><strong>æ€»ç»“ä»¥ä¸Šå†…å®¹ï¼Œæˆ‘ä»¬ä¿è¯æŸä¸€æ•°æ®çš„å®Œå…¨å®‰å…¨ï¼Œå°±æ˜¯è¦æ±‚å¯¹å…¶çš„æ“ä½œä¸€ä¸ªä¸€ä¸ªé¡ºåºä¸²è¡Œæ‰§è¡Œï¼ˆåŠ é”ï¼‰ï¼Œä¸”æŸ¥è¯¢æ¡ä»¶æ“ä½œä»¥åŠä¿®æ”¹æ“ä½œæ˜¯è€¦åˆåœ¨ä¸€å—çš„ä¸€ä¸ªåŸå­æ€§æ“ä½œï¼ˆæ”¾å…¥ä¸€ä¸ªäº‹åŠ¡/sqlï¼‰ï¼ŒåŒæ—¶æ³¨æ„æ¡ä»¶çš„å‡†ç¡®æ€§ï¼ˆæ“ä½œé—´æ•°æ®ä¸€è‡´æ€§ï¼Œæ”¹äº‹åŠ¡éš”ç¦»ç­‰çº§ï¼Œæˆ–è®©äº‹åŠ¡ä¸äº¤å‰å³æ”¾åˆ°é”å†…ï¼‰</strong></p><p><strong>ç®€å•è®°å¿†å°±æ˜¯å¦‚éœ€åŠ é”ï¼Œé‚£ä¹ˆè¿™æ—¶å€™ä¸€èˆ¬è€ƒè™‘å°†äº‹åŠ¡æŒªåˆ°é”å†…ï¼Œè®©é”åŒ…ä½äº‹åŠ¡ï¼Œä¿è¯äº‹åŠ¡é—´æ•°æ®ä¸€è‡´æ€§ï¼</strong></p><hr><h2 id="mybatisplusæä¾›çš„updateä»¥åŠsetsql-å¿«é€Ÿæ‹¼æ¥updateçš„sql" tabindex="-1"><a class="header-anchor" href="#mybatisplusæä¾›çš„updateä»¥åŠsetsql-å¿«é€Ÿæ‹¼æ¥updateçš„sql"><span>Mybatisplusæä¾›çš„updateä»¥åŠsetSql()å¿«é€Ÿæ‹¼æ¥updateçš„sql</span></a></h2><p>éƒ½çŸ¥é“å¯ä»¥é€šè¿‡Serviceçš„updateï¼Œå†ç»™å‡ºupdateWrapperæ¥å®ç°æ›´æ–°ï¼Œæˆ‘ä»¬å…¶å®ä¹Ÿå¯ä»¥ç”¨é“¾å¼ç¼–ç¨‹æ¥å®ç°sqlçš„æ‹¼æ¥ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">seckillVoucherService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSql</span><span class="token punctuation">(</span><span class="token string">&quot;stock = stock + 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;voucher_id&quot;</span><span class="token punctuation">,</span> voucherId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™ä¹Ÿå¯ä»¥å®ç°sqlè¯­å¥çš„æ‹¼æ¥æ•ˆæœï¼Œå½“ç„¶ä½¿ç”¨wrapperçš„è¯ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">seckillVoucherService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UpdateWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SeckillVoucher</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">        <span class="token function">setSql</span><span class="token punctuation">(</span><span class="token string">&quot;stock = stock - 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">        <span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;voucher_id&quot;</span><span class="token punctuation">,</span> voucherId<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­<strong>setSql</strong>æ¯”è¾ƒé‡è¦ï¼Œæˆ‘ä»¬å¹³æ—¶å†™ç®€å•æ›´æ–°ä¸šåŠ¡çš„æ—¶å€™ä¸æƒ³åˆ°mapperå±‚å†™çš„è¯ï¼Œå°±å¯ä»¥åœ¨è¿™ç›´æ¥åŠ ä¸Šsetåé¢çš„è¯­å¥ã€‚</p><h2 id="é›ªèŠ±ç®—æ³•" tabindex="-1"><a class="header-anchor" href="#é›ªèŠ±ç®—æ³•"><span>é›ªèŠ±ç®—æ³•</span></a></h2><p>é›ªèŠ±ç®—æ³•ï¼ˆSnowflakeï¼‰æ˜¯ä¸€ç§<strong>åˆ†å¸ƒå¼å”¯ä¸€ ID ç”Ÿæˆç®—æ³•</strong>ï¼Œæœ€æ—©ç”± Twitter å¼€æºï¼Œå¹¿æ³›ç”¨äºæ•°æ®åº“ä¸»é”®ã€è®¢å•å·ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰éœ€è¦<strong>é«˜æ€§èƒ½ã€å…¨å±€å”¯ä¸€ã€æœ‰åºé€’å¢</strong>çš„åœºæ™¯ã€‚</p><p><strong>æ ¸å¿ƒç»“æ„</strong></p><p>æ ‡å‡† 64 ä½ Snowflake ID ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š</p><ul><li><strong>1 ä½ç¬¦å·ä½</strong>ï¼šå›ºå®šä¸º 0ï¼Œä¿è¯æ­£æ•°ã€‚</li><li><strong>41 ä½æ—¶é—´æˆ³</strong>ï¼šè®°å½•è‡ªå®šä¹‰èµ·å§‹æ—¶é—´ï¼ˆepochï¼‰ä»¥æ¥çš„æ¯«ç§’æ•°ï¼Œå¯ç”¨çº¦ 69 å¹´ã€‚</li><li><strong>10 ä½æœºå™¨æ ‡è¯†</strong>ï¼šåŒºåˆ†ä¸åŒèŠ‚ç‚¹ï¼ˆå¯æ‹†åˆ†ä¸ºæ•°æ®ä¸­å¿ƒ ID + æœºå™¨ IDï¼‰ã€‚</li><li><strong>12 ä½åºåˆ—å·</strong>ï¼šåŒä¸€æ¯«ç§’å†…çš„è‡ªå¢åºåˆ—ï¼Œæœ€å¤§æ”¯æŒæ¯æ¯«ç§’ 4096 ä¸ª IDã€‚</li></ul><p>ç”Ÿæˆæµç¨‹</p><ol><li><strong>è·å–å½“å‰æ—¶é—´æˆ³</strong>ï¼ˆæ¯«ç§’ï¼‰å¹¶å‡å» epochã€‚</li><li><strong>å¤„ç†æ—¶é’Ÿå›æ‹¨</strong>ï¼šè‹¥å½“å‰æ—¶é—´å°äºä¸Šæ¬¡ç”Ÿæˆæ—¶é—´ï¼Œå¯ç­‰å¾…è¿½å¹³æˆ–æŠ›å¼‚å¸¸ã€‚</li><li><strong>ç”Ÿæˆåºåˆ—å·</strong>ï¼š åŒä¸€æ¯«ç§’å†…é€’å¢ï¼Œè¶…è¿‡æœ€å¤§å€¼åˆ™ç­‰å¾…ä¸‹ä¸€æ¯«ç§’ã€‚ ä¸åŒæ¯«ç§’é‡ç½®ä¸º 0ã€‚</li><li><strong>ä½ç§»æ‹¼æ¥</strong>ï¼šå°†æ—¶é—´æˆ³ã€æœºå™¨ IDã€åºåˆ—å·æŒ‰ä½ç§»ç»„åˆæˆ 64 ä½æ•´æ•°ã€‚</li></ol><h2 id="langå°è£…çš„ç±»å‹æ³¨æ„-åˆ¤æ–­å¯èƒ½å¹¶éå†…å®¹æ˜¯å¦ç›¸ç­‰" tabindex="-1"><a class="header-anchor" href="#langå°è£…çš„ç±»å‹æ³¨æ„-åˆ¤æ–­å¯èƒ½å¹¶éå†…å®¹æ˜¯å¦ç›¸ç­‰"><span>langå°è£…çš„ç±»å‹æ³¨æ„==åˆ¤æ–­å¯èƒ½å¹¶éå†…å®¹æ˜¯å¦ç›¸ç­‰</span></a></h2><p>åœ¨ Java ä¸­ï¼Œä½¿ç”¨ <code>==</code> æ¯”è¾ƒå°è£…ç±»å‹ï¼ˆå¦‚ <code>Integer</code>ã€<code>Long</code>ã€<code>Boolean</code> ç­‰ï¼‰æ—¶ï¼Œ<strong>æ¯”è¾ƒçš„æ˜¯å¯¹è±¡çš„å¼•ç”¨ï¼ˆå†…å­˜åœ°å€ï¼‰ï¼Œè€Œä¸æ˜¯å®ƒä»¬çš„å€¼å†…å®¹</strong>ã€‚è¿™å¯èƒ½å¯¼è‡´ <strong>çœ‹ä¼¼ç›¸ç­‰çš„æ•°å€¼ï¼Œç”¨ <code>==</code> åˆ¤æ–­å´è¿”å› <code>false</code></strong>ã€‚</p><p><strong>å¯¹å°è£…ç±»å‹ï¼ˆWrapper Classesï¼‰åº”å§‹ç»ˆä½¿ç”¨ <code>.equals()</code> æ¯”è¾ƒå€¼æ˜¯å¦ç›¸ç­‰ï¼Œè€Œä¸æ˜¯ <code>==</code>ã€‚</strong></p><h2 id="è§£å†³è‡ªè°ƒç”¨" tabindex="-1"><a class="header-anchor" href="#è§£å†³è‡ªè°ƒç”¨"><span>è§£å†³è‡ªè°ƒç”¨</span></a></h2><ol><li>ç®€å•äº‹åŠ¡å¤±æ•ˆç›´æ¥åœ¨å¤–å±‚å¥—ä¸€ä¸ªäº‹åŠ¡æ³¨è§£å°±è¡Œï¼Œä½†æ˜¯å†…å±‚äº‹åŠ¡ç›¸å…³é…ç½®æ˜¯ä¸ä¼šç”Ÿæ•ˆäº†ã€‚</li><li>è‡ªæ³¨å…¥</li></ol><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">OrderService</span> self<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><p>AOPè·å–ä»£ç†å¯¹è±¡</p></li><li><p><strong><code>ApplicationContext</code></strong> ä¸Šä¸‹æ–‡è·å–ä»£ç†å¯¹è±¡**ï¼ˆä¸æ¨èï¼‰**</p></li><li><p>æ‹†åˆ†åˆ°å…¶ä»–Service</p></li></ol><h2 id="mvccå¯é‡å¤è¯»ä¿è¯çš„äº‹åŠ¡å†…æ•°æ®ä¸€è‡´æ€§" tabindex="-1"><a class="header-anchor" href="#mvccå¯é‡å¤è¯»ä¿è¯çš„äº‹åŠ¡å†…æ•°æ®ä¸€è‡´æ€§"><span>MVCCå¯é‡å¤è¯»ä¿è¯çš„äº‹åŠ¡å†…æ•°æ®ä¸€è‡´æ€§</span></a></h2><p>MVCCå¯é‡å¤è¯»æ˜¯ç”¨äºä¿è¯äº‹åŠ¡å†…å‰åè¯»å–åŒä¸€è¡Œæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜çš„ç‰ˆæœ¬ç®¡ç†ï¼Œå¯é‡å¤è¯»å®ƒæ˜¯ä¿è¯æ¯ä¸ªäº‹åŠ¡åªèƒ½è¯»åˆ°<strong>è¯¥äº‹åŠ¡å¼€å¯ä¹‹å‰å°±å·²ç»å®Œæˆæäº¤</strong>çš„äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®ç‰ˆæœ¬ï¼Œå…¶ä»–çš„ä¸€æ¦‚ä¸å¯è§ï¼</p><p>è¿™å°±ä¼šå¯¼è‡´äº‹åŠ¡é—´æ•°æ®ä¸ä¸€è‡´ï¼Œä½¿ç”¨äº‹åŠ¡ä¸è¦æ— è„‘ï¼Œç»“åˆä¸šåŠ¡åœºæ™¯å»é€‰æ‹©äº‹åŠ¡éš”ç¦»ç­‰çº§ï¼Œå¦‚ä¸šåŠ¡è¦æ±‚æ“ä½œé—´æ•°æ®ä¸€è‡´æ€§å¼ºï¼Œé‚£ä¹ˆå°±è¦è€ƒè™‘å¦‚ä½•ä½¿å¾—æ“ä½œä¹‹é—´äº‹åŠ¡ä¸äº¤å‰ï¼ˆåŠ é”ï¼‰ï¼Œæˆ–æ˜¯æ¢æˆè¯»å·²æäº¤äº†ï¼</p><h2 id="ä¿è¯å¹¶å‘ä¸‹æ•°æ®å®‰å…¨çš„å‡ ä¸ªå¿…è¦æ¡ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¿è¯å¹¶å‘ä¸‹æ•°æ®å®‰å…¨çš„å‡ ä¸ªå¿…è¦æ¡ä»¶"><span>ä¿è¯å¹¶å‘ä¸‹æ•°æ®å®‰å…¨çš„å‡ ä¸ªå¿…è¦æ¡ä»¶</span></a></h2><ol><li>åŸå­æ€§ï¼š<strong>æ¡ä»¶æ£€æŸ¥</strong>ä¸<strong>ä¿®æ”¹</strong>æ“ä½œå†…èšä¸ºä¸€ä¸ª<strong>åŸå­</strong>æ“ä½œ</li><li>äº’æ–¥æ€§ï¼šå¯¹åŸå­æ“ä½œä¸Šé”ï¼Œä¿è¯åŒä¸€æ—¶é—´å¯¹è¯¥æ•°æ®åªèƒ½æœ‰ä¸€ä¸ªä¿®æ”¹æ“ä½œæ­£åœ¨æ‰§è¡Œ</li><li>æ¡ä»¶è·å–å¿…é¡»å‡†ç¡®ï¼ˆå¦‚RRçš„äº‹åŠ¡éš”ç¦»å¯èƒ½ä¼šå¯¼è‡´æ¡ä»¶æ•°æ®å­˜åœ¨å¼‚å¸¸ï¼Œéœ€ä¿®æ”¹éš”ç¦»ç­‰çº§æˆ–ä¿è¯äº‹åŠ¡ä¸äº¤å‰ï¼‰</li></ol><p>ä»¥è¶…å–é—®é¢˜ä¸ºä¾‹ï¼š</p><p>ä¸€æ¡sqlå®ç°whereæ¡ä»¶ä¸updateä¿®æ”¹å®ç°åŸå­æ€§ï¼›Xé”å®ç°äº’æ–¥ï¼›Xé”è¯»å–æœ€æ–°æ•°æ®</p>`,47))])}const k=t(l,[["render",i]]),d=JSON.parse('{"path":"/docs/heimadianping/yewusheji/3.youhuiquanmiaosha.html","title":"ä¼˜æƒ åˆ¸ç§’æ€","lang":"en-US","frontmatter":{"title":"ä¼˜æƒ åˆ¸ç§’æ€","date":"2025-1-7"},"headers":[{"level":2,"title":"å…¨å±€å”¯ä¸€ID","slug":"å…¨å±€å”¯ä¸€id","link":"#å…¨å±€å”¯ä¸€id","children":[]},{"level":2,"title":"ä¼˜æƒ åˆ¸","slug":"ä¼˜æƒ åˆ¸","link":"#ä¼˜æƒ åˆ¸","children":[]},{"level":2,"title":"æ‚²è§‚é”ä»¥åŠä¹è§‚é”","slug":"æ‚²è§‚é”ä»¥åŠä¹è§‚é”","link":"#æ‚²è§‚é”ä»¥åŠä¹è§‚é”","children":[]},{"level":2,"title":"è¶…å–é—®é¢˜","slug":"è¶…å–é—®é¢˜","link":"#è¶…å–é—®é¢˜","children":[]},{"level":2,"title":"ä¸€äººä¸€å•","slug":"ä¸€äººä¸€å•","link":"#ä¸€äººä¸€å•","children":[]},{"level":2,"title":"Mybatisplusæä¾›çš„updateä»¥åŠsetSql()å¿«é€Ÿæ‹¼æ¥updateçš„sql","slug":"mybatisplusæä¾›çš„updateä»¥åŠsetsql-å¿«é€Ÿæ‹¼æ¥updateçš„sql","link":"#mybatisplusæä¾›çš„updateä»¥åŠsetsql-å¿«é€Ÿæ‹¼æ¥updateçš„sql","children":[]},{"level":2,"title":"é›ªèŠ±ç®—æ³•","slug":"é›ªèŠ±ç®—æ³•","link":"#é›ªèŠ±ç®—æ³•","children":[]},{"level":2,"title":"langå°è£…çš„ç±»å‹æ³¨æ„==åˆ¤æ–­å¯èƒ½å¹¶éå†…å®¹æ˜¯å¦ç›¸ç­‰","slug":"langå°è£…çš„ç±»å‹æ³¨æ„-åˆ¤æ–­å¯èƒ½å¹¶éå†…å®¹æ˜¯å¦ç›¸ç­‰","link":"#langå°è£…çš„ç±»å‹æ³¨æ„-åˆ¤æ–­å¯èƒ½å¹¶éå†…å®¹æ˜¯å¦ç›¸ç­‰","children":[]},{"level":2,"title":"è§£å†³è‡ªè°ƒç”¨","slug":"è§£å†³è‡ªè°ƒç”¨","link":"#è§£å†³è‡ªè°ƒç”¨","children":[]},{"level":2,"title":"MVCCå¯é‡å¤è¯»ä¿è¯çš„äº‹åŠ¡å†…æ•°æ®ä¸€è‡´æ€§","slug":"mvccå¯é‡å¤è¯»ä¿è¯çš„äº‹åŠ¡å†…æ•°æ®ä¸€è‡´æ€§","link":"#mvccå¯é‡å¤è¯»ä¿è¯çš„äº‹åŠ¡å†…æ•°æ®ä¸€è‡´æ€§","children":[]},{"level":2,"title":"ä¿è¯å¹¶å‘ä¸‹æ•°æ®å®‰å…¨çš„å‡ ä¸ªå¿…è¦æ¡ä»¶","slug":"ä¿è¯å¹¶å‘ä¸‹æ•°æ®å®‰å…¨çš„å‡ ä¸ªå¿…è¦æ¡ä»¶","link":"#ä¿è¯å¹¶å‘ä¸‹æ•°æ®å®‰å…¨çš„å‡ ä¸ªå¿…è¦æ¡ä»¶","children":[]}],"git":{"createdTime":1771338216000,"updatedTime":1771338216000,"contributors":[{"name":"SaltFishGC","email":"130335482+SaltFishGC@users.noreply.github.com","commits":1}]},"filePathRelative":"docs/é»‘é©¬ç‚¹è¯„/ä¸šåŠ¡è®¾è®¡/3.ä¼˜æƒ åˆ¸ç§’æ€.md"}');export{k as comp,d as data};
