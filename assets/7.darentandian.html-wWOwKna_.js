import{ar as s,as as a,ax as t,at as p}from"./app-BEAZiIq9.js";const e={};function o(l,n){return p(),a("div",null,[...n[0]||(n[0]=[t(`<h2 id="发表探店笔记" tabindex="-1"><a class="header-anchor" href="#发表探店笔记"><span>发表探店笔记</span></a></h2><p><strong>产品需求</strong>：</p><ul><li>上传照片，撰写文案</li><li>可以评论</li></ul><p><strong>实现方案</strong>：</p><ul><li><p>用户前端准备好图片以及文章后点击提交时，对文件以及输入文章进行上传存储</p></li><li><p>数据库设置对应表记录文章</p></li><li><p>MultipartFile获取文件，使用本地文件存储，将文件流存至本地</p></li><li><p>数据库记录评论，评论项记录文章id</p></li></ul><blockquote><p><strong>其他方案</strong>：</p><p>上传照片一般使用自制的文件服务器或者<strong>OSS</strong>，如果是使用OSS：</p><p>前端发送文件操作请求至后端，后端根据操作类型向OSS服务器请求一个token用于专门处理该操作（策略等方式严格指定token的使用对象，途径，范围以防止前端恶意获取token进行破坏），后端将这个特化token传回前端，前端使用OSS-Client向指定OSS服务器发送请求，带上此token以完成所需操作。</p></blockquote><h2 id="查看探店笔记" tabindex="-1"><a class="header-anchor" href="#查看探店笔记"><span>查看探店笔记</span></a></h2><p><strong>产品需求</strong>：</p><ul><li>通过id查看笔记文章</li><li>额外展示用户信息（头像等）</li><li>提供用户关注接口</li></ul><p><strong>实现方案</strong>：</p><ul><li>接口获取文章id，根据id获取文章对象（带上是否已经点赞等信息）</li><li>根据文章的作者id获取相关信息并提供给前端（使用<code>@TableField(exist = false)</code>直接给Blog不必额外封装）</li></ul><h2 id="点赞" tabindex="-1"><a class="header-anchor" href="#点赞"><span>点赞</span></a></h2><p><strong>产品需求</strong>：</p><ul><li>提供点赞接口</li><li>限制单用户对同一笔记的点赞次数</li></ul><p><strong>实现方案</strong>：</p><ul><li>点赞后数据库对应项点赞数+1，若已经点过赞再次点击取消点赞</li><li>Redis的zset记录点赞用户，score为时间戳，当存在当前用户ID时就是已经点过赞了</li><li>使用锁防止同一用户并发点赞同一文章（占用一定资源）</li></ul><h2 id="点赞排行榜" tabindex="-1"><a class="header-anchor" href="#点赞排行榜"><span>点赞排行榜</span></a></h2><p><strong>产品需求</strong>：</p><ul><li>展示最早点赞的前几个用户</li></ul><p><strong>实现方案</strong>：</p><ul><li>利用先前点赞的zset记录获取score排序为0,4的用户id</li><li>按照时间戳先后顺序返回（早在前）</li></ul><hr><h2 id="zset——sorted-set" tabindex="-1"><a class="header-anchor" href="#zset——sorted-set"><span>Zset——Sorted Set</span></a></h2><p>支持排序的set，每个set都有自己的score，可以根据score加速查找以及排序（而set是不支持在redis中排序的）</p><p>zadd/remove key value score</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForZSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> loginUser<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForZSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> loginUser<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>像是set的ismember就被替代为了score（获取value的score）</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">Double</span> isMember <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForZSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">score</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> loginUser<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>倘若存在就会得到score，反之则是null</p><p>如果需要一个score范围的对象Set，那就可以</p><p>zrange key 0 5（从0到5，一共6个元素）</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> top5 <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForZSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="sql中的field-id" tabindex="-1"><a class="header-anchor" href="#sql中的field-id"><span>sql中的field(id, ...)</span></a></h2><p>我们根据zset的时间戳score获取到了前五个id，想要根据id查到对应用户信息并按照<strong>时间先后</strong>返回结果（早的在前）：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> top5 <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForZSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>top5 <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> top5<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> ids <span class="token operator">=</span> top5<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token operator">::</span><span class="token function">valueOf</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">String</span> idsStr <span class="token operator">=</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">,</span> ids<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">        <span class="token function">in</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> ids<span class="token punctuation">)</span><span class="token punctuation">.</span></span>
<span class="line">        <span class="token function">last</span><span class="token punctuation">(</span><span class="token string">&quot; order by field(id, &quot;</span> <span class="token operator">+</span> idsStr <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>last为mybatisplus的QueryWrapper提供的添加最后一行sql语句，和UpdateWrapper的setsql类似，可以<strong>自己直接写sql</strong></p></blockquote><p><code>ORDER BY FIELD()</code> 是一种<strong>自定义排序</strong>的方式，允许你按照指定的字段值顺序进行排序，而不是默认的升序（ASC）或降序（DESC）。</p><p>这里直接返回会按照id的大小自动升序排序，假如我们需要自定义顺序，就可以给出列，按照自己的列的value排序</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> table_name</span>
<span class="line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> FIELD<span class="token punctuation">(</span>column_name<span class="token punctuation">,</span> value1<span class="token punctuation">,</span> value2<span class="token punctuation">,</span> value3<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>column_name</code>：你要排序的列。</li><li><code>value1, value2, ...</code>：你希望该列按此顺序排列的值。</li><li>不在 <code>FIELD()</code> 列表中的值会被排在<strong>最后</strong>（视为 0），并按自然顺序排列（通常在末尾）。</li></ul><p><strong>但注意这个要求你一定清楚结果中含对应列的结果！这里的in和他就是完美搭配！</strong></p><blockquote><p>其实如果不想用这个也可以自己new一个List，遍历ids（时间先后顺序遍历），查到一个add一个就可以保证是时间先后顺序的了。</p></blockquote>`,42)])])}const i=s(e,[["render",o]]),u=JSON.parse('{"path":"/docs/heimadianping/yewusheji/7.darentandian.html","title":"达人探店","lang":"en-US","frontmatter":{"title":"达人探店","date":"2025-1-19"},"headers":[{"level":2,"title":"发表探店笔记","slug":"发表探店笔记","link":"#发表探店笔记","children":[]},{"level":2,"title":"查看探店笔记","slug":"查看探店笔记","link":"#查看探店笔记","children":[]},{"level":2,"title":"点赞","slug":"点赞","link":"#点赞","children":[]},{"level":2,"title":"点赞排行榜","slug":"点赞排行榜","link":"#点赞排行榜","children":[]},{"level":2,"title":"Zset——Sorted Set","slug":"zset——sorted-set","link":"#zset——sorted-set","children":[]},{"level":2,"title":"sql中的field(id, ...)","slug":"sql中的field-id","link":"#sql中的field-id","children":[]}],"git":{"createdTime":1771565155000,"updatedTime":1771565155000,"contributors":[{"name":"SaltFishGC","email":"130335482+SaltFishGC@users.noreply.github.com","commits":1}]},"filePathRelative":"docs/黑马点评/业务设计/7.达人探店.md"}');export{i as comp,u as data};
