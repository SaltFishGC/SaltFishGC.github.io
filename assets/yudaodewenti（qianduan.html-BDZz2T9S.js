import{_ as l,c as o,e,a as s,b as a,d as t,r as c,o as i}from"./app-Cm4IjFjh.js";const u={},r={href:"https://zhuanlan.zhihu.com/p/148311631",target:"_blank",rel:"noopener noreferrer"},d={href:"https://developer.aliyun.com/article/1166652",target:"_blank",rel:"noopener noreferrer"},k={href:"https://dplayer.diygod.dev/zh/guide.html",target:"_blank",rel:"noopener noreferrer"};function v(m,n){const p=c("ExternalLinkIcon");return i(),o("div",null,[n[4]||(n[4]=e(`<h3 id="跨域了怎么办" tabindex="-1"><a class="header-anchor" href="#跨域了怎么办"><span>跨域了怎么办</span></a></h3><p>跨域问题（CORS, Cross-Origin Resource Sharing）是浏览器出于安全考虑实施的同源策略（Same-Origin Policy）所导致的。当一个资源去访问另一个不同源（域名、协议、端口任一不同）的资源时，就会出现跨域问题。</p><p>解决跨域问题的方法在<strong>开发环境</strong>和<strong>生产环境</strong>中有所不同，因为两者的部署架构和可控性不同。</p><hr><h4 id="一、开发环境-development-environment" tabindex="-1"><a class="header-anchor" href="#一、开发环境-development-environment"><span>一、开发环境 (Development Environment)</span></a></h4><p>在开发时，前端（如 Vue, React 项目）通常运行在 <code>localhost:3000</code> 或 <code>localhost:8080</code>，而后端 API 运行在 <code>localhost:5000</code> 或其他端口，这就构成了跨域。</p><h5 id="常用解决方案" tabindex="-1"><a class="header-anchor" href="#常用解决方案"><span>常用解决方案：</span></a></h5><ol><li><p><strong>使用开发服务器代理 (Proxy)</strong></p><ul><li><p><strong>原理</strong>：利用前端开发服务器（如 Webpack Dev Server、Vite）的代理功能，将 API 请求转发到后端服务器。浏览器认为请求是发给自己的（同源），而开发服务器再将请求转发给真正的后端。</p></li><li><p>配置示例 (Vue CLI / Vite)：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"> <span class="token comment">// vite.config.js (Vite)</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">server</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string-property property">&#39;/api&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&#39;http://localhost:5000&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 后端地址</span></span>
<span class="line">        <span class="token literal-property property">changeOrigin</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 修改请求头中的 origin</span></span>
<span class="line">        <span class="token function-variable function">rewrite</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\\/api</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 重写路径</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"> <span class="token comment">// vue.config.js (Vue CLI)</span></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">devServer</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">proxy</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string-property property">&#39;/api&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">&#39;http://localhost:5000&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">changeOrigin</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">pathRewrite</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token string-property property">&#39;^/api&#39;</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>优点</strong>：简单、安全，只在开发时生效，不暴露后端接口。</p></li><li><p><strong>缺点</strong>：仅限开发环境。</p></li></ul></li><li><p><strong>后端开启 CORS</strong></p><ul><li><p><strong>原理</strong>：在后端代码中添加 CORS 中间件，允许来自前端开发服务器的请求。</p><h5 id="方法-1-使用-crossorigin-注解-局部" tabindex="-1"><a class="header-anchor" href="#方法-1-使用-crossorigin-注解-局部"><span>方法 1：使用 <code>@CrossOrigin</code> 注解（局部）</span></a></h5><p>适用于单个 Controller 或方法。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@RestController</span></span>
<span class="line"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/api/user&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token annotation punctuation">@CrossOrigin</span><span class="token punctuation">(</span>origins <span class="token operator">=</span> <span class="token string">&quot;http://localhost:3000&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 允许前端域名</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{id}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@PostMapping</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">createUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>你也可以指定更多选项：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@CrossOrigin</span><span class="token punctuation">(</span></span>
<span class="line">    origins <span class="token operator">=</span> <span class="token string">&quot;http://localhost:3000&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    methods <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span> <span class="token class-name">RequestMethod</span><span class="token punctuation">.</span><span class="token constant">POST</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    allowCredentials <span class="token operator">=</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    maxAge <span class="token operator">=</span> <span class="token number">3600</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h5 id="方法-2-全局配置-cors" tabindex="-1"><a class="header-anchor" href="#方法-2-全局配置-cors"><span>方法 2：全局配置 CORS</span></a></h5><p>创建一个配置类，全局允许 CORS。</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Configuration</span></span>
<span class="line"><span class="token annotation punctuation">@EnableWebMvc</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CorsConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addCorsMappings</span><span class="token punctuation">(</span><span class="token class-name">CorsRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        registry<span class="token punctuation">.</span><span class="token function">addMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/api/**&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 匹配的路径</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">allowedOriginPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:3000&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 允许的源</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;PUT&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;DELETE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OPTIONS&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">allowedHeaders</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">allowCredentials</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// 允许携带 Cookie</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">maxAge</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 预检请求缓存时间</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>⚠️ 注意：</p><ul><li><code>@EnableWebMvc</code> 会完全接管 Spring MVC 的默认配置，<strong>谨慎使用</strong>。如果只是加 CORS，建议不用它。</li><li>更好的做法是<strong>不加 <code>@EnableWebMvc</code></strong>，直接实现 <code>WebMvcConfigurer</code>，Spring Boot 会保留默认配置并叠加你的设置。</li></ul></blockquote><p>所以更安全的写法是：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Configuration</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CorsConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addCorsMappings</span><span class="token punctuation">(</span><span class="token class-name">CorsRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        registry<span class="token punctuation">.</span><span class="token function">addMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/api/**&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">allowedOriginPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:3000&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">allowedHeaders</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">allowCredentials</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">maxAge</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h5 id="方法-3-使用过滤器-filter" tabindex="-1"><a class="header-anchor" href="#方法-3-使用过滤器-filter"><span>方法 3：使用过滤器（Filter）</span></a></h5><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Component</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CorsFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> res<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">HttpServletResponse</span> response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span> res<span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> req<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://localhost:3000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Methods&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GET, POST, PUT, DELETE, OPTIONS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Max-Age&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3600&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Headers&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Credentials&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;OPTIONS&quot;</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            response<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">.</span><span class="token constant">SC_OK</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">            chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>优点</strong>：快速见效。</p></li><li><p><strong>缺点</strong>：生产环境不能随意开启，存在安全风险。</p></li></ul></li></ol><hr><h4 id="二、生产环境-production-environment" tabindex="-1"><a class="header-anchor" href="#二、生产环境-production-environment"><span>二、生产环境 (Production Environment)</span></a></h4><p>在生产环境中，通常通过域名部署，解决方案更注重安全性和稳定性。</p><h5 id="常用解决方案-1" tabindex="-1"><a class="header-anchor" href="#常用解决方案-1"><span>常用解决方案：</span></a></h5><ol><li><p><strong>Nginx 反向代理</strong></p><ul><li><p><strong>原理</strong>：使用 Nginx 作为前端和后端的统一入口。将前端静态资源和后端 API 都代理到同一个域名下，从而避免跨域。</p></li><li><p>配置示例：</p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx" data-title="nginx"><pre><code><span class="line"> <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> yourdomain.com</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 前端静态资源</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">root</span> /path/to/your/frontend/dist</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># API 接口代理到后端服务</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /api/</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_pass</span> http://localhost:5000/</span><span class="token punctuation">;</span> <span class="token comment"># 后端服务地址</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>优点</strong>：最推荐的生产环境方案，安全、高效、可扩展。</p></li><li><p><strong>缺点</strong>：需要额外的服务器配置。</p></li></ul></li><li><p><strong>后端精确配置 CORS</strong></p><ul><li><p><strong>原理</strong>：在生产环境中，后端可以安全地配置 CORS，只允许来自你正式域名的请求。</p></li><li><p>示例：</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Configuration</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductionCorsConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${frontend.origin}&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 可以从 application.yml 读取</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">String</span> frontendOrigin<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Override</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addCorsMappings</span><span class="token punctuation">(</span><span class="token class-name">CorsRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        registry<span class="token punctuation">.</span><span class="token function">addMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/api/**&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">allowedOriginPatterns</span><span class="token punctuation">(</span>frontendOrigin<span class="token punctuation">)</span> <span class="token comment">// 如 https://www.yourapp.com</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;PUT&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;DELETE&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">allowedHeaders</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">allowCredentials</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">.</span><span class="token function">maxAge</span><span class="token punctuation">(</span><span class="token number">3600</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>优点</strong>：直接在应用层控制。</p></li><li><p><strong>缺点</strong>：如果前端和后端完全分离部署，仍需确保 CORS 配置正确，且不如反向代理“彻底”解决跨域。</p></li></ul></li><li><p><strong>使用 JSONP (仅限 GET 请求)</strong></p><ul><li><strong>原理</strong>：利用 <code>&lt;script&gt;</code> 标签不受同源策略限制的特性，通过动态创建 script 标签来请求数据。</li><li><strong>缺点</strong>：只支持 GET 请求，安全性较差，已被现代技术（如 CORS）取代。</li><li><strong>结论</strong>：<strong>不推荐</strong>在新项目中使用。</li></ul></li><li><p><strong>前后端同域部署</strong></p><ul><li><strong>原理</strong>：将前端静态文件和后端服务部署在同一个域名和端口下。例如，后端服务同时提供 API 和静态文件。</li><li><strong>示例</strong>：Spring Boot 项目将 <code>dist</code> 目录下的文件放在 <code>src/main/resources/static</code> 下。</li><li><strong>优点</strong>：彻底避免跨域。</li><li><strong>缺点</strong>：耦合度高，不利于前后端独立部署和扩展。</li></ul></li></ol><hr><h4 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h4><table><thead><tr><th>环境</th><th>推荐方案</th><th>备选方案</th></tr></thead><tbody><tr><td><strong>开发环境</strong></td><td>前端开发服务器代理 (Proxy)</td><td>后端开启 CORS</td></tr><tr><td><strong>生产环境</strong></td><td>Nginx 反向代理</td><td>后端精确配置 CORS / 同域部署</td></tr></tbody></table><p><strong>最佳实践</strong>：</p><ul><li>开发时用 <strong>Vite/Webpack 代理</strong>。</li><li>生产时用 <strong>Nginx 反向代理</strong>，实现前后端同域，既解决了跨域，又提升了性能和安全性。</li></ul><h3 id="避免以明文形式传输密码等重要信息" tabindex="-1"><a class="header-anchor" href="#避免以明文形式传输密码等重要信息"><span>避免以明文形式传输密码等重要信息</span></a></h3><h3 id="组件component和布局layout的区别" tabindex="-1"><a class="header-anchor" href="#组件component和布局layout的区别"><span>组件Component和布局layout的区别</span></a></h3><h3 id="eletron本地sqlite缓存的实现" tabindex="-1"><a class="header-anchor" href="#eletron本地sqlite缓存的实现"><span>eletron本地sqlite缓存的实现</span></a></h3><h3 id="router-view-实现区域页面跳转" tabindex="-1"><a class="header-anchor" href="#router-view-实现区域页面跳转"><span><code>&lt;router-view&gt;</code>实现区域页面跳转</span></a></h3><h3 id="sqlite简易sql脚手架的实现" tabindex="-1"><a class="header-anchor" href="#sqlite简易sql脚手架的实现"><span>sqlite简易sql脚手架的实现</span></a></h3><h4 id="数据库表以及字段的提取以及对象映射-驼峰转换-的实现" tabindex="-1"><a class="header-anchor" href="#数据库表以及字段的提取以及对象映射-驼峰转换-的实现"><span>数据库表以及字段的提取以及对象映射（驼峰转换）的实现</span></a></h4><h4 id="sql基础语句的拼接以及执行" tabindex="-1"><a class="header-anchor" href="#sql基础语句的拼接以及执行"><span>sql基础语句的拼接以及执行</span></a></h4><h3 id="回到底部" tabindex="-1"><a class="header-anchor" href="#回到底部"><span>回到底部</span></a></h3><p><code>@scroll</code>可以监听滑轮滚动，给出监听位置方法：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token comment">// 处理滚动事件，检测是否在底部</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">handleScroll</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> messagePanel <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;message-panel1&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>messagePanel<span class="token punctuation">)</span> <span class="token keyword">return</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 计算是否在底部（允许一定误差）</span></span>
<span class="line">  <span class="token keyword">const</span> threshold <span class="token operator">=</span> <span class="token number">50</span> <span class="token comment">// 距离底部50px以内认为是在底部</span></span>
<span class="line">  <span class="token keyword">const</span> atBottom <span class="token operator">=</span> messagePanel<span class="token punctuation">.</span>scrollHeight <span class="token operator">-</span> messagePanel<span class="token punctuation">.</span>clientHeight <span class="token operator">&lt;=</span> messagePanel<span class="token punctuation">.</span>scrollTop <span class="token operator">+</span> threshold</span>
<span class="line">  isAtBottom<span class="token punctuation">.</span>value <span class="token operator">=</span> atBottom</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>每次滚动都会判断是否在底部，在就将<code>isAtBottom</code>赋为true，反之为false，通过<code>v-show</code>判断是否展示</p><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html" data-title="html"><pre><code><span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message-panel<span class="token punctuation">&quot;</span></span></span>
<span class="line">             <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message-panel1<span class="token punctuation">&quot;</span></span></span>
<span class="line">             <span class="token attr-name">@scroll</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleScroll<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            ......</span>
<span class="line">            <span class="token comment">&lt;!-- 回到底部按钮 --&gt;</span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>!isAtBottom<span class="token punctuation">&quot;</span></span></span>
<span class="line">                 <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>back-to-bottom<span class="token punctuation">&quot;</span></span></span>
<span class="line">                 <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>gotoBottom<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line">              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont icon-down<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="常见错误-套层" tabindex="-1"><a class="header-anchor" href="#常见错误-套层"><span>常见错误：套层</span></a></h3><p>有时候取不到值变成undefined可能是因为获取到的结构外部又套了一层，打开控制面板console一下看看结构。</p><p>注意函数的读取方式，当直接使用<code>data</code>时，有可能获取到的是一个对象，会有嵌套，<code>data.data</code>才是真正的数据。如果需要一开始就解析出内容，而非使用通用对象包装接收，那就使用<code>{data}</code>来接收数据。但要注意这种方式，你所填写的接收字段名称必须与发送的一致，否则会undefined。</p><h3 id="本项目怎么实现的文件图片视频等传输" tabindex="-1"><a class="header-anchor" href="#本项目怎么实现的文件图片视频等传输"><span>本项目怎么实现的文件图片视频等传输？</span></a></h3><p>当发送时，首先在本地数据库中记录该条记录，设置信息类型为文件；同时消息发送到服务器获取到messageId，并对文件做转码处理（如果有需要），获取封面，将两个文件存储到本地路径（users/{username}/.{项目名称}/fileStorage/{messageId}），并将两个文件上传到服务器。当两个文件上传完成时，后端会发送消息通知已经上传完成，前端修改视频的加载状态。</p><p>当接收时，</p><h3 id="本地文件存储与读取" tabindex="-1"><a class="header-anchor" href="#本地文件存储与读取"><span>本地文件存储与读取</span></a></h3><p>Eletron可以选择使用包装好的脚手架fs</p><p>当app获取一些文件（头像，图片）时，会通过express尝试从本地获取，如没有，则会尝试从服务器获取</p><h3 id="promise是什么-resolve又是什么-怎么用" tabindex="-1"><a class="header-anchor" href="#promise是什么-resolve又是什么-怎么用"><span>Promise是什么？resolve又是什么？怎么用？</span></a></h3><h3 id="视频文件是怎么截取封面的" tabindex="-1"><a class="header-anchor" href="#视频文件是怎么截取封面的"><span>视频文件是怎么截取封面的？</span></a></h3><h4 id="ffmpeg" tabindex="-1"><a class="header-anchor" href="#ffmpeg"><span>ffmpeg</span></a></h4><h3 id="node的express是什么-为什么选择使用它作为本地文件处理器" tabindex="-1"><a class="header-anchor" href="#node的express是什么-为什么选择使用它作为本地文件处理器"><span>node的express是什么？为什么选择使用它作为本地文件处理器？</span></a></h3><p>本项目主要用于管理本地文件</p><p>登录后生成express服务器</p><h3 id="文件更新逻辑混乱" tabindex="-1"><a class="header-anchor" href="#文件更新逻辑混乱"><span>文件更新逻辑混乱</span></a></h3><p>对于需要修改的文件，如更新后的头像，项目中没有选择使用每次修改更新就进行本地文件修改的方式来实现对本地图片缓存的修改，而是选择了上传完服务器之后，假如需要修改本地文件，再重新从服务器获取新的文件来覆盖本地文件，这种修改模式非常混乱，不利于后续更新维护。</p><p>之所以这么设计，其实只是懒。对于头像的更新，代码中给出了方案是在每次使用头像组件时，会检查输入参数forceget是否为true，若为true，那么就会直接从服务器下载并覆盖本地；反之，会现在本地找，找不到去服务器下，下不到就是用默认头像。为了偷懒，就直接在上传完头像后用store将自己的forceget设置为true来再次重新从服务器下载本就有的本地头像图片实现对自己头像的更新覆盖，这种做法的逻辑相对来说更加繁杂，且占用了服务器额外的带宽。</p><p>更加清晰的做法是更新头像就直接更新本地的原有头像文件，然后只需要上传到服务器即可，这样更加合适一点。</p><h3 id="视频-图片预览查看器" tabindex="-1"><a class="header-anchor" href="#视频-图片预览查看器"><span>视频，图片预览查看器</span></a></h3>`,50)),s("p",null,[s("a",r,[n[0]||(n[0]=a("web前端：Viewer.js图片查看器 - 知乎",-1)),t(p)])]),s("p",null,[s("a",d,[n[1]||(n[1]=a("强大的图片预览组件Viewer.js-阿里云开发者社区",-1)),t(p)])]),s("p",null,[n[3]||(n[3]=a("视频播放器",-1)),s("a",k,[n[2]||(n[2]=a("指南 | DPlayer",-1)),t(p)])]),n[5]||(n[5]=e(`<p>项目选择使用ipc通知主线程附上参数生成新窗口（根据vue路由获取到renderer里的组件），</p><h4 id="问题" tabindex="-1"><a class="header-anchor" href="#问题"><span>问题</span></a></h4><h5 id="视频快进等任何操作直接回到最开始" tabindex="-1"><a class="header-anchor" href="#视频快进等任何操作直接回到最开始"><span>视频快进等任何操作直接回到最开始</span></a></h5><p>对于视频，音频等文件，我们只是直接request从后端得到的文件存在问题，需要额外处理（断点续传）</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line">	<span class="token keyword">let</span> stat <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>localPath<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 使用 fs.statSync 同步获取文件的统计信息，包括文件大小等属性</span></span>
<span class="line">	<span class="token keyword">let</span> fileSize <span class="token operator">=</span> stat<span class="token punctuation">.</span>size<span class="token punctuation">;</span></span>
<span class="line">	<span class="token keyword">let</span> range <span class="token operator">=</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>range<span class="token punctuation">;</span>	<span class="token comment">// 从HTTP请求头中获取 range 字段，用于判断是否为范围请求（断点续传）</span></span>
<span class="line">	<span class="token keyword">if</span> <span class="token punctuation">(</span>range<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">let</span> parts <span class="token operator">=</span> range<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">bytes=</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;-&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 去除范围请求中的 &quot;bytes=&quot; 前缀，并按 &quot;-&quot; 分割获取起始和结束位置</span></span>
<span class="line">		<span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>parts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">		<span class="token keyword">let</span> end <span class="token operator">=</span> parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>parts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">:</span> start <span class="token operator">+</span> <span class="token number">99999</span><span class="token punctuation">;</span> 	<span class="token comment">// 如果有结束位置则解析，否则默认请求从起始位置开始的100000字节</span></span>
<span class="line">		end <span class="token operator">=</span> end <span class="token operator">&gt;</span> fileSize <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">?</span> fileSize <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> end<span class="token punctuation">;</span> 	<span class="token comment">// 确保结束位置不超过文件大小</span></span>
<span class="line">		<span class="token keyword">let</span> chunksize <span class="token operator">=</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">		<span class="token keyword">let</span> stream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>localPath<span class="token punctuation">,</span> <span class="token punctuation">{</span> start<span class="token punctuation">,</span> end <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 创建文件读取流，只读取指定范围内的内容</span></span>
<span class="line">		<span class="token keyword">let</span> head <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token string-property property">&#39;Content-Range&#39;</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">bytes </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>start<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>end<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>fileSize<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>			<span class="token comment">// 返回请求的区间</span></span>
<span class="line">			<span class="token string-property property">&#39;Accept-Ranges&#39;</span><span class="token operator">:</span> <span class="token string">&#39;bytes&#39;</span><span class="token punctuation">,</span>																	<span class="token comment">// 表示服务器支持范围请求</span></span>
<span class="line">			<span class="token string-property property">&#39;Content-Length&#39;</span><span class="token operator">:</span> chunksize<span class="token punctuation">,</span>															<span class="token comment">// 返回请求的区间大小										</span></span>
<span class="line">			<span class="token string-property property">&#39;Content-Type&#39;</span><span class="token operator">:</span> <span class="token string">&#39;video/mp4&#39;</span>																<span class="token comment">// 响应文件类型为视频							</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">		res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">206</span><span class="token punctuation">,</span> head<span class="token punctuation">)</span><span class="token punctuation">;</span>																		<span class="token comment">// 返回206状态码，表示206状态码表示部分内容返回</span></span>
<span class="line">		stream<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>																					  <span class="token comment">// 将文件内容写入响应</span></span>
<span class="line">	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token keyword">let</span> head <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">			<span class="token string-property property">&#39;Content-Length&#39;</span><span class="token operator">:</span> fileSize<span class="token punctuation">,</span></span>
<span class="line">			<span class="token string-property property">&#39;Content-Type&#39;</span><span class="token operator">:</span> <span class="token string">&#39;video/mp4&#39;</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">		res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> head<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">		fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>localPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="拖拽上传" tabindex="-1"><a class="header-anchor" href="#拖拽上传"><span>拖拽上传</span></a></h3><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html" data-title="html"><pre><code><span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>input-area<span class="token punctuation">&quot;</span></span></span>
<span class="line">         <span class="token attr-name">@drop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropHandler<span class="token punctuation">&quot;</span></span></span>
<span class="line">         <span class="token attr-name">@dragover</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dragOverHandler<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>vue本身实现了拖拽上传功能，只需实现对应的方法即可实现此功能</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">const</span> <span class="token function-variable function">dragOverHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">dropHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">const</span> files <span class="token operator">=</span> event<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>files</span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">checkFileLimit</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">uploadFileDo</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="滚动懒加载" tabindex="-1"><a class="header-anchor" href="#滚动懒加载"><span>滚动懒加载</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token comment">// 加载消息记录，滚动懒加载</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">loadChatMessage</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 如果没有更多数据，则返回</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>messageCountInfo<span class="token punctuation">.</span>noData<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token comment">// 每次滚动加载后变化页码</span></span>
<span class="line">  messageCountInfo<span class="token punctuation">.</span>pageNo<span class="token operator">++</span></span>
<span class="line">  <span class="token comment">// ipc获取数据</span></span>
<span class="line">  <span class="token keyword">const</span> <span class="token punctuation">{</span> dataList<span class="token punctuation">,</span> pageTotal<span class="token punctuation">,</span> pageNo <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> window<span class="token punctuation">.</span>ipcRenderer<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">&#39;loadChatMessage&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">sessionId</span><span class="token operator">:</span> currentChatSession<span class="token punctuation">.</span>value<span class="token punctuation">.</span>sessionId<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">pageNo</span><span class="token operator">:</span> messageCountInfo<span class="token punctuation">.</span>pageNo<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">maxMessageId</span><span class="token operator">:</span> messageCountInfo<span class="token punctuation">.</span>maxMessageId</span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  messageList<span class="token punctuation">.</span>value <span class="token operator">=</span> dataList<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>messageList<span class="token punctuation">.</span>value<span class="token punctuation">)</span></span>
<span class="line">  messageList<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> a<span class="token punctuation">.</span>messageId <span class="token operator">-</span> b<span class="token punctuation">.</span>messageId<span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;加载消息记录&#39;</span><span class="token punctuation">,</span> messageList<span class="token punctuation">.</span>value<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  messageCountInfo<span class="token punctuation">.</span>pageNo <span class="token operator">=</span> pageNo</span>
<span class="line">  messageCountInfo<span class="token punctuation">.</span>pageTotal <span class="token operator">=</span> pageTotal</span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>pageNo <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    messageCountInfo<span class="token punctuation">.</span>maxMessageId <span class="token operator">=</span></span>
<span class="line">      dataList<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> dataList<span class="token punctuation">[</span>dataList<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>messageId <span class="token operator">:</span> <span class="token keyword">null</span></span>
<span class="line"></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过分页的方式来实现，每次触发pageNum++，这个方法可以被一些监听事件使用，比如当滚动到头部时就会执行此方法以加载数据</p><h4 id="怎么避免一开始在顶部导致直接加载两次数据" tabindex="-1"><a class="header-anchor" href="#怎么避免一开始在顶部导致直接加载两次数据"><span>怎么避免一开始在顶部导致直接加载两次数据</span></a></h4><p>可以加入一个标志位标记是否需要加载：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token comment">// 添加一个标志来标识是否是初始加载</span></span>
<span class="line"><span class="token keyword">const</span> isInitialLoading <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 修改 handleScroll 函数</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">handleScroll</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> messagePanel <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;message-panel1&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>messagePanel<span class="token punctuation">)</span> <span class="token keyword">return</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 计算是否在底部（允许一定误差）</span></span>
<span class="line">  <span class="token keyword">const</span> threshold <span class="token operator">=</span> <span class="token number">50</span> <span class="token comment">// 距离底部50px以内认为是在底部</span></span>
<span class="line">  <span class="token keyword">const</span> atBottom <span class="token operator">=</span> messagePanel<span class="token punctuation">.</span>scrollHeight <span class="token operator">-</span> messagePanel<span class="token punctuation">.</span>clientHeight <span class="token operator">&lt;=</span> messagePanel<span class="token punctuation">.</span>scrollTop <span class="token operator">+</span> threshold</span>
<span class="line">  isAtBottom<span class="token punctuation">.</span>value <span class="token operator">=</span> atBottom</span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 检查是否滚动到顶部以加载更多聊天记录，但要排除初始加载的情况</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>messagePanel<span class="token punctuation">.</span>scrollTop <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>messageCountInfo<span class="token punctuation">.</span>noData <span class="token operator">&amp;&amp;</span> </span>
<span class="line">      messageList<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isInitialLoading<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token function">loadChatMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 修改 chatSessionClickHandler 函数</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">chatSessionClickHandler</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  currentChatSession<span class="token punctuation">.</span>value <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span></span>
<span class="line">  <span class="token comment">// TODO 消息记录要清空</span></span>
<span class="line">  messageList<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">  messageCountInfo<span class="token punctuation">.</span>pageTotal <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">  messageCountInfo<span class="token punctuation">.</span>pageNo <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line">  messageCountInfo<span class="token punctuation">.</span>maxMessageId <span class="token operator">=</span> <span class="token keyword">null</span></span>
<span class="line">  messageCountInfo<span class="token punctuation">.</span>noData <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// 设置初始加载标志</span></span>
<span class="line">  isInitialLoading<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line">  </span>
<span class="line">  <span class="token keyword">await</span> <span class="token function">setSessionSelect</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">contactId</span><span class="token operator">:</span> item<span class="token punctuation">.</span>contactId<span class="token punctuation">,</span> <span class="token literal-property property">sessionId</span><span class="token operator">:</span> item<span class="token punctuation">.</span>sessionId <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">await</span> <span class="token function">loadChatMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment">// 初始加载完成后，延迟取消标志，确保不会立即触发滚动加载，setTimeout 是异步函数，不会阻塞后续代码的执行</span></span>
<span class="line">  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    isInitialLoading<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">gotoBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token function">handleScroll</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到我们加了一个<code>isInitialLoading</code>来判断此时是否是初始加载，当我们点击一个会话，进入会话后，会短暂的设置这个标志位为true，这段时间，滚轮监听<code>handleScroll</code>的<code>loadChatMessage</code>将会因为这个标志位为true而无法执行，而<code>chatSessionClickHandler</code>的第一次加载是不会判断<code>isInitialLoading</code>的。当然，进入<code>chatSessionClickHandler</code>的第一次<code>loadChatMessage</code>加载是不会被阻塞的：</p><h3 id="未读消息的管理" tabindex="-1"><a class="header-anchor" href="#未读消息的管理"><span>未读消息的管理</span></a></h3><p>修改：contact页面同样监听是否有好友申请，有则刷新页面，添加红点；一些监听逻辑存在问题：如当在contact页面时chat的未读消息无法获取到。一些公共的事件最好还是放到main做监听比较好，否则会导致store无法正常更新或者通知无法正常显示</p><h3 id="eletron托盘自定义" tabindex="-1"><a class="header-anchor" href="#eletron托盘自定义"><span>eletron托盘自定义</span></a></h3><h3 id="应用更新的方式" tabindex="-1"><a class="header-anchor" href="#应用更新的方式"><span>应用更新的方式</span></a></h3><h3 id="简单搜索关键字" tabindex="-1"><a class="header-anchor" href="#简单搜索关键字"><span>简单搜索关键字</span></a></h3><p>直接使用contains来对输入查询内容作模糊查询，项目选择查询联系人名称以及最后一条消息的内容。</p><p>可以通过正则的方式来实现对关键字部分的标记：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>contactName<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>searchKey<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token operator">||</span> item<span class="token punctuation">.</span>lastMessage<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>searchKey<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">let</span> newData <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span></span>
<span class="line">      <span class="token comment">// 设置关键字区块高亮</span></span>
<span class="line">      newData<span class="token punctuation">.</span>searchContactName <span class="token operator">=</span> newData<span class="token punctuation">.</span>contactName<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span></span>
<span class="line">        regex<span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&quot;&lt;span class=&#39;highlight&#39;&gt;$1&lt;/span&gt;&quot;</span></span>
<span class="line">      <span class="token punctuation">)</span></span>
<span class="line">      newData<span class="token punctuation">.</span>searchLastMessage <span class="token operator">=</span> newData<span class="token punctuation">.</span>lastMessage<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span></span>
<span class="line">        regex<span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&quot;&lt;span class=&#39;highlight&#39;&gt;$1&lt;/span&gt;&quot;</span></span>
<span class="line">      <span class="token punctuation">)</span></span>
<span class="line">      searchList<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>newData<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当然也可以选择使用elasticsearch等更加强大的工具来实现搜索功能。</p><h3 id="群的头像点击后存在问题" tabindex="-1"><a class="header-anchor" href="#群的头像点击后存在问题"><span>群的头像点击后存在问题</span></a></h3><h3 id="点击后激活状态css样式" tabindex="-1"><a class="header-anchor" href="#点击后激活状态css样式"><span>点击后激活状态css样式</span></a></h3><p>可以添加一个.active样式名称并配置相关样式</p><h3 id="注意主线程axios和渲染线程的axios存在区别" tabindex="-1"><a class="header-anchor" href="#注意主线程axios和渲染线程的axios存在区别"><span>注意主线程axios和渲染线程的axios存在区别</span></a></h3><p>比方说请求头里面的userAgent：</p><ol><li><strong>主进程</strong>： <ul><li>运行在 Node.js 环境中</li><li>使用 axios 等库发起请求时，默认 User-Agent 是 Node.js 提供的字符串（例如 <code>axios/x.x.x</code>）</li><li>不会自动携带浏览器中常见的 User-Agent 信息</li></ul></li><li><strong>渲染进程</strong>： <ul><li>运行在 Chromium 浏览器环境中</li><li>发起请求时自动使用浏览器的 User-Agent，通常包含 Electron 和操作系统的相关信息</li></ul></li></ol><p>所以对于验证消息还是自行获取的动态数据好，当然如果就想要在主线程中使用userAgent来作为验证消息，也可以ipc通信，将渲染线程获取到的传给主线程，主线程用eletron的store存一下，每次需要发了从里面取，7</p><p>而且，如果需要为主线程的axios配备请求前拦截器等，记得给主线程自己配一个（或者干脆用渲染线程的）</p>`,33))])}const b=l(u,[["render",v]]),h=JSON.parse('{"path":"/docs/wx/qianduanbufen/yudaodewenti（qianduan.html","title":"遇到的问题（前端）","lang":"en-US","frontmatter":{"title":"遇到的问题（前端）","date":"2025-11-28T00:00:00.000Z"},"headers":[{"level":3,"title":"跨域了怎么办","slug":"跨域了怎么办","link":"#跨域了怎么办","children":[]},{"level":3,"title":"避免以明文形式传输密码等重要信息","slug":"避免以明文形式传输密码等重要信息","link":"#避免以明文形式传输密码等重要信息","children":[]},{"level":3,"title":"组件Component和布局layout的区别","slug":"组件component和布局layout的区别","link":"#组件component和布局layout的区别","children":[]},{"level":3,"title":"eletron本地sqlite缓存的实现","slug":"eletron本地sqlite缓存的实现","link":"#eletron本地sqlite缓存的实现","children":[]},{"level":3,"title":"<router-view>实现区域页面跳转","slug":"router-view-实现区域页面跳转","link":"#router-view-实现区域页面跳转","children":[]},{"level":3,"title":"sqlite简易sql脚手架的实现","slug":"sqlite简易sql脚手架的实现","link":"#sqlite简易sql脚手架的实现","children":[]},{"level":3,"title":"回到底部","slug":"回到底部","link":"#回到底部","children":[]},{"level":3,"title":"常见错误：套层","slug":"常见错误-套层","link":"#常见错误-套层","children":[]},{"level":3,"title":"本项目怎么实现的文件图片视频等传输？","slug":"本项目怎么实现的文件图片视频等传输","link":"#本项目怎么实现的文件图片视频等传输","children":[]},{"level":3,"title":"本地文件存储与读取","slug":"本地文件存储与读取","link":"#本地文件存储与读取","children":[]},{"level":3,"title":"Promise是什么？resolve又是什么？怎么用？","slug":"promise是什么-resolve又是什么-怎么用","link":"#promise是什么-resolve又是什么-怎么用","children":[]},{"level":3,"title":"视频文件是怎么截取封面的？","slug":"视频文件是怎么截取封面的","link":"#视频文件是怎么截取封面的","children":[]},{"level":3,"title":"node的express是什么？为什么选择使用它作为本地文件处理器？","slug":"node的express是什么-为什么选择使用它作为本地文件处理器","link":"#node的express是什么-为什么选择使用它作为本地文件处理器","children":[]},{"level":3,"title":"文件更新逻辑混乱","slug":"文件更新逻辑混乱","link":"#文件更新逻辑混乱","children":[]},{"level":3,"title":"视频，图片预览查看器","slug":"视频-图片预览查看器","link":"#视频-图片预览查看器","children":[]},{"level":3,"title":"拖拽上传","slug":"拖拽上传","link":"#拖拽上传","children":[]},{"level":3,"title":"滚动懒加载","slug":"滚动懒加载","link":"#滚动懒加载","children":[]},{"level":3,"title":"未读消息的管理","slug":"未读消息的管理","link":"#未读消息的管理","children":[]},{"level":3,"title":"eletron托盘自定义","slug":"eletron托盘自定义","link":"#eletron托盘自定义","children":[]},{"level":3,"title":"应用更新的方式","slug":"应用更新的方式","link":"#应用更新的方式","children":[]},{"level":3,"title":"简单搜索关键字","slug":"简单搜索关键字","link":"#简单搜索关键字","children":[]},{"level":3,"title":"群的头像点击后存在问题","slug":"群的头像点击后存在问题","link":"#群的头像点击后存在问题","children":[]},{"level":3,"title":"点击后激活状态css样式","slug":"点击后激活状态css样式","link":"#点击后激活状态css样式","children":[]},{"level":3,"title":"注意主线程axios和渲染线程的axios存在区别","slug":"注意主线程axios和渲染线程的axios存在区别","link":"#注意主线程axios和渲染线程的axios存在区别","children":[]}],"git":{"createdTime":1771237270000,"updatedTime":1771237270000,"contributors":[{"name":"SaltFishGC","email":"130335482+SaltFishGC@users.noreply.github.com","commits":1}]},"filePathRelative":"docs/wx/前端部分/遇到的问题（前端.md"}');export{b as comp,h as data};
