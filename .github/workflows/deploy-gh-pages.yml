name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main # 当推送到 main 分支时触发 CI/CD 流程

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout 源码
        uses: actions/checkout@v4

      - name: 设置 Node.js 环境
        uses: actions/setup-node@v3
        with:
          node-version: '18' # 根据你的项目需求选择版本

      - name: 安装 npm 依赖
        run: npm install

      - name: 构建 & 部署
        run: |
          npm run build
          chmod +x deploy.sh # 给 deploy.sh 添加可执行权限
          ./deploy.sh

      - name: 推送 dist 到 gh-pages 分支
        run: |
          cd .vuepress/dist
          git remote add origin-gh-pages git@github.com:SaltFishGC/SaltFishGC.github.io.git
          git push -f origin-gh-pages main:gh-pages
        env:
          SSH_AUTH_SOCK: /tmp/ssh_agent.sock